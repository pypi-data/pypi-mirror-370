{% load wagtailimages_tags %}

<section class="contato-secao" style="background-color: {{ value.cor_fundo }};">
    <div class="contato-container">
        <div class="contato-grid">
            <!-- Lado Esquerdo: Imagem -->
            <div class="contato-imagem">
                <div class="form-cabecalho">
                    {% if value.titulo_principal %}
                        <h2 class="form-titulo" style="color: {{ value.cor_titulo }};">
                            {{ value.titulo_principal }}
                        </h2>
                    {% else %}
                        <p>Título não definido</p>  <!-- Linha de depuração -->
                    {% endif %}

                    {% if value.subtitulo %}
                        <h3 class="form-subtitulo" style="color: {{ value.cor_subtitulo }};">
                            {{ value.subtitulo }}
                        </h3>
                    {% endif %}
                </div>
                {% if value.imagem %}
                    {% image value.imagem width-600 as contact_img %}
                    <img src="{{ contact_img.url }}" 
                         alt="{{ value.alt_imagem }}"
                         class="imagem-contato">
                {% endif %}
                {% if value.botoes %}
            <div class="material-apoio-botoes">
                {% for botao_block in value.botoes %}
                    {% if botao_block.block_type == 'botao' %}
                        <a href="{{ botao_block.value.link }}" 
                        class="material-apoio-botao" 
                        target="_blank"
                        style="background-color: {{ botao_block.value.cor_fundo }};"
                        onmouseover="this.style.backgroundColor='{{ botao_block.value.cor_hover }}'"
                        onmouseout="this.style.backgroundColor='{{ botao_block.value.cor_fundo }}'">
                        {{ botao_block.value.texto }}
                        </a>
                    {% endif %}
                {% endfor %}
            </div>
        {% endif %}
            </div>
            
            <!-- Lado Direito: Formulário -->
            <div class="contato-formulario">
                
                <!-- Formulário -->
                <form class="form-contato" id="contatoForm" onsubmit="enviarFormulario(event)">
                    <div class="campo-grupo">
                        <input type="text" 
                               id="nome" 
                               name="nome" 
                               placeholder="Digite seu nome"
                               class="form-input"
                               required>
                    </div>
                    
                    <div class="campo-grupo">
                        <input type="email" 
                               id="email" 
                               name="email" 
                               placeholder="Digite seu e-mail"
                               class="form-input"
                               required>
                    </div>
                    
                    <div class="campo-grupo">
                        <textarea id="mensagem" 
                                  name="mensagem" 
                                  placeholder="Entre com sua mensagem"
                                  class="form-textarea"
                                  rows="5"
                                  required></textarea>
                    </div>
                    
                    <button type="submit" 
                            class="form-botao" 
                            style="background-color: {{ value.cor_botao }};">
                        {{ value.texto_botao }}
                    </button>
                </form>
            </div>
        </div>
    </div>
</section>


<script>
function enviarFormulario(event) {
    event.preventDefault();
    
    const form = event.target;
    const botao = form.querySelector('.form-botao');
    const textoOriginal = botao.textContent;
    
    // Remover mensagens anteriores
    const mensagemAnterior = form.parentNode.querySelector('.form-sucesso, .form-erro');
    if (mensagemAnterior) {
        mensagemAnterior.remove();
    }
    
    // Estado de carregamento
    form.classList.add('form-enviando');
    botao.textContent = 'Enviando...';
    botao.disabled = true;
    
    // Simular envio (substituir por integração real)
    setTimeout(() => {
        // Resetar estado
        form.classList.remove('form-enviando');
        botao.textContent = textoOriginal;
        botao.disabled = false;
        
        // Simular sucesso (90% das vezes)
        if (Math.random() > 0.1) {
            // Sucesso
            const mensagemSucesso = document.createElement('div');
            mensagemSucesso.className = 'form-sucesso';
            mensagemSucesso.textContent = 'Mensagem enviada com sucesso! Entraremos em contato em breve.';
            form.parentNode.appendChild(mensagemSucesso);
            
            // Limpar formulário
            form.reset();
            
            // Remover mensagem após 5 segundos
            setTimeout(() => {
                mensagemSucesso.remove();
            }, 5000);
        } else {
            // Erro
            const mensagemErro = document.createElement('div');
            mensagemErro.className = 'form-erro';
            mensagemErro.textContent = 'Erro ao enviar mensagem. Tente novamente.';
            form.parentNode.appendChild(mensagemErro);
            
            // Remover mensagem após 5 segundos
            setTimeout(() => {
                mensagemErro.remove();
            }, 5000);
        }
    }, 2000);
}
</script>