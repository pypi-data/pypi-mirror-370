# Redis State Management Configuration for MAOS
# Production-ready configuration with performance optimization

redis_state:
  # Redis Connection Settings
  connection:
    # List of Redis URLs (cluster or single instance)
    urls:
      - "redis://localhost:6379"
      - "redis://localhost:6380"  # Add more for cluster mode
      - "redis://localhost:6381"
    
    # Enable cluster mode for high availability
    cluster_mode: true
    
    # Connection pool settings
    max_connections: 100
    retry_on_timeout: true
    health_check_interval: 30
    socket_keepalive: true
    socket_keepalive_options:
      TCP_KEEPIDLE: 1
      TCP_KEEPINTVL: 3
      TCP_KEEPCNT: 5
  
  # Memory Pool Configuration
  memory_pool:
    # Total memory pool size in GB
    total_size_gb: 10
    
    # Default partition size in MB
    default_partition_size_mb: 100
    
    # Memory cleanup interval in seconds
    cleanup_interval: 300
    
    # Enable quota enforcement
    quota_enforcement: true
    
    # Memory allocation strategies
    allocation_strategy: "best_fit"  # best_fit, first_fit, worst_fit
    
    # Agent memory limits (MB)
    agent_memory_limits:
      default: 500
      high_priority: 1000
      background: 200
  
  # Performance Settings
  performance:
    # Operation timeout in seconds
    operation_timeout: 30.0
    
    # Maximum retries for failed operations
    max_retries: 3
    
    # Retry delay in seconds
    retry_delay: 0.1
    
    # Bulk operation settings
    max_batch_size: 1000
    max_parallel_batches: 10
    
    # Latency targets (ms)
    target_latency_ms: 100
    max_acceptable_latency_ms: 500
  
  # Locking Configuration
  locking:
    # Default lock timeout in seconds
    default_timeout: 30
    
    # Lock cleanup interval in seconds
    cleanup_interval: 60
    
    # Maximum lock acquisition attempts
    max_lock_attempts: 5
    
    # Enable deadlock detection
    deadlock_detection: true
  
  # Versioning Settings
  versioning:
    # Maximum versions to keep per key
    max_versions_per_key: 100
    
    # Version history retention in days
    history_retention_days: 30
    
    # Enable compression for version history
    enable_compression: true
    
    # Cleanup interval for old versions
    cleanup_interval: 3600
  
  # Conflict Resolution
  conflict_resolution:
    # Default resolution strategy
    default_strategy: "last_write_wins"  # last_write_wins, first_write_wins, merge, reject
    
    # Resolution timeout in seconds
    resolution_timeout: 5.0
    
    # Maximum resolution history to keep
    max_resolution_history: 1000
    
    # Custom resolvers for specific key patterns
    custom_resolvers:
      "agents:*:state": "merge"
      "tasks:*:status": "last_write_wins"
      "resources:*:allocation": "reject"
  
  # Notification System
  notifications:
    # Buffer size for notifications
    buffer_size: 10000
    
    # Maximum delivery attempts
    max_delivery_attempts: 3
    
    # Delivery timeout in seconds
    delivery_timeout: 5.0
    
    # Batch size for notification delivery
    batch_size: 100
    
    # Enable persistent notifications
    persistent_notifications: true
  
  # Monitoring Settings
  monitoring:
    # Enable monitoring
    enabled: true
    
    # Metrics collection interval in seconds
    collection_interval: 1.0
    
    # Metrics retention in hours
    retention_hours: 24
    
    # Alert thresholds
    alert_thresholds:
      memory_usage_percentage: 80.0
      cpu_usage_percentage: 80.0
      hit_rate_percentage: 80.0
      latency_ms: 100.0
      operations_per_second: 10000.0
      connected_clients: 1000
      evictions_count_rate: 100.0
    
    # Performance baseline collection
    collect_baselines: true
    
    # Export metrics format
    export_format: "json"  # json, prometheus, csv
  
  # Backup and Recovery
  backup:
    # Enable backup functionality
    enabled: true
    
    # Backup directory
    directory: "/var/lib/maos/backups"
    
    # Enable compression
    compression: true
    
    # Encryption key (set via environment variable)
    # encryption_key: "${MAOS_BACKUP_ENCRYPTION_KEY}"
    
    # Backup retention
    max_backup_age_days: 30
    backup_retention_count: 100
    
    # Automatic backup schedule
    auto_backup:
      enabled: true
      interval_hours: 6
      incremental: true
    
    # Backup verification
    verify_backups: true
    verify_interval_hours: 24
  
  # Data Structures
  data_structures:
    # Enable advanced data structures
    enable_lists: true
    enable_sets: true
    enable_sorted_sets: true
    enable_hashes: true
    
    # Default TTL for data structures (seconds)
    default_ttl: 3600
    
    # Maximum size limits
    max_list_size: 10000
    max_set_size: 10000
    max_hash_fields: 1000
  
  # Security Settings
  security:
    # Enable authentication
    auth_enabled: true
    
    # Redis AUTH password (set via environment variable)
    # auth_password: "${REDIS_AUTH_PASSWORD}"
    
    # Enable TLS/SSL
    tls_enabled: false
    
    # TLS certificate settings
    tls_cert_file: "/etc/ssl/certs/redis.crt"
    tls_key_file: "/etc/ssl/private/redis.key"
    tls_ca_file: "/etc/ssl/certs/ca.crt"
    
    # Enable encryption for sensitive data
    encrypt_sensitive_data: true
    
    # Key rotation settings
    key_rotation:
      enabled: true
      rotation_interval_days: 90
      key_versions_to_keep: 3

# Integration Settings
integration:
  # Enable MAOS state manager integration
  maos_integration: true
  
  # Sync mode: "bidirectional", "redis_primary", "local_primary"
  sync_mode: "bidirectional"
  
  # Conflict resolution for integration
  integration_conflict_strategy: "redis_wins"
  
  # State categories to sync
  sync_categories:
    - "tasks"
    - "agents"
    - "resources"
    - "messages"
    - "checkpoints"
  
  # Performance settings for integration
  integration_performance:
    sync_batch_size: 100
    sync_interval_seconds: 1.0
    max_sync_retries: 3

# Logging Configuration
logging:
  # Log level
  level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
  
  # Log format
  format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"
  
  # Log handlers
  handlers:
    - type: "console"
      level: "INFO"
    
    - type: "file"
      level: "DEBUG"
      filename: "/var/log/maos/redis_state.log"
      max_bytes: 10485760  # 10MB
      backup_count: 5
    
    - type: "rotating_file"
      level: "ERROR"
      filename: "/var/log/maos/redis_state_errors.log"
      max_bytes: 5242880   # 5MB
      backup_count: 3
  
  # Log specific components
  component_levels:
    redis_state_manager: "INFO"
    cluster_manager: "INFO"
    lock_manager: "DEBUG"
    version_manager: "INFO"
    conflict_resolver: "INFO"
    notification_system: "INFO"
    memory_pool_manager: "INFO"
    bulk_operations_manager: "INFO"
    backup_recovery_manager: "INFO"
    monitoring: "INFO"

# Development Settings (only in development)
development:
  # Enable debug mode
  debug: false
  
  # Mock Redis for testing
  mock_redis: false
  
  # Test data generation
  generate_test_data: false
  
  # Performance profiling
  enable_profiling: false
  
  # Memory debugging
  memory_debugging: false
  
  # Trace all operations
  trace_operations: false