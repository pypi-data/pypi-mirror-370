# HOWTO: –ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É

## üéØ –û–±–∑–æ—Ä

–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É –≤ Vector Store –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫—É—é –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü–∏—é –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤. –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –≤ –≤–µ–∫—Ç–æ—Ä –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø–æ–∏—Å–∫ –ø–æ —Å—Ö–æ–¥—Å—Ç–≤—É.

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- –°–µ—Ä–≤–µ—Ä Vector Store –∑–∞–ø—É—â–µ–Ω –Ω–∞ `http://localhost:8007`
- –í —Å–∏—Å—Ç–µ–º–µ –µ—Å—Ç—å —Å–æ–∑–¥–∞–Ω–Ω—ã–µ —á–∞–Ω–∫–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞
- –ü–æ–Ω–∏–º–∞–Ω–∏–µ JSON-RPC 2.0 –ø—Ä–æ—Ç–æ–∫–æ–ª–∞

## üîç –ë–∞–∑–æ–≤—ã–π –ø–æ–∏—Å–∫

### –ü—Ä–æ—Å—Ç–æ–π —Ç–µ–∫—Å—Ç–æ–≤—ã–π –ø–æ–∏—Å–∫

```bash
curl -X POST http://localhost:8007/cmd \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "search",
    "params": {
      "search_str": "–º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ",
      "limit": 5
    },
    "id": 1
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç:**
```json
{
  "jsonrpc": "2.0",
  "result": {
    "success": true,
    "data": {
      "chunks": [
        {
          "uuid": "123e4567-e89b-12d3-a456-426614174000",
          "body": "–ú–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ - —ç—Ç–æ –ø–æ–¥—Ä–∞–∑–¥–µ–ª –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞...",
          "similarity": 0.85,
          "metadata": {
            "category": "ai",
            "language": "ru",
            "tags": ["ml", "ai"]
          }
        }
      ],
      "total_found": 1,
      "search_params": {
        "search_str": "–º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ",
        "limit": 5
      }
    }
  },
  "id": 1
}
```

### –ü–æ–∏—Å–∫ —Å –ø–æ—Ä–æ–≥–æ–º —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏

```bash
curl -X POST http://localhost:8007/cmd \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "search",
    "params": {
      "search_str": "–Ω–µ–π—Ä–æ–Ω–Ω—ã–µ —Å–µ—Ç–∏",
      "limit": 10,
      "level_of_relevance": 0.7
    },
    "id": 1
  }'
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `search_str` - —Ç–µ–∫—Å—Ç –¥–ª—è –ø–æ–∏—Å–∫–∞
- `limit` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 10)
- `level_of_relevance` - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–æ—Ä–æ–≥ —Å—Ö–æ–¥—Å—Ç–≤–∞ (0.0-1.0)

## üéõÔ∏è –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –ø–æ–∏—Å–∫

### –ü–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö

```bash
curl -X POST http://localhost:8007/cmd \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "search",
    "params": {
      "search_str": "–≤–µ–∫—Ç–æ—Ä–Ω—ã–µ —ç–º–±–µ–¥–¥–∏–Ω–≥–∏",
      "metadata_filter": {
        "category": {"$eq": "technical"},
        "language": {"$in": ["ru", "en"]},
        "year": {"$gte": 2020}
      },
      "limit": 5,
      "level_of_relevance": 0.8
    },
    "id": 1
  }'
```

### –ü–æ–∏—Å–∫ —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

```bash
curl -X POST http://localhost:8007/cmd \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "search",
    "params": {
      "search_str": "–∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç",
      "limit": 5,
      "offset": 10
    },
    "id": 1
  }'
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–∞–≥–∏–Ω–∞—Ü–∏–∏:**
- `limit` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
- `offset` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –¥–ª—è –ø—Ä–æ–ø—É—Å–∫–∞

## üîß –û–ø–µ—Ä–∞—Ç–æ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

### –û–ø–µ—Ä–∞—Ç–æ—Ä—ã —Å—Ä–∞–≤–Ω–µ–Ω–∏—è

| –û–ø–µ—Ä–∞—Ç–æ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|----------|----------|---------|
| `$eq` | –†–∞–≤–Ω–æ | `{"category": {"$eq": "technical"}}` |
| `$ne` | –ù–µ —Ä–∞–≤–Ω–æ | `{"language": {"$ne": "en"}}` |
| `$in` | –í —Å–ø–∏—Å–∫–µ | `{"tags": {"$in": ["ai", "ml"]}}` |
| `$nin` | –ù–µ –≤ —Å–ø–∏—Å–∫–µ | `{"status": {"$nin": ["deleted"]}}` |

### –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –¥–∏–∞–ø–∞–∑–æ–Ω–∞

| –û–ø–µ—Ä–∞—Ç–æ—Ä | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|----------|----------|---------|
| `$gt` | –ë–æ–ª—å—à–µ | `{"year": {"$gt": 2020}}` |
| `$gte` | –ë–æ–ª—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ | `{"quality_score": {"$gte": 0.8}}` |
| `$lt` | –ú–µ–Ω—å—à–µ | `{"tokens": {"$lt": 1000}}` |
| `$lte` | –ú–µ–Ω—å—à–µ –∏–ª–∏ —Ä–∞–≤–Ω–æ | `{"coverage": {"$lte": 1.0}}` |
| `$range` | –î–∏–∞–ø–∞–∑–æ–Ω | `{"year": {"$range": [2020, 2024]}}` |

### –õ–æ–≥–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã

```json
{
  "metadata_filter": {
    "$and": [
      {"category": {"$eq": "technical"}},
      {"language": {"$in": ["en", "ru"]}},
      {"year": {"$gte": 2020}}
    ]
  }
}
```

```json
{
  "metadata_filter": {
    "$or": [
      {"category": {"$eq": "technical"}},
      {"tags": {"$in": ["ai", "ml"]}}
    ]
  }
}
```

## üìä –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

```json
{
  "chunks": [
    {
      "uuid": "123e4567-e89b-12d3-a456-426614174000",
      "body": "–ù–∞–π–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —á–∞–Ω–∫–∞",
      "similarity": 0.85,
      "metadata": {
        "category": "technical",
        "language": "ru",
        "tags": ["ai", "ml"],
        "quality_score": 0.95,
        "created_at": "2024-12-19T10:00:00Z"
      }
    }
  ],
  "total_found": 1,
  "search_params": {
    "search_str": "–º–∞—à–∏–Ω–Ω–æ–µ –æ–±—É—á–µ–Ω–∏–µ",
    "limit": 5,
    "level_of_relevance": 0.7
  }
}
```

### –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—è similarity

- **0.9-1.0**: –û—á–µ–Ω—å –≤—ã—Å–æ–∫–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å
- **0.7-0.9**: –í—ã—Å–æ–∫–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å
- **0.5-0.7**: –°—Ä–µ–¥–Ω—è—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å
- **0.3-0.5**: –ù–∏–∑–∫–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å
- **0.0-0.3**: –û—á–µ–Ω—å –Ω–∏–∑–∫–∞—è —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç—å

## üöÄ –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ–∏—Å–∫–∞

### 1. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –ø–æ—Ä–æ–≥–∞ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏

```bash
# –î–ª—è —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
"level_of_relevance": 0.8

# –î–ª—è —à–∏—Ä–æ–∫–æ–≥–æ –ø–æ–∏—Å–∫–∞
"level_of_relevance": 0.5

# –î–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è –≤—Å–µ—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
"level_of_relevance": 0.0
```

### 2. –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

```bash
# –•–æ—Ä–æ—à–æ - —Ñ–∏–ª—å—Ç—Ä –ø–æ –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –ø–æ–ª—è–º
"metadata_filter": {
  "category": {"$eq": "technical"},
  "language": {"$eq": "ru"}
}

# –ü–ª–æ—Ö–æ - —Å–ª–æ–∂–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –≤ —Ñ–∏–ª—å—Ç—Ä–µ
"metadata_filter": {
  "body": {"$regex": ".*pattern.*"}
}
```

### 3. –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –ª–∏–º–∏—Ç–∞

```bash
# –î–ª—è UI –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
"limit": 10

# –î–ª—è batch –æ–±—Ä–∞–±–æ—Ç–∫–∏
"limit": 100

# –î–ª—è –∞–Ω–∞–ª–∏–∑–∞
"limit": 1000
```

## üîç –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –ü–æ–∏—Å–∫ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

```bash
curl -X POST http://localhost:8007/cmd \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "search",
    "params": {
      "search_str": "API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è",
      "metadata_filter": {
        "category": {"$eq": "documentation"},
        "type": {"$eq": "DocBlock"}
      },
      "limit": 10,
      "level_of_relevance": 0.7
    },
    "id": 1
  }'
```

### –ü–æ–∏—Å–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–º—É –ø–µ—Ä–∏–æ–¥—É

```bash
curl -X POST http://localhost:8007/cmd \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "search",
    "params": {
      "search_str": "–Ω–æ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏",
      "metadata_filter": {
        "year": {"$gte": 2023},
        "category": {"$eq": "technology"}
      },
      "limit": 20
    },
    "id": 1
  }'
```

### –ü–æ–∏—Å–∫ –ø–æ –∫–∞—á–µ—Å—Ç–≤—É –∫–æ–Ω—Ç–µ–Ω—Ç–∞

```bash
curl -X POST http://localhost:8007/cmd \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "search",
    "params": {
      "search_str": "–ª—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏",
      "metadata_filter": {
        "quality_score": {"$gte": 0.9},
        "status": {"$eq": "active"}
      },
      "limit": 5,
      "level_of_relevance": 0.8
    },
    "id": 1
  }'
```

## ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

### –¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏

```json
{
  "jsonrpc": "2.0",
  "error": {
    "code": -32001,
    "message": "No search method specified",
    "data": {
      "error_code": "validation_error",
      "details": {
        "required_methods": ["search_str", "embedding", "metadata_filter"]
      }
    }
  },
  "id": 1
}
```

### –ö–æ–¥—ã –æ—à–∏–±–æ–∫

| –ö–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –†–µ—à–µ–Ω–∏–µ |
|-----|----------|---------|
| `validation_error` | –ù–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ |
| `search_error` | –û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å —Å–µ—Ä–≤–∏—Å–æ–≤ |
| `reindex_error` | –û—à–∏–±–∫–∞ –ø–µ—Ä–µ–∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–µ—Ä–≤–∏—Å —ç–º–±–µ–¥–¥–∏–Ω–≥–æ–≤ |

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –ú–µ—Ç—Ä–∏–∫–∏ –ø–æ–∏—Å–∫–∞

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
time curl -X POST http://localhost:8007/cmd \
  -H "Content-Type: application/json" \
  -d '{
    "jsonrpc": "2.0",
    "method": "search",
    "params": {
      "search_str": "test query",
      "limit": 10
    },
    "id": 1
  }'
```

### –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

```python
import json
import requests

def analyze_search_performance(search_str, limit=10):
    response = requests.post(
        "http://localhost:8007/cmd",
        json={
            "jsonrpc": "2.0",
            "method": "search",
            "params": {
                "search_str": search_str,
                "limit": limit
            },
            "id": 1
        }
    )
    
    result = response.json()
    
    if "result" in result:
        data = result["result"]["data"]
        print(f"–ù–∞–π–¥–µ–Ω–æ: {data['total_found']} —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤")
        print(f"–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞: {response.elapsed.total_seconds():.3f}—Å")
        
        for chunk in data["chunks"]:
            print(f"- {chunk['similarity']:.3f}: {chunk['body'][:50]}...")
    
    return result
```

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã

- [HOWTO: –ü–æ–∏—Å–∫ –ø–æ –≤–µ–∫—Ç–æ—Ä–∞–º](vector-search.md)
- [HOWTO: –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö](metadata-filtering.md)
- [–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫ –∫–æ–º–∞–Ω–¥](../reference/command-schemas.md)
- [API Reference](../developer/api-reference.md)

---

*–°–ª–µ–¥—É—é—â–∏–π HOWTO: [–ü–æ–∏—Å–∫ –ø–æ –≤–µ–∫—Ç–æ—Ä–∞–º](vector-search.md)* 