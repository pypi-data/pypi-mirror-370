default:
    image: "archlinux:latest"

    before_script:
        - pacman -Syu --noconfirm sudo git util-linux alpm-mtree python python-coverage pyalpm python-zstandard

.unittest-scripts: &unittest-scripts
    - sudo -u nobody python -X no_debug_ranges -m unittest --verbose --failfast

.coverage-scripts: &coverage-scripts
    - sudo -u nobody python -m coverage run -m unittest
    - sudo -u nobody python -m coverage report --show-missing

unittest:
    stage: test
    script:
        - *unittest-scripts
        - *coverage-scripts
    coverage: '/TOTAL.* (100\%|\d?\d\%)$/'
