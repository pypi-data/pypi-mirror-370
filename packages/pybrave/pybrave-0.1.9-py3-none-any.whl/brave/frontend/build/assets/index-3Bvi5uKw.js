import{a as f,r,f as U,d as $,p as M,j as e,g as E,B as O,P as L,F as l,M as q,I as P,T as R,i as z,c as J,S as k}from"./index-k5nYwGaK.js";import{M as K}from"./index-ZTsZCk9V.js";import{T as W,C as H}from"./index-uY4zMwKa.js";import{F as Q,S as X}from"./Table-B22HuOla.js";import{P as Y}from"./index-7-CCDVgE.js";const ge=async t=>await f.post("/page-pipeline-components",t),Z=async t=>await f.post("/list-pipeline-components",t),xe=async t=>await f.delete(`/delete-pipeline-relation/${t}`),he=async t=>await f.delete(`/delete-component/${t}`),je=async t=>await f.post("/save-component-relation-order",t),ye=async t=>await f.post("/save-pipeline-components-edges",t),ee={script_type:"nextflow",image:"registry.cn-hangzhou.aliyuncs.com/wybioinfo/nextflow:25.06.0",databases:[{name:"metaphlan_database",dataKey:"metaphlan_database",label:"metaphlan_database",rules:[{required:!0,message:"该字段不能为空!"}],type:"BaseSelect"}],upstreamFormJson:[{name:"stat_q",data:[{label:"0.2",value:.2},{label:"0",value:0}],initialValue:.2,label:" Quantile value for the robust average(--stat_q)",rules:[{required:!0,message:"该字段不能为空!"}],type:"BaseSelect"}]},te={name:"丰度矩阵",script_type:"python",image:"registry.cn-hangzhou.aliyuncs.com/wybioinfo/datascience-notebook:x86_64-ubuntu-22.04",sampleGroupJSON:!0,saveAnalysisMethod:"metaphlan_sam_abundance_matrix",moduleName:"abundance_matrix",formJson:[{name:"group_field",label:"分组列",rules:[{required:!0,message:"该字段不能为空!"}],type:"GroupFieldSelect"},{name:"metaphlan_sam_abundance",label:"丰度文件",rules:[{required:!0,message:"该字段不能为空!"}],type:"GroupSelectSampleButton",group:"group_field"}],tableDesc:""},ne={name:"raw_reads",label:"下机原始reads",mode:"multiple",type:"GroupSelectSampleButton",group:"group_field",rules:[{required:!0,message:"该字段不能为空!"}],dir:"metaphlan",fileFormat:{profile:"*/*_profile.txt"},inputForm:[{name:["content","fastq1"],initialValue:"/data/wangyang/NGS_TEST/*_1.fastq.gz",label:"fastq1",type:"BaseInput",rules:[{required:!0,message:"该字段不能为空!"}]},{name:["content","fastq2"],initialValue:"/data/wangyang/NGS_TEST/*_2.fastq.gz",label:"fastq2",type:"BaseInput",rules:[{required:!0,message:"该字段不能为空!"}]}]},ae=async t=>await f.post("/container/page",t),se=({pageApi:t,params:n,map:a,initialPageSize:c=12})=>{const[o,s]=r.useState([]),[i,m]=r.useState(1),[u,w]=r.useState(0),[j,F]=r.useState(!1),[C]=r.useState(c),v=async I=>{F(!0);try{const b=await t({...n,page_number:I,page_size:C}),{items:g,total:p,...x}=b.data;a?(b.data=g.map(a),s(b.data)):s(b.data.items),w(p)}catch(b){console.error("Error fetching data:",b)}finally{F(!1)}},y=()=>{v(i)};return r.useEffect(()=>{v(i)},[i]),{data:o,pageNumber:i,totalPage:u,loading:j,setPageNumber:m,pageSize:C,reload:y}},B=({params:t,rowSelection:n})=>{const{data:a,pageNumber:c,totalPage:o,loading:s,reload:i,pageSize:m,setPageNumber:u}=se({pageApi:ae,params:t||{}});U();const{messageApi:w}=$(),{modal:j,openModal:F,closeModal:C}=M(),v=[{title:"namespace",dataIndex:"namespace_name",key:"namespace_name"},{title:"container_id",dataIndex:"container_id",key:"container_id"},{title:"名称",dataIndex:"name",key:"name"},{title:"镜像",dataIndex:"image",key:"image"},{title:"操作",key:"action",fixed:"right",width:200,render:(y,I)=>e.jsxs(X,{size:"middle",children:[e.jsx(O,{size:"small",color:"cyan",variant:"solid",onClick:()=>{F("modalA",I.container_id)},children:"更新"}),e.jsx(L,{title:"确认删除?",onConfirm:()=>{},children:e.jsx(O,{size:"small",danger:!0,variant:"solid",children:"删除"})})]})}];return e.jsxs("div",{style:{maxWidth:"1500px",margin:"1rem auto"},children:[e.jsxs(E,{justify:"flex-end",gap:"small",children:[e.jsx(O,{size:"small",color:"cyan",variant:"solid",onClick:()=>{F("modalA")},children:"新增"}),e.jsx(O,{size:"small",color:"cyan",variant:"solid",onClick:i,children:"刷新"})]}),e.jsx("div",{style:{marginBottom:"1rem"},children:" "}),e.jsx(Q,{rowKey:y=>y.id,size:"small",rowSelection:n,pagination:!1,loading:s,columns:v,dataSource:a}),o!=0&&e.jsxs(E,{style:{marginTop:"1rem"},align:"center",children:["一共",o,"条数据  ",e.jsx(Y,{current:c,pageSize:m,total:o,onChange:y=>u(y),showSizeChanger:!1})]}),e.jsx(oe,{callback:i,visible:j.key=="modalA"&&j.visible,params:j.params,onClose:C})]})},oe=({visible:t,params:n,onClose:a,callback:c})=>{const[o]=l.useForm(),{messageApi:s}=$();r.useEffect(()=>{t&&n&&i()},[t]);const i=async()=>{const u=await f.get(`/container/find-by-id/${n}`);o.setFieldsValue(u.data)},m=async()=>{const u=await o.validateFields();console.log(u),n&&(u.container_id=n),await f.post("/container/add-or-update-container",u),a(),c&&c(),s.success("操作成功!")};return e.jsx(q,{title:n?"编辑容器":"创建容器",onOk:m,width:"50%",open:t,onClose:a,onCancel:a,children:e.jsxs(l,{form:o,children:[e.jsx(l.Item,{name:"namespace",label:"namespace",rules:[{required:!0,message:"该字段不能为空!"}],children:e.jsx(G,{})}),e.jsx(l.Item,{name:"name",label:"名称",rules:[{required:!0,message:"该字段不能为空!"}],children:e.jsx(P,{})}),e.jsx(l.Item,{name:"image",label:"镜像",rules:[{required:!0,message:"该字段不能为空!"}],children:e.jsx(P,{})}),e.jsx(l.Item,{name:"description",label:"描述",children:e.jsx(R,{})}),e.jsx(z,{ghost:!0,items:[{key:"1",label:"更多",children:e.jsx(e.Fragment,{children:e.jsx(l.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(J,{children:e.jsx("pre",{children:JSON.stringify(o.getFieldsValue(),null,2)})})})})}]})]})})},_e=Object.freeze(Object.defineProperty({__proto__:null,default:B},Symbol.toStringTag,{value:"Module"})),be=({visible:t,onClose:n,params:a,callback:c})=>{if(!t)return null;const{data:o,pipelineStructure:s,namespace:i}=a,[m]=l.useForm(),[u,w]=r.useState(),[j,F]=r.useState(),[C,v]=r.useState([]),[y,I]=r.useState(!1),b={pipeline_software:T,software_input_file:T,software_output_file:T,file_script:T},g=({relation_type:S,data:d,form:_})=>{const h=b[S]||(()=>e.jsxs("div",{children:["未知类型 ",JSON.stringify(d)]}));return e.jsx(h,{data:d,form:_,components:C})},p=async S=>{const d=await Z({component_type:S,namespace:i}),_=d.data.map(h=>(JSON.parse(h.content),s.relation_type=="pipeline_software"?{label:`${h.component_name}(${h.component_id})`,value:h.component_id}:s.relation_type=="file_script"?{label:`${h.component_name}(${h.component_id})`,value:h.component_id}:{label:`${h.component_name}(${h.component_id})`,value:h.component_id}));console.log(_),v(_),console.log(d)},x=async S=>{const _=(await f.post(`/find-pipeline-relation/${S}`)).data;F(_),m.setFieldsValue(_)};r.useEffect(()=>{t&&(s.relation_type=="pipeline_software"?p("software"):s.relation_type=="software_input_file"||s.relation_type=="software_output_file"?p("file"):s.relation_type=="file_script"&&p("script"),o?x(o.relation_id):m.resetFields())},[t]);const N=S=>{const d={...S,...s};return o&&(d.relation_id=j.relation_id),d},D=async()=>{I(!0);const S=await m.validateFields(),d=N(S);typeof d.content!="string"&&(d.content=JSON.stringify(d.content)),console.log(d);const _=await f.post("/save-pipeline-relation",d);console.log(_),I(!1),c&&c(),n()};return e.jsx(e.Fragment,{children:e.jsx(q,{loading:y,title:`${o?"更新":"新增"}流程(${s==null?void 0:s.relation_type})`,okText:o?"更新":"新增",onOk:D,open:t,footer:(S,{OkBtn:d,CancelBtn:_})=>e.jsxs(e.Fragment,{children:[e.jsx(_,{}),e.jsx(d,{})]}),onClose:()=>n(),onCancel:()=>n(),children:e.jsxs(l,{form:m,children:[j&&e.jsx(e.Fragment,{}),e.jsx(g,{...s,data:u,form:m}),e.jsx(z,{ghost:!0,items:[{key:"1",label:"更多",children:e.jsx(e.Fragment,{children:e.jsx(l.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(J,{children:e.jsx("pre",{children:JSON.stringify(N(m.getFieldsValue()),null,2)})})})})}]})]})})})},Se=({visible:t,onClose:n,params:a,callback:c})=>{if(!t)return null;const{data:o,structure:s}=a,[i]=l.useForm(),[m,u]=r.useState(),[w,j]=r.useState(!1),F={pipeline:ce,software:le,file:re,script:ie},C=({component_type:g,data:p,form:x})=>{const N=F[g]||(()=>e.jsxs("div",{children:["未知类型 ",JSON.stringify(p)]}));return e.jsx(N,{data:p,form:x,structure:s})},v=async g=>{const x=(await f.post("/find-pipeline",{component_id:g})).data;u(x),s.component_type=="pipeline"&&(x.content=JSON.parse(x.content)),i.setFieldsValue(x)};r.useEffect(()=>{t&&(o?v(o.component_id):i.resetFields())},[t]);const y=g=>{const p={...g,...s};return o&&(p.component_id=m.component_id),p},I=g=>{const p=y(g);return typeof p.content=="string"&&(p.content=JSON.parse(p.content)),p},b=async()=>{j(!0);const g=await i.validateFields(),p=y(g);typeof p.content!="string"&&(p.content=JSON.stringify(p.content)),console.log(p);const x=await f.post("/save-pipeline",p);console.log(x),j(!1),c&&c(),n()};return e.jsx(e.Fragment,{children:e.jsx(q,{loading:w,title:`${o?"更新":"新增"}流程(${s==null?void 0:s.component_type})`,okText:o?"更新":"新增",onOk:b,open:t,width:"60%",onClose:()=>n(),onCancel:()=>n(),children:e.jsxs(l,{form:i,children:[e.jsx(W,{items:[{label:"组件信息",key:"1",children:e.jsxs(e.Fragment,{children:[e.jsx(l.Item,{name:"component_name",label:"组件名称",children:e.jsx(P,{})}),e.jsx(l.Item,{name:"namespace",label:"namespace",children:e.jsx(G,{disabled:o==null?void 0:o.componemt_id})}),e.jsx(C,{...s,data:m,form:i})]})},{label:"组件描述",key:"2",children:e.jsx(e.Fragment,{children:e.jsx(l.Item,{name:"description",label:"组件名称",children:e.jsx(A,{templete:""})})})}]}),e.jsx(z,{ghost:!0,items:[{key:"1",label:"更多",children:e.jsx(e.Fragment,{children:e.jsx(l.Item,{noStyle:!0,shouldUpdate:!0,children:()=>e.jsx(J,{children:e.jsx("pre",{children:JSON.stringify(I(i.getFieldsValue()),null,2)})})})})}]})]})})})},T=({data:t,form:n,components:a})=>e.jsx(e.Fragment,{children:e.jsx(l.Item,{name:"component_id",label:"组件",children:e.jsx(k,{showSearch:!0,options:a})})}),le=({data:t,form:n})=>{const[a,c]=r.useState();return r.useEffect(()=>{t!=null&&t.componemt_id||c(JSON.stringify(ee,null,2))},[]),e.jsxs(e.Fragment,{children:[e.jsx(l.Item,{name:"container_id",label:"容器",children:e.jsx(V,{data:t})}),e.jsx(l.Item,{name:"content",label:"content",children:e.jsx(A,{templete:a})})]})},ie=({data:t,form:n})=>{const[a,c]=r.useState();return r.useEffect(()=>{t!=null&&t.componemt_id||c(JSON.stringify(te,null,2))},[]),e.jsxs(e.Fragment,{children:[e.jsx(l.Item,{name:"container_id",label:"容器",children:e.jsx(V,{data:t})}),e.jsx(l.Item,{name:"content",label:"content",children:e.jsx(A,{templete:a})})]})},re=({data:t,form:n,structure:a})=>{const[c,o]=r.useState();return r.useEffect(()=>{t!=null&&t.componemt_id||o(JSON.stringify(ne,null,2))},[]),e.jsxs(e.Fragment,{children:[(a==null?void 0:a.files)&&e.jsx(H,{style:{maxHeight:"20rem",overflow:"auto",marginBottom:"1rem"},children:e.jsx(J,{children:e.jsx("pre",{children:JSON.stringify(a==null?void 0:a.files,null,2)})})}),e.jsx(l.Item,{name:"content",label:"content",children:e.jsx(A,{templete:c})})]})},V=({value:t,onChange:n,data:a})=>{const{modal:c,openModal:o,closeModal:s}=M(),[i,m]=r.useState(a==null?void 0:a.container);return e.jsxs(e.Fragment,{children:[e.jsx(P,{value:i==null?void 0:i.name,style:{cursor:"pointer"},onClick:()=>o("modalA")}),e.jsx(q,{footer:!1,width:"50%",title:"选择容器",open:c.visible&&c.key=="modalA",onClose:s,onCancel:s,children:e.jsx(B,{rowSelection:{type:"radio",onChange:(u,w)=>{w.length>0&&(m(w[0]),n(w[0].container_id),s())}}})})]})},A=({value:t,onChange:n,templete:a})=>{const c=r.useRef(null);return r.useEffect(()=>{a&&n(a)},[]),e.jsx(e.Fragment,{children:e.jsx(K,{value:t,onChange:n,editorRef:c,defaultLanguage:"json"})})},ce=({data:t,form:n})=>e.jsxs(e.Fragment,{children:[e.jsx(l.Item,{name:["content","name"],label:"name",children:e.jsx(P,{})}),e.jsx(l.Item,{name:["content","script_type"],label:"脚本类型",children:e.jsx(k,{options:[{label:"python",value:"python"},{label:"nextflow",value:"nextflow"},{label:"shell",value:"shell"},{label:"R",value:"R"}]})}),e.jsx(l.Item,{name:["content","image"],label:"镜像",children:e.jsx(P,{})}),e.jsx(l.Item,{name:["content","img"],label:"img",children:e.jsx(P,{})}),e.jsx(l.Item,{name:["content","category"],label:"category",children:e.jsx(P,{})}),e.jsx(l.Item,{name:["content","tags"],label:"tags",children:e.jsx(k,{mode:"tags",style:{width:"100%"}})}),e.jsx(l.Item,{name:["content","description"],label:"description",children:e.jsx(R,{})})]}),G=({value:t,onChange:n,disabled:a})=>{const[c,o]=r.useState([]),s=async()=>{const m=(await f.get("/list-namespace")).data;o(m)};return r.useEffect(()=>{s()},[]),e.jsx(e.Fragment,{children:e.jsx(E,{justify:"space-between",children:e.jsx(k,{disabled:a,value:t,onChange:n,options:c.map(i=>({label:i.name,value:i.namespace_id}))})})})};export{be as C,je as a,Se as b,he as c,xe as d,_e as i,ge as p,ye as s,se as u};
