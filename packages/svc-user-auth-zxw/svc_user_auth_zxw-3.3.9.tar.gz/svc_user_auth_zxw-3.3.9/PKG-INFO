Metadata-Version: 2.4
Name: svc_user_auth_zxw
Version: 3.3.9
Summary: ç”¨æˆ·æƒé™éªŒè¯å·¥å…·åŒ…
Home-page: https://github.com/sunshineinwater/
Author: æ™¯å‹Ÿ
Author-email: 
Classifier: Programming Language :: Python :: 3.10
Classifier: License :: OSI Approved :: MIT License
Classifier: Operating System :: OS Independent
Description-Content-Type: text/markdown
Requires-Dist: pycryptodome<=3.22.0,>=3.20.0
Requires-Dist: fastapi<0.113,>=0.112.0
Requires-Dist: jose<1.1.0,>=1.0.0
Requires-Dist: aiohttp>=3.12.14
Requires-Dist: httpx>=0.28.1
Requires-Dist: sqlalchemy==2.0.32
Requires-Dist: greenlet==3.0.3
Requires-Dist: databases==0.9.0
Requires-Dist: python-jose>=3.4.0
Requires-Dist: passlib==1.7.4
Requires-Dist: bcrypt==4.2.0
Requires-Dist: asyncpg==0.29.0
Requires-Dist: uvicorn<0.31.0,>=0.30.0
Requires-Dist: python-multipart>=0.0.19
Requires-Dist: app-tools-zxw>=2.2.1
Requires-Dist: alibabacloud_dysmsapi20170525==3.0.0
Requires-Dist: redis==5.2.0
Requires-Dist: apscheduler==3.10.4
Dynamic: author
Dynamic: classifier
Dynamic: description
Dynamic: description-content-type
Dynamic: home-page
Dynamic: requires-dist
Dynamic: summary

# svc_user_auth_zxw - ç”¨æˆ·æƒé™éªŒè¯å·¥å…·åŒ…

ä¸€ä¸ªåŸºäº FastAPI çš„ç”¨æˆ·è®¤è¯å’Œæƒé™ç®¡ç†ç³»ç»Ÿï¼Œæ”¯æŒå¤šç§ç™»å½•æ–¹å¼ã€JWT è®¤è¯ã€ä¼šå‘˜ç³»ç»Ÿå’Œæƒé™æ§åˆ¶ã€‚

## ç‰ˆæœ¬ä¿¡æ¯


## ğŸ“ˆ ç‰ˆæœ¬å†å²

- **3.3.9**
  - æ–°å¢æ‰‹æœºå·ç®¡ç†api: æ›´æ–°ç»‘å®šæ‰‹æœºå·
  - ä¼˜åŒ–loginé€»è¾‘ï¼Œç™»å½•å›è°ƒåŠŸèƒ½æ”¾å…¥ login.pyä¸­ç»Ÿä¸€ç®¡ç†ï¼Œå…¶ä»–apiä¸­æ— éœ€é‡å¤å®ç°ã€‚
  - æ‰‹æœºå·ä¸€é”®æ³¨å†Œç™»å½•ï¼Œæ”¯æŒä¼ å…¥username, å¦‚æœä¼ å…¥usernameï¼Œåˆ™usernameå†™å…¥æ•°æ®åº“ï¼Œå¦åˆ™å†™å…¥phone

- **3.3.7**
  - ä¿®å¤SQLAlchemy 2.xå…¼å®¹æ€§é—®é¢˜: è§£å†³ArgumentErrorå¼‚å¸¸ï¼Œselectinloadä¸å†æ¥å—å­—ç¬¦ä¸²å‚æ•°
  - æ›´æ–°æ‰€æœ‰selectinloadè°ƒç”¨: ä»å­—ç¬¦ä¸²æ ¼å¼æ”¹ä¸ºç±»å±æ€§æ ¼å¼ï¼Œæå‡ä»£ç å…¼å®¹æ€§
  - å®Œå–„ç±»å‹å¯¼å…¥: åœ¨æ‰€æœ‰ç™»å½•APIæ–‡ä»¶ä¸­æ·»åŠ Roleç±»å¯¼å…¥ï¼Œç¡®ä¿ç±»å‹å®‰å…¨
  - ä¿®æ”¹æ–‡ä»¶è¯¦æƒ…:
    - `apis/api_ç™»å½•æ³¨å†Œ/è´¦å·å¯†ç æ³¨å†Œç™»å½•/api_æ³¨å†Œç™»å½•.py`: ä¿®å¤3å¤„selectinloadè°ƒç”¨ï¼Œæ·»åŠ Roleç±»å¯¼å…¥
    - `apis/api_ç™»å½•æ³¨å†Œ/æ‰‹æœºæ³¨å†Œç™»å½•/api_æ³¨å†Œç™»å½•.py`: ä¿®å¤4å¤„selectinloadè°ƒç”¨ï¼Œæ·»åŠ Roleç±»å¯¼å…¥
    - `apis/api_ç™»å½•æ³¨å†Œ/å¾®ä¿¡H5å¿«æ·ç™»å½•/api_æ³¨å†Œç™»å½•.py`: ä¿®å¤2å¤„selectinloadè°ƒç”¨ï¼Œæ·»åŠ Roleç±»å¯¼å…¥
- **3.3.6**
  - ä¿®å¤SQLAlchemyå¼‚æ­¥å…³ç³»è®¿é—®é”™è¯¯: è§£å†³MissingGreenletå¼‚å¸¸ï¼Œç¡®ä¿æ‰€æœ‰ç™»å½•æ³¨å†Œåœºæ™¯æ­£ç¡®é¢„åŠ è½½ç”¨æˆ·è§’è‰²å’Œåº”ç”¨å…³ç³»
  - ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢æ€§èƒ½: ä½¿ç”¨selectinloadé¢„åŠ è½½ç­–ç•¥ï¼Œé¿å…N+1æŸ¥è¯¢é—®é¢˜
  - æ›´æ–°æ‰€æœ‰ç™»å½•ç›¸å…³API: è´¦å·å¯†ç ç™»å½•ã€æ‰‹æœºå·ç™»å½•ã€å¾®ä¿¡ç™»å½•å‡å·²ä¿®å¤å¼‚æ­¥å…³ç³»è®¿é—®é—®é¢˜
  - ä¿®æ”¹æ–‡ä»¶è¯¦æƒ…:
    - `db/models.py`: ä¼˜åŒ–User.to_payload()æ–¹æ³•ä¸­çš„å…³ç³»è®¿é—®é€»è¾‘
    - `apis/api_ç™»å½•æ³¨å†Œ/è´¦å·å¯†ç æ³¨å†Œç™»å½•/api_æ³¨å†Œç™»å½•.py`: æ·»åŠ selectinloadé¢„åŠ è½½ç”¨æˆ·è§’è‰²å’Œåº”ç”¨å…³ç³»
    - `apis/api_ç™»å½•æ³¨å†Œ/æ‰‹æœºæ³¨å†Œç™»å½•/api_æ³¨å†Œç™»å½•.py`: ä¿®å¤æ‰‹æœºå·ç™»å½•çš„å…³ç³»é¢„åŠ è½½é—®é¢˜
    - `apis/api_ç™»å½•æ³¨å†Œ/å¾®ä¿¡H5å¿«æ·ç™»å½•/api_æ³¨å†Œç™»å½•.py`: ä¿®å¤å¾®ä¿¡ç™»å½•çš„å…³ç³»é¢„åŠ è½½é—®é¢˜
- **3.3.5**
  - ä¸å†éœ€è¦åœ¨å¤–éƒ¨è¿è¡Œå†…éƒ¨å®šæ—¶ä»»åŠ¡, è‡ªåŠ¨è¿è¡Œä¼šå‘˜ç®¡ç†ç›¸å…³å®šæ—¶ä»»åŠ¡(æ¸…ç†è¿‡æœŸä¼šå‘˜ç­‰)

- **3.3.4**
  - æ–°å¢æ‰‹æœºå·ç®¡ç†api: æ›´æ–°ç»‘å®šæ‰‹æœºå·
  - æ–°å¢uniappå‰ç«¯é¡µé¢demo: æ‰‹æœºå·ç®¡ç†, æ›´æ–°ç»‘å®šæ‰‹æœºå·, å‘é€éªŒè¯ç , éªŒè¯éªŒè¯ç , è·å–å½“å‰æ‰‹æœºå·, è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯, è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
  - ä¼˜åŒ–loginé€»è¾‘ï¼Œç™»å½•å›è°ƒåŠŸèƒ½æ”¾å…¥ login.pyä¸­ç»Ÿä¸€ç®¡ç†ï¼Œå…¶ä»–apiä¸­æ— éœ€é‡å¤å®ç°ã€‚

- **3.3.3**
  - è´¦å·å¯†ç æ³¨å†Œç™»å½•ï¼šusernameä¸å†å†™å…¥phone,email,openidå­—æ®µ
  - è´¦å·å¯†ç æ³¨å†Œç™»å½• æµ‹è¯•é€šè¿‡
  - æ–°å¢uniappå‰ç«¯é¡µé¢demo: è´¦å·å¯†ç æ³¨å†Œç™»å½•
- **3.3.2**
  - æ›´æ–°ä¾èµ–åº“httpxç‰ˆæœ¬å·
- **3.3.1**
  - æ‰‹æœºå·æ³¨å†Œç™»å½•api æ”¯æŒé…ç½®æµ‹è¯•è´¦å·,åœ¨user_auth_configä¸­é…ç½®
- **3.3.0**
  - æ–°å¢ä¼šå‘˜è¡¨crudæ¥å£ï¼ŒæˆåŠŸç»éªŒç¼–ç¨‹ï¼Œæœªæµ‹è¯•
- **3.2.1**
  - æ›´æ–°:uniappå‰ç«¯é¡µé¢demo,å¼€ç®±å³ç”¨
- **3.2.0**
  - æ–°å¢é‚€è¯·ç åŠŸèƒ½:ç”¨æˆ·IDä¸é‚€è¯·ç äº’è½¬,æ”¯æŒæ‰¹é‡å¤„ç†
  - ä¼˜åŒ–api - æ‰‹æœºæ³¨å†Œç™»å½•:æ”¯æŒé‚€è¯·ç è½¬æ¢ä¸ºæ¨èäººID
  - æ·»åŠ é‚€è¯·ç ç›¸å…³å·¥å…·å‡½æ•°:ç¼–ç /è§£ç /éªŒè¯
- **3.1.32**
  - å…¼å®¹æ€§æ›´æ–°,ä¸svc_order_zxwå…¼å®¹: ä¼šå‘˜æ•°æ®åº“,priceç±»å‹æ”¹ä¸ºfloat,ç›¸å…³schemasåŒæ­¥æ›´æ”¹
- **3.1.31**
  - api_ä¼šå‘˜ç±»å‹ç®¡ç†:å­˜åœ¨æœªå®šä½bug,æ·»åŠ debugè¾“å‡º
- **3.1.3**
  - useExamplesï¼š æ·»åŠ  ç™»å½•å›è°ƒæ ·ä¾‹ä»£ç 
- **3.1.2**
  - api:/register-or-login-phone/ , æ·»åŠ ç™»å½•å›è°ƒåŠŸèƒ½,åœ¨configä¸­é…ç½®å›è°ƒåœ°å€
- **3.1.1**
  - æ‰‹æœºéªŒè¯ç ç™»å½•å,æ·»åŠ POSTå›è°ƒåŠŸèƒ½,ä¼ é€userä¿¡æ¯,åœ¨configä¸­é…ç½®å›è°ƒåœ°å€
- **3.1.0**
  - æ–°å¢å®Œæ•´çš„é‚€è¯·åŠŸèƒ½ç³»ç»Ÿ
  - æ·»åŠ é‚€è¯·ç”¨æˆ·ç®¡ç†æ¥å£ï¼ˆè·å–é‚€è¯·åˆ—è¡¨ã€ç»Ÿè®¡ã€æŸ¥è¯¢é‚€è¯·äººä¿¡æ¯ï¼‰
  - æ–°å¢é‚€è¯·æ±‡æ€»å’Œç»Ÿè®¡åŠŸèƒ½ï¼ˆåŒ…å«äºŒçº§é‚€è¯·ç»Ÿè®¡ï¼‰
  - æ·»åŠ é‚€è¯·åŠŸèƒ½Interfaceç±»ï¼Œæ”¯æŒå¼‚æ­¥æ“ä½œ
  - å®Œå–„é‚€è¯·å…³ç³»æ•°æ®æ¨¡å‹å’Œæƒé™æ§åˆ¶
- **3.0.2**
  - ä¼šå‘˜ç±»å‹ç®¡ç† - internalå‡½æ•°å»é™¤ç®¡ç†å‘˜èº«ä»½éªŒè¯, ç§»åˆ°APIå‡½æ•°å†…éªŒè¯
- **3.0.1**
  - å°†api_ä¼šå‘˜ç±»å‹ç®¡ç†.pyæ–‡ä»¶é‡æ„ä¸ºå¯å†…éƒ¨è°ƒç”¨çš„å‡½æ•°å’ŒAPIæ¥å£
  - æ–°å¢çš„å†…éƒ¨å‡½æ•°ï¼ˆä»¥internal_å¼€å¤´ï¼‰
### **éå…¼å®¹æ€§æ›´æ–°**
- **3.0.0** ğŸ‰ **é‡å¤§æ›´æ–°**:
  - å®‰å…¨æ¼æ´ä¿®å¤
  - æ•æ„Ÿæƒé™æ“ä½œç”±apiæ”¹ä¸ºå†…éƒ¨å‡½æ•°

### **éå…¼å®¹æ€§æ›´æ–°**
- **2.1.0** ğŸ‰ **é‡å¤§æ›´æ–°**: æ–°å¢å®Œæ•´çš„ä¼šå‘˜ä½“ç³»åŠŸèƒ½
  - æ·»åŠ ä¼šå‘˜ç±»å‹ç®¡ç†ï¼ˆåˆ›å»ºã€æŸ¥è¯¢ã€æ›´æ–°ã€åˆ é™¤ï¼‰
  - æ·»åŠ ç”¨æˆ·ä¼šå‘˜ç®¡ç†ï¼ˆè´­ä¹°ã€ç»­è´¹ã€çŠ¶æ€ç®¡ç†ï¼‰
  - æ·»åŠ ä¼šå‘˜æƒé™éªŒè¯è£…é¥°å™¨å’ŒAPI
  - æ·»åŠ å®šæ—¶ä»»åŠ¡è‡ªåŠ¨æ¸…ç†è¿‡æœŸä¼šå‘˜
  - ä¼šå‘˜æƒé™ä¸è§’è‰²æƒé™ç³»ç»Ÿæ— ç¼æ•´åˆ
  - âš ï¸ **éå…¼å®¹æ€§æ›´æ–°**ï¼Œä¸ä¹‹å‰ç‰ˆæœ¬ä¸å…¼å®¹

### è¿‘æœŸç‰ˆæœ¬
- **2.0.4**: æ·»åŠ uniAppæ‰‹æœºå·ç™»å½•é¡µ(å…·å¤‡å®Œå¤‡çš„apiè¯·æ±‚é€»è¾‘, å¤åˆ¶åˆ°é¡¹ç›®å†…ç›´æ¥ä½¿ç”¨)
- **2.0.3**: é˜¿é‡Œäº‘smså‘é€å¢åŠ loggerè®°å½•
- **2.0.2**: é˜¿é‡Œäº‘smså‘é€é…ç½®ä½¿ç”¨configä¸­é…ç½®, ä¸ºNoneæ—¶ä½¿ç”¨é»˜è®¤é…ç½®
- **2.0.1**: ä¿®æ­£ä½¿ç”¨æ–‡æ¡£é”™è¯¯
- **2.0.0**: é¡¹ç›®ç”± user_auth_zxw æ›´åä¸º svc_user_auth_zxw

### 1.0.x ç‰ˆæœ¬ï¼ˆé€‚é…VUE-ELEMENT-PLUS-ADMINæ¡†æ¶ï¼‰
- **1.0.5**: ç”¨æˆ·æ–‡æ¡£é”™è¯¯ä¿®æ­£
- **1.0.4**: æ·»åŠ ç”¨æˆ·æ–‡æ¡£
- **1.0.3**: bug fixï¼Œæ–°ç”¨æˆ·æ³¨å†Œåto_payload()æŠ¥é”™ä¿®å¤ï¼Œä¼˜åŒ–ç”¨æˆ·è§’è‰²å…³è”æ•°æ®åŠ è½½
- **1.0.2**: ä¼˜åŒ–è´¦å·å¯†ç æ³¨å†Œç™»å½•è¿”å›å€¼ï¼Œå˜æ›´æ•°æ®è¡¨ç»“æ„ï¼šRoleé‡‡ç”¨è”åˆä¸»é”®ï¼š(app_id, name)
- **1.0.1**: æ–°å¢vue-element-plus-admin api: é€€å‡ºç™»å½•
- **1.0.0**: ç»Ÿä¸€APIè¿”å›å€¼ï¼Œç¬¦åˆvue-element-plus-adminæ¡†æ¶åŸç”Ÿæ ‡å‡†

### æ—©æœŸç‰ˆæœ¬
- **0.1.1**: æ”¯æŒå¤šçº¿ç¨‹ä»»åŠ¡ï¼Œé›†æˆä¿®æ”¹: çŸ­ä¿¡éªŒè¯ç éªŒè¯ï¼Œrediså­˜å‚¨ä¸éªŒè¯
- **0.1.0**: ä¿®æ”¹: jwtéªŒè¯å¤±è´¥, å¼¹å‡º401 HTTPException_AppToolsSZXWå¼‚å¸¸
- **0.0.9**: è¡¨ç»“æ„Useræ–°å¢å­—æ®µ:referer_id,referer,inviteesï¼Œæ‰‹æœºå·æ³¨å†Œç™»å½•æ–°å¢ç›¸åº”å­—æ®µï¼Œå¢åŠ é‚€è¯·äººä¿¡æ¯
- **0.0.8**: æ–°å¢:æ‰¹é‡åˆ é™¤ç”¨æˆ·è§’è‰²(delete_roles)

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” ç”¨æˆ·è®¤è¯
- JWT Token è®¤è¯
- å¤šç§ç™»å½•æ–¹å¼ï¼šè´¦å·å¯†ç ã€æ‰‹æœºçŸ­ä¿¡ã€å¾®ä¿¡å…¬ä¼—å·
- Token åˆ·æ–°æœºåˆ¶
- å®‰å…¨çš„å¯†ç åŠ å¯†

### ğŸ‘¥ æƒé™ç®¡ç†
- åŸºäºè§’è‰²çš„æƒé™æ§åˆ¶ï¼ˆRBACï¼‰
- å¤šåº”ç”¨æƒé™éš”ç¦»
- æƒé™éªŒè¯è£…é¥°å™¨
- åŠ¨æ€è§’è‰²åˆ†é…å’Œåˆ é™¤
- è‡ªåŠ¨åˆ›å»ºåº”ç”¨å’Œè§’è‰²
- æ‰¹é‡æƒé™ç®¡ç†

### ğŸ’ ä¼šå‘˜ç³»ç»Ÿ
- å®šæœŸä¼šå‘˜åŠŸèƒ½
- ä¼šå‘˜ç±»å‹ç®¡ç†
- åŸºäºä¼šå‘˜çš„æƒé™æ§åˆ¶
- è‡ªåŠ¨è¿‡æœŸå¤„ç†

### ğŸ¯ é‚€è¯·ç³»ç»Ÿ
- ç”¨æˆ·é‚€è¯·å…³ç³»ç®¡ç†
- é‚€è¯·æ•°é‡ç»Ÿè®¡å’ŒæŸ¥è¯¢
- é‚€è¯·äººä¿¡æ¯è·å–
- äºŒçº§é‚€è¯·ç»Ÿè®¡æ”¯æŒ
- é‚€è¯·æ±‡æ€»ä¿¡æ¯å±•ç¤º
- æ”¯æŒåˆ†é¡µæŸ¥è¯¢å’Œå¼‚æ­¥æ“ä½œ

### â° å®šæ—¶ä»»åŠ¡
- è‡ªåŠ¨æ¸…ç†è¿‡æœŸä¼šå‘˜
- ä¼šå‘˜ç»Ÿè®¡æŠ¥è¡¨
- å®šæ—¶ä»»åŠ¡è°ƒåº¦

## å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…

#### é€šè¿‡ pip å®‰è£…
```bash
pip install svc_user_auth_zxw
```

#### ä»æºç å®‰è£…
```bash
git clone [é¡¹ç›®åœ°å€]
cd svc_user_auth_zxw
pip install -e .
```

### 2. ç¯å¢ƒé…ç½®

#### æ•°æ®åº“é…ç½®
åœ¨ `configs/config_user_auth.py` ä¸­é…ç½®æ•°æ®åº“è¿æ¥ï¼š

```python
# PostgreSQL æ•°æ®åº“
DATABASE_URL = "postgresql+asyncpg://user:password@localhost:5432/database"

# Redis æ•°æ®åº“
REDIS_URL_AUTH = "redis://:password@localhost:6379/0"
```

æˆ–é€šè¿‡ç¯å¢ƒå˜é‡ï¼š
```bash
export USER_CENTER_DATABASE_URL="postgresql+asyncpg://user:password@localhost:5432/database"
export REDIS_URL_AUTH="redis://:password@localhost:6379/0"
```

#### å›è°ƒé…ç½®
```python
class å›è°ƒé…ç½®:
    login_recall = ""
```

#### JWT é…ç½®
```python
class JWT:
    SECRET_KEY = "your-secret-key"  # ç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨å¼ºå¯†é’¥
    ALGORITHM = "HS256"
    expire_time = timedelta(seconds=30)  # tokenè¿‡æœŸæ—¶é—´
```

#### çŸ­ä¿¡æœåŠ¡é…ç½®ï¼ˆé˜¿é‡Œäº‘ï¼‰
```python
class AliyunSMS:
    ali_access_key_id = "your-access-key-id"
    ali_access_key_secret = "your-access-key-secret"
    ali_secretNo_pool_key = "your-pool-key"
```

#### å¾®ä¿¡ç™»å½•é…ç½®
```python
class WeChatPub:
    app_id = "your-wechat-app-id"
    app_secret = "your-wechat-app-secret"
```

### 3. å¿«é€Ÿå¯åŠ¨

#### æ–¹å¼ä¸€ï¼šç›´æ¥è¿è¡Œ
```bash
python main.py
```

#### æ–¹å¼äºŒï¼šé›†æˆåˆ°ç°æœ‰ FastAPI åº”ç”¨
```python
from fastapi import FastAPI
from svc_user_auth_zxw.main import router
from contextlib import asynccontextmanager
from svc_user_auth_zxw.tools.scheduler import start_membership_scheduler, stop_membership_scheduler

@asynccontextmanager
async def lifespan(app: FastAPI):
    # å¯åŠ¨æ—¶
    await start_membership_scheduler()  # å¯åŠ¨ä¼šå‘˜å®šæ—¶ä»»åŠ¡
    yield
    # å…³é—­æ—¶
    await stop_membership_scheduler()

app = FastAPI(lifespan=lifespan)
app.include_router(router, prefix="/user_center")

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="0.0.0.0", port=8101)
```

### 4. éªŒè¯å®‰è£…
æœåŠ¡å¯åŠ¨åè®¿é—®ï¼š
- æœåŠ¡åœ°å€ï¼šhttp://localhost:8101
- API æ–‡æ¡£ï¼šhttp://localhost:8101/docs
- å¥åº·æ£€æŸ¥ï¼šhttp://localhost:8101/user_center/health

## API æ¥å£è¯¦ç»†è¯´æ˜

### 1. JWT Token ç®¡ç† (`/user_center/token`)

#### è·å–å½“å‰ç”¨æˆ·ä¿¡æ¯
- **æ¥å£**: `POST /user_center/token/get-current-user/`
- **è®¤è¯**: éœ€è¦ JWT Token
- **è¾“å…¥**: æ— ï¼ˆä» Header ä¸­è·å– Tokenï¼‰
- **è¾“å‡º**:
  ```json
  {
    "code": 200,
    "data": {
      "sub": "username",
      "username": "username",
      "nickname": "æ˜µç§°",
      "roles": [
        {
          "role_name": "admin",
          "app_name": "myapp",
          "app_id": 1
        }
      ]
    }
  }
  ```

#### åˆ·æ–° Token
- **æ¥å£**: `POST /user_center/token/refresh-token/`
- **è¾“å…¥**:
  ```json
  {
    "refresh_token": "refresh_token_string"
  }
  ```
- **è¾“å‡º**:
  ```json
  {
    "code": 200,
    "data": {
      "access_token": "new_access_token",
      "refresh_token": "new_refresh_token"
    }
  }
  ```

#### éªŒè¯ Tokenï¼ˆBodyï¼‰
- **æ¥å£**: `POST /user_center/token/check-token-from-body/`
- **è¾“å…¥**:
  ```json
  {
    "access_token": "access_token_string"
  }
  ```
- **è¾“å‡º**: è¿”å›è§£ç åçš„ Payload

#### éªŒè¯ Tokenï¼ˆHeaderï¼‰
- **æ¥å£**: `POST /user_center/token/check-token-from-header/`
- **è®¤è¯**: éœ€è¦åœ¨ Header ä¸­ä¼ é€’ `Authorization: Bearer token`
- **è¾“å‡º**: è¿”å›è§£ç åçš„ Payload

### 2. è´¦å·å¯†ç æ³¨å†Œç™»å½• (`/user_center/account`)

#### æ³¨å†Œ
- **æ¥å£**: `POST /user_center/account/register/`
- **è¾“å…¥**:
  ```json
  {
    "username": "testuser",
    "password": "password123",
    "role_name": "l0",
    "app_name": "app0"
  }
  ```
- **è¾“å‡º**:
  ```json
  {
    "code": 200,
    "data": {
      "access_token": "jwt_token",
      "refresh_token": "refresh_token",
      "user_info": {
        "sub": "testuser",
        "username": "testuser",
        "nickname": null,
        "roles": [...]
      }
    }
  }
  ```

#### ç™»å½•
- **æ¥å£**: `POST /user_center/account/login/`
- **è¾“å…¥**:
  ```json
  {
    "username": "testuser",
    "password": "password123"
  }
  ```
- **è¾“å‡º**: åŒæ³¨å†Œæ¥å£

#### è¡¨å•ç™»å½•
- **æ¥å£**: `POST /user_center/account/login-form/`
- **è¾“å…¥**: è¡¨å•æ•°æ®ï¼ˆ`application/x-www-form-urlencoded`ï¼‰
  ```
  username=testuser&password=password123
  ```
- **è¾“å‡º**: åŒæ³¨å†Œæ¥å£

### 3. æ‰‹æœºæ³¨å†Œç™»å½• (`/user_center/account/phone`)

#### å‘é€çŸ­ä¿¡éªŒè¯ç 
- **æ¥å£**: `POST /user_center/account/phone/send-verification-code/`
- **è¾“å…¥**: `phone=13800138000` (Query å‚æ•°)
- **è¾“å‡º**:
  ```json
  {
    "code": 200,
    "data": {
      "message": "éªŒè¯ç å·²å‘é€"
    }
  }
  ```

#### æ‰‹æœºæ³¨å†Œ
- **æ¥å£**: `POST /user_center/account/phone/register-phone/`
- **è¾“å…¥**:
  ```json
  {
    "phone": "13800138000",
    "sms_code": "1234",
    "email": "user@example.com",
    "role_name": "l0",
    "app_name": "app0",
    "referer_id": null
  }
  ```
- **è¾“å‡º**: ç™»å½•æˆåŠŸä¿¡æ¯

#### æ‰‹æœºç™»å½•
- **æ¥å£**: `POST /user_center/account/phone/login-phone/`
- **è¾“å…¥**:
  ```json
  {
    "phone": "13800138000",
    "sms_code": "1234"
  }
  ```
- **è¾“å‡º**: ç™»å½•æˆåŠŸä¿¡æ¯

#### æ³¨å†Œæˆ–ç™»å½•ï¼ˆä¸€é”®ï¼‰
- **æ¥å£**: `POST /user_center/account/phone/register-or-login-phone/`
- **åŠŸèƒ½**: è‡ªåŠ¨åˆ¤æ–­ç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Œå­˜åœ¨åˆ™ç™»å½•ï¼Œä¸å­˜åœ¨åˆ™æ³¨å†Œ
- **è¾“å…¥**: åŒæ‰‹æœºç™»å½•
- **è¾“å‡º**: ç™»å½•æˆåŠŸä¿¡æ¯

#### æ›´æ¢ç»‘å®šæ‰‹æœºå·
- **æ¥å£**: `POST /user_center/account/phone/change-phone/`
- **è®¤è¯**: éœ€è¦ JWT Token
- **è¾“å…¥**: `new_phone` å’Œ `sms_code` (Query å‚æ•°)
- **è¾“å‡º**: æ›´æ–°åçš„ç”¨æˆ·ä¿¡æ¯

### 4. å¾®ä¿¡å…¬ä¼—å·ç™»å½• (`/user_center/wechat`)

#### è·å–ç™»å½•äºŒç»´ç 
- **æ¥å£**: `POST /user_center/wechat/qr-login/get-qrcode`
- **è¾“å…¥**:
  ```json
  {
    "WECHAT_REDIRECT_URI": "https://your-domain.com/callback"
  }
  ```
- **è¾“å‡º**:
  ```json
  {
    "qr_code_url": "https://open.weixin.qq.com/connect/qrconnect?..."
  }
  ```

#### å¾®ä¿¡ç™»å½•
- **æ¥å£**: `POST /user_center/wechat/qr-login/login/`
- **è¾“å…¥**:
  ```json
  {
    "code": "wechat_auth_code",
    "app_name": "myapp"
  }
  ```
- **è¾“å‡º**: ç™»å½•æˆåŠŸä¿¡æ¯

### 5. æƒé™ç®¡ç† (`/user_center/api/roles`)

#### åˆ†é…è§’è‰²
- **æ¥å£**: `POST /user_center/api/roles/assign-role/`
- **è¾“å…¥**:
  ```json
  {
    "user_id": 1,
    "role_name": "admin",
    "app_name": "myapp"
  }
  ```
- **è¾“å‡º**:
  ```json
  {
    "status": true,
    "message": "è§’è‰²åˆ†é…æˆåŠŸ"
  }
  ```

#### éªŒè¯è§’è‰²æƒé™
- **æ¥å£**: `POST /user_center/api/roles/role-auth/`
- **è®¤è¯**: éœ€è¦ JWT Token
- **è¾“å…¥**:
  ```json
  {
    "role_name": "admin",
    "app_name": "myapp"
  }
  ```
- **è¾“å‡º**:
  ```json
  {
    "status": true
  }
  ```

#### Admin æƒé™ç¤ºä¾‹
- **æ¥å£**: `GET /user_center/api/roles/admin-data/`
- **è®¤è¯**: éœ€è¦ Admin è§’è‰²
- **è¾“å‡º**: ç®¡ç†å‘˜ä¸“å±æ•°æ®

### 6. ä¼šå‘˜ç±»å‹ç®¡ç† (`/user_center/membership-types`)

#### è·å–ä¼šå‘˜ç±»å‹åˆ—è¡¨
- **æ¥å£**: `GET /user_center/membership-types/`
- **å‚æ•°**: `skip=0&limit=100`
- **è¾“å‡º**:
  ```json
  {
    "code": 200,
    "data": [
      {
        "id": 1,
        "name": "VIPä¼šå‘˜",
        "description": "VIPä¼šå‘˜äº«å—æ‰€æœ‰é«˜çº§åŠŸèƒ½",
        "duration_days": 30,
        "price": 9900,
        "is_active": true,
        "created_at": "2024-01-01T00:00:00Z"
      }
    ],
    "message": "è·å–æˆåŠŸ"
  }
  ```

#### è·å–ä¼šå‘˜ç±»å‹è¯¦æƒ…
- **æ¥å£**: `GET /user_center/membership-types/{membership_type_id}`
- **è¾“å‡º**: å•ä¸ªä¼šå‘˜ç±»å‹è¯¦æƒ…

#### åˆ›å»ºä¼šå‘˜ç±»å‹ï¼ˆç®¡ç†å‘˜ï¼‰
- **æ¥å£**: `POST /user_center/membership-types/admin/`
- **è®¤è¯**: éœ€è¦ç®¡ç†å‘˜æƒé™
- **è¾“å…¥**:
  ```json
  {
    "name": "è¶…çº§VIP",
    "description": "è¶…çº§VIPä¼šå‘˜",
    "duration_days": 90,
    "price": 29900,
    "role_names": ["super_vip", "premium_access"],
    "app_name": "myapp"
  }
  ```
- **è¾“å‡º**: åˆ›å»ºçš„ä¼šå‘˜ç±»å‹ä¿¡æ¯

#### æ›´æ–°ä¼šå‘˜ç±»å‹ï¼ˆç®¡ç†å‘˜ï¼‰
- **æ¥å£**: `PUT /user_center/membership-types/admin/{membership_type_id}`
- **è®¤è¯**: éœ€è¦ç®¡ç†å‘˜æƒé™
- **è¾“å…¥**: ä¼šå‘˜ç±»å‹æ›´æ–°æ•°æ®ï¼ˆå­—æ®µå¯é€‰ï¼‰
- **è¾“å‡º**: æ›´æ–°åçš„ä¼šå‘˜ç±»å‹ä¿¡æ¯

#### åˆ é™¤ä¼šå‘˜ç±»å‹ï¼ˆç®¡ç†å‘˜ï¼‰
- **æ¥å£**: `DELETE /user_center/membership-types/admin/{membership_type_id}`
- **è®¤è¯**: éœ€è¦ç®¡ç†å‘˜æƒé™
- **è¾“å‡º**: åˆ é™¤ç¡®è®¤ä¿¡æ¯

### 7. ç”¨æˆ·ä¼šå‘˜ç®¡ç† (`/user_center/memberships`)

#### è·å–æˆ‘çš„ä¼šå‘˜
- **æ¥å£**: `GET /user_center/memberships/my`
- **è®¤è¯**: éœ€è¦ JWT Token
- **è¾“å‡º**:
  ```json
  {
    "code": 200,
    "data": [
      {
        "id": 1,
        "user_id": 1,
        "membership_type_id": 1,
        "membership_type_name": "VIPä¼šå‘˜",
        "start_time": "2024-01-01T00:00:00Z",
        "end_time": "2024-01-31T00:00:00Z",
        "status": "active",
        "created_at": "2024-01-01T00:00:00Z",
        "updated_at": "2024-01-01T00:00:00Z",
        "notes": "è´­ä¹°è®°å½•",
        "is_valid": true
      }
    ],
    "message": "è·å–æˆåŠŸ"
  }
  ```

#### è·å–ä¼šå‘˜è¯¦æƒ…
- **æ¥å£**: `GET /user_center/memberships/{membership_id}`
- **è®¤è¯**: éœ€è¦ JWT Tokenï¼ˆåªèƒ½æŸ¥çœ‹è‡ªå·±çš„æˆ–ç®¡ç†å‘˜æŸ¥çœ‹æ‰€æœ‰ï¼‰
- **è¾“å‡º**: å•ä¸ªä¼šå‘˜è®°å½•è¯¦æƒ…

#### ç®¡ç†å‘˜è·å–ç”¨æˆ·ä¼šå‘˜
- **æ¥å£**: `GET /user_center/memberships/admin/user/{user_id}`
- **è®¤è¯**: éœ€è¦ç®¡ç†å‘˜æƒé™
- **è¾“å‡º**: æŒ‡å®šç”¨æˆ·çš„æ‰€æœ‰ä¼šå‘˜è®°å½•

#### ç®¡ç†å‘˜æ›´æ–°ä¼šå‘˜çŠ¶æ€
- **æ¥å£**: `PUT /user_center/memberships/admin/{membership_id}/status`
- **è®¤è¯**: éœ€è¦ç®¡ç†å‘˜æƒé™
- **è¾“å…¥**:
  ```json
  {
    "status": "suspended",
    "notes": "ç”¨æˆ·è¿è§„ï¼Œæš‚åœä¼šå‘˜"
  }
  ```
- **è¾“å‡º**: æ›´æ–°åçš„ä¼šå‘˜ä¿¡æ¯

#### ç®¡ç†å‘˜è·å–æ‰€æœ‰æ´»è·ƒä¼šå‘˜
- **æ¥å£**: `GET /user_center/memberships/admin/active/all`
- **è®¤è¯**: éœ€è¦ç®¡ç†å‘˜æƒé™
- **å‚æ•°**: `skip=0&limit=100`
- **è¾“å‡º**: æ‰€æœ‰æ´»è·ƒä¼šå‘˜åˆ—è¡¨

#### ç®¡ç†å‘˜è·å–æ‰€æœ‰è¿‡æœŸä¼šå‘˜
- **æ¥å£**: `GET /user_center/memberships/admin/expired/all`
- **è®¤è¯**: éœ€è¦ç®¡ç†å‘˜æƒé™
- **å‚æ•°**: `skip=0&limit=100`
- **è¾“å‡º**: æ‰€æœ‰è¿‡æœŸä¼šå‘˜åˆ—è¡¨

### 8. ä¼šå‘˜æƒé™éªŒè¯ (`/user_center/membership-auth`)

#### éªŒè¯ä¼šå‘˜æƒé™
- **æ¥å£**: `POST /user_center/membership-auth/verify`
- **è®¤è¯**: éœ€è¦ JWT Token
- **è¾“å…¥**:
  ```json
  {
    "membership_type_name": "VIPä¼šå‘˜",
    "role_name": "vip_user",
    "app_name": "myapp"
  }
  ```
- **è¾“å‡º**:
  ```json
  {
    "code": 200,
    "data": {
      "has_membership": true,
      "has_permission": true,
      "membership_info": {
        // ä¼šå‘˜è¯¦ç»†ä¿¡æ¯
      }
    },
    "message": "éªŒè¯æˆåŠŸ"
  }
  ```

#### è·å–æˆ‘çš„æœ‰æ•ˆä¼šå‘˜
- **æ¥å£**: `GET /user_center/membership-auth/my-memberships`
- **è®¤è¯**: éœ€è¦ JWT Token
- **è¾“å‡º**: å½“å‰ç”¨æˆ·çš„æ‰€æœ‰æœ‰æ•ˆä¼šå‘˜åˆ—è¡¨

### 9. é‚€è¯·ç®¡ç† (`/user_center/invitation`)

#### è·å–ç”¨æˆ·é‚€è¯·æ±‡æ€»ä¿¡æ¯
- **æ¥å£**: `GET /user_center/invitation/summary/{user_id}`
- **è®¤è¯**: éœ€è¦ JWT Token
- **å‚æ•°**: `user_id` - ç”¨æˆ·ID
- **è¾“å‡º**:
  ```json
  {
    "code": 200,
    "data": {
      "inviter_info": {
        "user_id": 1,
        "username": "inviter",
        "nickname": "é‚€è¯·äºº",
        "phone": "13900139000",
        "email": "inviter@example.com"
      },
      "invitation_count": 25,
      "invitees": [
        {
          "user_id": 123,
          "username": "user123",
          "nickname": "ç”¨æˆ·æ˜µç§°",
          "phone": "13800138000",
          "email": "user@example.com",
          "created_time": 1640995200,
          "notes": "æ³¨å†Œå¤‡æ³¨"
        }
      ],
      "summary": {
        "total_invitations": 25,
        "displayed_invitations": 25,
        "query_time": "2024-12-19T10:30:00"
      }
    },
    "message": "è·å–æˆåŠŸ"
  }
  ```

#### è·å–ç”¨æˆ·é‚€è¯·åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µï¼‰
- **æ¥å£**: `GET /user_center/invitation/invitees/{user_id}`
- **è®¤è¯**: éœ€è¦ JWT Token
- **å‚æ•°**:
  - `user_id` - ç”¨æˆ·ID
  - `limit` - é™åˆ¶è¿”å›æ•°é‡ï¼ˆå¯é€‰ï¼Œé»˜è®¤10ï¼‰
  - `offset` - è·³è¿‡è®°å½•æ•°ï¼ˆå¯é€‰ï¼Œé»˜è®¤0ï¼‰
- **è¾“å‡º**:
  ```json
  {
    "code": 200,
    "data": [
      {
        "user_id": 123,
        "username": "user123",
        "nickname": "ç”¨æˆ·æ˜µç§°",
        "phone": "13800138000",
        "email": "user@example.com",
        "created_time": 1640995200,
        "notes": "æ³¨å†Œå¤‡æ³¨"
      }
    ],
    "message": "è·å–æˆåŠŸ"
  }
  ```

#### è·å–ç”¨æˆ·é‚€è¯·æ•°é‡
- **æ¥å£**: `GET /user_center/invitation/count/{user_id}`
- **è®¤è¯**: éœ€è¦ JWT Token
- **å‚æ•°**: `user_id` - ç”¨æˆ·ID
- **è¾“å‡º**:
  ```json
  {
    "code": 200,
    "data": {
      "invitation_count": 25
    },
    "message": "è·å–æˆåŠŸ"
  }
  ```

#### è·å–ç”¨æˆ·çš„é‚€è¯·äººä¿¡æ¯
- **æ¥å£**: `GET /user_center/invitation/referrer/{user_id}`
- **è®¤è¯**: éœ€è¦ JWT Token
- **å‚æ•°**: `user_id` - ç”¨æˆ·ID
- **è¾“å‡º**:
  ```json
  {
    "code": 200,
    "data": {
      "referrer_info": {
        "user_id": 1,
        "username": "referrer",
        "nickname": "é‚€è¯·äººæ˜µç§°",
        "phone": "13900139000",
        "email": "referrer@example.com"
      }
    },
    "message": "è·å–æˆåŠŸ"
  }
  ```

#### è·å–é‚€è¯·ç»Ÿè®¡ä¿¡æ¯ï¼ˆåŒ…å«äºŒçº§é‚€è¯·ï¼‰
- **æ¥å£**: `GET /user_center/invitation/statistics/{user_id}`
- **è®¤è¯**: éœ€è¦ JWT Token
- **å‚æ•°**: `user_id` - ç”¨æˆ·ID
- **è¾“å‡º**:
  ```json
  {
    "code": 200,
    "data": {
      "user_id": 1,
      "direct_invitations": 25,
      "second_level_invitations": 8,
      "total_network_size": 33,
      "statistics_time": "2024-12-19T10:30:00"
    },
    "message": "è·å–æˆåŠŸ"
  }
  ```

#### è·å–å½“å‰ç”¨æˆ·é‚€è¯·æ±‡æ€»
- **æ¥å£**: `GET /user_center/invitation/my-summary`
- **è®¤è¯**: éœ€è¦ JWT Token
- **è¾“å…¥**: æ— ï¼ˆä» Token ä¸­è·å–å½“å‰ç”¨æˆ·ï¼‰
- **è¾“å‡º**: åŒè·å–ç”¨æˆ·é‚€è¯·æ±‡æ€»ä¿¡æ¯

### 10. ç™»å‡º (`/user_center/logout`)

#### ç™»å‡º
- **æ¥å£**: `POST /user_center/logout/`
- **è®¤è¯**: éœ€è¦ JWT Token
- **åŠŸèƒ½**: ä½¿å½“å‰ refresh_token å¤±æ•ˆ
- **è¾“å‡º**: ç™»å‡ºæˆåŠŸç¡®è®¤

## å¯å¤–éƒ¨è°ƒç”¨çš„æ ¸å¿ƒå‡½æ•°

**è¯´æ˜**: ä»¥ä¸‹å‡½æ•°æ˜¯å¯ä»¥åœ¨æ‚¨çš„ä»£ç ä¸­ç›´æ¥å¯¼å…¥å’Œè°ƒç”¨çš„å†…éƒ¨å‡½æ•°ï¼ŒåŒºåˆ«äºä¸Šè¿°çš„ REST API æ¥å£ã€‚è¿™äº›å‡½æ•°é€šå¸¸ç”¨äºæœåŠ¡ç«¯çš„ä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œæ— éœ€é€šè¿‡ HTTP è¯·æ±‚è°ƒç”¨ã€‚

### 1. JWT ç›¸å…³å‡½æ•°

#### `get_current_user(token: str) -> User`
- **ä½ç½®**: `svc_user_auth_zxw.SDK_jwt.jwt`
- **ä½œç”¨**: ä» JWT Token è·å–å½“å‰ç”¨æˆ·
- **è¾“å…¥**: JWT Token å­—ç¬¦ä¸²
- **è¾“å‡º**: User å¯¹è±¡
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  from svc_user_auth_zxw.SDK_jwt.jwt import get_current_user
  from fastapi import Depends

  @app.get("/protected")
  async def protected_route(user: User = Depends(get_current_user)):
      return {"user": user.username}
  ```

#### `create_jwt_token(payload: dict) -> str`
- **ä½ç½®**: `svc_user_auth_zxw.SDK_jwt.jwt`
- **ä½œç”¨**: åˆ›å»º JWT Token
- **è¾“å…¥**: ç”¨æˆ·ä¿¡æ¯å­—å…¸
- **è¾“å‡º**: JWT Token å­—ç¬¦ä¸²

#### `check_jwt_token(token: str) -> Payload`
- **ä½ç½®**: `svc_user_auth_zxw.SDK_jwt.jwt`
- **ä½œç”¨**: éªŒè¯å¹¶è§£ç  JWT Token
- **è¾“å…¥**: JWT Token å­—ç¬¦ä¸²
- **è¾“å‡º**: Payload å¯¹è±¡æˆ– None

### 2. æƒé™ç®¡ç†å‡½æ•°

#### `add_new_role(request: è¯·æ±‚_åˆ†é…æˆ–åˆ›å»ºè§’è‰², db: AsyncSession)`
- **ä½ç½®**: `svc_user_auth_zxw.apis.api_ç”¨æˆ·æƒé™_å¢åŠ `
- **ä½œç”¨**: ç»™ç”¨æˆ·åˆ†é…è§’è‰²ï¼Œå¦‚æœè§’è‰²æˆ–åº”ç”¨ä¸å­˜åœ¨åˆ™è‡ªåŠ¨åˆ›å»º
- **è¾“å…¥**: åˆ†é…è§’è‰²è¯·æ±‚å¯¹è±¡ã€æ•°æ®åº“ä¼šè¯
- **è¾“å‡º**: æ“ä½œçŠ¶æ€å’Œæ¶ˆæ¯
- **åŠŸèƒ½**:
  - å¦‚æœç”¨æˆ·ä¸å­˜åœ¨åˆ™è¿”å›404
  - å¦‚æœè§’è‰²ä¸å­˜åœ¨åˆ™åˆ›å»ºè§’è‰²
  - å¦‚æœåº”ç”¨ä¸å­˜åœ¨åˆ™åˆ›å»ºåº”ç”¨
  - è‡ªåŠ¨å…³è”ç”¨æˆ·å’Œè§’è‰²
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  from svc_user_auth_zxw.apis.api_ç”¨æˆ·æƒé™_å¢åŠ  import add_new_role
  from svc_user_auth_zxw.apis.schemas import è¯·æ±‚_åˆ†é…æˆ–åˆ›å»ºè§’è‰²

  request = è¯·æ±‚_åˆ†é…æˆ–åˆ›å»ºè§’è‰²(
      user_id=1,
      role_name="admin",
      app_name="myapp"
  )
  result = await add_new_role(request, db)
  ```

#### `delete_role(user_id: int, role_name: str, db: AsyncSession)`
- **ä½ç½®**: `svc_user_auth_zxw.apis.api_ç”¨æˆ·æƒé™_å¢åŠ `
- **ä½œç”¨**: è§£é™¤ç”¨æˆ·ä¸æŒ‡å®šè§’è‰²çš„å…³è”
- **è¾“å…¥**: ç”¨æˆ·IDã€è§’è‰²åã€æ•°æ®åº“ä¼šè¯
- **è¾“å‡º**: æ“ä½œçŠ¶æ€å’Œæ¶ˆæ¯
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  from svc_user_auth_zxw.apis.api_ç”¨æˆ·æƒé™_å¢åŠ  import delete_role

  result = await delete_role(user_id=1, role_name="admin", db=db)
  ```

#### `delete_roles(user_id: int, role_names: list[str], db: AsyncSession)`
- **ä½ç½®**: `svc_user_auth_zxw.apis.api_ç”¨æˆ·æƒé™_å¢åŠ `
- **ä½œç”¨**: æ‰¹é‡è§£é™¤ç”¨æˆ·ä¸å¤šä¸ªè§’è‰²çš„å…³è”
- **è¾“å…¥**: ç”¨æˆ·IDã€è§’è‰²ååˆ—è¡¨ã€æ•°æ®åº“ä¼šè¯
- **è¾“å‡º**: æ“ä½œçŠ¶æ€å’Œåˆ é™¤çš„è§’è‰²æ•°é‡
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  from svc_user_auth_zxw.apis.api_ç”¨æˆ·æƒé™_å¢åŠ  import delete_roles

  result = await delete_roles(user_id=1, role_names=["admin", "user"], db=db)
  ```

### 3. æƒé™éªŒè¯å‡½æ•°

#### `require_role(role_name: str, app_name: str = None)`
- **ä½ç½®**: `svc_user_auth_zxw.apis.api_ç”¨æˆ·æƒé™_éªŒè¯`
- **ä½œç”¨**: è£…é¥°å™¨ï¼ŒéªŒè¯ç”¨æˆ·æ˜¯å¦å…·æœ‰æŒ‡å®šè§’è‰²
- **è¾“å…¥**: è§’è‰²åã€åº”ç”¨åï¼ˆå¯é€‰ï¼‰
- **è¾“å‡º**: ç”¨æˆ·å¯¹è±¡æˆ–æŠ›å‡ºæƒé™å¼‚å¸¸
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  from svc_user_auth_zxw.apis.api_ç”¨æˆ·æƒé™_éªŒè¯ import require_role

  @app.get("/admin-only")
  async def admin_only(user: User = Depends(require_role("admin", "myapp"))):
      return {"message": "ç®¡ç†å‘˜ä¸“ç”¨æ¥å£"}
  ```

### 4. ä¼šå‘˜æƒé™éªŒè¯å‡½æ•°

#### `require_membership(membership_type_name: str, app_name: str = None)`
- **ä½ç½®**: `svc_user_auth_zxw.apis.api_ä¼šå‘˜æƒé™éªŒè¯`
- **ä½œç”¨**: è£…é¥°å™¨ï¼ŒéªŒè¯ç”¨æˆ·æ˜¯å¦å…·æœ‰æœ‰æ•ˆä¼šå‘˜
- **è¾“å…¥**: ä¼šå‘˜ç±»å‹åã€åº”ç”¨åï¼ˆå¯é€‰ï¼‰
- **è¾“å‡º**: ç”¨æˆ·å¯¹è±¡æˆ–æŠ›å‡ºæƒé™å¼‚å¸¸
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  from svc_user_auth_zxw.apis.api_ä¼šå‘˜æƒé™éªŒè¯ import require_membership

  @app.get("/vip-content")
  async def vip_content(user: User = Depends(require_membership("VIPä¼šå‘˜"))):
      return {"content": "VIPä¸“äº«å†…å®¹"}
  ```

#### `require_membership_or_role(membership_type_name: str, role_name: str, app_name: str = None)`
- **ä½ç½®**: `svc_user_auth_zxw.apis.api_ä¼šå‘˜æƒé™éªŒè¯`
- **ä½œç”¨**: è£…é¥°å™¨ï¼ŒéªŒè¯ç”¨æˆ·æ˜¯å¦å…·æœ‰ä¼šå‘˜æƒé™æˆ–è§’è‰²æƒé™ï¼ˆä»»ä¸€å³å¯ï¼‰
- **è¾“å…¥**: ä¼šå‘˜ç±»å‹åã€è§’è‰²åã€åº”ç”¨åï¼ˆå¯é€‰ï¼‰
- **è¾“å‡º**: ç”¨æˆ·å¯¹è±¡æˆ–æŠ›å‡ºæƒé™å¼‚å¸¸

### 5. å†…éƒ¨ä¼šå‘˜ç®¡ç†å‡½æ•°

#### `internal_purchase_membership()`
- **ä½ç½®**: `svc_user_auth_zxw.apis.api_ç”¨æˆ·ä¼šå‘˜ç®¡ç†`
- **ä½œç”¨**: å†…éƒ¨ä¼šå‘˜è´­ä¹°å‡½æ•°ï¼ˆä»…ä¾›å†…éƒ¨è°ƒç”¨ï¼‰
- **è¾“å…¥**: ç”¨æˆ·IDã€ä¼šå‘˜ç±»å‹IDã€éªŒè¯çŠ¶æ€ç­‰
- **è¾“å‡º**: ä¼šå‘˜å“åº”å¯¹è±¡
- **å®‰å…¨æ€§**: å—ä¿æŠ¤çš„å†…éƒ¨å‡½æ•°ï¼Œéœ€è¦ç‰¹å®šæƒé™

#### `internal_admin_grant_membership()`
- **ä½ç½®**: `svc_user_auth_zxw.apis.api_ç”¨æˆ·ä¼šå‘˜ç®¡ç†`
- **ä½œç”¨**: ç®¡ç†å‘˜å†…éƒ¨èµ é€ä¼šå‘˜å‡½æ•°
- **è¾“å…¥**: ç®¡ç†å‘˜ç”¨æˆ·ã€ç›®æ ‡ç”¨æˆ·IDã€ä¼šå‘˜ç±»å‹IDç­‰
- **è¾“å‡º**: ä¼šå‘˜å“åº”å¯¹è±¡
- **æƒé™**: éœ€è¦ç®¡ç†å‘˜æƒé™

### 6. å†…éƒ¨ä¼šå‘˜ç±»å‹ç®¡ç†å‡½æ•°

#### `internal_get_membership_types()`
- **ä½ç½®**: `svc_user_auth_zxw.apis.api_ä¼šå‘˜ç±»å‹ç®¡ç†`
- **ä½œç”¨**: å†…éƒ¨è·å–ä¼šå‘˜ç±»å‹åˆ—è¡¨å‡½æ•°
- **è¾“å…¥**: skipï¼ˆè·³è¿‡è®°å½•æ•°ï¼‰ã€limitï¼ˆé™åˆ¶è®°å½•æ•°ï¼‰ã€include_disabledï¼ˆæ˜¯å¦åŒ…å«å·²åœç”¨ï¼‰ã€dbï¼ˆæ•°æ®åº“ä¼šè¯ï¼‰
- **è¾“å‡º**: ä¼šå‘˜ç±»å‹å“åº”åˆ—è¡¨
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  from svc_user_auth_zxw.apis.api_ä¼šå‘˜ç±»å‹ç®¡ç† import internal_get_membership_types

  # è·å–æ‰€æœ‰å¯ç”¨çš„ä¼šå‘˜ç±»å‹
  membership_types = await internal_get_membership_types(
      skip=0,
      limit=10,
      include_disabled=False,
      db=db
  )
  ```

#### `internal_get_membership_type_by_id()`
- **ä½ç½®**: `svc_user_auth_zxw.apis.api_ä¼šå‘˜ç±»å‹ç®¡ç†`
- **ä½œç”¨**: å†…éƒ¨è·å–å•ä¸ªä¼šå‘˜ç±»å‹è¯¦æƒ…å‡½æ•°
- **è¾“å…¥**: membership_type_idï¼ˆä¼šå‘˜ç±»å‹IDï¼‰ã€include_disabledï¼ˆæ˜¯å¦åŒ…å«å·²åœç”¨ï¼‰ã€dbï¼ˆæ•°æ®åº“ä¼šè¯ï¼‰
- **è¾“å‡º**: ä¼šå‘˜ç±»å‹å“åº”å¯¹è±¡
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  from svc_user_auth_zxw.apis.api_ä¼šå‘˜ç±»å‹ç®¡ç† import internal_get_membership_type_by_id

  # è·å–æŒ‡å®šä¼šå‘˜ç±»å‹è¯¦æƒ…
  membership_type = await internal_get_membership_type_by_id(
      membership_type_id=1,
      include_disabled=False,
      db=db
  )
  ```

#### `internal_create_membership_type()`
- **ä½ç½®**: `svc_user_auth_zxw.apis.api_ä¼šå‘˜ç±»å‹ç®¡ç†`
- **ä½œç”¨**: å†…éƒ¨åˆ›å»ºä¼šå‘˜ç±»å‹å‡½æ•°
- **è¾“å…¥**: requestï¼ˆä¼šå‘˜ç±»å‹åˆ›å»ºè¯·æ±‚ï¼‰ã€admin_userï¼ˆç®¡ç†å‘˜ç”¨æˆ·å¯¹è±¡ï¼‰ã€dbï¼ˆæ•°æ®åº“ä¼šè¯ï¼‰
- **è¾“å‡º**: ä¼šå‘˜ç±»å‹å“åº”å¯¹è±¡
- **æƒé™**: éœ€è¦ç®¡ç†å‘˜æƒé™
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  from svc_user_auth_zxw.apis.api_ä¼šå‘˜ç±»å‹ç®¡ç† import internal_create_membership_type
  from svc_user_auth_zxw.apis.schemas import ä¼šå‘˜ç±»å‹åˆ›å»ºè¯·æ±‚

  # åˆ›å»ºæ–°çš„ä¼šå‘˜ç±»å‹
  request = ä¼šå‘˜ç±»å‹åˆ›å»ºè¯·æ±‚(
      name="é«˜çº§VIP",
      description="é«˜çº§VIPä¼šå‘˜äº«å—æ‰€æœ‰ç‰¹æƒ",
      duration_days=90,
      price=29900,
      role_names=["advanced_vip"],
      app_name="myapp"
  )
  result = await internal_create_membership_type(request, admin_user, db)
  ```

#### `internal_update_membership_type()`
- **ä½ç½®**: `svc_user_auth_zxw.apis.api_ä¼šå‘˜ç±»å‹ç®¡ç†`
- **ä½œç”¨**: å†…éƒ¨æ›´æ–°ä¼šå‘˜ç±»å‹å‡½æ•°
- **è¾“å…¥**: membership_type_idï¼ˆä¼šå‘˜ç±»å‹IDï¼‰ã€requestï¼ˆä¼šå‘˜ç±»å‹æ›´æ–°è¯·æ±‚ï¼‰ã€admin_userï¼ˆç®¡ç†å‘˜ç”¨æˆ·å¯¹è±¡ï¼‰ã€dbï¼ˆæ•°æ®åº“ä¼šè¯ï¼‰
- **è¾“å‡º**: ä¼šå‘˜ç±»å‹å“åº”å¯¹è±¡
- **æƒé™**: éœ€è¦ç®¡ç†å‘˜æƒé™
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  from svc_user_auth_zxw.apis.api_ä¼šå‘˜ç±»å‹ç®¡ç† import internal_update_membership_type
  from svc_user_auth_zxw.apis.schemas import ä¼šå‘˜ç±»å‹æ›´æ–°è¯·æ±‚

  # æ›´æ–°ä¼šå‘˜ç±»å‹ä¿¡æ¯
  request = ä¼šå‘˜ç±»å‹æ›´æ–°è¯·æ±‚(
      name="è¶…çº§VIP",
      price=39900,
      is_active=True
  )
  result = await internal_update_membership_type(1, request, admin_user, db)
  ```

#### `internal_delete_membership_type()`
- **ä½ç½®**: `svc_user_auth_zxw.apis.api_ä¼šå‘˜ç±»å‹ç®¡ç†`
- **ä½œç”¨**: å†…éƒ¨åˆ é™¤ä¼šå‘˜ç±»å‹å‡½æ•°
- **è¾“å…¥**: membership_type_idï¼ˆä¼šå‘˜ç±»å‹IDï¼‰ã€admin_userï¼ˆç®¡ç†å‘˜ç”¨æˆ·å¯¹è±¡ï¼‰ã€dbï¼ˆæ•°æ®åº“ä¼šè¯ï¼‰
- **è¾“å‡º**: åˆ é™¤æˆåŠŸè¿”å›True
- **æƒé™**: éœ€è¦ç®¡ç†å‘˜æƒé™
- **å®‰å…¨æ€§**: ä¼šæ£€æŸ¥æ˜¯å¦æœ‰ç”¨æˆ·ä½¿ç”¨æ­¤ä¼šå‘˜ç±»å‹ï¼Œæœ‰åˆ™æ— æ³•åˆ é™¤
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  from svc_user_auth_zxw.apis.api_ä¼šå‘˜ç±»å‹ç®¡ç† import internal_delete_membership_type

  # åˆ é™¤æŒ‡å®šä¼šå‘˜ç±»å‹
  deleted = await internal_delete_membership_type(1, admin_user, db)
  if deleted:
      print("ä¼šå‘˜ç±»å‹åˆ é™¤æˆåŠŸ")
  ```

### 7. æ•°æ®åº“ç›¸å…³å‡½æ•°

#### `get_db() -> AsyncSession`
- **ä½ç½®**: `svc_user_auth_zxw.db.get_db`
- **ä½œç”¨**: è·å–æ•°æ®åº“ä¼šè¯
- **è¾“å…¥**: æ— 
- **è¾“å‡º**: AsyncSession å¯¹è±¡
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  from svc_user_auth_zxw.db.get_db import get_db

  @app.get("/users")
  async def get_users(db: AsyncSession = Depends(get_db)):
      # æ•°æ®åº“æ“ä½œ
      pass
  ```

### 8. é‚€è¯·åŠŸèƒ½æ¥å£å‡½æ•°

#### `InvitationInterface` ç±»
- **ä½ç½®**: `svc_user_auth_zxw.interface.invitation_interface`
- **ä½œç”¨**: æä¾›å®Œæ•´çš„ç”¨æˆ·é‚€è¯·å…³ç³»ç®¡ç†åŠŸèƒ½
- **åˆ›å»ºæ–¹å¼**:
  ```python
  from svc_user_auth_zxw.interface.invitation_interface import InvitationInterface, create_invitation_interface
  from svc_user_auth_zxw.db.get_db import get_async_session

  # æ–¹å¼ä¸€ï¼šç›´æ¥åˆ›å»º
  async with get_async_session() as db:
      invitation_interface = InvitationInterface(db)

  # æ–¹å¼äºŒï¼šä½¿ç”¨ä¾¿æ·å‡½æ•°
  async with get_async_session() as db:
      invitation_interface = await create_invitation_interface(db)
  ```

#### `get_invitation_count(user_id: int) -> int`
- **ä½œç”¨**: è·å–ç”¨æˆ·é‚€è¯·æ•°é‡
- **è¾“å…¥**: ç”¨æˆ·ID
- **è¾“å‡º**: é‚€è¯·æ•°é‡
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  user_id = 1
  count = await invitation_interface.get_invitation_count(user_id)
  print(f"ç”¨æˆ·{user_id}å…±é‚€è¯·äº†{count}ä¸ªç”¨æˆ·")
  ```

#### `get_user_invitees(user_id: int, limit: int = None, offset: int = 0) -> List[Dict]`
- **ä½œç”¨**: è·å–é‚€è¯·ç”¨æˆ·åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µï¼‰
- **è¾“å…¥**: ç”¨æˆ·IDã€é™åˆ¶æ•°é‡ã€åç§»é‡
- **è¾“å‡º**: é‚€è¯·ç”¨æˆ·ä¿¡æ¯åˆ—è¡¨
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  user_id = 1
  invitees = await invitation_interface.get_user_invitees(
      user_id=user_id,
      limit=10,    # é™åˆ¶è¿”å›10æ¡è®°å½•
      offset=0     # ä»ç¬¬0æ¡å¼€å§‹
  )

  for invitee in invitees:
      print(f"ç”¨æˆ·ID: {invitee['user_id']}, ç”¨æˆ·å: {invitee['username']}")
  ```

#### `get_invitation_summary(user_id: int) -> Dict`
- **ä½œç”¨**: è·å–é‚€è¯·æ±‡æ€»ä¿¡æ¯
- **è¾“å…¥**: ç”¨æˆ·ID
- **è¾“å‡º**: åŒ…å«é‚€è¯·äººä¿¡æ¯ã€é‚€è¯·æ•°é‡å’Œé‚€è¯·ç”¨æˆ·åˆ—è¡¨çš„å­—å…¸
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  user_id = 1
  summary = await invitation_interface.get_invitation_summary(user_id)

  print(f"é‚€è¯·äººä¿¡æ¯: {summary['inviter_info']}")
  print(f"é‚€è¯·æ•°é‡: {summary['invitation_count']}")
  print(f"é‚€è¯·ç”¨æˆ·åˆ—è¡¨: {summary['invitees']}")
  ```

#### `get_user_referrer(user_id: int) -> Dict`
- **ä½œç”¨**: è·å–ç”¨æˆ·çš„é‚€è¯·äººä¿¡æ¯
- **è¾“å…¥**: ç”¨æˆ·ID
- **è¾“å‡º**: é‚€è¯·äººä¿¡æ¯å­—å…¸æˆ–None
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  user_id = 2
  referrer_info = await invitation_interface.get_user_referrer(user_id)

  if referrer_info:
      print(f"é‚€è¯·äººä¿¡æ¯: {referrer_info['referrer_info']}")
  else:
      print("è¯¥ç”¨æˆ·æ²¡æœ‰é‚€è¯·äºº")
  ```

#### `get_invitation_statistics(user_id: int) -> Dict`
- **ä½œç”¨**: è·å–é‚€è¯·ç»Ÿè®¡ä¿¡æ¯ï¼ˆåŒ…å«äºŒçº§é‚€è¯·ï¼‰
- **è¾“å…¥**: ç”¨æˆ·ID
- **è¾“å‡º**: åŒ…å«ç›´æ¥é‚€è¯·ã€äºŒçº§é‚€è¯·å’Œæ€»ç½‘ç»œè§„æ¨¡çš„ç»Ÿè®¡ä¿¡æ¯
- **ä½¿ç”¨ç¤ºä¾‹**:
  ```python
  user_id = 1
  statistics = await invitation_interface.get_invitation_statistics(user_id)

  print(f"ç›´æ¥é‚€è¯·æ•°é‡: {statistics['direct_invitations']}")
  print(f"äºŒçº§é‚€è¯·æ•°é‡: {statistics['second_level_invitations']}")
  print(f"æ€»ç½‘ç»œè§„æ¨¡: {statistics['total_network_size']}")
  ```

### 9. å·¥å…·å‡½æ•°

#### SMS éªŒè¯ç ç›¸å…³
- **ç±»**: `SMSCodeChecker`
- **ä½ç½®**: `svc_user_auth_zxw.tools.check_sms_code`
- **æ–¹æ³•**:
  - `store_verification_code(phone: str, code: str)`: å­˜å‚¨éªŒè¯ç 
  - `verify_code(phone: str, code: str) -> bool`: éªŒè¯éªŒè¯ç 

#### å®šæ—¶ä»»åŠ¡ç®¡ç†
- **å‡½æ•°**: `start_membership_scheduler()` / `stop_membership_scheduler()`
- **ä½ç½®**: `svc_user_auth_zxw.tools.scheduler`
- **ä½œç”¨**: å¯åŠ¨/åœæ­¢ä¼šå‘˜å®šæ—¶ä»»åŠ¡

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€è®¤è¯ç¤ºä¾‹
```python
from fastapi import FastAPI, Depends
from svc_user_auth_zxw.SDK_jwt.jwt import get_current_user
from svc_user_auth_zxw.db.models import User

app = FastAPI()

@app.get("/profile")
async def get_profile(user: User = Depends(get_current_user)):
    return {
        "username": user.username,
        "nickname": user.nickname,
        "roles": [{"name": role.name, "app": role.app.name} for role in user.roles]
    }
```

### æƒé™æ§åˆ¶ç¤ºä¾‹
```python
from svc_user_auth_zxw.apis.api_ç”¨æˆ·æƒé™_éªŒè¯ import require_role

@app.get("/admin-dashboard")
async def admin_dashboard(user: User = Depends(require_role("admin"))):
    return {"message": "æ¬¢è¿ç®¡ç†å‘˜", "user": user.username}
```

### æƒé™ç®¡ç†ç¤ºä¾‹
```python
from svc_user_auth_zxw.apis.api_ç”¨æˆ·æƒé™_å¢åŠ  import add_new_role, delete_role, delete_roles
from svc_user_auth_zxw.apis.schemas import è¯·æ±‚_åˆ†é…æˆ–åˆ›å»ºè§’è‰²
from svc_user_auth_zxw.db.get_db import get_db

async def assign_user_role():
    """ç»™ç”¨æˆ·åˆ†é…è§’è‰²ç¤ºä¾‹"""
    db = get_db()

    # åˆ†é…ç®¡ç†å‘˜è§’è‰²
    request = è¯·æ±‚_åˆ†é…æˆ–åˆ›å»ºè§’è‰²(
        user_id=1,
        role_name="admin",
        app_name="myapp"
    )
    result = await add_new_role(request, db)
    print(f"åˆ†é…ç»“æœ: {result}")

async def remove_user_role():
    """åˆ é™¤ç”¨æˆ·è§’è‰²ç¤ºä¾‹"""
    db = get_db()

    # åˆ é™¤å•ä¸ªè§’è‰²
    result1 = await delete_role(user_id=1, role_name="admin", db=db)
    print(f"åˆ é™¤å•ä¸ªè§’è‰²: {result1}")

    # æ‰¹é‡åˆ é™¤è§’è‰²
    result2 = await delete_roles(user_id=1, role_names=["user", "editor"], db=db)
    print(f"æ‰¹é‡åˆ é™¤è§’è‰²: {result2}")
```

### ä¼šå‘˜ç±»å‹ç®¡ç†ç¤ºä¾‹
```python
from svc_user_auth_zxw.apis.api_ä¼šå‘˜ç±»å‹ç®¡ç† import (
    internal_get_membership_types,
    internal_get_membership_type_by_id,
    internal_create_membership_type,
    internal_update_membership_type,
    internal_delete_membership_type
)
from svc_user_auth_zxw.apis.schemas import ä¼šå‘˜ç±»å‹åˆ›å»ºè¯·æ±‚, ä¼šå‘˜ç±»å‹æ›´æ–°è¯·æ±‚
from svc_user_auth_zxw.db.get_db import get_db
from svc_user_auth_zxw.SDK_jwt.jwt import get_current_user

async def membership_type_management_example():
    """ä¼šå‘˜ç±»å‹ç®¡ç†ç¤ºä¾‹"""
    db = get_db()
    admin_user = get_current_user()  # éœ€è¦ç®¡ç†å‘˜æƒé™çš„ç”¨æˆ·

    # è·å–ä¼šå‘˜ç±»å‹åˆ—è¡¨
    membership_types = await internal_get_membership_types(
        skip=0,
        limit=10,
        include_disabled=False,
        db=db
    )
    print(f"ä¼šå‘˜ç±»å‹åˆ—è¡¨: {len(membership_types)} ä¸ª")

    # åˆ›å»ºæ–°çš„ä¼šå‘˜ç±»å‹
    create_request = ä¼šå‘˜ç±»å‹åˆ›å»ºè¯·æ±‚(
        name="é’»çŸ³VIP",
        description="é’»çŸ³VIPä¼šå‘˜äº«å—æœ€é«˜çº§åˆ«æƒé™",
        duration_days=365,
        price=99900,  # 999.00å…ƒ
        role_names=["diamond_vip", "premium_access"],
        app_name="myapp"
    )
    new_membership_type = await internal_create_membership_type(
        request=create_request,
        admin_user=admin_user,
        db=db
    )
    print(f"åˆ›å»ºæˆåŠŸ: {new_membership_type.name}")

    # è·å–ä¼šå‘˜ç±»å‹è¯¦æƒ…
    membership_type_detail = await internal_get_membership_type_by_id(
        membership_type_id=new_membership_type.id,
        include_disabled=False,
        db=db
    )
    print(f"ä¼šå‘˜ç±»å‹è¯¦æƒ…: {membership_type_detail.name}")

    # æ›´æ–°ä¼šå‘˜ç±»å‹
    update_request = ä¼šå‘˜ç±»å‹æ›´æ–°è¯·æ±‚(
        description="é’»çŸ³VIPä¼šå‘˜äº«å—æœ€é«˜çº§åˆ«æƒé™ï¼ŒåŒ…å«æ‰€æœ‰é«˜çº§åŠŸèƒ½",
        price=89900,  # é™ä»·åˆ°899.00å…ƒ
        is_active=True
    )
    updated_membership_type = await internal_update_membership_type(
        membership_type_id=new_membership_type.id,
        request=update_request,
        admin_user=admin_user,
        db=db
    )
    print(f"æ›´æ–°æˆåŠŸ: {updated_membership_type.name}, æ–°ä»·æ ¼: {updated_membership_type.price}")

    # åˆ é™¤ä¼šå‘˜ç±»å‹ï¼ˆè°¨æ…æ“ä½œï¼‰
    # deleted = await internal_delete_membership_type(
    #     membership_type_id=new_membership_type.id,
    #     admin_user=admin_user,
    #     db=db
    # )
    # print(f"åˆ é™¤ç»“æœ: {deleted}")
```

### ä¼šå‘˜æƒé™ç¤ºä¾‹
```python
from svc_user_auth_zxw.apis.api_ä¼šå‘˜æƒé™éªŒè¯ import require_membership

@app.get("/premium-feature")
async def premium_feature(user: User = Depends(require_membership("VIPä¼šå‘˜"))):
    return {"feature": "é«˜çº§åŠŸèƒ½", "user": user.username}
```

### é‚€è¯·åŠŸèƒ½ä½¿ç”¨ç¤ºä¾‹
```python
from svc_user_auth_zxw.interface.invitation_interface import create_invitation_interface
from svc_user_auth_zxw.db.get_db import get_async_session

async def invitation_management_example():
    """é‚€è¯·åŠŸèƒ½ç®¡ç†ç¤ºä¾‹"""
    async with get_async_session() as db:
        invitation_interface = await create_invitation_interface(db)

        # è·å–ç”¨æˆ·é‚€è¯·æ•°é‡
        user_id = 1
        count = await invitation_interface.get_invitation_count(user_id)
        print(f"ç”¨æˆ·{user_id}å…±é‚€è¯·äº†{count}ä¸ªç”¨æˆ·")

        # è·å–é‚€è¯·ç”¨æˆ·åˆ—è¡¨ï¼ˆæ”¯æŒåˆ†é¡µï¼‰
        invitees = await invitation_interface.get_user_invitees(
            user_id=user_id,
            limit=10,    # é™åˆ¶è¿”å›10æ¡è®°å½•
            offset=0     # ä»ç¬¬0æ¡å¼€å§‹
        )
        print(f"é‚€è¯·ç”¨æˆ·åˆ—è¡¨: {len(invitees)} ä¸ªç”¨æˆ·")

        # è·å–é‚€è¯·æ±‡æ€»ä¿¡æ¯
        summary = await invitation_interface.get_invitation_summary(user_id)
        print(f"é‚€è¯·æ±‡æ€»: {summary}")

        # è·å–ç”¨æˆ·çš„é‚€è¯·äººä¿¡æ¯
        user_id = 2
        referrer_info = await invitation_interface.get_user_referrer(user_id)
        if referrer_info:
            print(f"ç”¨æˆ·{user_id}çš„é‚€è¯·äºº: {referrer_info['referrer_info']}")
        else:
            print(f"ç”¨æˆ·{user_id}æ²¡æœ‰é‚€è¯·äºº")

        # è·å–é‚€è¯·ç»Ÿè®¡ä¿¡æ¯ï¼ˆåŒ…å«äºŒçº§é‚€è¯·ï¼‰
        user_id = 1
        statistics = await invitation_interface.get_invitation_statistics(user_id)
        print(f"é‚€è¯·ç»Ÿè®¡:")
        print(f"  ç›´æ¥é‚€è¯·: {statistics['direct_invitations']}")
        print(f"  äºŒçº§é‚€è¯·: {statistics['second_level_invitations']}")
        print(f"  æ€»ç½‘ç»œè§„æ¨¡: {statistics['total_network_size']}")

# æ‰¹é‡æŸ¥è¯¢ç¤ºä¾‹
async def batch_invitation_query_example():
    """æ‰¹é‡æŸ¥è¯¢é‚€è¯·ä¿¡æ¯ç¤ºä¾‹"""
    user_ids = [1, 2, 3, 4, 5]
    results = {}

    async with get_async_session() as db:
        invitation_interface = await create_invitation_interface(db)

        for user_id in user_ids:
            try:
                count = await invitation_interface.get_invitation_count(user_id)
                results[user_id] = count
            except Exception as e:
                results[user_id] = f"é”™è¯¯: {e}"

    print("æ‰¹é‡æŸ¥è¯¢ç»“æœ:", results)

# åˆ†é¡µæŸ¥è¯¢ç¤ºä¾‹
async def paginated_invitation_query_example():
    """åˆ†é¡µæŸ¥è¯¢é‚€è¯·åˆ—è¡¨ç¤ºä¾‹"""
    user_id = 1
    page_size = 20
    page = 1
    offset = (page - 1) * page_size

    async with get_async_session() as db:
        invitation_interface = await create_invitation_interface(db)

        invitees = await invitation_interface.get_user_invitees(
            user_id=user_id,
            limit=page_size,
            offset=offset
        )

        print(f"ç¬¬{page}é¡µé‚€è¯·ç”¨æˆ·åˆ—è¡¨: {len(invitees)} ä¸ªç”¨æˆ·")
        for invitee in invitees:
            print(f"  - {invitee['username']} ({invitee['user_id']})")
```

### APIæ¥å£ä½¿ç”¨ç¤ºä¾‹
```python
from fastapi import FastAPI, Depends
from svc_user_auth_zxw.SDK_jwt.jwt import get_current_user
from svc_user_auth_zxw.db.models import User

app = FastAPI()

@app.get("/invitation/my-summary")
async def get_my_invitation_summary(user: User = Depends(get_current_user)):
    """è·å–å½“å‰ç”¨æˆ·çš„é‚€è¯·æ±‡æ€»ä¿¡æ¯"""
    async with get_async_session() as db:
        invitation_interface = await create_invitation_interface(db)
        summary = await invitation_interface.get_invitation_summary(user.id)
        return {"code": 200, "data": summary, "message": "è·å–æˆåŠŸ"}

@app.get("/invitation/my-invitees")
async def get_my_invitees(
    limit: int = 10,
    offset: int = 0,
    user: User = Depends(get_current_user)
):
    """è·å–å½“å‰ç”¨æˆ·çš„é‚€è¯·åˆ—è¡¨"""
    async with get_async_session() as db:
        invitation_interface = await create_invitation_interface(db)
        invitees = await invitation_interface.get_user_invitees(
            user_id=user.id,
            limit=limit,
            offset=offset
        )
        return {"code": 200, "data": invitees, "message": "è·å–æˆåŠŸ"}

@app.get("/invitation/my-referrer")
async def get_my_referrer(user: User = Depends(get_current_user)):
    """è·å–å½“å‰ç”¨æˆ·çš„é‚€è¯·äººä¿¡æ¯"""
    async with get_async_session() as db:
        invitation_interface = await create_invitation_interface(db)
        referrer_info = await invitation_interface.get_user_referrer(user.id)
        return {"code": 200, "data": referrer_info, "message": "è·å–æˆåŠŸ"}
```

## éƒ¨ç½²å»ºè®®

### 1. ç”Ÿäº§ç¯å¢ƒé…ç½®
- ä½¿ç”¨å¼ºå¯†é’¥å’Œå®‰å…¨çš„æ•°æ®åº“å¯†ç 
- é…ç½® HTTPS
- è®¾ç½®åˆé€‚çš„ CORS ç­–ç•¥
- é…ç½®æ—¥å¿—æ”¶é›†

### 2. æ•°æ®åº“ä¼˜åŒ–
- ä¸ºé«˜é¢‘æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
- å®šæœŸå¤‡ä»½ç”¨æˆ·æ•°æ®å’Œä¼šå‘˜æ•°æ®
- ç›‘æ§æ•°æ®åº“æ€§èƒ½

### 3. å®‰å…¨è€ƒè™‘
- å®šæœŸæ›´æ–°ä¾èµ–åŒ…
- ç›‘æ§å¼‚å¸¸ç™»å½•è¡Œä¸º
- å®æ–½ API è®¿é—®é¢‘ç‡é™åˆ¶
- å®šæœŸå®¡æŸ¥æƒé™é…ç½®

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **Token éªŒè¯å¤±è´¥**
   - æ£€æŸ¥ JWT SECRET_KEY é…ç½®
   - ç¡®è®¤ Token æ˜¯å¦è¿‡æœŸ
   - éªŒè¯ Header æ ¼å¼æ˜¯å¦æ­£ç¡®

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥æ•°æ®åº“ URL é…ç½®
   - ç¡®è®¤æ•°æ®åº“æœåŠ¡æ˜¯å¦è¿è¡Œ
   - éªŒè¯ç”¨æˆ·æƒé™

3. **çŸ­ä¿¡å‘é€å¤±è´¥**
   - æ£€æŸ¥é˜¿é‡Œäº‘ SMS é…ç½®
   - ç¡®è®¤è´¦æˆ·ä½™é¢å……è¶³
   - éªŒè¯çŸ­ä¿¡æ¨¡æ¿æ˜¯å¦æ­£ç¡®

4. **ä¼šå‘˜æƒé™éªŒè¯å¤±è´¥**
   - æ£€æŸ¥ä¼šå‘˜æ˜¯å¦è¿‡æœŸ
   - ç¡®è®¤ä¼šå‘˜ç±»å‹é…ç½®æ­£ç¡®
   - éªŒè¯è§’è‰²å…³è”è®¾ç½®

### æ—¥å¿—æŸ¥çœ‹
- åº”ç”¨æ—¥å¿—ï¼š`logs/app.log`
- API æ—¥å¿—ï¼š`logs/svc_user_auth_zxw.apis.*.log`

## æ¥å£ä¸å‡½æ•°ä½¿ç”¨è¯´æ˜

### API æ¥å£ vs å†…éƒ¨å‡½æ•°

#### API æ¥å£ï¼ˆREST APIï¼‰
- **ä½¿ç”¨åœºæ™¯**: å‰ç«¯åº”ç”¨ã€ç§»åŠ¨ç«¯ã€ç¬¬ä¸‰æ–¹ç³»ç»Ÿè°ƒç”¨
- **è°ƒç”¨æ–¹å¼**: é€šè¿‡ HTTP è¯·æ±‚ï¼ˆGETã€POSTã€PUTã€DELETEï¼‰
- **è®¤è¯æ–¹å¼**: éœ€è¦ JWT Token æˆ–å…¶ä»–è®¤è¯æ–¹å¼
- **ç¤ºä¾‹**: `POST /user_center/api/roles/assign-role/`

#### å†…éƒ¨å‡½æ•°ï¼ˆPython å‡½æ•°ï¼‰
- **ä½¿ç”¨åœºæ™¯**: æœåŠ¡ç«¯å†…éƒ¨ä¸šåŠ¡é€»è¾‘ã€å…¶ä»– Python æ¨¡å—è°ƒç”¨
- **è°ƒç”¨æ–¹å¼**: ç›´æ¥å¯¼å…¥å¹¶è°ƒç”¨ Python å‡½æ•°
- **æ•°æ®åº“æ“ä½œ**: éœ€è¦ä¼ é€’æ•°æ®åº“ä¼šè¯å¯¹è±¡
- **ç¤ºä¾‹**: `await add_new_role(request, db)`

#### é€‰æ‹©å»ºè®®
- **å‰ç«¯å¼€å‘**: ä½¿ç”¨ REST API æ¥å£
- **åç«¯é›†æˆ**: ä¼˜å…ˆä½¿ç”¨å†…éƒ¨å‡½æ•°ï¼Œæ€§èƒ½æ›´å¥½
- **å¾®æœåŠ¡è°ƒç”¨**: ä½¿ç”¨ REST API æ¥å£
- **æ•°æ®åº“äº‹åŠ¡**: ä½¿ç”¨å†…éƒ¨å‡½æ•°ï¼Œä¾¿äºäº‹åŠ¡ç®¡ç†

## æ›´æ–°æ—¥å¿—

### v2.1.0
- æ–°å¢å®šæœŸä¼šå‘˜åŠŸèƒ½
- ä¼˜åŒ–å®‰å…¨æ€§
- å®Œå–„æ–‡æ¡£
- è¡¥å……æƒé™ç®¡ç†å†…éƒ¨å‡½æ•°è¯´æ˜

### è”ç³»æ–¹å¼
- **ä½œè€…**: æ™¯å‹Ÿ
- **é‚®ç®±**: shuiheyangguang@gmail.com
- **è®¸å¯è¯**: MIT License

---

**æ³¨æ„**: æœ¬æ–‡æ¡£åŸºäº v2.1.0 ç‰ˆæœ¬ç¼–å†™ï¼Œä½¿ç”¨å‰è¯·ç¡®ä¿ç‰ˆæœ¬åŒ¹é…ã€‚ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å‰è¯·ä»”ç»†é…ç½®å®‰å…¨å‚æ•°ã€‚
