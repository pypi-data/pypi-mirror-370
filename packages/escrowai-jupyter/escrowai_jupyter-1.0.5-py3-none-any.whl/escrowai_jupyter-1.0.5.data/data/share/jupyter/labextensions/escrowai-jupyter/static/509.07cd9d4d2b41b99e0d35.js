"use strict";(self.webpackChunkescrowai_jupyter=self.webpackChunkescrowai_jupyter||[]).push([[509],{509:(e,t,s)=>{s.r(t),s.d(t,{default:()=>c});var o=s(715),i=s(256);const r=new(s(816).AnsiUp);class a{constructor(){this.isOpen=!1,this.isDragging=!1,this.xOffset=0,this.yOffset=0,this.mouseStartX=0,this.mouseStartY=0,this.isMouseDown=!1,this.dialogNode=document.createElement("div"),this.dialogNode.className="escrowai-modal",this.headerNode=document.createElement("div"),this.headerNode.className="escrowai-modal-header";const e=document.createElement("div");e.className="escrowai-modal-title",e.textContent="EscrowAI Upload",this.headerNode.appendChild(e);const t=document.createElement("button");t.className="escrowai-modal-close",t.innerHTML="&times;",t.onclick=()=>this.close(),this.headerNode.appendChild(t),this.bodyNode=document.createElement("div"),this.bodyNode.className="escrowai-modal-body",this.progressWidget=new n,this.bodyNode.appendChild(this.progressWidget.node),this.dialogNode.appendChild(this.headerNode),this.dialogNode.appendChild(this.bodyNode),this.dialogWidget=new i.Widget({node:this.dialogNode}),this.dialogWidget.addClass("jp-EscrowAI-modal"),this.setupDrag()}setupDrag(){this.headerNode.addEventListener("mousedown",this.dragStart.bind(this),!1),document.addEventListener("mouseup",this.dragEnd.bind(this),!1),document.addEventListener("mousemove",this.drag.bind(this),!1)}dragStart(e){if(e.target===this.headerNode||e.target.parentNode===this.headerNode&&"BUTTON"!==e.target.tagName){e.preventDefault();const t=this.dialogNode.getBoundingClientRect();"none"!==window.getComputedStyle(this.dialogNode).transform&&(this.dialogNode.style.top=`${t.top}px`,this.dialogNode.style.left=`${t.left}px`,this.dialogNode.style.transform="none"),this.mouseStartX=e.clientX,this.mouseStartY=e.clientY,this.isMouseDown=!0,this.xOffset=e.clientX-t.left,this.yOffset=e.clientY-t.top,console.log("Mouse down",{clientX:e.clientX,clientY:e.clientY,xOffset:this.xOffset,yOffset:this.yOffset})}}dragEnd(e){this.isMouseDown=!1,this.isDragging&&(this.isDragging=!1,this.dialogNode.classList.remove("escrowai-dragging"),console.log("Drag ended"))}drag(e){if(this.isMouseDown&&!this.isDragging){const t=Math.abs(e.clientX-this.mouseStartX),s=Math.abs(e.clientY-this.mouseStartY);if(!(t>5||s>5))return;this.isDragging=!0,this.dialogNode.classList.add("escrowai-dragging"),console.log("Drag started after movement threshold")}if(!this.isDragging)return;e.preventDefault();const t=e.clientX-this.xOffset,s=e.clientY-this.yOffset;this.dialogNode.style.left=`${t}px`,this.dialogNode.style.top=`${s}px`,this.dialogNode.style.transform="none",console.log("Dragging",{newLeft:t,newTop:s})}open(){this.isOpen||(document.body.appendChild(this.dialogNode),this.isOpen=!0)}close(){this.isOpen&&(this.dialogNode.parentNode&&this.dialogNode.parentNode.removeChild(this.dialogNode),this.isOpen=!1)}updateProgress(e,t,s){this.progressWidget.updateProgress(e,t,s)}}class n extends i.Widget{constructor(){super(),this.addClass("jp-EscrowAI-progress");const e=document.createElement("div");e.className="escrowai-progress-container",this.stepLabel=document.createElement("div"),this.stepLabel.className="escrowai-step-label",this.progressBar=document.createElement("div"),this.progressBar.className="escrowai-progress-bar",this.progressFill=document.createElement("div"),this.progressFill.className="escrowai-progress-fill",this.progressBar.appendChild(this.progressFill);const t=document.createElement("div");t.className="escrowai-header-container",t.appendChild(this.stepLabel),t.appendChild(this.progressBar),this.detailsLabel=document.createElement("div"),this.detailsLabel.className="escrowai-details-label",e.appendChild(t),e.appendChild(this.detailsLabel),this.node.appendChild(e),this.currentStep="Initializing...",this.latestByStep=new Map,this.updateProgress(this.currentStep,"Preparing to start upload...",0),console.log("ProgressWidget: Initialization complete")}setErrorState(e){e?(this.stepLabel.classList.add("error"),this.progressFill.classList.add("error")):(this.stepLabel.classList.remove("error"),this.progressFill.classList.remove("error"))}scrollToBottom(){this.detailsLabel.scrollTop=this.detailsLabel.scrollHeight}updateProgress(e,t,s){console.log("updateProgress:",{step:e,details:t,progress:s});const o="Error"===e;if(this.setErrorState(o),e!==this.currentStep&&(console.log("Step changed from",this.currentStep,"to",e),this.currentStep=e,this.stepLabel.textContent=e),t&&t.trim()){const s=(new Date).toLocaleTimeString();this.latestByStep.set(e,`[${s}] ${t}`),this.updateDisplay()}const i=`${Math.min(100,Math.max(0,s))}%`;this.progressFill.style.width=i,this.scrollToBottom()}updateDisplay(){if(this.latestByStep.has(this.currentStep)){const e=this.latestByStep.get(this.currentStep),t=`<div class="escrowai-output-line">${r.ansi_to_html(e)}</div>`;this.detailsLabel.innerHTML=t}else this.detailsLabel.innerHTML=""}}const d={id:"escrowai-jupyter:plugin",description:"An extension to encrypt and upload the working directory to EscrowAI",autoStart:!0,optional:[o.ICommandPalette],activate:(e,t)=>{console.log("EscrowAI Extension: Activating...");const s="escrowai-jupyter:run-script";e.commands.addCommand(s,{label:"Upload to EscrowAI",execute:async()=>{console.log("EscrowAI Extension: Command executed");const e=new a;e.open();try{console.log("EscrowAI Extension: Starting EventSource connection...");const t=new EventSource("/escrowai_jupyter/run-script");t.onopen=()=>{console.log("EscrowAI Extension: EventSource connection opened")},t.onmessage=s=>{console.log("EscrowAI Extension: Received event data:",s.data);const a=JSON.parse(s.data);if(console.log("EscrowAI Extension: Parsed event data:",a),"running"===a.status)console.log("EscrowAI Extension: Processing running status update"),e.updateProgress(a.step||"Processing...",a.details||"",a.progress||0);else if("complete"===a.status)console.log("EscrowAI Extension: Processing completion"),t.close(),e.updateProgress("Complete","Upload successful!",100),(0,o.showDialog)({title:"Upload Complete",body:new i.Widget({node:l.createHTMLNode("Successfully uploaded to EscrowAI!")}),buttons:[o.Dialog.okButton()]}).then(()=>e.close());else if("error"===a.status){console.error("EscrowAI Extension: Processing error:",a.error),t.close();const s=a.error||"Upload failed";e.updateProgress("Error",s,0),(0,o.showDialog)({title:"Upload Failed",body:new i.Widget({node:l.createHTMLNode(`Error: ${r.ansi_to_html(s)}`)}),buttons:[o.Dialog.okButton()]}).then(()=>e.close())}},t.onerror=s=>{console.error("EscrowAI Extension: EventSource error:",s),t.close();const r="Connection failed";e.updateProgress("Error",r,0),(0,o.showDialog)({title:"Upload Failed",body:new i.Widget({node:l.createHTMLNode(`Error: ${r}`)}),buttons:[o.Dialog.okButton()]}).then(()=>e.close())}}catch(t){const s=String(t);e.updateProgress("Error",s,0),(0,o.showDialog)({title:"Upload Failed",body:new i.Widget({node:l.createHTMLNode(`Error: ${r.ansi_to_html(s)}`)}),buttons:[o.Dialog.okButton()]}).then(()=>e.close())}}}),t&&t.addItem({command:s,category:"Extensions"}),console.log("EscrowAI Extension: Activation complete")}};var l;!function(e){e.createHTMLNode=function(e){const t=document.createElement("div");return t.innerHTML=e,t}}(l||(l={}));const c=d}}]);