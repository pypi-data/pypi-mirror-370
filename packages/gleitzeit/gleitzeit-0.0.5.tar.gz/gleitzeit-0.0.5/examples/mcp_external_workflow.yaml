# External MCP Server Workflow Example
# Demonstrates using external MCP servers (filesystem, GitHub, etc.)
# 
# Prerequisites:
# 1. Configure MCP servers in ~/.gleitzeit/config.yaml (see mcp_config.yaml)
# 2. Install required MCP servers:
#    - npm install -g @modelcontextprotocol/server-filesystem
#    - npm install -g @modelcontextprotocol/server-github
#    - npm install -g @modelcontextprotocol/server-web-search

name: "External MCP Servers Demo"
description: "Workflow using external MCP servers for real-world tasks"

tasks:
  # Web search using search server
  - id: "search_info"
    name: "Search for Information"
    method: "mcp/tool.search"
    parameters:
      query: "latest AI developments 2024"
      max_results: 5
  
  # Read a local file using filesystem server
  - id: "read_template"
    name: "Read Template File"
    method: "mcp/tool.fs.read"
    parameters:
      path: "./templates/report.md"
  
  # Process search results with LLM
  - id: "analyze_results"
    name: "Analyze Search Results"
    method: "llm/chat"
    dependencies: ["search_info", "read_template"]
    parameters:
      model: "llama3.2"
      messages:
        - role: "system"
          content: "You are a helpful AI assistant that creates structured reports."
        - role: "user"
          content: |
            Using this template:
            ${read_template.content}
            
            Create a report about these search results:
            ${search_info.results}
  
  # Save the report to file
  - id: "save_report"
    name: "Save Report to File"
    method: "mcp/tool.fs.write"
    dependencies: ["analyze_results"]
    parameters:
      path: "./output/ai_report.md"
      content: "${analyze_results.response}"
  
  # Create GitHub issue with report summary
  - id: "create_issue"
    name: "Create GitHub Issue"
    method: "mcp/tool.gh.create_issue"
    dependencies: ["analyze_results"]
    parameters:
      repo: "myorg/research"
      title: "AI Developments Report - ${date}"
      body: |
        ## Summary
        New AI developments report has been generated.
        
        ## Key Findings
        ${analyze_results.response}
        
        ## Source
        Generated by Gleitzeit MCP workflow
      labels: ["research", "ai", "automated"]