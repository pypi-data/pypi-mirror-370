<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Code Executor - Fremko</title>
    <link rel="stylesheet" href="/static/css/styles.css" />
    <link rel="stylesheet" href="/static/css/executor.css" />
  </head>
  <body>
    <header class="app-header">
      <div class="header-nav">
        <h3>Fremko - Code Executor</h3>
        <nav class="nav-links">
          <a href="/">Device Control</a>
          <a href="/executor" class="active">Code Executor</a>
        </nav>
      </div>
    </header>
    
    <main class="executor-main">
      <button id="show-device-panel-btn" class="floating-device-tab" title="Show device selection">üì±</button>
      <div class="executor-layout">
        <!-- Device Selection Panel -->
        <section class="panel device-panel" id="device-panel">
          <div class="panel-header">
            <strong>Device Selection</strong>
            <div class="header-actions">
              <button id="refresh-devices-btn" class="secondary-btn">Refresh</button>
              <button id="toggle-device-panel-btn" class="secondary-btn" title="Hide device selection">‚Üê</button>
            </div>
          </div>
          
          <div class="device-selection">
            <div id="device-list" class="device-list">
              <div class="no-devices">No devices connected</div>
            </div>
            <div id="selected-device-info" class="selected-device-info" style="display: none;">
              <h4>Selected Device</h4>
              <div id="device-details"></div>
            </div>
          </div>
        </section>

        <!-- Code Editor Panel -->
        <section class="panel code-panel">
          <div class="panel-header">
            <strong>Python Code Editor</strong>
            <div class="editor-actions">
              <button id="run-code-btn" class="primary-btn">‚ñ∂ Run Code</button>
              <button id="clear-code-btn" class="secondary-btn">Clear</button>
              <button id="load-example-btn" class="secondary-btn">Load Example</button>
            </div>
          </div>
          
          <div class="code-editor-container">
            <textarea 
              id="code-editor" 
              class="code-editor"
              placeholder="# Write your Python code here
# DEFAULT persona tools only:
# - swipe(start_x, start_y, end_x, end_y, duration_ms=300) - Swipe gesture
# - input_text(index, text) - Type text into element
# - press_key(keycode) - Press device key (HOME=3, BACK=4)
# - tap_by_index(index) - Tap UI element by index
# - start_app(package, activity='') - Launch app
# - list_packages(include_system=False) - List packages
# - remember(info) - Store information
# - complete(success, reason) - Mark task complete

print('Hello from the web executor!')
await tap_by_index(1)
              rows="20"
            ></textarea>
            <div class="editor-status">
              <span id="editor-status" class="status-text">Ready</span>
              <span id="line-col" class="line-col">Line 1, Col 1</span>
            </div>
          </div>
        </section>
        
        <!-- Results Panel -->
        <section class="panel results-panel">
          <div class="panel-header">
            <strong>Execution Results</strong>
            <div class="results-actions">
              <button id="clear-results-btn" class="secondary-btn">Clear Results</button>
              <button id="copy-output-btn" class="secondary-btn">Copy Output</button>
            </div>
          </div>
          
          <div class="results-container">
            <!-- Console Output -->
            <div class="result-section">
              <h4>Console Output</h4>
              <pre id="console-output" class="console-output">Ready to execute code...</pre>
            </div>
            
            <!-- Tool Actions -->
            <div class="result-section">
              <h4>Tool Actions</h4>
              <div id="tool-actions" class="tool-actions">
                <div class="no-actions">No tool actions yet</div>
              </div>
            </div>
            
            <!-- Execution Info -->
            <div class="result-section">
              <h4>Execution Info</h4>
              <div id="execution-info" class="execution-info">
                <div class="info-item">
                  <span class="label">Status:</span>
                  <span id="exec-status" class="value">Ready</span>
                </div>
                <div class="info-item">
                  <span class="label">Execution Time:</span>
                  <span id="exec-time" class="value">-</span>
                </div>
                <!--TODO: Memory Usage-->
                <div class="info-item">
                  <span class="label">Memory Usage:</span>
                  <span id="memory-count" class="value">0 items</span>
                </div>
              </div>
            </div>
          </div>
        </section>
        
        <!-- Tools Reference Panel -->
        <section class="panel tools-panel">
          <div class="panel-header">
            <strong>Available Tools</strong>
            <button id="toggle-tools-btn" class="toggle-btn">‚àí</button>
          </div>
          
          <div id="tools-content" class="tools-content">
            <div class="tool-category">
              <h4>DEFAULT Persona Tools</h4>
              <div class="tool-item">
                <code>swipe(start_x, start_y, end_x, end_y, duration_ms=300)</code>
                <p>Perform swipe gesture between coordinates</p>
              </div>
              <div class="tool-item">
                <code>input_text(index: int, text: str)</code>
                <p>Type text into element at index</p>
              </div>
              <div class="tool-item">
                <code>press_key(keycode: int)</code>
                <p>Press device key (HOME=3, BACK=4, ENTER=66, DELETE=67)</p>
              </div>
              <div class="tool-item">
                <code>tap_by_index(index: int)</code>
                <p>Tap UI element at the specified index</p>
              </div>
              <div class="tool-item">
                <code>start_app(package: str, activity: str = "")</code>
                <p>Launch app by package name</p>
              </div>
              <div class="tool-item">
                <code>list_packages(include_system: bool = False)</code>
                <p>Get list of installed packages</p>
              </div>
              <div class="tool-item">
                <code>remember(information: str)</code>
                <p>Store information in memory</p>
              </div>
              <div class="tool-item">
                <code>complete(success: bool, reason: str)</code>
                <p>Mark task as complete with status</p>
              </div>
            </div>
            
            <div class="tool-category">
              <h4>Note</h4>
              <div class="tool-item">
                <p><strong>Only DEFAULT persona tools are available.</strong> Functions like get_state(), take_screenshot(), back(), tap_by_description() are NOT in this persona and will cause errors if used.</p>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
    
    <!-- Loading Modal -->
    <div class="modal" id="loading-modal" aria-hidden="true">
      <div class="modal-backdrop"></div>
      <div class="modal-dialog loading-dialog">
        <div class="modal-body">
          <div class="loading-spinner"></div>
          <div class="loading-text">Executing code...</div>
        </div>
      </div>
    </div>

    <script src="/static/js/executor.js"></script>
  </body>
</html>
