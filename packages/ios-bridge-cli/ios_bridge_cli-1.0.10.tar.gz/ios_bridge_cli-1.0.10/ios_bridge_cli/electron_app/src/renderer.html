<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' data: ws: wss: http: https:; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; connect-src 'self' http: https: ws: wss:;">
    <title>iOS Bridge Desktop</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div id="app">
        <!-- Header with controls -->
        <header class="header">
            <div class="header-left">
                <div class="device-info">
                    <span id="device-name">Loading...</span>
                    <span id="connection-status" class="status-connecting">●</span>
                </div>
            </div>
            
            <div class="header-controls">
                <button id="home-btn" class="control-btn" data-action="home" title="Go to Home Screen (F1)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                </button>
                
                <button id="screenshot-btn" class="control-btn" data-action="screenshot" title="Take Screenshot (F2)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M14.25 2.1l-.9-.9L9.8 4.7 5.1 0l-.9.9L8.7 5.6 0 14.25l.9.9L9.8 6.7l4.7 4.7.9-.9L10.9 6l8.6-8.6z"/>
                        <circle cx="9" cy="9" r="2"/>
                        <path d="M21 15H3v6h18v-6zM7 18H5v-1h2v1z"/>
                    </svg>
                </button>
                
                <button id="info-btn" class="control-btn" data-action="info" title="Show Device Information (F3)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/>
                    </svg>
                </button>
                
                <button id="keyboard-btn" class="control-btn" data-action="keyboard" title="Toggle Virtual Keyboard (F4)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 7v10c0 1.1-.9 2-2 2H6c-1.1 0-2-.9-2-2V7c0-1.1.9-2 2-2h12c1.1 0 2 .9 2 2zm-2 0H6v10h12V7z"/>
                        <rect x="8" y="9" width="1.5" height="1.5"/>
                        <rect x="10" y="9" width="1.5" height="1.5"/>
                        <rect x="12" y="9" width="1.5" height="1.5"/>
                        <rect x="14" y="9" width="1.5" height="1.5"/>
                        <rect x="7" y="11" width="1.5" height="1.5"/>
                        <rect x="9" y="11" width="1.5" height="1.5"/>
                        <rect x="11" y="11" width="1.5" height="1.5"/>
                        <rect x="13" y="11" width="1.5" height="1.5"/>
                        <rect x="15" y="11" width="1.5" height="1.5"/>
                        <rect x="9" y="13" width="6" height="1.5"/>
                    </svg>
                </button>
                
                <button id="swipe-btn" class="control-btn dropdown-btn" title="Swipe Gestures - Up, Down, Left, Right">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M13 1v6h3l-4 5-4-5h3V1h2zm-2 16H8l5-4 5 4h-3v6h-2v-6z"/>
                    </svg>
                    <div class="dropdown-menu" id="swipe-menu">
                        <div class="dropdown-item" data-swipe="up">⬆️ Swipe Up</div>
                        <div class="dropdown-item" data-swipe="down">⬇️ Swipe Down</div>
                        <div class="dropdown-item" data-swipe="left">⬅️ Swipe Left</div>
                        <div class="dropdown-item" data-swipe="right">➡️ Swipe Right</div>
                    </div>
                </button>
                
                <button id="lock-btn" class="control-btn" data-action="lock" title="Lock/Unlock Device Screen (F5)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zM9 6c0-1.66 1.34-3 3-3s3 1.34 3 3v2H9V6z"/>
                    </svg>
                </button>
                
                <button id="record-btn" class="control-btn" data-action="record" title="Start Screen Recording (F6)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
                        <circle cx="12" cy="12" r="4" fill="currentColor"/>
                    </svg>
                </button>
                
                <button id="stream-mode-btn" class="control-btn" data-action="toggle-stream" title="Switch between WebSocket and WebRTC streaming (F7)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M4 6H2v14c0 1.1.9 2 2 2h14v-2H4V6zm16-4H8c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-1 9H9V9h10v2zm0 4H9v-2h10v2z"/>
                    </svg>
                    <span id="stream-mode-label">WebSocket</span>
                </button>
                
                <button id="stop-record-btn" class="control-btn" data-action="stop-record" title="Stop Screen Recording" style="display: none;">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/>
                        <rect x="8" y="8" width="8" height="8" fill="currentColor"/>
                    </svg>
                </button>
                
                <div class="separator"></div>
                
                <button id="quality-btn" class="control-btn dropdown-btn" title="Adjust Video Quality - Low, Medium, High, Ultra">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19.43 12.98c.04-.32.07-.64.07-.98s-.03-.66-.07-.98l2.11-1.65c.19-.15.24-.42.12-.64l-2-3.46c-.12-.22-.39-.3-.61-.22l-2.49 1c-.52-.4-1.08-.73-1.69-.98l-.38-2.65C14.46 2.18 14.25 2 14 2h-4c-.25 0-.46.18-.49.42l-.38 2.65c-.61.25-1.17.59-1.69.98l-2.49-1c-.23-.09-.49 0-.61.22l-2 3.46c-.13.22-.07.49.12.64l2.11 1.65c-.04.32-.07.65-.07.98s.03.66.07.98l-2.11 1.65c-.19.15-.24.42-.12.64l2 3.46c.12.22.39.3.61.22l2.49-1c.52.4 1.08.73 1.69.98l.38 2.65c.03.24.24.42.49.42h4c.25 0 .46-.18.49-.42l.38-2.65c.61-.25 1.17-.59 1.69-.98l2.49 1c.23.09.49 0 .61-.22l2-3.46c.12-.22.07-.49-.12-.64l-2.11-1.65zM12 15.5c-1.93 0-3.5-1.57-3.5-3.5s1.57-3.5 3.5-3.5 3.5 1.57 3.5 3.5-1.57 3.5-3.5 3.5z"/>
                    </svg>
                    <div class="dropdown-menu" id="quality-menu">
                        <div class="dropdown-item" data-quality="low">Low</div>
                        <div class="dropdown-item" data-quality="medium">Medium</div>
                        <div class="dropdown-item active" data-quality="high">High</div>
                        <div class="dropdown-item" data-quality="ultra">Ultra</div>
                    </div>
                </button>
                
                <button id="refresh-btn" class="control-btn" data-action="refresh" title="Refresh Stream Connection (F8)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                    </svg>
                </button>
                
                <button id="import-app-btn" class="control-btn" data-action="import-app" title="Import App - Install IPA or ZIP files (F9)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                        <path d="M12,11L16,15H13V19H11V15H8L12,11Z"/>
                    </svg>
                </button>
                
                <div class="separator"></div>
                
                <button id="minimize-btn" class="control-btn" title="Minimize Window">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M6 19h12v2H6z"/>
                    </svg>
                </button>
                
                <button id="close-btn" class="control-btn close" title="Close Application (Ctrl+C)">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
        </header>
        
        <!-- Main content area -->
        <main class="main-content">
            <div id="loading" class="loading">
                <div class="loading-spinner"></div>
                <p>Connecting to iOS Bridge...</p>
            </div>
            
            <div id="device-container" class="device-container" style="display: none;">
                <div class="device-shell">
                    <div class="device-screen">
                        <canvas id="video-canvas" class="video-canvas"></canvas>
                        <video id="webrtc-video" class="webrtc-video" style="display: none;" autoplay playsinline muted></video>
                        <div id="touch-overlay" class="touch-overlay"></div>
                    </div>
                </div>
            </div>
            
            <div id="error-container" class="error-container" style="display: none;">
                <div class="error-content">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="#ff4444">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
                    </svg>
                    <h3>Connection Error</h3>
                    <p id="error-message">Unable to connect to iOS Bridge server</p>
                    <button id="retry-btn" class="retry-btn">Retry Connection</button>
                </div>
            </div>
            
            <!-- Keyboard Input Section -->
            <div id="keyboard-section" class="keyboard-section" style="display: none;">
                <div class="keyboard-container">
                    <div class="keyboard-input-row">
                        <input type="text" id="keyboard-input" placeholder="Type text to send to device..." maxlength="500">
                        <button id="send-text-btn" class="keyboard-btn">Send</button>
                        <button id="clear-text-btn" class="keyboard-btn secondary">Clear</button>
                    </div>
                </div>
            </div>
        </main>
        
        <!-- Footer with status -->
        <footer class="footer">
            <div class="footer-content">
                <span id="fps-counter">FPS: 0</span>
                <span id="resolution">Resolution: 0x0</span>
                <span class="spacer"></span>
                <span id="keyboard-hint">💡 Click to focus, type to input text</span>
                <span id="stream-mode-indicator">WebSocket</span>
            </div>
        </footer>
    </div>
    
    <!-- Device info modal -->
    <div id="info-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Device Information</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body" id="info-modal-body">
                <!-- Device info will be populated here -->
            </div>
        </div>
    </div>

    <!-- App Installation modal -->
    <div id="app-install-modal" class="modal">
        <div class="modal-content app-install-modal">
            <div class="modal-header">
                <h3>📱 Install Application</h3>
                <button class="modal-close" onclick="closeModal('app-install-modal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="app-install-form">
                    <div class="file-upload-area" id="file-upload-area">
                        <input type="file" id="app-file-input" accept=".ipa,.zip" style="display: none;">
                        <div class="upload-placeholder">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="#666">
                                <path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M18,20H6V4H13V9H18V20Z"/>
                                <path d="M12,11L16,15H13V19H11V15H8L12,11Z"/>
                            </svg>
                            <p>Click to select IPA or ZIP file</p>
                            <p class="file-types">Supported: .ipa (iOS apps), .zip (app bundles)</p>
                        </div>
                        <div class="file-selected" id="file-selected" style="display: none;">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="#00aa00">
                                <path d="M9,20.42L2.79,14.21L5.62,11.38L9,14.77L18.88,4.88L21.71,7.71L9,20.42Z"/>
                            </svg>
                            <span id="selected-file-name">No file selected</span>
                        </div>
                    </div>
                    <div class="install-actions">
                        <button id="install-btn" class="install-action-btn primary" disabled>
                            📱 Install
                        </button>
                        <button id="install-launch-btn" class="install-action-btn secondary" disabled>
                            🚀 Install & Launch
                        </button>
                    </div>
                    <div class="install-progress" id="install-progress" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <p id="progress-text">Installing...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="renderer.js"></script>
</body>
</html>