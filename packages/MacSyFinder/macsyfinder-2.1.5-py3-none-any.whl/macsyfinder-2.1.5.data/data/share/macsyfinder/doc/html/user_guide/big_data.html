

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>For big data people &mdash; MacSyFinder 2.1.5 documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
      <link rel="stylesheet" type="text/css" href="../_static/_css/custom.css?v=b89f2dfc" />

  
      <script src="../_static/jquery.js?v=5d32c60e"></script>
      <script src="../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../_static/documentation_options.js?v=786ba454"></script>
      <script src="../_static/doctools.js?v=9bcbadda"></script>
      <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Macromolecular models" href="model_definition.html" />
    <link rel="prev" title="Output format" href="outputs.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            MacSyFinder
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#running-macsyfinder">Running MacSyFinder</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="new_v2.html">What’s new in MacSyFinder v2?</a></li>
<li class="toctree-l3"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html">MacSyFinder Quick Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="quickstart.html#an-example-data-set">An example data set</a></li>
<li class="toctree-l3"><a class="reference internal" href="input.html">Input and Options of MacSyFinder</a></li>
<li class="toctree-l3"><a class="reference internal" href="outputs.html">Output format</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">For big data people</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#parallelization">Parallelization</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="index.html#macsyfinder-functioning">MacSyFinder functioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="index.html#frequently-asked-questions">Frequently Asked Questions</a></li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modeler_guide/index.html">Modeller Guide</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developer_guide/index.html">Developer Guide</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MacSyFinder</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">User Guide</a></li>
      <li class="breadcrumb-item active">For big data people</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="for-big-data-people">
<h1>For big data people<a class="headerlink" href="#for-big-data-people" title="Link to this heading"></a></h1>
<section id="parallelization">
<span id="parallel"></span><h2>Parallelization<a class="headerlink" href="#parallelization" title="Link to this heading"></a></h2>
<p>The time limiting part are HMMER (search genes).
If you want to deal with a large data</p>
<ul class="simple">
<li><p>a collection of file containing replicons (each file must contains one replicon)</p></li>
<li><p>or a gembase file (with a lot of replicons, from ten to more than thousand)</p></li>
</ul>
<p>we provide a workflow to parallelize the execution by the data.
This mean that</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>We split the data input into chunks containing one replicon each (for <em>gembase</em> input file).</p></li>
<li><p>Then execute MacSyFinder in parallel on each replicon (the number of parallel tasks can be limited)</p></li>
<li><p>Then aggregate the results in one global summary.</p></li>
</ol>
</div></blockquote>
<figure class="align-default" id="id2">
<div class="graphviz"><img src="../_images/graphviz-e048f6355ae896b33fbcab05b1235620a715564a.png" alt="digraph parallel_macsyfinder_gembase {
&quot;gembase input&quot; -&gt; &quot;MSF on replicon 1&quot;;
&quot;gembase input&quot; -&gt; &quot;MSF on replicon 2&quot;;
&quot;gembase input&quot; -&gt; &quot;MSF on replicon 3&quot;;
&quot;gembase input&quot; -&gt; &quot;MSF on replicon n&quot;;
&quot;MSF on replicon 1&quot; -&gt; &quot;merge results&quot;;
&quot;MSF on replicon 2&quot; -&gt; &quot;merge results&quot;;
&quot;MSF on replicon 3&quot; -&gt; &quot;merge results&quot;;
&quot;MSF on replicon n&quot; -&gt; &quot;merge results&quot;;
}" class="graphviz" /></div>
<figcaption>
<p><span class="caption-text">Diagram of the parallel_macsyfinder workflow on gembase input</span><a class="headerlink" href="#id2" title="Link to this image"></a></p>
</figcaption>
</figure>
<figure class="align-default" id="id3">
<div class="graphviz"><img src="../_images/graphviz-d343e674fd159053aa383b9bbc9e061038f4e4ad.png" alt="digraph parallel_macsyfinder_gembase {
&quot;file 1 input&quot; -&gt; &quot;MSF on replicon 1&quot;;
&quot;file 2 input&quot; -&gt; &quot;MSF on replicon 2&quot;;
&quot;file 3 input&quot; -&gt; &quot;MSF on replicon 3&quot;;
&quot;file 4 input&quot; -&gt; &quot;MSF on replicon n&quot;;
&quot;MSF on replicon 1&quot; -&gt; &quot;merge results&quot;;
&quot;MSF on replicon 2&quot; -&gt; &quot;merge results&quot;;
&quot;MSF on replicon 3&quot; -&gt; &quot;merge results&quot;;
&quot;MSF on replicon n&quot; -&gt; &quot;merge results&quot;;
}" class="graphviz" /></div>
<figcaption>
<p><span class="caption-text">Diagram of the parallel_macsyfinder workflow on ordered or unordered replicon</span><a class="headerlink" href="#id3" title="Link to this image"></a></p>
</figcaption>
</figure>
<p>The workflow use the <a class="reference external" href="https://www.nextflow.io/">nextflow</a> framework and can be run on a single machine or a cluster.</p>
<p>First, you have to install <a class="reference external" href="https://www.nextflow.io/">nextflow</a> first, and  <a class="reference internal" href="installation.html#user-installation"><span class="std std-ref">macsyfinder</span></a>.
Then we provide 2 files (you need to download them from the MacSyFinder github repo.)</p>
<ul class="simple">
<li><p><cite>parallel_macsyfinder.nf</cite> which is the workflow itself in nextflow syntax</p></li>
<li><p><cite>nextflow.config</cite> which is a configuration file to execute the workflow.</p></li>
</ul>
<p>The workflow file should not be modified.
Whereas the profile <strong>must</strong> be adapted to the <strong>local</strong> architecture.</p>
<dl class="simple">
<dt>The file <cite>nextflow.config</cite> provide five profiles:</dt><dd><ul class="simple">
<li><p>a standard profile for local use (single machine).</p></li>
<li><p>an apptainer profile using docker image with apptainer executor (on a single machine).</p></li>
<li><p>a docker profile using docker image with docker executor (on a single machine).</p></li>
<li><p>a cluster profile.</p></li>
<li><p>a cluster profile using apptainer container system with the docker image.</p></li>
</ul>
</dd>
</dl>
<section id="how-to-get-parallel-macsyfinder">
<h3>How to get parallel_macsyfinder<a class="headerlink" href="#how-to-get-parallel-macsyfinder" title="Link to this heading"></a></h3>
<p>The release contains the workflow <cite>parallel_macsyfinder.nf</cite> and the <cite>nextflow.config</cite> at the top level of the archive
But if you use pip to install MacSyFinder you have not easily access to them.
But they can be downloaded or executed directly by using nextflow.</p>
<p>to download it</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">pull</span> <span class="n">gem</span><span class="o">-</span><span class="n">pasteur</span><span class="o">/</span><span class="n">macsyfinder</span>
</pre></div>
</div>
<p>to get the latest version or use <em>-r</em>    option to specify a version</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">pull</span> <span class="o">-</span><span class="n">r</span> <span class="n">release_2</span><span class="mf">.0</span> <span class="n">gem</span><span class="o">-</span><span class="n">pasteur</span><span class="o">/</span><span class="n">macsyfinder</span>
</pre></div>
</div>
<p>to see what you download</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">view</span> <span class="n">macsyfinder</span>
</pre></div>
</div>
<p>to execute it directly on a local host with macsyfinder already installed and with with models installed too:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">run</span> <span class="n">gem</span><span class="o">-</span><span class="n">pasteur</span><span class="o">/</span><span class="n">macsyfinder</span> <span class="o">-</span><span class="n">profile</span> <span class="n">standard</span> <span class="o">--</span><span class="n">models</span> <span class="s2">&quot;TFF-SF all&quot;</span> <span class="o">--</span><span class="n">db</span><span class="o">-</span><span class="nb">type</span> <span class="n">gembase</span> <span class="o">--</span><span class="n">sequence</span><span class="o">-</span><span class="n">db</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">my</span><span class="o">/</span><span class="n">gembase</span><span class="o">.</span><span class="n">fasta</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>or:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">run</span> <span class="o">-</span><span class="n">r</span> <span class="n">release_2</span><span class="mf">.0</span> <span class="n">gem</span><span class="o">-</span><span class="n">pasteur</span><span class="o">/</span><span class="n">macsyfinder</span> <span class="o">-</span><span class="n">profile</span> <span class="n">standard</span> <span class="o">--</span><span class="n">models</span> <span class="s2">&quot;TFF-SF all&quot;</span> <span class="o">--</span><span class="n">db</span><span class="o">-</span><span class="nb">type</span> <span class="n">gembas</span> <span class="o">--</span><span class="n">sequence</span><span class="o">-</span><span class="n">db</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">my</span><span class="o">/</span><span class="n">gembase</span><span class="o">.</span><span class="n">fasta</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>or for ordered replicon</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">run</span> <span class="n">gem</span><span class="o">-</span><span class="n">pasteur</span><span class="o">/</span><span class="n">macsyfinder</span> <span class="o">-</span><span class="n">profile</span> <span class="n">cluster_apptainer</span> <span class="o">--</span><span class="n">models</span> <span class="s2">&quot;TFF-SF all&quot;</span> <span class="o">--</span><span class="n">db</span><span class="o">-</span><span class="nb">type</span> <span class="n">ordered_replicon</span> <span class="o">--</span><span class="n">sequence</span><span class="o">-</span><span class="n">db</span> <span class="s1">&#39;&lt;path/to/replicons/*.fasta&gt;&#39;</span> <span class="o">--</span><span class="n">outdir</span> <span class="o">&lt;</span><span class="n">my_results</span><span class="o">&gt;</span>
<span class="n">nextflow</span> <span class="n">run</span> <span class="n">gem</span><span class="o">-</span><span class="n">pasteur</span><span class="o">/</span><span class="n">macsyfinder</span> <span class="o">-</span><span class="n">profile</span> <span class="n">cluster_apptainer</span> <span class="o">--</span><span class="n">models</span> <span class="s2">&quot;TFF-SF all&quot;</span> <span class="o">--</span><span class="n">db</span><span class="o">-</span><span class="nb">type</span> <span class="n">ordered_replicon</span> <span class="o">--</span><span class="n">sequence</span><span class="o">-</span><span class="n">db</span> <span class="s1">&#39;file1.fasta,file2.fasta,file3.fst&#39;</span> <span class="o">--</span><span class="n">outdir</span> <span class="o">&lt;</span><span class="n">my_results</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>or if you download the macsyfinder repository, or the the workflow with it’s configuration file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nextflow</span> <span class="n">run</span>  <span class="n">parallel_macsyfinder</span><span class="o">.</span><span class="n">nf</span> <span class="o">-</span><span class="n">profile</span> <span class="n">standard</span> <span class="o">--</span><span class="n">models</span> <span class="s2">&quot;TFF-SF all&quot;</span> <span class="o">--</span><span class="n">db</span><span class="o">-</span><span class="nb">type</span> <span class="n">ordered_replicon</span> <span class="o">--</span><span class="n">sequence</span><span class="o">-</span><span class="n">db</span> <span class="s1">&#39;data/base/split/GCF_*.fasta&#39;</span> <span class="o">--</span><span class="n">outdir</span> <span class="n">GCF</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<ul class="simple">
<li><p>For <em>gembase</em> data the workflow expected one file with several replicons.</p></li>
<li><p>For <em>ordered_replicon</em> or <em>unordered</em> the workflow expected several files with one replicon per file.</p></li>
</ul>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>See the double quotes surrounding the models value <em>–models “TFF-SF all”</em> with out quoting
macsyfinder will not received the right argument.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>See the (double) quotes surrounding the models value <em>–sequence-db ‘&lt;path/to/replicons/</em>.fasta&gt;’* with out quoting
parallel_macsyfinder will not received all files.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When you analyzed ordered or unordered replicons (<em>–db-type</em> set to <em>ordered_replicon</em> or <em>unordered</em>)
the <em>–out-dir</em> option is <strong>REQUIRED</strong>.</p>
</div>
</section>
<section id="standard-profile">
<h3>standard profile<a class="headerlink" href="#standard-profile" title="Link to this heading"></a></h3>
<p>This profile is used if you want to parallelize MacSyFinder on your machine.
You can specify the number of tasks in parallel by setting the <em>queueSize</em> value
You can also fix the number of cpu used by each task (macsyfinder –worker option see <a class="reference internal" href="input.html#general-options"><span class="std std-ref">macsyfinder options</span></a>)
by setting the <cite>params.worker</cite> parameter in <cite>nextflow.config</cite></p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">standard</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">executor</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;local&#39;</span>
<span class="w">        </span><span class="nx">queueSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">process</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">errorStrategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ignore&#39;</span>
<span class="w">        </span><span class="nx">withName</span><span class="o">:</span><span class="w"> </span><span class="nx">macsyfinder</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">cpus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">worker</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Almost options available in non parallel version are also available for the parallel one.
except:
* <code class="docutils literal notranslate"><span class="pre">--db-type</span></code> which is set to <em>gembase</em> (only data type supported for the parallelized macsyfinder version).
* <code class="docutils literal notranslate"><span class="pre">--out-dir</span></code> which is not available.</p>
<p>A typical command line will be:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">parallel_macsyfinder</span><span class="o">.</span><span class="n">nf</span> <span class="o">-</span><span class="n">profile</span> <span class="n">standard</span> <span class="o">--</span><span class="n">models</span> <span class="s2">&quot;TFF-SF all&quot;</span> <span class="o">--</span><span class="n">sequence</span><span class="o">-</span><span class="n">db</span> <span class="o">&lt;</span><span class="n">path</span><span class="o">/</span><span class="n">to</span><span class="o">/</span><span class="n">my</span><span class="o">/</span><span class="n">gembase</span><span class="o">.</span><span class="n">fasta</span><span class="o">&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The options starting with one dash are for nextflow workflow engine,
whereas the options starting by two dashes are for macsyfinder workflow.</p>
</div>
<p>If you execute this line, 2 kinds of directories will be created.</p>
<blockquote>
<div><ul class="simple">
<li><p>One named <cite>work</cite> containing lot of subdirectories this for all jobs
launch by nextflow.</p></li>
<li><p>Directories named <cite>merged_macsyfinder_results_XXX</cite> where XXX is the name of the gembase file.
This directory contain the final results as in non parallel version.</p></li>
</ul>
</div></blockquote>
</section>
<section id="standard-apptainer-or-standard-docker-profile">
<h3>standard_apptainer or standard_docker profile<a class="headerlink" href="#standard-apptainer-or-standard-docker-profile" title="Link to this heading"></a></h3>
<p>If you have not installed <em>macsyfinder</em> but you use it through a container
docker or <a class="reference external" href="apptainer">https://apptainer.org/</a> (former <em>singularity</em>)
We provide profiles for these situations.
With the command line below nextflow will download parallel_macsyfinder from github and
download the macsyfinder image from the docker-hub (<a class="reference external" href="https://hub.docker.com/r/gempasteur/macsyfinder">https://hub.docker.com/r/gempasteur/macsyfinder</a>)
(and apptainer convert the image on the right format on the fly)
so you haven’t to install anything except nextflow and apptainer or docker.</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">standard_apptainer</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">executor</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;local&#39;</span>
<span class="w">        </span><span class="nx">queueSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">process</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">errorStrategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ignore&#39;</span>
<span class="w">        </span><span class="nx">container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;docker://gempasteur/macsyfinder:latest&#39;</span>
<span class="w">        </span><span class="nx">withName</span><span class="o">:</span><span class="w"> </span><span class="nx">macsyfinder</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">cpus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">worker</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">singularity</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">standard_docker</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">executor</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;local&#39;</span>
<span class="w">        </span><span class="nx">queueSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">4</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">process</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">errorStrategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ignore&#39;</span>
<span class="w">        </span><span class="nx">container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;macsyfinder&#39;</span>
<span class="w">        </span><span class="nx">withName</span><span class="o">:</span><span class="w"> </span><span class="nx">macsyfinder</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">cpus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">worker</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">docker</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="nx">runOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;--user $(id -u):$(id -g)&#39;</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The execution is similar than for installed macsyfinder</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./parallel_macsyfinder.nf<span class="w"> </span>-profile<span class="w"> </span>standard_apptainer<span class="w"> </span>--models<span class="w"> </span><span class="s2">&quot;TFF-SF all&quot;</span><span class="w"> </span>--sequence-db<span class="w"> </span>&lt;path/to/my/gembase.fasta&gt;
</pre></div>
</div>
<p>or</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./parallel_macsyfinder.nf<span class="w"> </span>-profile<span class="w"> </span>standard_docker<span class="w"> </span>--models<span class="w"> </span><span class="s2">&quot;TFF-SF all&quot;</span><span class="w"> </span>--sequence-db<span class="w"> </span>&lt;path/to/my/gembase.fasta&gt;
</pre></div>
</div>
</section>
<section id="cluster-profile">
<h3>cluster profile<a class="headerlink" href="#cluster-profile" title="Link to this heading"></a></h3>
<p>The cluster profile is intended to work on a cluster managed by SLURM.
If your cluster is managed by an other drm replace executor name by the right value
(see <a class="reference external" href="https://www.nextflow.io/docs/latest/executor.html">nextflow supported cluster</a> )</p>
<p>You can also manage</p>
<ul class="simple">
<li><p>The number of tasks in parallel with the <cite>executor.queueSize</cite> parameter (here 500).
If you remove this line, the system will send in parallel as many jobs as there are replicons in your data set.</p></li>
<li><p>The queue (or partition in <em>Slurm</em> teminology) with <cite>process.queue</cite> parameter (here <em>common,dedicated</em>)</p></li>
<li><p>and some options specific to your cluster management systems with <cite>process.clusterOptions</cite> parameter</p></li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nx">cluster</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">executor</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;slurm&#39;</span>
<span class="w">        </span><span class="nx">queueSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">500</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">process</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">errorStrategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ignore&#39;</span>
<span class="w">        </span><span class="nx">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;common,dedicated&#39;</span>
<span class="w">        </span><span class="nx">clusterOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;--qos=fast&#39;</span>
<span class="w">        </span><span class="nx">withName</span><span class="o">:</span><span class="w"> </span><span class="nx">macsyfinder</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">cpus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">worker</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>To run the parallel version on cluster, for instance on a cluster managed by slurm,
I can launch the main nextflow process in one slot. The parallelization and the submission on the other slots
is made by nextflow itself.
Below a command line to run parallel_macsyfinder and use 3 cpus per macsyfinder task,
each macsyfinder task can be executed on different machine, each macsyfinder task claim 2 cpus/cores
(cpu in <em>nextflow</em> terminology/ cores for hardware) to speed up the genes search.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch<span class="w"> </span>--qos<span class="w"> </span>fast<span class="w"> </span>-p<span class="w"> </span>common<span class="w"> </span>nextflow<span class="w"> </span>run<span class="w"> </span>parallel_macsyfinder.nf<span class="w"> </span>-profile<span class="w"> </span>cluster<span class="w"> </span>--models<span class="w"> </span><span class="s2">&quot;TFF-SF all&quot;</span><span class="w"> </span>--sequence-db<span class="w"> </span>&lt;path/to/my/gembase.fasta&gt;<span class="w"> </span>--worker<span class="w"> </span><span class="m">3</span>
</pre></div>
</div>
<p>The results will be the same as describe in local execution.</p>
</section>
<section id="cluster-apptainer-profiles">
<h3>cluster_apptainer profiles<a class="headerlink" href="#cluster-apptainer-profiles" title="Link to this heading"></a></h3>
<p>You can also use the macsyfinder apptainer image on a cluster, for this use the profile <em>cluster_apptainer</em>.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch<span class="w"> </span>--qos<span class="w"> </span>fast<span class="w"> </span>-p<span class="w"> </span>common<span class="w"> </span>nextflow<span class="w"> </span>run<span class="w">  </span>gem-pasteur/macsyfinder<span class="w"> </span>-profile<span class="w"> </span>cluster_apttainer<span class="w"> </span>--models<span class="w"> </span><span class="s2">&quot;TFF-SF all&quot;</span><span class="w"> </span>--sequence-db<span class="w"> </span>&lt;path/to/my/gembase.fasta&gt;
</pre></div>
</div>
<p>In the case of your cluster cannot reach the world wide web. you have to download the singularity image</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apptainer</span> <span class="n">pull</span> <span class="o">--</span><span class="n">name</span> <span class="n">macsyfinder</span><span class="o">.</span><span class="n">simg</span> <span class="n">docker</span><span class="p">:</span><span class="o">//</span><span class="n">gempasteur</span><span class="o">/</span><span class="n">macsyfinder</span>
</pre></div>
</div>
<p>Then move the image on your cluster
modify the nextflow.config to point on the location of the image, and adapt the cluster options
(executor, queue, …) to your architecture</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="w"> </span><span class="nx">cluster_apptainer</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="nx">executor</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;slurm&#39;</span>
<span class="w">        </span><span class="nx">queueSize</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">500</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="nx">process</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">errorStrategy</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;ignore&#39;</span>
<span class="w">        </span><span class="nx">container</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;/path/to/macsyfinder.simg&#39;</span>
<span class="w">        </span><span class="nx">queue</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;common,dedicated&#39;</span>
<span class="w">        </span><span class="nx">clusterOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;--qos=fast&#39;</span>
<span class="w">        </span><span class="nx">withName</span><span class="o">:</span><span class="w"> </span><span class="nx">macsyfinder</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="nx">cpus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">params</span><span class="p">.</span><span class="nx">worker</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nx">singularity</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nx">enabled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">true</span>
<span class="w">        </span><span class="nx">runOptions</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;-H $HOME -B /pasteur&#39;</span>
<span class="w">        </span><span class="nx">autoMounts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">false</span>
<span class="w">   </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>then run it</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>sbatch<span class="w"> </span>--qos<span class="w"> </span>fast<span class="w"> </span>-p<span class="w"> </span>common<span class="w"> </span>nextflow<span class="w"> </span>run<span class="w">  </span>./parallel_macsyfinder.nf<span class="w"> </span>-profile<span class="w"> </span>cluster_apptainer<span class="w"> </span>--models<span class="w"> </span><span class="s2">&quot;TFF-SF all&quot;</span><span class="w"> </span>--sequence-db<span class="w"> </span>&lt;path/to/my/gembase.fasta&gt;
</pre></div>
</div>
<p>If you want to have more details about the jobs execution you can add some options to generate report:</p>
</section>
<section id="execution-report">
<h3>Execution report<a class="headerlink" href="#execution-report" title="Link to this heading"></a></h3>
<p>To enable the creation of this report add the <code class="docutils literal notranslate"><span class="pre">-with-report</span></code> command line option when
launching the pipeline execution. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nextflow<span class="w"> </span>run<span class="w">  </span>./parallel_macsyfinder.nf<span class="w"> </span>-profile<span class="w"> </span>standard<span class="w"> </span>-with-report<span class="w"> </span><span class="o">[</span>file<span class="w"> </span>name<span class="o">]</span><span class="w"> </span>--models<span class="w"> </span><span class="s2">&quot;TFF-SF all&quot;</span><span class="w"> </span>--sequence-db<span class="w"> </span>&lt;path/to/my/gembase.fasta&gt;
</pre></div>
</div>
<p>It creates an HTML execution report: a single document which includes many useful metrics about
a workflow execution. For further details see <a class="reference external" href="https://www.nextflow.io/docs/latest/tracing.html#execution-report">https://www.nextflow.io/docs/latest/tracing.html#execution-report</a></p>
</section>
<section id="trace-report">
<h3>Trace report<a class="headerlink" href="#trace-report" title="Link to this heading"></a></h3>
<p>In order to create the execution trace file add the <code class="docutils literal notranslate"><span class="pre">-with-trace</span></code> command line option when launching the pipeline
execution. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nextflow<span class="w"> </span>run<span class="w">  </span>./parallel_macsyfinder.nf<span class="w"> </span>-profile<span class="w"> </span>standard<span class="w"> </span>-with-trace<span class="w"> </span>--models<span class="w"> </span><span class="s2">&quot;TFF-SF all&quot;</span><span class="w"> </span>--sequence-db<span class="w"> </span>&lt;path/to/my/gembase.fasta&gt;
</pre></div>
</div>
<p>It creates an HTML timeline for all processes executed in your pipeline.
For further details see <a class="reference external" href="https://www.nextflow.io/docs/latest/tracing.html#timeline-report">https://www.nextflow.io/docs/latest/tracing.html#timeline-report</a></p>
</section>
<section id="timeline-report">
<h3>Timeline report<a class="headerlink" href="#timeline-report" title="Link to this heading"></a></h3>
<p>To enable the creation of the timeline report add the <code class="docutils literal notranslate"><span class="pre">-with-timeline</span></code>
command line option when launching the pipeline execution. For example:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>nextflow<span class="w"> </span>run<span class="w">  </span>./parallel_macsyfinder.nf<span class="w"> </span>-profile<span class="w"> </span>standard<span class="w"> </span>-with-timeline<span class="w"> </span><span class="o">[</span>file<span class="w"> </span>name<span class="o">]</span><span class="w"> </span>--models<span class="w"> </span><span class="s2">&quot;TFF-SF all&quot;</span><span class="w"> </span>--sequence-db<span class="w"> </span>&lt;path/to/my/gembase.fasta&gt;<span class="w"> </span>...
</pre></div>
</div>
<p>It creates an execution tracing file that contains some useful information about
each process executed in your pipeline script, including: submission time, start time, completion time,
cpu and memory used. For further details see <a class="reference external" href="https://www.nextflow.io/docs/latest/tracing.html#trace-report">https://www.nextflow.io/docs/latest/tracing.html#trace-report</a></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>When you run parallelize version of macsyfinder the hhm score for each genes can be different than in non parallel version.
As hmmsearch use the size of the sequence database to compute the score.</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="outputs.html" class="btn btn-neutral float-left" title="Output format" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="model_definition.html" class="btn btn-neutral float-right" title="Macromolecular models" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014-2025, &#39;Institut Pasteur (Paris), CNRS&#39;.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  

<div class="licensing">
  <p>
    This documentation is licensed under <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International License
      <img src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png">.
    </a>
  </p>
</div>


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

<a class="github" href="https://github.com/gem-pasteur/macsyfinder">
    <img style="position: absolute; top: 0; right: 0; border: 0;"
         src="https://raw.githubusercontent.com/gem-pasteur/macsyfinder/refs/heads/main/doc/source/_static/github-banner.svg"
         alt="Fork me on GitHub" />
</a>



</body>
</html>