import{r as e,j as t}from"./react-Blzc5Mwu.js";const n=["shift","alt","meta","mod","ctrl","control"],o={esc:"escape",return:"enter",left:"arrowleft",right:"arrowright",up:"arrowup",down:"arrowdown",ShiftLeft:"shift",ShiftRight:"shift",AltLeft:"alt",AltRight:"alt",MetaLeft:"meta",MetaRight:"meta",OSLeft:"meta",OSRight:"meta",ControlLeft:"ctrl",ControlRight:"ctrl"};function i(e){return(o[e.trim()]||e.trim()).toLowerCase().replace(/key|digit|numpad/,"")}function r(e){return n.includes(e)}function l(e,t=","){return e.toLowerCase().split(t)}function u(e,t="+",o=">",r=!1,l){let u=[],c=!1;e.includes(o)?(c=!0,u=e.toLocaleLowerCase().split(o).map(e=>i(e))):u=e.toLocaleLowerCase().split(t).map(e=>i(e));return{...{alt:u.includes("alt"),ctrl:u.includes("ctrl")||u.includes("control"),shift:u.includes("shift"),meta:u.includes("meta"),mod:u.includes("mod"),useKey:r},keys:u.filter(e=>!n.includes(e)),description:l,isSequence:c}}typeof document<"u"&&(document.addEventListener("keydown",e=>{void 0!==e.code&&a([i(e.code)])}),document.addEventListener("keyup",e=>{void 0!==e.code&&d([i(e.code)])})),typeof window<"u"&&(window.addEventListener("blur",()=>{c.clear()}),window.addEventListener("contextmenu",()=>{setTimeout(()=>{c.clear()},0)}));const c=new Set;function s(e){return Array.isArray(e)}function a(e){const t=Array.isArray(e)?e:[e];c.has("meta")&&c.forEach(e=>!r(e)&&c.delete(e.toLowerCase())),t.forEach(e=>c.add(e.toLowerCase()))}function d(e){const t=Array.isArray(e)?e:[e];"meta"===e?c.clear():t.forEach(e=>c.delete(e.toLowerCase()))}function f(e,t=!1){const{target:n,composed:o}=e;let i;return i=function(e){return!!e.tagName&&!e.tagName.startsWith("-")&&e.tagName.includes("-")}(n)&&o?e.composedPath()[0]&&e.composedPath()[0].tagName:n&&n.tagName,s(t)?!!(i&&t&&t.some(e=>e.toLowerCase()===i.toLowerCase())):!!(i&&t&&t)}const v=(e,t,n=!1)=>{const{alt:o,meta:r,mod:l,shift:u,ctrl:a,keys:d,useKey:f}=t,{code:v,key:y,ctrlKey:m,metaKey:p,shiftKey:h,altKey:k}=e,w=i(v);if(f&&1===(null==d?void 0:d.length)&&d.includes(y))return!0;if(!(null!=d&&d.includes(w)||["ctrl","control","unknown","meta","alt","shift","os"].includes(w)))return!1;if(!n){if(o!==k&&"alt"!==w||u!==h&&"shift"!==w)return!1;if(l){if(!p&&!m)return!1}else if(r!==p&&"meta"!==w&&"os"!==w||a!==m&&"ctrl"!==w&&"control"!==w)return!1}return!(!d||1!==d.length||!d.includes(w))||(d?function(e,t=","){return(s(e)?e:e.split(t)).every(e=>c.has(e.trim().toLowerCase()))}(d):!d)},y=e.createContext(void 0);function m({addHotkey:e,removeHotkey:n,children:o}){return t.jsx(y.Provider,{value:{addHotkey:e,removeHotkey:n},children:o})}function p(e,t){return e&&t&&"object"==typeof e&&"object"==typeof t?Object.keys(e).length===Object.keys(t).length&&Object.keys(e).reduce((n,o)=>n&&p(e[o],t[o]),!0):e===t}const h=e.createContext({hotkeys:[],activeScopes:[],toggleScope:()=>{},enableScope:()=>{},disableScope:()=>{}}),k=({initiallyActiveScopes:n=["*"],children:o})=>{const[i,r]=e.useState(n),[l,u]=e.useState([]),c=e.useCallback(e=>{r(t=>t.includes("*")?[e]:Array.from(new Set([...t,e])))},[]),s=e.useCallback(e=>{r(t=>t.filter(t=>t!==e))},[]),a=e.useCallback(e=>{r(t=>t.includes(e)?t.filter(t=>t!==e):t.includes("*")?[e]:Array.from(new Set([...t,e])))},[]),d=e.useCallback(e=>{u(t=>[...t,e])},[]),f=e.useCallback(e=>{u(t=>t.filter(t=>!p(t,e)))},[]);return t.jsx(h.Provider,{value:{activeScopes:i,hotkeys:l,enableScope:c,disableScope:s,toggleScope:a},children:t.jsx(m,{addHotkey:d,removeHotkey:f,children:o})})};const w=e=>{e.stopPropagation(),e.preventDefault(),e.stopImmediatePropagation()},g=typeof window<"u"?e.useLayoutEffect:e.useEffect;function L(t,n,o,c){const m=e.useRef(null),k=e.useRef(!1),L=o instanceof Array?c instanceof Array?void 0:c:o,S=s(t)?t.join(null==L?void 0:L.delimiter):t,C=o instanceof Array?o:c instanceof Array?c:void 0,b=e.useCallback(n,C??[]),E=e.useRef(b);E.current=C?b:n;const K=function(t){const n=e.useRef(void 0);return p(n.current,t)||(n.current=t),n.current}(L),{activeScopes:A}=e.useContext(h),j=e.useContext(y);return g(()=>{if(!1===(null==K?void 0:K.enabled)||!function(e,t){return!(0!==e.length||!t)||!t||e.some(e=>t.includes(e))||e.includes("*")}(A,null==K?void 0:K.scopes))return;let e,t=[];const n=(n,o=!1)=>{var c;if(!function(e){return f(e,["input","textarea","select"])}(n)||f(n,null==K?void 0:K.enableOnFormTags)){if(null!==m.current){const e=m.current.getRootNode();if((e instanceof Document||e instanceof ShadowRoot)&&e.activeElement!==m.current&&!m.current.contains(e.activeElement))return void w(n)}null!=(c=n.target)&&c.isContentEditable&&(null==K||!K.enableOnContentEditable)||l(S,null==K?void 0:K.delimiter).forEach(l=>{var c,s,a,d;if(l.includes((null==K?void 0:K.splitKey)??"+")&&l.includes((null==K?void 0:K.sequenceSplitKey)??">"))return;const f=u(l,null==K?void 0:K.splitKey,null==K?void 0:K.sequenceSplitKey,null==K?void 0:K.useKey,null==K?void 0:K.description);if(f.isSequence){e=setTimeout(()=>{t=[]},(null==K?void 0:K.sequenceTimeoutMs)??1e3);const o=f.useKey?n.key:i(n.code);if(r(o.toLowerCase()))return;t.push(o);if(o!==(null==(c=f.keys)?void 0:c[t.length-1]))return t=[],void(e&&clearTimeout(e));t.length===(null==(s=f.keys)?void 0:s.length)&&(E.current(n,f),e&&clearTimeout(e),t=[])}else if(v(n,f,null==K?void 0:K.ignoreModifiers)||null!=(a=f.keys)&&a.includes("*")){if(null!=(d=null==K?void 0:K.ignoreEventWhen)&&d.call(K,n)||o&&k.current)return;if(function(e,t,n){("function"==typeof n&&n(e,t)||!0===n)&&e.preventDefault()}(n,f,null==K?void 0:K.preventDefault),!function(e,t,n){return"function"==typeof n?n(e,t):!0===n||void 0===n}(n,f,null==K?void 0:K.enabled))return void w(n);E.current(n,f),o||(k.current=!0)}})}},o=e=>{void 0!==e.code&&(a(i(e.code)),(void 0===(null==K?void 0:K.keydown)&&!0!==(null==K?void 0:K.keyup)||null!=K&&K.keydown)&&n(e))},c=e=>{void 0!==e.code&&(d(i(e.code)),k.current=!1,null!=K&&K.keyup&&n(e,!0))},s=m.current||(null==L?void 0:L.document)||document;return s.addEventListener("keyup",c,null==L?void 0:L.eventListenerOptions),s.addEventListener("keydown",o,null==L?void 0:L.eventListenerOptions),j&&l(S,null==K?void 0:K.delimiter).forEach(e=>j.addHotkey(u(e,null==K?void 0:K.splitKey,null==K?void 0:K.sequenceSplitKey,null==K?void 0:K.useKey,null==K?void 0:K.description))),()=>{s.removeEventListener("keyup",c,null==L?void 0:L.eventListenerOptions),s.removeEventListener("keydown",o,null==L?void 0:L.eventListenerOptions),j&&l(S,null==K?void 0:K.delimiter).forEach(e=>j.removeHotkey(u(e,null==K?void 0:K.splitKey,null==K?void 0:K.sequenceSplitKey,null==K?void 0:K.useKey,null==K?void 0:K.description))),t=[],e&&clearTimeout(e)}},[S,K,A]),m}export{k as h,L as w};
