import{l as e}from"./longest-streak-2qYzcRvv.js";import{c as t}from"./micromark-util-classify-character-D70wJgn_.js";import{v as n}from"./unist-util-visit-BGZk_7Z4.js";import{t as r}from"./mdast-util-to-string-Ck87fAyN.js";import{E as o}from"./unist-util-visit-parents-DrBR4cjY.js";import{p as i}from"./mdast-util-phrasing-Bu1DMNL2.js";function s(e,t,n){return">"+(n?"":" ")+e}function c(e,t){return a(e,t.inConstruct,!0)&&!a(e,t.notInConstruct,!1)}function a(e,t,n){if("string"==typeof t&&(t=[t]),!t||0===t.length)return n;let r=-1;for(;++r<t.length;)if(e.includes(t[r]))return!0;return!1}function u(e,t,n,r){let o=-1;for(;++o<n.unsafe.length;)if("\n"===n.unsafe[o].character&&c(n.stack,n.unsafe[o]))return/[ \t]/.test(r.before)?"":" ";return"\\\n"}function l(e,t,n){return(n?"":"    ")+e}function f(e){const t=e.options.quote||'"';if('"'!==t&&"'"!==t)throw new Error("Cannot serialize title with `"+t+"` for `options.quote`, expected `\"`, or `'`");return t}function d(e){return"&#x"+e.toString(16).toUpperCase()+";"}function h(e,n,r){const o=t(e),i=t(n);return void 0===o?void 0===i?"_"===r?{inside:!0,outside:!0}:{inside:!1,outside:!1}:1===i?{inside:!0,outside:!0}:{inside:!1,outside:!0}:1===o?void 0===i?{inside:!1,outside:!1}:1===i?{inside:!0,outside:!0}:{inside:!1,outside:!1}:void 0===i?{inside:!1,outside:!1}:1===i?{inside:!0,outside:!1}:{inside:!1,outside:!1}}function m(e,t,n,r){const o=function(e){const t=e.options.emphasis||"*";if("*"!==t&&"_"!==t)throw new Error("Cannot serialize emphasis with `"+t+"` for `options.emphasis`, expected `*`, or `_`");return t}(n),i=n.enter("emphasis"),s=n.createTracker(r),c=s.move(o);let a=s.move(n.containerPhrasing(e,{after:o,before:c,...s.current()}));const u=a.charCodeAt(0),l=h(r.before.charCodeAt(r.before.length-1),u,o);l.inside&&(a=d(u)+a.slice(1));const f=a.charCodeAt(a.length-1),m=h(r.after.charCodeAt(0),f,o);m.inside&&(a=a.slice(0,-1)+d(f));const p=s.move(o);return i(),n.attentionEncodeSurroundingInfo={after:m.outside,before:l.outside},c+a+p}function p(e){return e.value||""}function v(e,t,n,r){const o=f(n),i='"'===o?"Quote":"Apostrophe",s=n.enter("image");let c=n.enter("label");const a=n.createTracker(r);let u=a.move("![");return u+=a.move(n.safe(e.alt,{before:u,after:"]",...a.current()})),u+=a.move("]("),c(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(c=n.enter("destinationLiteral"),u+=a.move("<"),u+=a.move(n.safe(e.url,{before:u,after:">",...a.current()})),u+=a.move(">")):(c=n.enter("destinationRaw"),u+=a.move(n.safe(e.url,{before:u,after:e.title?" ":")",...a.current()}))),c(),e.title&&(c=n.enter(`title${i}`),u+=a.move(" "+o),u+=a.move(n.safe(e.title,{before:u,after:o,...a.current()})),u+=a.move(o),c()),u+=a.move(")"),s(),u}function k(e,t,n,r){const o=e.referenceType,i=n.enter("imageReference");let s=n.enter("label");const c=n.createTracker(r);let a=c.move("![");const u=n.safe(e.alt,{before:a,after:"]",...c.current()});a+=c.move(u+"]["),s();const l=n.stack;n.stack=[],s=n.enter("reference");const f=n.safe(n.associationId(e),{before:a,after:"]",...c.current()});return s(),n.stack=l,i(),"full"!==o&&u&&u===f?"shortcut"===o?a=a.slice(0,-1):a+=c.move("]"):a+=c.move(f+"]"),a}function g(e,t,n){let r=e.value||"",o="`",i=-1;for(;new RegExp("(^|[^`])"+o+"([^`]|$)").test(r);)o+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++i<n.unsafe.length;){const e=n.unsafe[i],t=n.compilePattern(e);let o;if(e.atBreak)for(;o=t.exec(r);){let e=o.index;10===r.charCodeAt(e)&&13===r.charCodeAt(e-1)&&e--,r=r.slice(0,e)+" "+r.slice(o.index+1)}}return o+r+o}function b(e,t){const n=r(e);return Boolean(!t.options.resourceLink&&e.url&&!e.title&&e.children&&1===e.children.length&&"text"===e.children[0].type&&(n===e.url||"mailto:"+n===e.url)&&/^[a-z][a-z+.-]+:/i.test(e.url)&&!/[\0- <>\u007F]/.test(e.url))}function w(e,t,n,r){const o=f(n),i='"'===o?"Quote":"Apostrophe",s=n.createTracker(r);let c,a;if(b(e,n)){const t=n.stack;n.stack=[],c=n.enter("autolink");let r=s.move("<");return r+=s.move(n.containerPhrasing(e,{before:r,after:">",...s.current()})),r+=s.move(">"),c(),n.stack=t,r}c=n.enter("link"),a=n.enter("label");let u=s.move("[");return u+=s.move(n.containerPhrasing(e,{before:u,after:"](",...s.current()})),u+=s.move("]("),a(),!e.url&&e.title||/[\0- \u007F]/.test(e.url)?(a=n.enter("destinationLiteral"),u+=s.move("<"),u+=s.move(n.safe(e.url,{before:u,after:">",...s.current()})),u+=s.move(">")):(a=n.enter("destinationRaw"),u+=s.move(n.safe(e.url,{before:u,after:e.title?" ":")",...s.current()}))),a(),e.title&&(a=n.enter(`title${i}`),u+=s.move(" "+o),u+=s.move(n.safe(e.title,{before:u,after:o,...s.current()})),u+=s.move(o),a()),u+=s.move(")"),c(),u}function x(e,t,n,r){const o=e.referenceType,i=n.enter("linkReference");let s=n.enter("label");const c=n.createTracker(r);let a=c.move("[");const u=n.containerPhrasing(e,{before:a,after:"]",...c.current()});a+=c.move(u+"]["),s();const l=n.stack;n.stack=[],s=n.enter("reference");const f=n.safe(n.associationId(e),{before:a,after:"]",...c.current()});return s(),n.stack=l,i(),"full"!==o&&u&&u===f?"shortcut"===o?a=a.slice(0,-1):a+=c.move("]"):a+=c.move(f+"]"),a}function C(e){const t=e.options.bullet||"*";if("*"!==t&&"+"!==t&&"-"!==t)throw new Error("Cannot serialize items with `"+t+"` for `options.bullet`, expected `*`, `+`, or `-`");return t}function A(e){const t=e.options.rule||"*";if("*"!==t&&"-"!==t&&"_"!==t)throw new Error("Cannot serialize rules with `"+t+"` for `options.rule`, expected `*`, `-`, or `_`");return t}function I(e,t,n,r){const o=function(e){const t=e.options.strong||"*";if("*"!==t&&"_"!==t)throw new Error("Cannot serialize strong with `"+t+"` for `options.strong`, expected `*`, or `_`");return t}(n),i=n.enter("strong"),s=n.createTracker(r),c=s.move(o+o);let a=s.move(n.containerPhrasing(e,{after:o,before:c,...s.current()}));const u=a.charCodeAt(0),l=h(r.before.charCodeAt(r.before.length-1),u,o);l.inside&&(a=d(u)+a.slice(1));const f=a.charCodeAt(a.length-1),m=h(r.after.charCodeAt(0),f,o);m.inside&&(a=a.slice(0,-1)+d(f));const p=s.move(o+o);return i(),n.attentionEncodeSurroundingInfo={after:m.outside,before:l.outside},c+a+p}m.peek=function(e,t,n){return n.options.emphasis||"*"},p.peek=function(){return"<"},v.peek=function(){return"!"},k.peek=function(){return"!"},g.peek=function(){return"`"},w.peek=function(e,t,n){return b(e,n)?"<":"["},x.peek=function(){return"["},I.peek=function(e,t,n){return n.options.strong||"*"};const E={blockquote:function(e,t,n,r){const o=n.enter("blockquote"),i=n.createTracker(r);i.move("> "),i.shift(2);const c=n.indentLines(n.containerFlow(e,i.current()),s);return o(),c},break:u,code:function(t,n,r,o){const i=function(e){const t=e.options.fence||"`";if("`"!==t&&"~"!==t)throw new Error("Cannot serialize code with `"+t+"` for `options.fence`, expected `` ` `` or `~`");return t}(r),s=t.value||"",c="`"===i?"GraveAccent":"Tilde";if(function(e,t){return Boolean(!1===t.options.fences&&e.value&&!e.lang&&/[^ \r\n]/.test(e.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(e.value))}(t,r)){const e=r.enter("codeIndented"),t=r.indentLines(s,l);return e(),t}const a=r.createTracker(o),u=i.repeat(Math.max(e(s,i)+1,3)),f=r.enter("codeFenced");let d=a.move(u);if(t.lang){const e=r.enter(`codeFencedLang${c}`);d+=a.move(r.safe(t.lang,{before:d,after:" ",encode:["`"],...a.current()})),e()}if(t.lang&&t.meta){const e=r.enter(`codeFencedMeta${c}`);d+=a.move(" "),d+=a.move(r.safe(t.meta,{before:d,after:"\n",encode:["`"],...a.current()})),e()}return d+=a.move("\n"),s&&(d+=a.move(s+"\n")),d+=a.move(u),f(),d},definition:function(e,t,n,r){const o=f(n),i='"'===o?"Quote":"Apostrophe",s=n.enter("definition");let c=n.enter("label");const a=n.createTracker(r);let u=a.move("[");return u+=a.move(n.safe(n.associationId(e),{before:u,after:"]",...a.current()})),u+=a.move("]: "),c(),!e.url||/[\0- \u007F]/.test(e.url)?(c=n.enter("destinationLiteral"),u+=a.move("<"),u+=a.move(n.safe(e.url,{before:u,after:">",...a.current()})),u+=a.move(">")):(c=n.enter("destinationRaw"),u+=a.move(n.safe(e.url,{before:u,after:e.title?" ":"\n",...a.current()}))),c(),e.title&&(c=n.enter(`title${i}`),u+=a.move(" "+o),u+=a.move(n.safe(e.title,{before:u,after:o,...a.current()})),u+=a.move(o),c()),s(),u},emphasis:m,hardBreak:u,heading:function(e,t,i,s){const c=Math.max(Math.min(6,e.depth||1),1),a=i.createTracker(s);if(function(e,t){let i=!1;return n(e,function(e){if("value"in e&&/\r?\n|\r/.test(e.value)||"break"===e.type)return i=!0,o}),Boolean((!e.depth||e.depth<3)&&r(e)&&(t.options.setext||i))}(e,i)){const t=i.enter("headingSetext"),n=i.enter("phrasing"),r=i.containerPhrasing(e,{...a.current(),before:"\n",after:"\n"});return n(),t(),r+"\n"+(1===c?"=":"-").repeat(r.length-(Math.max(r.lastIndexOf("\r"),r.lastIndexOf("\n"))+1))}const u="#".repeat(c),l=i.enter("headingAtx"),f=i.enter("phrasing");a.move(u+" ");let h=i.containerPhrasing(e,{before:"# ",after:"\n",...a.current()});return/^[\t ]/.test(h)&&(h=d(h.charCodeAt(0))+h.slice(1)),h=h?u+" "+h:u,i.options.closeAtx&&(h+=" "+u),f(),l(),h},html:p,image:v,imageReference:k,inlineCode:g,link:w,linkReference:x,list:function(e,t,n,r){const o=n.enter("list"),i=n.bulletCurrent;let s=e.ordered?function(e){const t=e.options.bulletOrdered||".";if("."!==t&&")"!==t)throw new Error("Cannot serialize items with `"+t+"` for `options.bulletOrdered`, expected `.` or `)`");return t}(n):C(n);const c=e.ordered?"."===s?")":".":function(e){const t=C(e),n=e.options.bulletOther;if(!n)return"*"===t?"-":"*";if("*"!==n&&"+"!==n&&"-"!==n)throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===t)throw new Error("Expected `bullet` (`"+t+"`) and `bulletOther` (`"+n+"`) to be different");return n}(n);let a=!(!t||!n.bulletLastUsed)&&s===n.bulletLastUsed;if(!e.ordered){const t=e.children?e.children[0]:void 0;if("*"!==s&&"-"!==s||!t||t.children&&t.children[0]||"list"!==n.stack[n.stack.length-1]||"listItem"!==n.stack[n.stack.length-2]||"list"!==n.stack[n.stack.length-3]||"listItem"!==n.stack[n.stack.length-4]||0!==n.indexStack[n.indexStack.length-1]||0!==n.indexStack[n.indexStack.length-2]||0!==n.indexStack[n.indexStack.length-3]||(a=!0),A(n)===s&&t){let t=-1;for(;++t<e.children.length;){const n=e.children[t];if(n&&"listItem"===n.type&&n.children&&n.children[0]&&"thematicBreak"===n.children[0].type){a=!0;break}}}}a&&(s=c),n.bulletCurrent=s;const u=n.containerFlow(e,r);return n.bulletLastUsed=s,n.bulletCurrent=i,o(),u},listItem:function(e,t,n,r){const o=function(e){const t=e.options.listItemIndent||"one";if("tab"!==t&&"one"!==t&&"mixed"!==t)throw new Error("Cannot serialize items with `"+t+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return t}(n);let i=n.bulletCurrent||C(n);t&&"list"===t.type&&t.ordered&&(i=("number"==typeof t.start&&t.start>-1?t.start:1)+(!1===n.options.incrementListMarker?0:t.children.indexOf(e))+i);let s=i.length+1;("tab"===o||"mixed"===o&&(t&&"list"===t.type&&t.spread||e.spread))&&(s=4*Math.ceil(s/4));const c=n.createTracker(r);c.move(i+" ".repeat(s-i.length)),c.shift(s);const a=n.enter("listItem"),u=n.indentLines(n.containerFlow(e,c.current()),function(e,t,n){if(t)return(n?"":" ".repeat(s))+e;return(n?i:i+" ".repeat(s-i.length))+e});return a(),u},paragraph:function(e,t,n,r){const o=n.enter("paragraph"),i=n.enter("phrasing"),s=n.containerPhrasing(e,r);return i(),o(),s},root:function(e,t,n,r){return(e.children.some(function(e){return i(e)})?n.containerPhrasing:n.containerFlow).call(n,e,r)},strong:I,text:function(e,t,n,r){return n.safe(e.value,r)},thematicBreak:function(e,t,n){const r=(A(n)+(n.options.ruleSpaces?" ":"")).repeat(function(e){const t=e.options.ruleRepetition||3;if(t<3)throw new Error("Cannot serialize rules with repetition `"+t+"` for `options.ruleRepetition`, expected `3` or more");return t}(n));return n.options.ruleSpaces?r.slice(0,-1):r}};export{E as h};
