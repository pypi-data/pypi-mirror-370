import{f as e}from"./micromark-factory-space-O0Sojo8n.js";import{m as t,f as n,j as i}from"./micromark-util-character-DUwsRT9L.js";class r{constructor(){this.map=[]}add(e,t,n){!function(e,t,n,i){let r=0;if(0===n&&0===i.length)return;for(;r<e.map.length;){if(e.map[r][0]===t)return e.map[r][1]+=n,void e.map[r][2].push(...i);r+=1}e.map.push([t,n,i])}(this,e,t,n)}consume(e){if(this.map.sort(function(e,t){return e[0]-t[0]}),0===this.map.length)return;let t=this.map.length;const n=[];for(;t>0;)t-=1,n.push(e.slice(this.map[t][0]+this.map[t][1]),this.map[t][2]),e.length=this.map[t][0];n.push(e.slice()),e.length=0;let i=n.pop();for(;i;){for(const t of i)e.push(t);i=n.pop()}this.map.length=0}}function l(e,t){let n=!1;const i=[];for(;t<e.length;){const r=e[t];if(n){if("enter"===r[0])"tableContent"===r[1].type&&i.push("tableDelimiterMarker"===e[t+1][1].type?"left":"none");else if("tableContent"===r[1].type){if("tableDelimiterMarker"===e[t-1][1].type){const e=i.length-1;i[e]="left"===i[e]?"center":"right"}}else if("tableDelimiterRow"===r[1].type)break}else"enter"===r[0]&&"tableDelimiterRow"===r[1].type&&(n=!0);t+=1}return i}function a(){return{flow:{null:{name:"table",tokenize:s,resolveAll:o}}}}function s(r,l,a){const s=this;let o,u=0,c=0;return function(e){let t=s.events.length-1;for(;t>-1;){const e=s.events[t][1].type;if("lineEnding"!==e&&"linePrefix"!==e)break;t--}const n=t>-1?s.events[t][1].type:null,i="tableHead"===n||"tableRow"===n?k:d;if(i===k&&s.parser.lazy[s.now().line])return a(e);return i(e)};function d(e){return r.enter("tableHead"),r.enter("tableRow"),function(e){if(124===e)return p(e);return o=!0,c+=1,p(e)}(e)}function p(i){return null===i?a(i):t(i)?c>1?(c=0,s.interrupt=!0,r.exit("tableRow"),r.enter("lineEnding"),r.consume(i),r.exit("lineEnding"),m):a(i):n(i)?e(r,p,"whitespace")(i):(c+=1,o&&(o=!1,u+=1),124===i?(r.enter("tableCellDivider"),r.consume(i),r.exit("tableCellDivider"),o=!0,p):(r.enter("data"),b(i)))}function b(e){return null===e||124===e||i(e)?(r.exit("data"),p(e)):(r.consume(e),92===e?f:b)}function f(e){return 92===e||124===e?(r.consume(e),b):b(e)}function m(t){return s.interrupt=!1,s.parser.lazy[s.now().line]?a(t):(r.enter("tableDelimiterRow"),o=!1,n(t)?e(r,h,"linePrefix",s.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(t):h(t))}function h(e){return 45===e||58===e?g(e):124===e?(o=!0,r.enter("tableCellDivider"),r.consume(e),r.exit("tableCellDivider"),y):j(e)}function y(t){return n(t)?e(r,g,"whitespace")(t):g(t)}function g(e){return 58===e?(c+=1,o=!0,r.enter("tableDelimiterMarker"),r.consume(e),r.exit("tableDelimiterMarker"),v):45===e?(c+=1,v(e)):null===e||t(e)?w(e):j(e)}function v(e){return 45===e?(r.enter("tableDelimiterFiller"),D(e)):j(e)}function D(e){return 45===e?(r.consume(e),D):58===e?(o=!0,r.exit("tableDelimiterFiller"),r.enter("tableDelimiterMarker"),r.consume(e),r.exit("tableDelimiterMarker"),x):(r.exit("tableDelimiterFiller"),x(e))}function x(t){return n(t)?e(r,w,"whitespace")(t):w(t)}function w(e){return 124===e?h(e):(null===e||t(e))&&o&&u===c?(r.exit("tableDelimiterRow"),r.exit("tableHead"),l(e)):j(e)}function j(e){return a(e)}function k(e){return r.enter("tableRow"),R(e)}function R(i){return 124===i?(r.enter("tableCellDivider"),r.consume(i),r.exit("tableCellDivider"),R):null===i||t(i)?(r.exit("tableRow"),l(i)):n(i)?e(r,R,"whitespace")(i):(r.enter("data"),O(i))}function O(e){return null===e||124===e||i(e)?(r.exit("data"),R(e)):(r.consume(e),92===e?C:O)}function C(e){return 92===e||124===e?(r.consume(e),O):O(e)}}function o(e,t){let n,i,a,s=-1,o=!0,d=0,p=[0,0,0,0],b=[0,0,0,0],f=!1,m=0;const h=new r;for(;++s<e.length;){const r=e[s],l=r[1];"enter"===r[0]?"tableHead"===l.type?(f=!1,0!==m&&(c(h,t,m,n,i),i=void 0,m=0),n={type:"table",start:Object.assign({},l.start),end:Object.assign({},l.end)},h.add(s,0,[["enter",n,t]])):"tableRow"===l.type||"tableDelimiterRow"===l.type?(o=!0,a=void 0,p=[0,0,0,0],b=[0,s+1,0,0],f&&(f=!1,i={type:"tableBody",start:Object.assign({},l.start),end:Object.assign({},l.end)},h.add(s,0,[["enter",i,t]])),d="tableDelimiterRow"===l.type?2:i?3:1):!d||"data"!==l.type&&"tableDelimiterMarker"!==l.type&&"tableDelimiterFiller"!==l.type?"tableCellDivider"===l.type&&(o?o=!1:(0!==p[1]&&(b[0]=b[1],a=u(h,t,p,d,void 0,a)),p=b,b=[p[1],s,0,0])):(o=!1,0===b[2]&&(0!==p[1]&&(b[0]=b[1],a=u(h,t,p,d,void 0,a),p=[0,0,0,0]),b[2]=s)):"tableHead"===l.type?(f=!0,m=s):"tableRow"===l.type||"tableDelimiterRow"===l.type?(m=s,0!==p[1]?(b[0]=b[1],a=u(h,t,p,d,s,a)):0!==b[1]&&(a=u(h,t,b,d,s,a)),d=0):!d||"data"!==l.type&&"tableDelimiterMarker"!==l.type&&"tableDelimiterFiller"!==l.type||(b[3]=s)}for(0!==m&&c(h,t,m,n,i),h.consume(t.events),s=-1;++s<t.events.length;){const e=t.events[s];"enter"===e[0]&&"table"===e[1].type&&(e[1]._align=l(t.events,s))}return e}function u(e,t,n,i,r,l){const a=1===i?"tableHeader":2===i?"tableDelimiter":"tableData";0!==n[0]&&(l.end=Object.assign({},d(t.events,n[0])),e.add(n[0],0,[["exit",l,t]]));const s=d(t.events,n[1]);if(l={type:a,start:Object.assign({},s),end:Object.assign({},s)},e.add(n[1],0,[["enter",l,t]]),0!==n[2]){const r=d(t.events,n[2]),l=d(t.events,n[3]),a={type:"tableContent",start:Object.assign({},r),end:Object.assign({},l)};if(e.add(n[2],0,[["enter",a,t]]),2!==i){const i=t.events[n[2]],r=t.events[n[3]];if(i[1].end=Object.assign({},r[1].end),i[1].type="chunkText",i[1].contentType="text",n[3]>n[2]+1){const t=n[2]+1,i=n[3]-n[2]-1;e.add(t,i,[])}}e.add(n[3]+1,0,[["exit",a,t]])}return void 0!==r&&(l.end=Object.assign({},d(t.events,r)),e.add(r,0,[["exit",l,t]]),l=void 0),l}function c(e,t,n,i,r){const l=[],a=d(t.events,n);r&&(r.end=Object.assign({},a),l.push(["exit",r,t])),i.end=Object.assign({},a),l.push(["exit",i,t]),e.add(n+1,0,l)}function d(e,t){const n=e[t],i="enter"===n[0]?"start":"end";return n[1][i]}export{a as g};
