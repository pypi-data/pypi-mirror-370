<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}United LLM - Admin{% endblock %}</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Font Awesome -->
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
      rel="stylesheet"
    />

    <!-- Custom Tailwind Config -->
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: {
                50: "#f0f9ff",
                100: "#e0f2fe",
                200: "#bae6fd",
                300: "#7dd3fc",
                400: "#38bdf8",
                500: "#0ea5e9",
                600: "#0284c7",
                700: "#0369a1",
                800: "#075985",
                900: "#0c4a6e",
              },
              secondary: {
                50: "#faf5ff",
                100: "#f3e8ff",
                200: "#e9d5ff",
                300: "#d8b4fe",
                400: "#c084fc",
                500: "#8b5cf6",
                600: "#7c3aed",
                700: "#6d28d9",
                800: "#5b21b6",
                900: "#4c1d95",
              },
              success: {
                50: "#f0fdf4",
                100: "#dcfce7",
                500: "#22c55e",
                600: "#16a34a",
                700: "#15803d",
              },
              warning: {
                50: "#fffbeb",
                100: "#fef3c7",
                500: "#f59e0b",
                600: "#d97706",
                700: "#b45309",
              },
              danger: {
                50: "#fef2f2",
                100: "#fee2e2",
                500: "#ef4444",
                600: "#dc2626",
                700: "#b91c1c",
              },
            },
            animation: {
              "spin-slow": "spin 2s linear infinite",
              "pulse-slow": "pulse 3s ease-in-out infinite",
              "fade-in": "fadeIn 0.5s ease-in-out",
              "slide-up": "slideUp 0.3s ease-out",
              "bounce-gentle": "bounceGentle 2s infinite",
            },
            keyframes: {
              fadeIn: {
                "0%": { opacity: "0" },
                "100%": { opacity: "1" },
              },
              slideUp: {
                "0%": { transform: "translateY(10px)", opacity: "0" },
                "100%": { transform: "translateY(0)", opacity: "1" },
              },
              bounceGentle: {
                "0%, 100%": { transform: "translateY(0)" },
                "50%": { transform: "translateY(-5px)" },
              },
            },
            backgroundImage: {
              "gradient-main":
                "linear-gradient(135deg, #667eea 0%, #764ba2 100%)",
              "gradient-primary":
                "linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%)",
              "gradient-secondary":
                "linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)",
              "gradient-success":
                "linear-gradient(135deg, #22c55e 0%, #16a34a 100%)",
              "gradient-warning":
                "linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",
              "gradient-danger":
                "linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",
            },
            backdropBlur: {
              glass: "10px",
              "glass-sm": "4px",
              "glass-lg": "16px",
            },
            backgroundColor: {
              glass: "rgba(255, 255, 255, 0.95)",
              "glass-dark": "rgba(0, 0, 0, 0.8)",
              "modal-overlay": "rgba(0, 0, 0, 0.5)",
              "modal-overlay-light": "rgba(0, 0, 0, 0.3)",
            },
            boxShadow: {
              glass: "0 8px 32px rgba(0, 0, 0, 0.1)",
              "glass-lg": "0 20px 40px rgba(0, 0, 0, 0.15)",
              glow: "0 0 20px rgba(59, 130, 246, 0.5)",
              "glow-sm": "0 0 10px rgba(59, 130, 246, 0.3)",
            },
            spacing: {
              18: "4.5rem",
              88: "22rem",
              128: "32rem",
            },
            borderRadius: {
              "4xl": "2rem",
            },
            zIndex: {
              60: "60",
              70: "70",
              80: "80",
              90: "90",
              100: "100",
            },
          },
        },
        plugins: [],
      };
    </script>

    {% block extra_head %}{% endblock %}
  </head>
  <body class="bg-gray-50 min-h-screen text-gray-800">
    {% if request.session.get('admin_authenticated') %}
    <!-- Top Header -->
    <header
      class="bg-white shadow-sm border-b border-gray-200 fixed top-0 left-0 right-0 z-50"
    >
      <div class="flex items-center justify-between px-6 py-4">
        <!-- Logo Section -->
        <div class="flex items-center gap-3">
          <div
            class="bg-gradient-to-r from-blue-600 to-purple-600 w-10 h-10 rounded-lg flex items-center justify-center"
          >
            <i class="fas fa-brain text-white text-lg"></i>
          </div>
          <div>
            <h1 class="text-xl font-bold text-gray-900">United LLM</h1>
            <p class="text-xs text-gray-500">Admin Dashboard</p>
          </div>
        </div>

        <!-- Account Menu -->
        <div class="relative">
          <button
            id="accountMenuBtn"
            class="flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-gray-100 transition-colors"
          >
            <div class="text-right">
              <p class="text-sm font-medium text-gray-900">Admin User</p>
              <p class="text-xs text-gray-500">Administrator</p>
            </div>
            <div
              class="bg-gray-200 w-10 h-10 rounded-full flex items-center justify-center"
            >
              <i class="fas fa-user text-gray-600"></i>
            </div>
            <i class="fas fa-chevron-down text-gray-400 text-sm"></i>
          </button>

          <!-- Dropdown Menu -->
          <div
            id="accountDropdown"
            class="hidden absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg border border-gray-200 py-2"
          >
            <a
              href="/admin/profile"
              class="flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"
            >
              <i class="fas fa-user-circle text-gray-400"></i>
              Profile Settings
            </a>
            <a
              href="/admin/preferences"
              class="flex items-center gap-3 px-4 py-2 text-sm text-gray-700 hover:bg-gray-50"
            >
              <i class="fas fa-cog text-gray-400"></i>
              Preferences
            </a>
            <hr class="my-2 border-gray-200" />
            <a
              href="/admin/logout"
              class="flex items-center gap-3 px-4 py-2 text-sm text-red-600 hover:bg-red-50"
            >
              <i class="fas fa-sign-out-alt text-red-500"></i>
              Sign Out
            </a>
          </div>
        </div>
      </div>
    </header>

    <!-- Left Sidebar -->
    <aside
      class="fixed left-0 top-16 bottom-0 w-64 bg-white shadow-sm border-r border-gray-200 z-40"
    >
      <nav class="p-4 space-y-2">
        <!-- Dashboard -->
        <a
          href="/"
          class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors {% if request.url.path == '/' %}bg-blue-50 text-blue-700 border-r-2 border-blue-700{% endif %}"
        >
          <i class="fas fa-tachometer-alt w-5"></i>
          <span class="font-medium">Dashboard</span>
        </a>

        <!-- Requests -->
        <a
          href="/admin/requests"
          class="flex items-center gap-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-blue-50 hover:text-blue-700 transition-colors {% if '/admin/requests' in request.url.path or '/admin/llm_calls' in request.url.path %}bg-blue-50 text-blue-700 border-r-2 border-blue-700{% endif %}"
        >
          <i class="fas fa-history w-5"></i>
          <span class="font-medium">Requests</span>
        </a>
      </nav>
    </aside>

    <!-- Account Menu Script -->
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const accountMenuBtn = document.getElementById("accountMenuBtn");
        const accountDropdown = document.getElementById("accountDropdown");

        if (accountMenuBtn && accountDropdown) {
          accountMenuBtn.addEventListener("click", function (e) {
            e.stopPropagation();
            accountDropdown.classList.toggle("hidden");
          });

          // Close dropdown when clicking outside
          document.addEventListener("click", function () {
            accountDropdown.classList.add("hidden");
          });

          // Prevent dropdown from closing when clicking inside it
          accountDropdown.addEventListener("click", function (e) {
            e.stopPropagation();
          });
        }
      });
    </script>
    {% endif %}

    <!-- Main Content Area -->
    <main
      class="{% if request.session.get('admin_authenticated') %}ml-64 mt-16{% endif %} min-h-screen"
    >
      {% block content %}{% endblock %}
    </main>

    {% block scripts %}{% endblock %}
    <!-- Auto-refresh on server restart (development only) -->
    <script>
      // Only enable auto-refresh in development
      if (
        window.location.hostname === "localhost" ||
        window.location.hostname === "127.0.0.1"
      ) {
        let lastPingTime = Date.now();

        async function checkServerStatus() {
          try {
            const response = await fetch("/health", {
              method: "GET",
              cache: "no-cache",
            });

            if (response.ok) {
              lastPingTime = Date.now();
            }
          } catch (error) {
            // Server is down, wait for it to come back up
            console.log("Server appears to be restarting...");

            // Wait a bit then try to reconnect
            setTimeout(async () => {
              try {
                const response = await fetch("/health", {
                  method: "GET",
                  cache: "no-cache",
                });

                if (response.ok) {
                  console.log("Server is back up, refreshing page...");
                  window.location.reload();
                }
              } catch (e) {
                // Still down, keep checking
                checkServerStatus();
              }
            }, 2000);
          }
        }

        // Check server status every 3 seconds
        setInterval(checkServerStatus, 3000);

        console.log("🔄 Auto-refresh enabled for development");
      }
    </script>
  </body>
</html>
