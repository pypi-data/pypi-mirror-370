<!-- Send Request Modal -->
<div
  id="sendRequestModal"
  class="hidden fixed inset-0 z-[1000] bg-modal-overlay items-center justify-center"
>
  <div
    class="bg-white rounded-2xl shadow-2xl w-full max-w-7xl mx-4 max-h-[90vh] overflow-hidden"
  >
    <!-- Modal Header -->
    <div
      class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 flex justify-between items-center"
    >
      <h2 class="text-2xl font-bold flex items-center gap-3">
        <i class="fas fa-paper-plane"></i>
        Send LLM Request
      </h2>
      <span
        class="close text-white text-3xl font-bold cursor-pointer hover:opacity-70 transition-opacity"
        >&times;</span
      >
    </div>

    <!-- Modal Body -->
    <div class="p-8 overflow-y-auto max-h-[calc(90vh-120px)]">
      <form id="requestForm">
        <div class="flex flex-col lg:flex-row gap-8">
          <!-- Left Side: Input Fields -->
          <div class="flex-1 min-w-0 lg:min-w-[400px]">
            <!-- Prompt Input -->
            <div class="mb-6">
              <label
                for="promptInput"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                Prompt
              </label>
              <textarea
                id="promptInput"
                class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all"
                placeholder="generate name and address"
                rows="6"
                required
              ></textarea>
            </div>

            <!-- Schema Input with Tabs -->
            <div class="mb-6">
              <label class="block text-sm font-semibold text-gray-700 mb-2">
                Schema Definition
              </label>

              <!-- Schema Tabs -->
              <div class="border-b border-gray-200 mb-3">
                <nav class="-mb-px flex space-x-8">
                  <button
                    type="button"
                    id="stringSchemaTab"
                    class="py-2 px-1 border-b-2 border-blue-500 font-medium text-sm text-blue-600 whitespace-nowrap"
                  >
                    String Schema
                  </button>
                  <button
                    type="button"
                    id="jsonSchemaTab"
                    class="py-2 px-1 border-b-2 border-transparent font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap"
                  >
                    JSON Schema
                  </button>
                </nav>
              </div>

              <!-- String Schema Tab Content -->
              <div id="stringSchemaContent" class="schema-tab-content">
                <textarea
                  id="stringSchemaInput"
                  class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all"
                  placeholder="{name, address}"
                  rows="4"
                ></textarea>
                <p class="text-xs text-gray-500 mt-2">
                  String schema format: {field}, {field:type}, {field?} for
                  optional, [{...}] for arrays
                </p>
              </div>

              <!-- JSON Schema Tab Content -->
              <div id="jsonSchemaContent" class="schema-tab-content hidden">
                <textarea
                  id="jsonSchemaInput"
                  class="w-full p-4 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all"
                  placeholder='{"type": "object", "properties": {"name": {"type": "string"}, "address": {"type": "string"}}, "required": ["name", "address"]}'
                  rows="6"
                ></textarea>
                <p class="text-xs text-gray-500 mt-2">
                  JSON Schema format: Standard JSON Schema specification
                </p>
              </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex gap-3 mb-6">
              <button
                type="submit"
                id="sendBtn"
                class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-all duration-200 transform hover:scale-105 shadow-lg flex items-center gap-2"
              >
                <span id="sendBtnText">Send Request</span>
                <div
                  class="hidden w-4 h-4 border-2 border-gray-300 border-t-blue-500 rounded-full animate-spin"
                  id="loadingSpinner"
                ></div>
              </button>
              <button
                type="button"
                id="checkSchemaBtn"
                class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors flex items-center gap-2"
              >
                <i class="fas fa-check-circle"></i>
                Check Schema
              </button>
              <button
                type="button"
                id="generateCodeBtn"
                class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors flex items-center gap-2"
              >
                <i class="fas fa-code"></i>
                Generate Code
              </button>
              <button
                type="button"
                id="clearFormBtn"
                class="bg-gray-500 hover:bg-gray-600 text-white px-6 py-3 rounded-lg font-semibold transition-colors"
              >
                Clear Form
              </button>
            </div>

            <!-- Output Section with Tabs -->
            <div class="border-t border-gray-200 pt-6">
              <!-- Tab Navigation -->
              <div class="flex border-b border-gray-200 mb-4">
                <button
                  type="button"
                  id="outputTab"
                  class="px-4 py-2 text-sm font-semibold text-blue-600 border-b-2 border-blue-600 bg-blue-50 rounded-t-lg transition-colors"
                >
                  <i class="fas fa-terminal mr-2"></i>Output
                </button>
                <button
                  type="button"
                  id="codeTab"
                  class="px-4 py-2 text-sm font-semibold text-gray-500 hover:text-gray-700 transition-colors ml-2"
                >
                  <i class="fas fa-code mr-2"></i>Code
                </button>
              </div>

              <!-- Tab Content -->
              <div id="outputTabContent" class="tab-content">
                <textarea
                  id="outputTextarea"
                  class="w-full p-4 border border-gray-300 rounded-lg bg-gray-50 font-mono text-sm resize-none"
                  rows="8"
                  readonly
                  placeholder="Response will appear here..."
                ></textarea>
              </div>

              <div id="codeTabContent" class="tab-content hidden">
                <textarea
                  id="codeTextarea"
                  class="w-full p-4 border border-gray-300 rounded-lg bg-gray-900 text-green-400 font-mono text-sm resize-none"
                  rows="8"
                  readonly
                  placeholder="Python code will appear here..."
                ></textarea>
              </div>
            </div>
          </div>

          <!-- Right Side: Configuration -->
          <div
            class="w-full lg:w-80 lg:flex-shrink-0 lg:border-l lg:border-gray-200 lg:pl-8"
          >
            <!-- Model Selection -->
            <div class="mb-6">
              <label
                for="modelSelect"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                Model
              </label>
              <select
                id="modelSelect"
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all"
                required
              >
                <option value="">Select a model...</option>
                {% for model in available_models %}
                <option
                  value="{{ model.id }}"
                  {%
                  if
                  model.selected
                  %}selected{%
                  endif
                  %}
                >
                  {{ model.display_name }}
                </option>
                {% endfor %}
              </select>
            </div>

            <!-- Backup Models -->
            <div class="mb-6">
              <label
                for="fallbackModels"
                class="block text-sm font-semibold text-gray-700 mb-2"
              >
                Backup Models (optional)
              </label>
              <select
                id="fallbackModels"
                multiple
                class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all h-32"
              >
                {% for model in available_models %}
                <option value="{{ model.id }}">{{ model.display_name }}</option>
                {% endfor %}
              </select>
              <p class="text-xs text-gray-500 mt-2">
                Hold Ctrl/Cmd to select multiple backup models
              </p>
            </div>

            <!-- Web Search Option -->
            <div class="mb-6">
              <div class="flex items-center">
                <input
                  type="checkbox"
                  id="enableWebSearch"
                  class="h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded"
                />
                <label
                  for="enableWebSearch"
                  class="ml-2 block text-sm font-semibold text-gray-700"
                >
                  Enable Web Search
                </label>
              </div>
              <p class="mt-1 text-xs text-gray-500">
                Automatically uses Anthropic Web Search for Claude models,
                DuckDuckGo for others
              </p>
            </div>

            <!-- Example Selection -->
            <div>
              <label class="block text-sm font-semibold text-gray-700 mb-3">
                Example Selection:
              </label>
              <div class="space-y-2">
                <button
                  type="button"
                  class="w-full bg-green-100 hover:bg-green-200 text-green-800 px-4 py-2 rounded-lg transition-colors text-sm font-medium"
                  onclick="loadExample('json')"
                >
                  User Info (JSON Schema)
                </button>
                <button
                  type="button"
                  class="w-full bg-blue-100 hover:bg-blue-200 text-blue-800 px-4 py-2 rounded-lg transition-colors text-sm font-medium"
                  onclick="loadExample('string')"
                >
                  User Info (String Schema)
                </button>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>
  </div>
</div>
