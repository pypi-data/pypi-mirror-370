<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP Server Configuration - AI Coding Agent System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .server-status-badge {
            font-size: 0.8em;
        }
        .tools-grid {
            max-height: 500px;
            overflow-y: auto;
        }
        .server-card {
            transition: box-shadow 0.2s;
        }
        .server-card:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        .config-section {
            background: #f8f9fa;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        .tool-card {
            border-left: 4px solid #007bff;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">
                <i class="fas fa-tools me-2"></i>MCP Server Configuration
            </span>
            <a href="/" class="btn btn-outline-light btn-sm">
                <i class="fas fa-arrow-left me-1"></i>Back to Dashboard
            </a>
        </div>
    </nav>

    <div class="container-fluid py-4">
        <!-- Alerts Container -->
        <div id="mcp-alerts"></div>

        <!-- Status Overview -->
        <div class="config-section p-4 mb-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h2><i class="fas fa-chart-bar me-2"></i>MCP System Status</h2>
                <button class="btn btn-outline-primary btn-sm" onclick="location.reload()">
                    <i class="fas fa-sync-alt me-1"></i>Refresh
                </button>
            </div>
            <div id="mcp-status">
                <div class="text-center py-3">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Server Configuration -->
        <div class="row">
            <div class="col-lg-8">
                <div class="config-section p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3><i class="fas fa-server me-2"></i>MCP Servers</h3>
                        <button class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#addServerModal">
                            <i class="fas fa-plus me-1"></i>Add Server
                        </button>
                    </div>
                    <div id="mcp-servers">
                        <div class="text-center py-3">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Loading servers...</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Available Tools -->
                <div class="config-section p-4">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <h3><i class="fas fa-wrench me-2"></i>Available Tools</h3>
                        <button class="btn btn-outline-info btn-sm" id="refresh-tools">
                            <i class="fas fa-sync-alt me-1"></i>Refresh Tools
                        </button>
                    </div>
                    <div id="available-tools" class="tools-grid">
                        <div class="text-center py-3">
                            <div class="spinner-border text-info" role="status">
                                <span class="visually-hidden">Loading tools...</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <!-- Common Servers -->
                <div class="config-section p-4">
                    <h4><i class="fas fa-star me-2"></i>Common Servers</h4>
                    <p class="text-muted small">Quick setup for popular MCP servers</p>
                    
                    <div class="list-group">
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>Filesystem</strong>
                                <br><small class="text-muted">File operations (read, write, search)</small>
                            </div>
                            <button class="btn btn-outline-primary btn-sm" onclick="mcpConfig.addCommonServer('filesystem')">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>Web Search</strong>
                                <br><small class="text-muted">Web search and content retrieval</small>
                            </div>
                            <button class="btn btn-outline-primary btn-sm" onclick="mcpConfig.addCommonServer('web_search')">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                        
                        <div class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <strong>Git</strong>
                                <br><small class="text-muted">Git repository operations</small>
                            </div>
                            <button class="btn btn-outline-primary btn-sm" onclick="mcpConfig.addCommonServer('git')">
                                <i class="fas fa-plus"></i>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Agent Tool Configuration -->
                <div class="config-section p-4">
                    <h4><i class="fas fa-robot me-2"></i>Agent Tools</h4>
                    <p class="text-muted small">Configure which tools each agent can use</p>
                    
                    <div class="mb-3">
                        <label class="form-label">Select Agent:</label>
                        <select class="form-select" id="agent-select">
                            <option value="">Choose an agent...</option>
                            <option value="planner">Planner</option>
                            <option value="developer">Developer</option>
                            <option value="tester">Tester</option>
                            <option value="ui_ux_expert">UI/UX Expert</option>
                            <option value="db_expert">DB Expert</option>
                            <option value="devops_expert">DevOps Expert</option>
                        </select>
                    </div>
                    
                    <div id="agent-tools-config" style="display: none;">
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" value="filesystem" id="tool-filesystem">
                            <label class="form-check-label" for="tool-filesystem">Filesystem</label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" value="web_search" id="tool-web-search">
                            <label class="form-check-label" for="tool-web-search">Web Search</label>
                        </div>
                        <div class="form-check mb-2">
                            <input class="form-check-input" type="checkbox" value="git" id="tool-git">
                            <label class="form-check-label" for="tool-git">Git</label>
                        </div>
                        <button class="btn btn-primary btn-sm mt-2" id="save-agent-tools">
                            <i class="fas fa-save me-1"></i>Save Tools
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Server Modal -->
    <div class="modal fade" id="addServerModal" tabindex="-1" aria-labelledby="addServerModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <form id="add-server-form">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addServerModalLabel">
                            <i class="fas fa-plus me-2"></i>Add MCP Server
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="server-name" class="form-label">Server Name *</label>
                            <input type="text" class="form-control" id="server-name" name="name" required 
                                   placeholder="e.g., my-custom-server">
                        </div>
                        
                        <div class="mb-3">
                            <label for="server-command" class="form-label">Command *</label>
                            <input type="text" class="form-control" id="server-command" name="command" required 
                                   placeholder="e.g., npx or python">
                        </div>
                        
                        <div class="mb-3">
                            <label for="server-args" class="form-label">Arguments</label>
                            <input type="text" class="form-control" id="server-args" name="args" 
                                   placeholder="e.g., -y @modelcontextprotocol/server-filesystem">
                            <small class="form-text text-muted">Separate arguments with spaces</small>
                        </div>
                        
                        <div class="mb-3">
                            <label for="server-description" class="form-label">Description</label>
                            <textarea class="form-control" id="server-description" name="description" rows="2" 
                                      placeholder="Brief description of what this server provides"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label for="server-env" class="form-label">Environment Variables</label>
                            <textarea class="form-control" id="server-env" name="env" rows="3" 
                                      placeholder="KEY=value&#10;API_KEY=${API_KEY}"></textarea>
                            <small class="form-text text-muted">One per line in KEY=value format</small>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="server-timeout" class="form-label">Timeout (seconds)</label>
                                    <input type="number" class="form-control" id="server-timeout" name="timeout" 
                                           value="30" min="5" max="300">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check mt-4">
                                    <input class="form-check-input" type="checkbox" id="server-enabled" name="enabled" checked>
                                    <label class="form-check-label" for="server-enabled">
                                        Enable server
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-plus me-1"></i>Add Server
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/mcp-config.js"></script>
    
    <script>
        // Additional methods for the MCP config manager
        if (window.mcpConfig) {
            // Add method to add common servers
            window.mcpConfig.addCommonServer = async function(serverType) {
                try {
                    const response = await fetch(`/api/mcp/common-servers/${serverType}/add`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({})
                    });

                    const data = await response.json();
                    
                    if (data.success) {
                        this.showSuccess(data.message);
                        await this.loadServers();
                    } else {
                        this.showError(data.error || 'Failed to add common server');
                    }
                } catch (error) {
                    console.error('Error adding common server:', error);
                    this.showError('Failed to add common server');
                }
            };

            // Agent tools configuration
            document.getElementById('agent-select')?.addEventListener('change', function() {
                const agentToolsConfig = document.getElementById('agent-tools-config');
                if (this.value) {
                    agentToolsConfig.style.display = 'block';
                    // Load current tools for this agent
                    // mcpConfig.loadAgentTools(this.value);
                } else {
                    agentToolsConfig.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>