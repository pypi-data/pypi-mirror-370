# MyConfig Template System

## üìã Overview

MyConfig uses a powerful template system to generate professional documentation and metadata files. This system allows you to customize the format and content of generated files without modifying any Python code.

## üèóÔ∏è Architecture

### Template Engine Components

- **Template Engine** (`src/template_engine.py`) - Core template processing logic
- **Template Directory** (`src/templates/`) - Storage for all template files
- **Context Generation** - Automatic analysis of exported data to create template variables
- **Fallback System** - Graceful degradation when templates fail

### Template Processing Flow

1. **Export Components** ‚Üí Generate backup files
2. **Analyze Content** ‚Üí Extract metadata and statistics
3. **Create Context** ‚Üí Build template variables
4. **Render Templates** ‚Üí Apply templates with context data
5. **Generate Files** ‚Üí Create formatted output files

## üìÅ Template Files

### Available Templates

| Template File | Purpose | Output File |
|---------------|---------|-------------|
| `README.md.template` | Export documentation | `README.md` |
| `ENVIRONMENT.txt.template` | System environment | `ENVIRONMENT.txt` |
| `MANIFEST.json.template` | Backup metadata | `MANIFEST.json` |

### Template Locations

```
src/templates/
‚îú‚îÄ‚îÄ README.md.template           # Primary export documentation
‚îú‚îÄ‚îÄ ENVIRONMENT.txt.template     # System environment information
‚îî‚îÄ‚îÄ MANIFEST.json.template       # Backup metadata (future use)
```

## üé® Template Syntax

MyConfig uses a Mustache-like template syntax that's easy to read and write.

### Variable Substitution

```mustache
{{variable_name}}
```

**Example:**
```markdown
Export Time: {{export_time}}
Hostname: {{hostname}}
Total Size: {{total_size_formatted}}
```

### Conditional Sections

```mustache
{{#section_name}}
Content displayed if section_name exists and is truthy
{{/section_name}}
```

**Example:**
```markdown
{{#homebrew}}
### üç∫ Homebrew Configuration
- Packages: {{brew_count}} formulas
- Casks: {{cask_count}} applications
{{/homebrew}}
```

### Lists and Iteration

```mustache
{{#list_name}}
- {{item_property}}
{{/list_name}}
```

**Example:**
```markdown
{{#components}}
- Component: {{name}}
{{/components}}
```

## üìä Available Template Variables

### Global Variables

| Variable | Type | Description | Example |
|----------|------|-------------|---------|
| `export_time` | String | Export timestamp | `20250818-001234` |
| `hostname` | String | System hostname | `MacBook-Pro.local` |
| `version` | String | MyConfig version | `2.0` |
| `total_components` | Number | Number of exported components | `5` |
| `total_files` | Number | Total number of files | `28` |
| `total_size` | Number | Total size in bytes | `16842752` |
| `total_size_formatted` | String | Human-readable size | `16.1 MB` |

### Component-Specific Variables

#### System Environment (`system_environment`)
```json
{
  "filename": "ENVIRONMENT.txt",
  "size": 193,
  "description": "macOS version, hostname, Xcode tools info"
}
```

#### Homebrew (`homebrew`)
```json
{
  "filename": "Brewfile",
  "size": 2275,
  "brew_count": 16,
  "cask_count": 5,
  "tap_count": 1,
  "version_file": "HOMEBREW_VERSION.txt"
}
```

#### VS Code (`vscode`)
```json
{
  "filename": "vscode_extensions.txt",
  "size": 1365,
  "extension_count": 55
}
```

#### Dotfiles (`dotfiles`)
```json
{
  "filename": "dotfiles.tar.gz",
  "size": 16816250,
  "size_formatted": "16.1 MB"
}
```

#### System Defaults (`defaults`)
```json
{
  "directory": "defaults/",
  "file_count": 15,
  "total_size": 45678,
  "total_size_formatted": "44.6 KB",
  "domain_list": "com.apple.dock, com.apple.finder, com.apple.Safari and 12 more"
}
```

#### Launch Agents (`launchagents`)
```json
{
  "directory": "LaunchAgents/",
  "service_count": 8
}
```

#### Mac App Store (`mas`)
```json
{
  "filename": "mas.list",
  "app_count": 12
}
```

#### Manifest (`manifest`)
```json
{
  "manifest_file": "MANIFEST.json"
}
```

## üõ†Ô∏è Customizing Templates

### Basic Customization

1. **Locate Template File**
   ```bash
   ls src/templates/
   ```

2. **Edit Template**
   ```bash
   vim src/templates/README.md.template
   ```

3. **Test Changes**
   ```bash
   myconfig export test-backup
   cat test-backup/README.md
   ```

### Example Customizations

#### Adding Company Branding

```markdown
# {{company_name}} System Configuration Export

**Generated by**: MyConfig v{{version}}
**Export Time**: {{export_time}}
**System**: {{hostname}}
**Department**: {{department}}

---

## üìã Configuration Summary
This backup was created for {{user_name}} ({{employee_id}})
```

#### Custom Section Ordering

```markdown
# MyConfig Export Manifest

{{#vscode}}
### üíª Development Environment
- **VS Code Extensions**: {{extension_count}} installed
{{/vscode}}

{{#homebrew}}
### üç∫ Package Management
- **Homebrew Packages**: {{brew_count}} formulas, {{cask_count}} casks
{{/homebrew}}
```

#### Adding Custom Statistics

```markdown
## üìä Detailed Statistics

| Component | Files | Size |
|-----------|-------|------|
{{#system_environment}}
| System Environment | 1 | {{size}} bytes |
{{/system_environment}}
{{#homebrew}}
| Homebrew | 1 | {{size}} bytes |
{{/homebrew}}
{{#vscode}}
| VS Code | 1 | {{size}} bytes |
{{/vscode}}
```

## üîß Advanced Template Features

### Custom Context Variables

You can extend the template context by modifying `create_template_context()` in `template_engine.py`:

```python
def create_template_context(export_dir: str) -> Dict[str, Any]:
    context = {
        # ... existing context ...
        'company_name': 'Your Company',
        'department': 'IT Department',
        'custom_note': 'Generated automatically'
    }
    return context
```

### Template Inheritance

Create reusable template components:

**base_header.template:**
```markdown
# {{company_name}} Configuration Export
**Date**: {{export_time}}
**System**: {{hostname}}

---
```

**README.md.template:**
```markdown
{{>base_header}}

## Export Contents
{{#components}}
- {{.}}
{{/components}}
```

### Conditional Logic

```markdown
{{#homebrew}}
{{#homebrew.brew_count}}
### üç∫ Homebrew Packages ({{homebrew.brew_count}})
{{/homebrew.brew_count}}
{{^homebrew.brew_count}}
### üç∫ Homebrew (No packages installed)
{{/homebrew.brew_count}}
{{/homebrew}}
```

## üß™ Testing Templates

### Template Validation

```bash
# Test template syntax
python3 -c "
from src.template_engine import TemplateEngine
engine = TemplateEngine()
try:
    result = engine.render_template('README.md.template', {})
    print('Template syntax is valid')
except Exception as e:
    print(f'Template error: {e}')
"
```

### Debug Template Context

```bash
# View template context data
myconfig export debug-test
python3 -c "
from src.template_engine import create_template_context
import json
context = create_template_context('debug-test')
print(json.dumps(context, indent=2))
"
```

### Preview Template Output

```bash
# Generate test backup and examine output
myconfig export template-test
cat template-test/README.md
```

## üö® Error Handling

### Template Fallbacks

If template processing fails, MyConfig automatically falls back to:

1. **Simple README**: Basic text file with minimal information
2. **Plain Text Environment**: Simple environment file without formatting
3. **Error Logging**: Detailed error information in logs

### Common Template Errors

| Error | Cause | Solution |
|-------|-------|----------|
| `Template not found` | Missing template file | Check file exists in `src/templates/` |
| `Variable not found` | Undefined variable in template | Add variable to context or use conditional |
| `Syntax error` | Invalid Mustache syntax | Check template syntax |
| `Encoding error` | File encoding issues | Ensure UTF-8 encoding |

### Debugging Template Issues

```bash
# Enable verbose logging
myconfig -v export debug-backup

# Check log files
tail -f logs/myconfig.log

# Validate template files
python3 -m src.template_engine
```

## üìù Template Development Guidelines

### Best Practices

1. **Use Conditional Sections**: Always wrap optional content in conditional blocks
2. **Provide Fallbacks**: Include default text for missing data
3. **Format Consistently**: Use consistent spacing and formatting
4. **Test Thoroughly**: Test with various system configurations
5. **Document Variables**: Comment complex template logic

### Template Style Guide

```markdown
# Use consistent heading levels
# H1 for main title
## H2 for major sections
### H3 for subsections

# Use consistent emoji icons
üîß for tools/utilities
üìÅ for files/directories  
üìä for statistics
‚öôÔ∏è for settings/configuration

# Use consistent formatting
- **Bold**: for labels and important terms
- `Code`: for filenames and commands
- *Italic*: for emphasis and notes
```

### Performance Considerations

- Keep templates simple and focused
- Avoid complex calculations in templates
- Use conditional sections to minimize processing
- Cache template results when possible

## üîÑ Template Migration

### Updating Templates

When updating MyConfig, template changes are handled automatically:

1. **Backward Compatibility**: Old templates continue to work
2. **New Variables**: Added gradually with fallbacks
3. **Deprecation Warnings**: Old variables are marked deprecated
4. **Migration Tools**: Scripts to update custom templates

### Version Compatibility

| MyConfig Version | Template Version | Compatibility |
|------------------|------------------|---------------|
| 2.0+ | v2 | Full support |
| 1.x | v1 | Legacy fallback |

For detailed information about specific template changes, see the [CHANGELOG.md](../CHANGELOG.md) file.
