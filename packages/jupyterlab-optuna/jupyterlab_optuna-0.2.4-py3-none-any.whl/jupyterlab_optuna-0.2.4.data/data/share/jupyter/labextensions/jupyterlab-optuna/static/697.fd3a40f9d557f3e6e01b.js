"use strict";(self.webpackChunkjupyterlab_optuna=self.webpackChunkjupyterlab_optuna||[]).push([[697],{71697:(e,t,a)=>{a.r(t),a.d(t,{default:()=>L});var r=a(39246),i=a(48213),n=a(39346),s=a(93345),o=a.n(s),d=a(6627),l=a(86941),c=a(85239),u=a(70319),p=a(14519),m=a(50783),h=a(34200),y=a(1558),_=a(44675),f=a(15695),g=a(89510),b=a(97621),x=a(49473),S=a(38480),v=a(33979),E=a(16907),w=a(50748);async function A(e="",t={}){const a=w.ServerConnection.makeSettings(),r=E.URLExt.join(a.baseUrl,"jupyterlab-optuna",e);let i;try{i=await w.ServerConnection.makeRequest(r,t,a)}catch(e){throw new w.ServerConnection.NetworkError(e)}let n=await i.text();if(n.length>0)try{n=JSON.parse(n)}catch(e){console.log("Not a JSON response body.",i)}if(!i.ok)throw new w.ServerConnection.ResponseError(i,n.message||n);return n}class O extends S.APIClient{constructor(){super(),this.getMetaInfo=()=>A("/api/meta").then(e=>e),this.getStudyDetail=(e,t)=>A(`/api/studies/${e}/?after=${t}`,{method:"GET"}).then(t=>{var a,r;const i=t.trials.map(e=>this.convertTrialResponse(e)),n=t.best_trials.map(e=>this.convertTrialResponse(e));return{id:e,name:t.name,datetime_start:new Date(t.datetime_start),directions:t.directions,user_attrs:t.user_attrs,trials:i,best_trials:n,union_search_space:t.union_search_space,intersection_search_space:t.intersection_search_space,union_user_attrs:t.union_user_attrs,has_intermediate_values:t.has_intermediate_values,note:t.note,objective_names:t.objective_names,form_widgets:t.form_widgets,is_preferential:t.is_preferential,feedback_component_type:t.feedback_component_type,preferences:t.preferences,preference_history:null===(a=t.preference_history)||void 0===a?void 0:a.map(this.convertPreferenceHistory),plotly_graph_objects:t.plotly_graph_objects,artifacts:t.artifacts,skipped_trial_numbers:null!==(r=t.skipped_trial_numbers)&&void 0!==r?r:[]}}),this.getStudySummaries=()=>A("/api/studies").then(e=>e.study_summaries.map(e=>({study_id:e.study_id,study_name:e.study_name,directions:e.directions,user_attrs:e.user_attrs,is_preferential:e.is_preferential,datetime_start:e.datetime_start?new Date(e.datetime_start):void 0}))),this.createNewStudy=(e,t)=>A("/api/studies",{body:JSON.stringify({study_name:e,directions:t}),method:"POST"}).then(e=>{const t=e.study_summary;return{study_id:t.study_id,study_name:t.study_name,directions:t.directions,user_attrs:t.user_attrs,is_preferential:t.is_preferential,datetime_start:t.datetime_start?new Date(t.datetime_start):void 0}}),this.deleteStudy=(e,t)=>A(`/api/studies/${e}`,{method:"DELETE",body:JSON.stringify({remove_associated_artifacts:t})}).then(()=>{}),this.renameStudy=(e,t)=>A(`/api/studies/${e}/rename`,{body:JSON.stringify({study_name:t}),method:"POST"}).then(e=>({study_id:e.study_id,study_name:e.study_name,directions:e.directions,user_attrs:e.user_attrs,is_preferential:e.is_prefential,datetime_start:e.datetime_start?new Date(e.datetime_start):void 0})),this.saveStudyNote=(e,t)=>A(`/api/studies/${e}/note`,{body:JSON.stringify(t),method:"PUT"}).then(()=>{}),this.saveTrialNote=(e,t,a)=>A(`/api/studies/${e}/${t}/note`,{body:JSON.stringify(a),method:"PUT"}).then(()=>{}),this.uploadTrialArtifact=(e,t,a,r)=>A(`/api/artifacts/${e}/${t}`,{body:JSON.stringify({file:r,filename:a}),method:"POST"}).then(e=>e),this.uploadStudyArtifact=(e,t,a)=>A(`/api/artifacts/${e}`,{body:JSON.stringify({file:a,filename:t}),method:"POST"}).then(e=>e),this.deleteTrialArtifact=(e,t,a)=>A(`/api/artifacts/${e}/${t}/${a}`,{method:"DELETE"}).then(()=>{}),this.deleteStudyArtifact=(e,t)=>A(`/api/artifacts/${e}/${t}`,{method:"DELETE"}).then(()=>{}),this.tellTrial=async(e,t,a)=>{const r={state:t,values:a};await A(`/api/trials/${e}/tell`,{body:JSON.stringify(r),method:"POST"})},this.saveTrialUserAttrs=async(e,t)=>{const a={user_attrs:t};await A(`/api/trials/${e}/user-attrs`,{body:JSON.stringify(a),method:"POST"})},this.getParamImportances=e=>A(`/api/studies/${e}/param_importances`).then(e=>e.param_importances),this.reportPreference=(e,t,a)=>A(`/api/studies/${e}/preference`,{body:JSON.stringify({candidates:t,clicked:a,mode:"ChooseWorst"}),method:"POST"}).then(()=>{}),this.skipPreferentialTrial=(e,t)=>A(`/api/studies/${e}/${t}/skip`,{method:"POST"}).then(()=>{}),this.removePreferentialHistory=(e,t)=>A(`/api/studies/${e}/preference/${t}`,{method:"DELETE"}).then(()=>{}),this.restorePreferentialHistory=(e,t)=>A(`/api/studies/${e}/preference/${t}`,{method:"POST"}).then(()=>{}),this.reportFeedbackComponent=(e,t)=>A(`/api/studies/${e}/preference_feedback_component`,{body:JSON.stringify({component_type:t}),method:"POST"}).then(()=>{}),this.getPlot=(e,t)=>A(`/api/studies/${e}/plot/${t}`).then(e=>e),this.getCompareStudiesPlot=(e,t)=>A(`/api/compare-studies/plot/${t}`,{body:JSON.stringify({study_ids:e})}).then(e=>e)}callTrialFilterQuery(e){throw new Error("Trial filter query is not implemented in JupyterLab API client.")}}var P=a(11282);const C=({onChange:e,delay:t,textFieldProps:a})=>{const[r,i]=o().useState(""),[n,d]=o().useState(!0);return(0,s.useEffect)(()=>{const a=setTimeout(()=>{e(r,n)},t);return()=>{clearTimeout(a)}},[r,t]),o().createElement(P.A,{onChange:e=>{i(e.target.value),d(e.target.validity.valid)},...a})},T=new O,$=()=>{const[e,t]=(0,s.useState)(!1),[a,r]=(0,s.useState)(""),i="0"===getComputedStyle(document.querySelector(":root")).getPropertyValue("--jp-shadow-base-lightness")?"light":"dark",n=(0,s.useMemo)(()=>(0,c.A)({palette:{mode:i,primary:b.A,secondary:x.A}}),[i]);return(0,s.useEffect)(()=>{r(window.location.pathname)},[]),e?o().createElement(S.ConstantsContext.Provider,{value:{color_mode:i,environment:"jupyterlab",url_prefix:a}},o().createElement(S.APIClientProvider,{apiClient:T},o().createElement(S.App,null))):o().createElement(u.A,{theme:n},o().createElement(p.Ay,null),o().createElement(v.n,{maxSnack:3},o().createElement(m.A,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",backgroundColor:n.palette.background.default}},o().createElement(k,{showOptunaDashboard:()=>{t(!0)}}))))},k=({showOptunaDashboard:e})=>{const[t,a]=(0,s.useState)(!0),[r,i]=(0,s.useState)(!1),[n,c]=(0,s.useState)("");return(0,s.useEffect)(()=>{a(!0),A("/api/is_initialized",{method:"GET"}).then(e=>{i(e.is_initialized),c(e.cwd_path),a(!1)}).catch(e=>{a(!1),(0,v.M8)("Failed to check the initialized state",{variant:"error"}),console.error(e)})},[]),t?o().createElement(m.A,{sx:{height:"100vh",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"}},o().createElement(g.A,null)):r?o().createElement(m.A,{sx:{display:"flex",flexDirection:"column",width:"600px",borderRadius:"8px",boxShadow:"rgba(0, 0, 0, 0.08) 0 8px 24px",padding:"64px"}},o().createElement(h.A,{variant:"h4"},"Continue or Reset?"),o().createElement(h.A,{sx:{margin:"8px 0"}},"Continue with the existing storage URL and artifact path settings, or you can reset them."),o().createElement(y.A,{variant:"contained",onClick:e,color:"primary",startIcon:o().createElement(l.A,null),sx:{margin:"8px 0",minWidth:"120px"}},"Continue"),o().createElement(y.A,{variant:"outlined",onClick:()=>{i(!1)},color:"primary",startIcon:o().createElement(d.A,null),sx:{margin:"8px 0",minWidth:"120px"}},"Reset")):o().createElement(D,{showOptunaDashboard:e,cwd:n,setLoading:a})},D=({showOptunaDashboard:e,cwd:t,setLoading:a})=>{const r="dark"===(0,_.A)().palette.mode,[i,n]=(0,s.useState)(""),[d,l]=(0,s.useState)(""),[c,u]=(0,s.useState)(!1);return o().createElement(m.A,{sx:{display:"flex",flexDirection:"column",width:"600px",borderRadius:"8px",boxShadow:r?"rgba(255, 255, 255, 0.08) 0 8px 24px":"rgba(0, 0, 0, 0.08) 0 8px 24px",padding:"64px"}},o().createElement(h.A,{variant:"h4"},"Initialize Dashboard"),o().createElement(h.A,{sx:{margin:"8px 0"}},"Please enter a storage URL and an artifact path.",""!==t&&o().createElement(o().Fragment,null," ","Your current working directory is ",o().createElement("strong",null,t),".")),o().createElement(f.A,null,o().createElement(C,{onChange:e=>{u(""!==e),n(e)},delay:500,textFieldProps:{autoFocus:!0,fullWidth:!0,label:"Storage URL or File Path (Required)",type:"text",sx:{margin:"8px 0"}}})),o().createElement(f.A,null,o().createElement(C,{onChange:e=>{l(e)},delay:500,textFieldProps:{fullWidth:!0,label:"Artifact path (Optional)",type:"text",sx:{margin:"8px 0"}}})),o().createElement(y.A,{variant:"contained",onClick:()=>{a(!0),A("/api/register_dashboard_app",{method:"POST",body:JSON.stringify({storage_url:i,artifact_path:d})}).then(t=>{a(!1),e()}).catch(e=>{a(!1),(0,v.M8)("Failed to initialize Optuna Dashboard",{variant:"error"}),console.error(e)})},color:"primary",disabled:!c,sx:{margin:"8px 0"}},"Create"))};class N extends n.ReactWidget{constructor(){super(),this.addClass("jp-react-widget")}render(){return o().createElement($,null)}}var J;!function(e){e.get="server:get-file",e.ui="server:dashboard-ui"}(J||(J={}));const L={id:"jupyterlab-optuna:plugin",description:"A JupyterLab extension for Optuna",autoStart:!0,optional:[i.ILauncher],requires:[r.ICommandPalette],activate:(e,t,a)=>{console.log("JupyterLab extension jupyterlab-optuna is activated!"),console.log("ICommandPalette:",t);const{commands:i,shell:s}=e,o=new n.LabIcon({name:"ui-components:optuna",svgstr:'<svg class="optuna-animation" xmlns="http://www.w3.org/2000/svg" width="294.7" height="280" viewBox="0 0 221 210">\n    <path fill="rgb(6, 71, 135)" d="M104.5.6c-31.2 4.6-55 16.5-74.5 37A107.3 107.3 0 0 0 3.2 84.9a78.4 78.4 0 0 0-2.6 24.6c0 12.5.3 16.4 2.2 23.5a114.2 114.2 0 0 0 19.5 38 114 114 0 0 0 103.3 37.5 111.6 111.6 0 0 0 83.1-63.1 100.3 100.3 0 0 0 11-44.9c.4-11.5.1-15.7-1.5-23.5a85.3 85.3 0 0 0-25.1-47.1 98 98 0 0 0-49.4-27c-8-2-31.9-3.4-39.2-2.3zm35.3 16.8A90 90 0 0 1 206.7 80a112 112 0 0 1 0 40.8 103.3 103.3 0 0 1-73.7 72 76.6 76.6 0 0 1-25 2.5 77 77 0 0 1-23.2-2.1 99.6 99.6 0 0 1-68.4-66.7 64 64 0 0 1-2.8-22.5c-.1-11.3.3-14.8 2.2-21.4C25.5 49.2 53.6 25 92.5 16.9a156 156 0 0 1 47.3.5z"/>\n    <path fill="rgb(12, 97, 152)" d="M94.6 29.5A88.3 88.3 0 0 0 68 39.1c-17 8.8-30.5 22-38.1 37.4a56.4 56.4 0 0 0-6.7 32c.9 18.9 7.2 32.1 22.7 47.5 13 12.8 25.8 20 44.9 25.2 11 3 31.5 2.9 42.7-.1a85.5 85.5 0 0 0 61.1-60.1c2.3-8.8 2.4-26.3.1-35a78.6 78.6 0 0 0-55.2-54.6 74.9 74.9 0 0 0-23.5-3c-9.9-.2-16.7.1-21.4 1.1zm37.2 11.1a61 61 0 0 1 29.7 17.9 55 55 0 0 1 18.6 43.6c.3 39.1-30.4 68.9-71.1 69.1-16.9 0-30-4.1-42.5-13.4A59.7 59.7 0 0 1 47.1 83c15.6-33 51.5-51 84.7-42.4z"/>\n    <path fill="rgb(39, 126, 170)" d="M96 57.6a58.6 58.6 0 0 0-40 35 43 43 0 0 0 1.6 30.4 62.8 62.8 0 0 0 20.2 22.6 70.7 70.7 0 0 0 28.8 10c34.6 3.2 64.7-28.1 58-60.4a50 50 0 0 0-37.3-37.7c-7.2-1.9-24-1.8-31.3.1zm31.9 16.1A32 32 0 0 1 148 93.4c.7 2.4 1.1 6.8.8 11.5a28 28 0 0 1-3.8 13.9 43.4 43.4 0 0 1-18.8 17.9c-5.2 2.5-6.7 2.8-16.7 2.8-9.8 0-11.6-.3-16.7-2.7-17.2-8-24.7-25.5-17.6-41a43.9 43.9 0 0 1 52.7-22.1z"/>\n    <path fill="rgb(77, 154, 184)" d="M109.5 86.9c-12.1 3-20.9 13.7-19.1 23.4 2.6 14.1 25 17.3 37.4 5.4 4.5-4.3 6.4-8.1 6.4-13.1.2-11.4-11.6-18.8-24.7-15.7zm7.7 11.8c4.5 4 .5 13.3-5.7 13.3-4.3 0-6.5-2.2-6.5-6.6 0-6.6 7.6-10.9 12.2-6.7z"/>\n</svg>\n'});i.addCommand(J.ui,{caption:"Launch Optuna Dashboard",label:"Optuna Dashboard",icon:e=>e.isPalette?void 0:o,execute:()=>{const e=new N,t=new r.MainAreaWidget({content:e});t.title.label="Optuna Dashboard Widget",t.title.icon=o,s.add(t,"main")}}),a&&a.add({command:J.ui}),t.addItem({command:J.ui,category:"Optuna"})}}}}]);