# –°–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ MCP Proxy Adapter - –î–æ—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìã –û–±–∑–æ—Ä

–î–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –∏ –ø–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ MCP Proxy Adapter –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ —Å –º—É–ª—å—Ç–∏–ø–æ—Ä—Ç–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–∞ —Å–∏—Å—Ç–µ–º—É —Å –æ–¥–Ω–∏–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º.

## üéØ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
- **TransportManager** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ø–æ—Ä—Ç–æ–≤** - HTTP:8000, HTTPS:8443, MTLS:9443
- **–ö–æ–º–∞–Ω–¥–∞ `transport_management`** - —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- **HTTP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç** - 100% —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö 3 —Ç–∏–ø–æ–≤
- **–í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** - –ø—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–∫

### ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:
- **SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤ uvicorn** - –ø–µ—Ä–µ–¥–∞—á–∞ SSL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- **MTLS —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ø–æ–ª–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–º–∏ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞–º–∏
- **Middleware –¥–ª—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞** - –∑–∞–º–µ–Ω–∞ protocol middleware

## üîß –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ uvicorn

#### –ü—Ä–æ–±–ª–µ–º–∞:
HTTPS —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ HTTP –≤–º–µ—Å—Ç–æ HTTPS. SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –≤ uvicorn.

#### –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- `mcp_proxy_adapter/examples/custom_commands/server.py`
- `mcp_proxy_adapter/core/ssl_utils.py`

#### –†–µ—à–µ–Ω–∏–µ:
```python
# –í server.py - –∏—Å–ø—Ä–∞–≤–∏—Ç—å –ø–µ—Ä–µ–¥–∞—á—É SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
ssl_config = transport_manager.get_ssl_config()
if ssl_config and transport_manager.is_ssl_enabled():
    uvicorn_ssl_config = SSLUtils.get_ssl_config_for_uvicorn(ssl_config)
    # –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
    uvicorn.run(
        app,
        host=server_settings['host'],
        port=transport_manager.get_port(),
        log_level=server_settings['log_level'].lower(),
        **uvicorn_ssl_config
    )
else:
    # HTTP —Ä–µ–∂–∏–º –±–µ–∑ SSL
    uvicorn.run(
        app,
        host=server_settings['host'],
        port=transport_manager.get_port(),
        log_level=server_settings['log_level'].lower()
    )
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å HTTPS —Å–µ—Ä–≤–µ—Ä
curl -k -s https://localhost:8443/health
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å JSON –æ—Ç–≤–µ—Ç

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
openssl s_client -connect localhost:8443 -servername localhost
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ Transport Middleware

#### –ü—Ä–æ–±–ª–µ–º–∞:
–¢–µ–∫—É—â–∏–π `protocol_middleware.py` –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è –Ω–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞.

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:
- `mcp_proxy_adapter/api/middleware/transport_middleware.py`

#### –†–µ—à–µ–Ω–∏–µ:
```python
class TransportMiddleware(BaseHTTPMiddleware):
    """Middleware –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞."""
    
    def __init__(self, app, transport_manager_instance=None):
        super().__init__(app)
        self.transport_manager = transport_manager_instance or transport_manager
    
    async def dispatch(self, request: Request, call_next: Callable) -> Response:
        # –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞
        transport_type = self._get_request_transport_type(request)
        
        # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω–æ–º—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É
        if not self._is_transport_allowed(transport_type):
            return JSONResponse(
                status_code=403,
                content={
                    "error": "Transport not allowed",
                    "message": f"Transport '{transport_type}' is not allowed. Configured transport: {self.transport_manager.get_transport_type().value}",
                    "configured_transport": self.transport_manager.get_transport_type().value
                }
            )
        
        response = await call_next(request)
        return response
    
    def _get_request_transport_type(self, request: Request) -> str:
        """–û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ –∏–∑ –∑–∞–ø—Ä–æ—Å–∞."""
        if request.url.scheme == "https":
            # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞ –¥–ª—è MTLS
            if self._has_client_certificate(request):
                return "mtls"
            return "https"
        return "http"
    
    def _has_client_certificate(self, request: Request) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞."""
        # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
        pass
    
    def _is_transport_allowed(self, transport_type: str) -> bool:
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —Ä–∞–∑—Ä–µ—à–µ–Ω –ª–∏ —Ç–∏–ø —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞."""
        configured_type = self.transport_manager.get_transport_type().value
        return transport_type == configured_type
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# HTTP —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ç–æ–ª—å–∫–æ HTTP –∑–∞–ø—Ä–æ—Å—ã
curl -s http://localhost:8000/health  # ‚úÖ OK
curl -k -s https://localhost:8000/health  # ‚ùå 403 Forbidden

# HTTPS —Å–µ—Ä–≤–µ—Ä –¥–æ–ª–∂–µ–Ω –ø—Ä–∏–Ω–∏–º–∞—Ç—å —Ç–æ–ª—å–∫–æ HTTPS –∑–∞–ø—Ä–æ—Å—ã
curl -k -s https://localhost:8443/health  # ‚úÖ OK
curl -s http://localhost:8443/health  # ‚ùå 403 Forbidden
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ SSLUtils –¥–ª—è –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

#### –ü—Ä–æ–±–ª–µ–º–∞:
`SSLUtils.get_ssl_config_for_uvicorn()` –º–æ–∂–µ—Ç –Ω–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

#### –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- `mcp_proxy_adapter/core/ssl_utils.py`

#### –†–µ—à–µ–Ω–∏–µ:
```python
@staticmethod
def get_ssl_config_for_uvicorn(ssl_config: Dict[str, Any]) -> Dict[str, Any]:
    """
    –ü–æ–ª—É—á–∏—Ç—å SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è uvicorn –∏–∑ transport –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
    
    Args:
        ssl_config: SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ transport manager
        
    Returns:
        –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è uvicorn
    """
    uvicorn_ssl = {}
    
    if not ssl_config:
        return uvicorn_ssl
    
    # –ë–∞–∑–æ–≤—ã–µ SSL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    if ssl_config.get("cert_file"):
        uvicorn_ssl["ssl_certfile"] = ssl_config["cert_file"]
    
    if ssl_config.get("key_file"):
        uvicorn_ssl["ssl_keyfile"] = ssl_config["key_file"]
    
    if ssl_config.get("ca_cert"):
        uvicorn_ssl["ssl_ca_certs"] = ssl_config["ca_cert"]
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–ª–∏–µ–Ω—Ç–∞
    if ssl_config.get("verify_client", False):
        # –î–ª—è MTLS - —Ç—Ä–µ–±–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
        uvicorn_ssl["ssl_verify_mode"] = ssl.CERT_REQUIRED
    else:
        # –î–ª—è HTTPS - –Ω–µ —Ç—Ä–µ–±–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç
        uvicorn_ssl["ssl_verify_mode"] = ssl.CERT_NONE
    
    return uvicorn_ssl
```

#### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ SSL –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
python -c "
from mcp_proxy_adapter.core.ssl_utils import SSLUtils
config = {
    'cert_file': 'test_env/server/server.crt',
    'key_file': 'test_env/server/server.key',
    'ca_cert': 'test_env/ca/ca.crt',
    'verify_client': True
}
uvicorn_config = SSLUtils.get_ssl_config_for_uvicorn(config)
print('Uvicorn SSL config:', uvicorn_config)
"
```

### 4. –£–ª—É—á—à–µ–Ω–∏–µ TransportManager

#### –ü—Ä–æ–±–ª–µ–º–∞:
–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç–æ–¥—ã –º–æ–≥—É—Ç –±—ã—Ç—å —É–ª—É—á—à–µ–Ω—ã –¥–ª—è –ª—É—á—à–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏.

#### –§–∞–π–ª—ã –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- `mcp_proxy_adapter/core/transport_manager.py`

#### –î–æ—Ä–∞–±–æ—Ç–∫–∏:
```python
def validate_ssl_files(self) -> bool:
    """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ SSL —Ñ–∞–π–ª–æ–≤."""
    if not self._config or not self._config.ssl_enabled:
        return True
    
    files_to_check = []
    if self._config.cert_file:
        files_to_check.append(self._config.cert_file)
    if self._config.key_file:
        files_to_check.append(self._config.key_file)
    if self._config.ca_cert:
        files_to_check.append(self._config.ca_cert)
    
    for file_path in files_to_check:
        if not Path(file_path).exists():
            logger.error(f"SSL file not found: {file_path}")
            return False
    
    return True

def get_uvicorn_config(self) -> Dict[str, Any]:
    """–ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –¥–ª—è uvicorn."""
    config = {
        "host": "0.0.0.0",  # –ú–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        "port": self.get_port(),
        "log_level": "info"
    }
    
    if self.is_ssl_enabled():
        ssl_config = self.get_ssl_config()
        if ssl_config:
            from mcp_proxy_adapter.core.ssl_utils import SSLUtils
            uvicorn_ssl = SSLUtils.get_ssl_config_for_uvicorn(ssl_config)
            config.update(uvicorn_ssl)
    
    return config
```

## üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### 1. –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:
- `tests/core/test_transport_manager.py`
- `tests/commands/test_transport_management_command.py`
- `tests/api/middleware/test_transport_middleware.py`

#### –¢–µ—Å—Ç—ã –¥–ª—è TransportManager:
```python
def test_load_config_http():
    """–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ HTTP –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏."""
    manager = TransportManager()
    config = {
        "transport": {
            "type": "http",
            "port": None,
            "ssl": {"enabled": False}
        }
    }
    
    assert manager.load_config(config) == True
    assert manager.get_transport_type() == TransportType.HTTP
    assert manager.get_port() == 8000
    assert manager.is_ssl_enabled() == False

def test_load_config_https():
    """–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ HTTPS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏."""
    manager = TransportManager()
    config = {
        "transport": {
            "type": "https",
            "port": None,
            "ssl": {
                "enabled": True,
                "cert_file": "test_env/server/server.crt",
                "key_file": "test_env/server/server.key"
            }
        }
    }
    
    assert manager.load_config(config) == True
    assert manager.get_transport_type() == TransportType.HTTPS
    assert manager.get_port() == 8443
    assert manager.is_ssl_enabled() == True

def test_load_config_mtls():
    """–¢–µ—Å—Ç –∑–∞–≥—Ä—É–∑–∫–∏ MTLS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏."""
    manager = TransportManager()
    config = {
        "transport": {
            "type": "mtls",
            "port": None,
            "ssl": {
                "enabled": True,
                "cert_file": "test_env/server/server.crt",
                "key_file": "test_env/server/server.key",
                "ca_cert": "test_env/ca/ca.crt",
                "verify_client": True
            }
        }
    }
    
    assert manager.load_config(config) == True
    assert manager.get_transport_type() == TransportType.MTLS
    assert manager.get_port() == 9443
    assert manager.is_ssl_enabled() == True
    assert manager.is_mtls() == True
```

### 2. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:
- `tests/integration/test_transport_integration.py`

#### –¢–µ—Å—Ç—ã:
```python
async def test_http_transport_integration():
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç HTTP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞."""
    # –ó–∞–ø—É—Å—Ç–∏—Ç—å HTTP —Å–µ—Ä–≤–µ—Ä
    # –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    # –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å JSON-RPC
    # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

async def test_https_transport_integration():
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç HTTPS —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞."""
    # –ó–∞–ø—É—Å—Ç–∏—Ç—å HTTPS —Å–µ—Ä–≤–µ—Ä
    # –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å SSL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
    # –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å JSON-RPC
    # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

async def test_mtls_transport_integration():
    """–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç MTLS —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞."""
    # –ó–∞–ø—É—Å—Ç–∏—Ç—å MTLS —Å–µ—Ä–≤–µ—Ä
    # –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å –∫–ª–∏–µ–Ω—Ç—Å–∫–∏–º —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º
    # –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å JSON-RPC
    # –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
```

### 3. –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

#### –û–±–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —É—Ç–∏–ª–∏—Ç—É:
- `scripts/test_transport.py`

#### –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã:
```python
async def test_transport_switching():
    """–¢–µ—Å—Ç –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞–º–∏."""
    # HTTP -> HTTPS -> MTLS -> HTTP
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è

async def test_transport_validation():
    """–¢–µ—Å—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞."""
    # –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    # –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ñ–∞–π–ª—ã
    # –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–æ—Ä—Ç—ã

async def test_transport_commands():
    """–¢–µ—Å—Ç –∫–æ–º–∞–Ω–¥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º."""
    # get_info
    # validate
    # reload
```

### 4. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

#### –§–∞–π–ª—ã –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è:
- `tests/performance/test_transport_performance.py`

#### –¢–µ—Å—Ç—ã:
```python
async def test_transport_performance():
    """–¢–µ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞."""
    # HTTP vs HTTPS vs MTLS
    # Latency –∏–∑–º–µ—Ä–µ–Ω–∏—è
    # Throughput –∏–∑–º–µ—Ä–µ–Ω–∏—è
    # Memory usage
```

## üìã –ß–µ–∫-–ª–∏—Å—Ç –¥–æ—Ä–∞–±–æ—Ç–æ–∫

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–æ—Ä–∞–±–æ—Ç–∫–∏:
- [ ] –ò—Å–ø—Ä–∞–≤–∏—Ç—å SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ uvicorn
- [ ] –°–æ–∑–¥–∞—Ç—å Transport Middleware
- [ ] –û–±–Ω–æ–≤–∏—Ç—å SSLUtils
- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é SSL —Ñ–∞–π–ª–æ–≤

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:
- [ ] –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è TransportManager
- [ ] –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è TransportManagementCommand
- [ ] –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –¥–ª—è Transport Middleware
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [ ] –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
- [ ] –¢–µ—Å—Ç—ã –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
- [ ] –û–±–Ω–æ–≤–∏—Ç—å API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
- [ ] –°–æ–∑–¥–∞—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- [ ] –û–±–Ω–æ–≤–∏—Ç—å README
- [ ] –°–æ–∑–¥–∞—Ç—å —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
- [ ] –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞

## üöÄ –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1-2 –¥–Ω—è)
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ uvicorn
2. –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π Transport Middleware
3. –û–±–Ω–æ–≤–∏—Ç—å SSLUtils

### –≠—Ç–∞–ø 2: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (2-3 –¥–Ω—è)
1. –ù–∞–ø–∏—Å–∞—Ç—å –º–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
2. –ù–∞–ø–∏—Å–∞—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
3. –û–±–Ω–æ–≤–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

### –≠—Ç–∞–ø 3: –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ —É–ª—É—á—à–µ–Ω–∏—è (1-2 –¥–Ω—è)
1. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
2. –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
3. –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## üìä –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- ‚úÖ HTTP —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç: 100% —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ HTTPS —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç: 100% —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ MTLS —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç: 100% —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è: 100% —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- HTTP latency < 10ms
- HTTPS latency < 20ms
- MTLS latency < 30ms
- Memory usage < 100MB

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞:
- Test coverage > 90%
- No critical security issues
- All linting checks pass
- Documentation coverage > 95%

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
```python
# –î–æ–±–∞–≤–∏—Ç—å –≤ TransportManager
logger.info(f"Transport config loaded: {transport_type.value} on port {port}")
logger.debug(f"SSL config: {ssl_config}")
logger.warning(f"SSL file not found: {file_path}")
logger.error(f"Transport validation failed: {error}")
```

### –ú–µ—Ç—Ä–∏–∫–∏:
```python
# –î–æ–±–∞–≤–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞
transport_requests_total = Counter('transport_requests_total', 'Total transport requests', ['transport_type'])
transport_request_duration = Histogram('transport_request_duration', 'Transport request duration', ['transport_type'])
transport_errors_total = Counter('transport_errors_total', 'Total transport errors', ['transport_type', 'error_type'])
```

### –û—Ç–ª–∞–¥–∫–∞:
```bash
# –í–∫–ª—é—á–∏—Ç—å debug –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
export LOG_LEVEL=DEBUG

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSL –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
openssl s_client -connect localhost:8443 -servername localhost

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
openssl x509 -in test_env/server/server.crt -text -noout
```

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ MCP Proxy Adapter —É—Å–ø–µ—à–Ω–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏—Ä–æ–≤–∞–Ω–∞ —Å –º—É–ª—å—Ç–∏–ø–æ—Ä—Ç–æ–≤–æ–π —Å–∏—Å—Ç–µ–º—ã –Ω–∞ —Å–∏—Å—Ç–µ–º—É —Å –æ–¥–Ω–∏–º —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–æ–º. –û—Å–Ω–æ–≤–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –Ω–æ —Ç—Ä–µ–±—É—é—Ç—Å—è –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –¥–ª—è –ø–æ–ª–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ SSL/MTLS –∏ —É–ª—É—á—à–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –¥–æ—Ä–∞–±–æ—Ç–æ–∫ —Å–∏—Å—Ç–µ–º–∞ –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç–∞ (HTTP, HTTPS, MTLS) –∏ –ø–æ–ª–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º —Ç–µ—Å—Ç–æ–≤. 