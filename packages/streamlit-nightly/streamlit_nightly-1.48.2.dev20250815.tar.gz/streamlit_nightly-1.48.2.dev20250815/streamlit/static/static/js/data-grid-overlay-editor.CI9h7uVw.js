import{r,aa as z}from"./index.Dd6t8viw.js";import{s as J,i as D,a as Q,b as U,T as Z,C as ee,m as te}from"./index.D0SK_gOf.js";import"./withFullScreenWrapper.DO6Lv2t_.js";import"./Toolbar.CRanrSsg.js";import"./FormClearHelper.CdPDlJPQ.js";import"./sprintf.D7DtBTRn.js";import"./checkbox.DcA-U3pK.js";import"./createDownloadLinkElement.ZaXNnPK4.js";import"./toConsumableArray.CRNt08cC.js";import"./possibleConstructorReturn.CyDaXnG6.js";import"./createSuper.BqfCBVAH.js";import"./FileDownload.esm.CM0FMi6m.js";const re=()=>t=>t.targetX,ne=()=>t=>t.targetY,ie=()=>t=>t.targetWidth,se=()=>t=>t.targetHeight,ae=()=>t=>t.targetY+10,oe=()=>t=>Math.max(0,(t.targetHeight-28)/2),le=J("div")({name:"DataGridOverlayEditorStyle",class:"gdg-d19meir1",propsAsIs:!1,vars:{"d19meir1-0":[ne(),"px"],"d19meir1-1":[re(),"px"],"d19meir1-2":[ie(),"px"],"d19meir1-3":[se(),"px"],"d19meir1-4":[ae(),"px"],"d19meir1-5":[oe(),"px"]}});function de(){const[t,s]=r.useState();return[t??void 0,s]}function ce(){const[t,s]=de(),[i,h]=r.useState(0),[f,v]=r.useState(!0);r.useLayoutEffect(()=>{if(t===void 0||!("IntersectionObserver"in window))return;const a=new IntersectionObserver(o=>{o.length!==0&&v(o[0].isIntersecting)},{threshold:1});return a.observe(t),()=>a.disconnect()},[t]),r.useEffect(()=>{if(f||t===void 0)return;let a;const o=()=>{const{right:x}=t.getBoundingClientRect();h(m=>Math.min(m+window.innerWidth-x-10,0)),a=requestAnimationFrame(o)};return a=requestAnimationFrame(o),()=>{a!==void 0&&cancelAnimationFrame(a)}},[t,f]);const C=r.useMemo(()=>({transform:`translateX(${i}px)`}),[i]);return{ref:s,style:C}}const Oe=t=>{const{target:s,content:i,onFinishEditing:h,forceEditMode:f,initialValue:v,imageEditorOverride:C,markdownDivCreateNode:a,highlight:o,className:x,theme:m,id:H,cell:g,bloom:I,portalElementRef:w,validateCell:p,getCellRenderer:F,provideEditor:P,isOutsideClick:W,customEventTarget:X}=t,[l,A]=r.useState(f?i:void 0),O=r.useRef(l??i);O.current=l??i;const[E,S]=r.useState(()=>p===void 0?!0:!(D(i)&&p?.(g,i,O.current)===!1)),c=r.useCallback((e,n)=>{h(E?e:void 0,n)},[E,h]),K=r.useCallback(e=>{if(p!==void 0&&e!==void 0&&D(e)){const n=p(g,e,O.current);n===!1?S(!1):(typeof n=="object"&&(e=n),S(!0))}A(e)},[g,p]),y=r.useRef(!1),u=r.useRef(void 0),Y=r.useCallback(()=>{c(l,[0,0]),y.current=!0},[l,c]),j=r.useCallback((e,n)=>{c(e,n??u.current??[0,0]),y.current=!0},[c]),L=r.useCallback(async e=>{let n=!1;switch(e.key){case"Escape":{e.stopPropagation(),e.preventDefault(),u.current=[0,0];break}case"Enter":{e.stopPropagation(),e.preventDefault(),u.current=[0,e.shiftKey?-1:1],n=!0;break}case"Tab":{e.stopPropagation(),e.preventDefault(),u.current=[e.shiftKey?-1:1,0],n=!0;break}}window.setTimeout(()=>{!y.current&&u.current!==void 0&&(c(n?l:void 0,u.current),y.current=!0)},0)},[c,l]),k=l??i,[d,q]=r.useMemo(()=>{if(Q(i))return[];const e={...i,location:g},n=P?.(e);return n!==void 0?[n,!1]:[F(i)?.provideEditor?.(e),!1]},[g,i,F,P]),{ref:B,style:$}=ce();let T=!0,M,_=!0,b;if(d!==void 0){T=d.disablePadding!==!0,_=d.disableStyling!==!0;const e=U(d);e&&(b=d.styleOverride);const n=e?d.editor:d;M=r.createElement(n,{portalElementRef:w,isHighlighted:o,onChange:K,value:k,initialValue:v,onFinishedEditing:j,validatedSelection:D(k)?k.selectionRange:void 0,forceEditMode:f,target:s,imageEditorOverride:C,markdownDivCreateNode:a,isValid:E,theme:m})}b={...b,...$};const N=w?.current??document.getElementById("portal");if(N===null)return console.error('Cannot open Data Grid overlay editor, because portal not found. Please, either provide a portalElementRef or add `<div id="portal" />` as the last child of your `<body>`.'),null;let R=_?"gdg-style":"gdg-unstyle";E||(R+=" gdg-invalid"),T&&(R+=" gdg-pad");const V=I?.[0]??1,G=I?.[1]??1;return z.createPortal(r.createElement(Z.Provider,{value:m},r.createElement(ee,{style:te(m),className:x,onClickOutside:Y,isOutsideClick:W,customEventTarget:X},r.createElement(le,{ref:B,id:H,className:R,style:b,as:q===!0?"label":void 0,targetX:s.x-V,targetY:s.y-G,targetWidth:s.width+V*2,targetHeight:s.height+G*2},r.createElement("div",{className:"gdg-clip-region",onKeyDown:L},M)))),N)};export{Oe as default};
