{"version":3,"sources":["pages/RunDetail/RunMetricCard.tsx","pages/RunDetail/RunDetailMetricsAndSystemTab.tsx","config/charts/index.ts","components/LineChart/LineChart.tsx"],"names":["RunMetricCard","batch","index","observer","isPinned","togglePin","containerRef","React","current","observe","ErrorBoundary","className","data-name","name","data-context","contextToString","context","ref","Tooltip","title","color","size","variant","withOnlyIcon","onClick","iters","LineChart","data","key","xValues","yValues","values","dasharray","selectors","component","tint","weight","isSystemMetric","formatSystemMetricName","split","map","label","i","monospace","COLORS","length","RunDetailMetricsAndSystemTab","runHash","runTraces","runBatch","isSystem","isRunBatchLoading","observerRef","observerIsReady","setObserverIsReady","visibleMetrics","setVisibleMetrics","projectsData","useModel","projectsModel","tabMertcis","metric","filter","m","pinnedMetrics","regularMetrics","pinnedSequenceIndex","pinnedSequences","findIndex","seq","push","newPinnedMetrics","setPinnedSequencesRequestRef","setPinnedSequences","sequences","detail","setState","exceptionHandler","model","runDetailAppModel","call","renderMetricCards","metrics","pinned","sortKey","sort","alphabeticalSortComparator","orderBy","find","options","root","parentElement","rootMargin","threshold","IntersectionObserver","entries","forEach","entry","isIntersecting","metricName","target","getAttribute","metricContext","vM","concat","analytics","ANALYTICS_EVENT_KEYS","runDetails","tabs","tabView","disconnect","timerID","runsBatchRequestRef","window","setTimeout","getRunMetricsBatch","clearTimeout","abort","BusyLoaderWrapper","isLoading","height","_","isEmpty","IllustrationBlock","RENDER_LINES_OPTIMIZED_LIMIT","GRID_SIZE","S","M","L","CHART_GRID_PATTERN","1","2","3","4","5","6","7","8","9","props","id","nameKey","aggregatedData","aggregationConfig","syncHoverState","axesScaleRange","ignoreOutliers","alignmentConfig","highlightMode","HighlightEnum","Off","curveInterpolation","CurveEnum","Linear","chartTitle","zoom","onZoomChange","resizeMode","onMount","axesScaleType","xAxis","ScaleEnum","yAxis","readOnly","margin","top","right","bottom","left","visBoxRef","width","plotBoxRef","parentRef","visAreaRef","svgNodeRef","bgRectNodeRef","plotNodeRef","axesNodeRef","linesNodeRef","attributesNodeRef","xAxisLabelNodeRef","yAxisLabelNodeRef","highlightedNodeRef","axesRef","linesRef","attributesRef","humanizerConfigRef","rafIDRef","unableToDrawConditions","updateDeps","renderChart","clearArea","drawArea","processLineChartData","processedData","processedAggrData","min","max","drawAxes","xScale","yScale","drawBgTickLines","y","x","drawLines","selectChildren","classed","drawBrush","drawHoverAttributes","drawUnableToRender","renderArr","draw","resizeObserverCallback","requestAnimationFrame","observerReturnCallback","cancelAnimationFrame","useResizeObserver","currentXValue","undefined","setActiveLineAndCircle","lineKey","focusedStateActive","force","updateHoverAttributes","xValue","dataSelector","clearHoverAttributes","setFocusedState","focusedState","visId","chartIndex","classNames","zoomMode","active","displayName"],"mappings":"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","file":"static/js/RunDetailMetricsAndSystemTab.js?version=b069c0cd097a2c864dca","sourcesContent":["import * as React from 'react';\n\nimport { Tooltip } from '@material-ui/core';\n\nimport LineChart from 'components/LineChart/LineChart';\nimport { Badge, Text, Button, Spinner, Icon } from 'components/kit';\nimport ErrorBoundary from 'components/ErrorBoundary/ErrorBoundary';\n\nimport COLORS from 'config/colors/colors';\n\nimport contextToString from 'utils/contextToString';\nimport { isSystemMetric } from 'utils/isSystemMetric';\nimport { formatSystemMetricName } from 'utils/formatSystemMetricName';\n\nimport { IRunMetricCardProps } from './types';\n\nfunction RunMetricCard({\n  batch,\n  index,\n  observer,\n  isPinned,\n  togglePin,\n}: IRunMetricCardProps): React.FunctionComponentElement<React.ReactNode> {\n  const containerRef = React.useRef(null);\n\n  React.useEffect(() => {\n    if (containerRef.current && observer) {\n      observer.observe(containerRef.current!);\n    }\n  }, [observer]);\n\n  return (\n    <ErrorBoundary>\n      <div\n        className='RunDetailMetricsTab__container__chartContainer'\n        data-name={batch.name}\n        data-context={contextToString(batch.context)}\n        ref={containerRef}\n      >\n        <Tooltip title={isPinned ? 'Unpin' : 'Pin'}>\n          <div className='RunDetailMetricsTab__container__chartContainer__metricDetailBox__pin'>\n            <Button\n              color={isPinned ? 'primary' : 'default'}\n              size='xSmall'\n              variant='outlined'\n              withOnlyIcon\n              onClick={() =>\n                togglePin(\n                  {\n                    name: batch.name,\n                    context: batch.context,\n                  },\n                  isPinned,\n                )\n              }\n            >\n              <Icon name='pin' />\n            </Button>\n          </div>\n        </Tooltip>\n        <div className='RunDetailMetricsTab__container__chartContainer__chartBox'>\n          {batch.iters ? (\n            <ErrorBoundary>\n              <LineChart\n                data={[\n                  {\n                    key: batch.key,\n                    data: {\n                      xValues: [...batch.iters],\n                      yValues: [...batch.values],\n                    },\n                    color: '#1c2852',\n                    dasharray: 'none',\n                    selectors: [batch.key],\n                  },\n                ]}\n                index={index}\n              />\n            </ErrorBoundary>\n          ) : (\n            <Spinner />\n          )}\n        </div>\n        <div className='RunDetailMetricsTab__container__chartContainer__metricDetailBox'>\n          <Text\n            component='h4'\n            tint={100}\n            size={18}\n            weight={600}\n            className='RunDetailMetricsTab__container__chartContainer__metricDetailBox__metricName'\n          >\n            {isSystemMetric(batch?.name)\n              ? formatSystemMetricName(batch?.name)\n              : batch?.name}\n          </Text>\n          {contextToString(batch?.context)\n            ?.split(',')\n            .map((label: string, i: number) => (\n              <Badge\n                key={i}\n                monospace\n                size='large'\n                color={COLORS[0][(i + index) % COLORS[0].length]}\n                label={label || 'Empty context'}\n              />\n            ))}\n        </div>\n      </div>\n    </ErrorBoundary>\n  );\n}\n\nexport default React.memo(RunMetricCard);\n","import * as React from 'react';\nimport _ from 'lodash-es';\nimport { useModel } from 'hooks';\n\nimport IllustrationBlock from 'components/IllustrationBlock/IllustrationBlock';\nimport BusyLoaderWrapper from 'components/BusyLoaderWrapper/BusyLoaderWrapper';\nimport ErrorBoundary from 'components/ErrorBoundary/ErrorBoundary';\nimport { Text } from 'components/kit';\n\nimport { ANALYTICS_EVENT_KEYS } from 'config/analytics/analyticsKeysMap';\n\nimport * as analytics from 'services/analytics';\nimport runDetailAppModel from 'services/models/runs/runDetailAppModel';\nimport projectsModel from 'services/models/projects/projectsModel';\n\nimport {\n  IPinnedSequence,\n  IProjectsModelState,\n} from 'types/services/models/projects/projectsModel';\n\nimport { isSystemMetric } from 'utils/isSystemMetric';\nimport contextToString from 'utils/contextToString';\nimport alphabeticalSortComparator from 'utils/alphabeticalSortComparator';\nimport exceptionHandler from 'utils/app/exceptionHandler';\n\nimport RunMetricCard from './RunMetricCard';\nimport { IRunBatch, IRunDetailMetricsAndSystemTabProps } from './types';\n\nfunction RunDetailMetricsAndSystemTab({\n  runHash,\n  runTraces,\n  runBatch,\n  isSystem,\n  isRunBatchLoading,\n}: IRunDetailMetricsAndSystemTabProps): React.FunctionComponentElement<React.ReactNode> {\n  const containerRef = React.useRef<HTMLDivElement>(null);\n  const observerRef = React.useRef<IntersectionObserver>();\n  const [observerIsReady, setObserverIsReady] = React.useState(false);\n  const [visibleMetrics, setVisibleMetrics] = React.useState<\n    IRunDetailMetricsAndSystemTabProps['runTraces']['metric']\n  >([]);\n  const projectsData = useModel<Partial<IProjectsModelState>>(\n    projectsModel,\n    false,\n  );\n\n  const tabMertcis = React.useMemo(\n    () =>\n      runTraces.metric.filter((m) =>\n        isSystem ? isSystemMetric(m.name) : !isSystemMetric(m.name),\n      ),\n    [runTraces.metric, isSystem],\n  );\n  let pinnedMetrics: IRunDetailMetricsAndSystemTabProps['runTraces']['metric'] =\n    [];\n  let regularMetrics: IRunDetailMetricsAndSystemTabProps['runTraces']['metric'] =\n    [];\n\n  for (let i = 0; i < tabMertcis.length; i++) {\n    let metric = tabMertcis[i];\n    let pinnedSequenceIndex =\n      projectsData?.pinnedSequences?.findIndex(\n        (seq) =>\n          seq.name === metric.name &&\n          contextToString(seq.context) === contextToString(metric.context),\n      ) ?? -1;\n    if (pinnedSequenceIndex > -1) {\n      pinnedMetrics[pinnedSequenceIndex] = metric;\n    } else {\n      regularMetrics.push(metric);\n    }\n  }\n\n  pinnedMetrics.filter((metric) => !!metric);\n\n  React.useEffect(() => {\n    if (!!containerRef.current) {\n      let options = {\n        root: containerRef.current.parentElement?.parentElement,\n        rootMargin: '0px',\n        threshold: 0,\n      };\n      observerRef.current = new IntersectionObserver(\n        (entries: IntersectionObserverEntry[]) => {\n          let metrics: { name: string; context: string }[] = [];\n          entries.forEach((entry: IntersectionObserverEntry) => {\n            if (entry.isIntersecting) {\n              let metricName = entry.target.getAttribute('data-name')!;\n              let metricContext = entry.target.getAttribute('data-context')!;\n              if (\n                !runBatch?.find(\n                  (batch: IRunBatch) =>\n                    batch.name === metricName &&\n                    contextToString(batch.context) === metricContext,\n                )\n              ) {\n                metrics.push({\n                  name: metricName,\n                  context: metricContext,\n                });\n              }\n            }\n          });\n\n          if (metrics.length > 0) {\n            setVisibleMetrics((vM) =>\n              vM.concat(\n                metrics.map(\n                  (metric) =>\n                    tabMertcis.find(\n                      (m) =>\n                        m.name === metric.name &&\n                        contextToString(m.context) === metric.context,\n                    )!,\n                ),\n              ),\n            );\n          }\n        },\n        options,\n      );\n      setObserverIsReady(true);\n    }\n\n    analytics.pageView(\n      ANALYTICS_EVENT_KEYS.runDetails.tabs[isSystem ? 'system' : 'metrics']\n        .tabView,\n    );\n\n    return () => {\n      if (observerRef.current) {\n        observerRef.current.disconnect();\n      }\n    };\n  }, [isSystem, runBatch, observerIsReady, runTraces.metric, tabMertcis]);\n\n  React.useEffect(() => {\n    let timerID: number;\n    let runsBatchRequestRef: { call: () => Promise<void>; abort: () => void };\n    if (visibleMetrics.length > 0) {\n      timerID = window.setTimeout(() => {\n        runsBatchRequestRef = runDetailAppModel.getRunMetricsBatch(\n          visibleMetrics,\n          runHash,\n        );\n\n        runsBatchRequestRef.call();\n      }, 100);\n    }\n\n    return () => {\n      if (timerID) {\n        clearTimeout(timerID);\n      }\n      if (runsBatchRequestRef) {\n        runsBatchRequestRef.abort();\n      }\n    };\n  }, [visibleMetrics, runHash]);\n\n  React.useEffect(() => {\n    setVisibleMetrics((vM) =>\n      vM.filter(\n        (m) =>\n          runBatch.findIndex(\n            (batch: IRunBatch) =>\n              batch.name === m.name &&\n              contextToString(batch.context) === contextToString(m.context),\n          ) === -1,\n      ),\n    );\n  }, [runBatch]);\n\n  async function togglePin(metric: IPinnedSequence, isPinned: boolean) {\n    const newPinnedMetrics = isPinned\n      ? pinnedMetrics.filter(\n          (m) =>\n            !(\n              m.name === metric.name &&\n              contextToString(m.context) === contextToString(metric.context)\n            ),\n        )\n      : [...pinnedMetrics, metric];\n    const setPinnedSequencesRequestRef = projectsModel.setPinnedSequences(\n      {\n        sequences: newPinnedMetrics,\n      },\n      (detail: unknown) => {\n        projectsModel.setState({\n          pinnedSequences: pinnedMetrics,\n        });\n        exceptionHandler({ detail, model: runDetailAppModel });\n      },\n    );\n\n    projectsModel.setState({\n      pinnedSequences: newPinnedMetrics,\n    });\n\n    setPinnedSequencesRequestRef.call();\n  }\n\n  function renderMetricCards(\n    metrics: IRunDetailMetricsAndSystemTabProps['runTraces']['metric'],\n    pinned: boolean,\n  ) {\n    return (\n      observerIsReady &&\n      metrics.length > 0 && (\n        <>\n          <div className='RunDetailMetricsTab__header'>\n            <Text component='h3' size={16} color='primary'>\n              {pinned ? 'Pinned ' : ''}Metrics\n            </Text>\n          </div>\n          <div className='RunDetailMetricsTab__container'>\n            {(pinned\n              ? metrics\n              : metrics\n                  .map((m) => ({\n                    ...m,\n                    sortKey: `${m.name}_${contextToString(m.context)}`,\n                  }))\n                  .sort(alphabeticalSortComparator({ orderBy: 'sortKey' }))\n            ).map((metric, i: number) => {\n              const batch: IRunBatch = {\n                ...metric,\n                ...runBatch?.find(\n                  (batch: IRunBatch) =>\n                    batch.name === metric.name &&\n                    contextToString(batch.context) ===\n                      contextToString(metric.context),\n                ),\n              };\n              return (\n                <RunMetricCard\n                  key={`${batch.name}_${contextToString(batch.context)}`}\n                  batch={batch}\n                  index={i}\n                  observer={observerRef.current}\n                  isPinned={pinned}\n                  togglePin={togglePin}\n                />\n              );\n            })}\n          </div>\n        </>\n      )\n    );\n  }\n\n  return (\n    <ErrorBoundary>\n      <BusyLoaderWrapper\n        isLoading={isRunBatchLoading}\n        className='RunDetailTabLoader'\n        height='100%'\n      >\n        {!_.isEmpty(tabMertcis) ? (\n          <div className='RunDetailMetricsTab' ref={containerRef}>\n            {renderMetricCards(pinnedMetrics, true)}\n            {renderMetricCards(regularMetrics, false)}\n          </div>\n        ) : (\n          <IllustrationBlock\n            size='xLarge'\n            className='RunDetailTabLoader'\n            title={`No tracked ${isSystem ? 'system' : ''} metrics`}\n          />\n        )}\n      </BusyLoaderWrapper>\n    </ErrorBoundary>\n  );\n}\n\nexport default React.memo(RunDetailMetricsAndSystemTab);\n","export const RENDER_LINES_OPTIMIZED_LIMIT = 100;\n\nexport const GRID_SIZE = {\n  S: 4,\n  M: 6,\n  L: 12,\n};\n\nconst { S, M, L } = GRID_SIZE;\n// Chart grid pattern based on a 12-column grid layout\nexport const CHART_GRID_PATTERN: { [key: number]: number[] } = {\n  1: [L],\n  2: [M, M],\n  3: [S, S, S],\n  4: [M, M, M, M],\n  5: [S, S, S, M, M],\n  6: [S, S, S, S, S, S],\n  7: [S, S, S, M, M, M, M],\n  8: [S, S, S, S, S, S, M, M],\n  9: [S, S, S, S, S, S, S, S, S],\n};\n","import * as React from 'react';\nimport classNames from 'classnames';\nimport { useResizeObserver } from 'hooks';\n\nimport ErrorBoundary from 'components/ErrorBoundary/ErrorBoundary';\n\nimport { RENDER_LINES_OPTIMIZED_LIMIT } from 'config/charts';\n\nimport {\n  IAttributesRef,\n  ILineChartProps,\n  ILineChartRef,\n} from 'types/components/LineChart/LineChart';\nimport { IFocusedState } from 'types/services/models/metrics/metricsAppModel';\n\nimport {\n  drawArea,\n  clearArea,\n  drawAxes,\n  drawLines,\n  processLineChartData,\n  drawBrush,\n  drawHoverAttributes,\n  drawUnableToRender,\n  CurveEnum,\n  HighlightEnum,\n  ScaleEnum,\n} from 'utils/d3';\n\nimport './LineChart.scss';\n\nconst LineChart = React.forwardRef(function LineChart(\n  props: ILineChartProps,\n  ref: React.ForwardedRef<ILineChartRef>,\n): React.FunctionComponentElement<React.ReactNode> {\n  const {\n    data,\n    index,\n    id = `${index}`,\n    nameKey = '',\n    aggregatedData,\n    aggregationConfig,\n    syncHoverState,\n    axesScaleRange,\n    ignoreOutliers = false,\n    alignmentConfig,\n    highlightMode = HighlightEnum.Off,\n    curveInterpolation = CurveEnum.Linear,\n    chartTitle,\n    zoom,\n    onZoomChange,\n    resizeMode,\n    onMount,\n    axesScaleType = {\n      xAxis: ScaleEnum.Linear,\n      yAxis: ScaleEnum.Linear,\n    },\n    readOnly = false,\n    margin = {\n      top: 30,\n      right: 20,\n      bottom: 30,\n      left: 60,\n    },\n  } = props;\n\n  // boxes\n  const visBoxRef = React.useRef({\n    margin,\n    height: 0,\n    width: 0,\n  });\n  const plotBoxRef = React.useRef({\n    height: 0,\n    width: 0,\n  });\n\n  // containers\n  const parentRef = React.useRef<HTMLDivElement>(null);\n  const visAreaRef = React.useRef<HTMLDivElement>(null);\n\n  // d3 node elements\n  const svgNodeRef = React.useRef(null);\n  const bgRectNodeRef = React.useRef(null);\n  const plotNodeRef = React.useRef(null);\n  const axesNodeRef = React.useRef(null);\n  const linesNodeRef = React.useRef<any>(null);\n  const attributesNodeRef = React.useRef(null);\n  const xAxisLabelNodeRef = React.useRef(null);\n  const yAxisLabelNodeRef = React.useRef(null);\n  const highlightedNodeRef = React.useRef(null);\n\n  // methods and values refs\n  const axesRef = React.useRef({});\n  const linesRef = React.useRef({});\n  const attributesRef = React.useRef<IAttributesRef>({});\n  const humanizerConfigRef = React.useRef({});\n  const rafIDRef = React.useRef<number>();\n\n  const unableToDrawConditions: { condition: boolean; text?: string }[] = [];\n  const updateDeps = [\n    data,\n    zoom,\n    ignoreOutliers,\n    highlightMode,\n    axesScaleType,\n    axesScaleRange,\n    curveInterpolation,\n    aggregationConfig,\n    readOnly,\n    alignmentConfig,\n    resizeMode,\n    id,\n  ];\n\n  function draw() {\n    drawArea({\n      index,\n      id,\n      nameKey,\n      visBoxRef,\n      plotBoxRef,\n      parentRef,\n      visAreaRef,\n      svgNodeRef,\n      bgRectNodeRef,\n      plotNodeRef,\n      axesNodeRef,\n      linesNodeRef,\n      attributesNodeRef,\n      chartTitle,\n    });\n\n    const { processedData, processedAggrData, min, max } = processLineChartData(\n      {\n        data,\n        ignoreOutliers,\n        visBoxRef,\n        axesScaleType,\n        axesScaleRange,\n        aggregatedData,\n        aggregationConfig,\n        unableToDrawConditions,\n        attributesRef,\n      },\n    );\n\n    drawAxes({\n      svgNodeRef,\n      axesNodeRef,\n      axesRef,\n      plotBoxRef,\n      xScale: attributesRef.current.xScale,\n      yScale: attributesRef.current.yScale,\n      visBoxRef,\n      alignmentConfig,\n      axesScaleType,\n      humanizerConfigRef,\n      drawBgTickLines: { y: true, x: false },\n    });\n\n    drawLines({\n      id,\n      processedData,\n      nameKey,\n      linesNodeRef,\n      linesRef,\n      curveInterpolation,\n      xScale: attributesRef.current.xScale,\n      yScale: attributesRef.current.yScale,\n      highlightMode,\n      aggregationConfig,\n      processedAggrData,\n      readOnly,\n    });\n\n    /**\n     * render lines with low quality if lines count are more than 'RENDER_LINES_OPTIMIZED_LIMIT'\n     */\n    if (!readOnly && linesNodeRef.current) {\n      const linesCount = linesNodeRef.current.selectChildren().size();\n      if (linesCount > RENDER_LINES_OPTIMIZED_LIMIT) {\n        linesNodeRef.current.classed('optimizeRendering', true);\n      }\n    }\n\n    drawBrush({\n      id,\n      plotBoxRef,\n      plotNodeRef,\n      visBoxRef,\n      axesRef,\n      attributesRef,\n      linesRef,\n      svgNodeRef,\n      axesScaleType,\n      min,\n      max,\n      axesScaleRange,\n      zoom,\n      onZoomChange,\n      readOnly,\n      unableToDrawConditions,\n    });\n\n    if (!readOnly) {\n      drawHoverAttributes({\n        index,\n        id,\n        nameKey,\n        data,\n        processedData,\n        axesScaleType,\n        highlightMode,\n        syncHoverState,\n        visAreaRef,\n        attributesRef,\n        plotBoxRef,\n        visBoxRef,\n        svgNodeRef,\n        bgRectNodeRef,\n        attributesNodeRef,\n        xAxisLabelNodeRef,\n        yAxisLabelNodeRef,\n        linesNodeRef,\n        highlightedNodeRef,\n        aggregationConfig,\n        alignmentConfig,\n      });\n    }\n\n    drawUnableToRender({\n      renderArr: unableToDrawConditions,\n      visAreaRef,\n      attributesRef,\n      readOnly,\n      syncHoverState,\n    });\n  }\n\n  function renderChart() {\n    clearArea({ visAreaRef });\n    draw();\n  }\n\n  const resizeObserverCallback: ResizeObserverCallback = React.useCallback(\n    (entries: ResizeObserverEntry[]) => {\n      if (entries?.length) {\n        rafIDRef.current = window.requestAnimationFrame(renderChart);\n      }\n    },\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n    updateDeps,\n  );\n\n  const observerReturnCallback = React.useCallback(() => {\n    if (rafIDRef.current) {\n      window.cancelAnimationFrame(rafIDRef.current);\n    }\n  }, []);\n\n  useResizeObserver(resizeObserverCallback, parentRef, observerReturnCallback);\n\n  React.useEffect(() => {\n    attributesRef.current.currentXValue = undefined;\n  }, [alignmentConfig, data]);\n\n  React.useEffect(() => {\n    rafIDRef.current = window.requestAnimationFrame(renderChart);\n    return () => {\n      if (rafIDRef.current) {\n        window.cancelAnimationFrame(rafIDRef.current);\n      }\n    };\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, updateDeps);\n\n  React.useEffect(() => {\n    if (typeof onMount === 'function') {\n      onMount();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n\n  React.useImperativeHandle(ref, () => ({\n    setActiveLineAndCircle: (\n      lineKey: string,\n      focusedStateActive: boolean = false,\n      force: boolean = false,\n    ) => {\n      attributesRef.current.setActiveLineAndCircle?.(\n        lineKey,\n        focusedStateActive,\n        force,\n      );\n    },\n    updateHoverAttributes: (xValue: number, dataSelector?: string) => {\n      attributesRef.current.updateHoverAttributes?.(xValue, dataSelector);\n    },\n    clearHoverAttributes: () => {\n      attributesRef.current.clearHoverAttributes?.();\n    },\n    setFocusedState: (focusedState: IFocusedState) => {\n      if (focusedState) {\n        attributesRef.current.focusedState = {\n          ...focusedState,\n          visId: focusedState.visId ?? `${focusedState.chartIndex}`,\n        };\n      }\n    },\n  }));\n\n  return (\n    <ErrorBoundary>\n      <div\n        id={'vis-' + id}\n        ref={parentRef}\n        className={classNames('LineChart', {\n          zoomMode: !readOnly && zoom?.active,\n        })}\n      >\n        <div ref={visAreaRef} />\n      </div>\n    </ErrorBoundary>\n  );\n});\n\nLineChart.displayName = 'LineChart';\n\nexport default React.memo(LineChart);\n"],"sourceRoot":""}