[build-system]
requires = [
    "setuptools>=77",
    "wheel",
    "Cython>=3,<3.2",
    "fastrlock>=0.5",
]
build-backend = "setuptools.build_meta"

[project]
name = "cupy"
description = "CuPy: NumPy & SciPy for GPU"
authors = [
    { name = "Seiya Tokui", email = "tokui@preferred.jp" },
]
maintainers = [
    { name = "CuPy Developers" },
]
license = "MIT"
license-files = [
    "LICENSE",
    "docs/source/license.rst",
]
classifiers = [
    "Development Status :: 5 - Production/Stable",
    "Intended Audience :: Science/Research",
    "Intended Audience :: Developers",
    "Programming Language :: Python",
    "Programming Language :: Python :: 3",
    "Programming Language :: Python :: 3.9",
    "Programming Language :: Python :: 3.10",
    "Programming Language :: Python :: 3.11",
    "Programming Language :: Python :: 3.12",
    "Programming Language :: Python :: 3.13",
    "Programming Language :: Python :: 3 :: Only",
    "Programming Language :: Cython",
    "Topic :: Software Development",
    "Topic :: Scientific/Engineering",
    "Operating System :: POSIX",
    "Operating System :: Microsoft :: Windows",
]
requires-python = ">=3.9"
dependencies = [
    "numpy>=1.22,<2.6",
    "fastrlock>=0.5",
]
dynamic = [
    "version",
    "readme",
]

[project.optional-dependencies]
all = [
    "scipy>=1.7,<1.17",
    "Cython>=3",
    "optuna>=2.0",
]
test = [
    "packaging",
    "pytest>=7.2",
    "hypothesis>=6.37.2,<6.55.0",
    "mpmath",
]

[project.urls]
Homepage = "https://cupy.dev/"
Documentation = "https://docs.cupy.dev/"
"Bug Tracker" = "https://github.com/cupy/cupy/issues"
"Source Code" = "https://github.com/cupy/cupy"

[tool.setuptools]
include-package-data = false

[tool.setuptools.packages.find]
include = [
    "cupy*",
    "cupyx*",
    "cupy_backends*",
]

[tool.setuptools.dynamic.version]
attr = "cupy._version.__version__"

[tool.autopep8]
exclude = "*.git*, *.eggs*, *cupy/array_api*, *tests/cupy_tests/array_api_tests*, *docs/source*"

[tool.autopep8.per-file-ignores]
"cupyx/scipy/special/_gammainc.py" = [
    "E501",
]

[tool.mypy]
files = [
    "cupy",
    "cupyx",
    "cupy_backends",
    ".github",
    ".pfnci",
]
ignore_missing_imports = true
disable_error_code = [
    "attr-defined",
]

[tool.pytest.ini_options]
xfail_strict = true
testpaths = "tests"
addopts = "--strict-markers"
markers = [
    "slow",
    "multi_gpu",
]
filterwarnings = [
    "error::FutureWarning",
    "ignore:.* is experimental\\.:FutureWarning:cupy",
    "ignore::UserWarning",
    "error::DeprecationWarning",
    "error::PendingDeprecationWarning",
    "error::cupy.exceptions.VisibleDeprecationWarning",
    "error::cupy.exceptions.ComplexWarning",
    "ignore:The distutils(.+) is deprecated:DeprecationWarning",
    "ignore:dep_util is Deprecated:DeprecationWarning",
    "ignore::DeprecationWarning:pkg_resources",
    "ignore:pkg_resources is deprecated",
    "ignore::DeprecationWarning:scipy\\._lib\\._numpy_compat",
    "ignore::DeprecationWarning:scipy\\.stats\\.morestats",
    "ignore::PendingDeprecationWarning:scipy\\.sparse\\.\\w+",
    "ignore::PendingDeprecationWarning:numpy\\.matrixlib\\.defmatrix",
    "ignore:Using or importing the ABCs from:DeprecationWarning:pyreadline",
    "ignore:(.+?) has been deprecated in v3.0.0:FutureWarning:optuna",
    "ignore:Deprecated API features detected! These feature\\(s\\) are not compatible with SQLAlchemy 2\\.0\\.:DeprecationWarning:optuna",
    "ignore:(.+?)SQLAlchemy 2\\.0(.+?):DeprecationWarning",
    "ignore:Absolute path '(.+?)' is being replaced with a relative path '(.+?)' for outputs:DeprecationWarning:distutils",
]

[tool.coverage.run]
plugins = "Cython.Coverage"
include = [
    "cupy/*",
    "cupyx/*",
    "examples/*",
]

[tool.coverage.report]
ecxlude_lines = [
    "if __name__ == .__main__.:",
]

[tool.ruff]
line-length = 79
extend-exclude = [
    "cupy/array_api",
    "docs/source",
    "tests/cupy_tests/array_api_tests",
    "third_party",
]

[tool.ruff.lint]
select = [
    "E",
    "F",
    "W",
]

[tool.ruff.lint.per-file-ignores]
"cupyx/scipy/special/_gammainc.py" = [
    "E501",
]
"tests/typing_tests/cupy_tests/creation_tests/test_basic.pyi" = [
    "E501",
]
