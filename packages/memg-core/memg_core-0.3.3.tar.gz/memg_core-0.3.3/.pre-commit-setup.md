# Pre-commit Setup Guide

## Overview
This repository uses pre-commit hooks to maintain code quality and ensure CI/CD pipeline compatibility.

## What's Configured

### Essential Hooks (Always Run)
- **File Quality**: Trailing whitespace, end-of-file fixes, YAML/JSON/TOML validation
- **Security**: Debug statement detection, large file checks, merge conflict detection
- **Code Formatting**: Ruff auto-formatting (ensures CI compatibility)
- **Shell Scripts**: Shellcheck validation

### Manual Quality Checks
- **Pylint**: Run manually with `pylint src/memory_system/ --score=yes`
- **Ruff Linting**: Run manually with `ruff check src/memory_system/ --fix`

## Installation

Pre-commit is already installed and configured. For new developers:

```bash
# Install pre-commit (if not already installed)
pipx install pre-commit

# Install hooks in your local repo
pre-commit install

# Test hooks on all files (optional)
pre-commit run --all-files
```

## How It Works

1. **On Every Commit**: Pre-commit hooks run automatically
2. **Auto-fixes**: Many issues are fixed automatically (formatting, whitespace)
3. **Commit Blocked**: If critical issues found, commit is blocked until fixed
4. **CI Compatibility**: Ensures your code passes the CI/CD pipeline

## Key Benefits

### ✅ **Prevents CI Failures**
- Ruff formatting issues (main cause of CI failures)
- File format problems
- Debug statements in production code

### ✅ **Maintains Code Quality**
- Consistent formatting across the team
- Clean file structure
- No accidentally committed debug code

### ✅ **Developer Friendly**
- Most issues are auto-fixed
- Only blocks commits for serious problems
- Manual control over advanced linting

## Troubleshooting

### Pre-commit Hook Failed
```bash
# See what failed and why
git commit -m "your message"

# Fix auto-fixable issues and try again
git add -A && git commit -m "your message"
```

### Skip Hooks (Emergency Only)
```bash
# Skip all hooks (use sparingly!)
git commit --no-verify -m "emergency fix"
```

### Update Hooks
```bash
# Update to latest versions
pre-commit autoupdate

# Re-run on all files after update
pre-commit run --all-files
```

## Manual Quality Commands

### Full Quality Check
```bash
# Format code
ruff format src/memory_system/

# Check for issues
ruff check src/memory_system/ --fix

# Comprehensive linting
pylint src/memory_system/ --score=yes
```

### CI Simulation
```bash
# Simulate what CI will run
ruff format --check src/memory_system/
ruff check src/memory_system/
```

## Configuration Files

- `.pre-commit-config.yaml`: Pre-commit hook configuration
- `pyproject.toml`: Ruff and other tool configurations
- `.pylintrc`: Pylint-specific settings

## Support

If you encounter issues with pre-commit hooks:

1. Check this guide for common solutions
2. Run `pre-commit run --all-files` to see detailed output
3. Use `git commit --no-verify` for emergency commits (rare)
4. Ask the team for help with persistent issues

Remember: Pre-commit hooks are here to help maintain code quality and prevent CI failures. They save time by catching issues early!
