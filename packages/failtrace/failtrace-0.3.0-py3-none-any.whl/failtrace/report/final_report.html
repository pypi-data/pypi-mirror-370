<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Test Analysis Report</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="app.css" />
  </head>
  <body>
    <div class="container">
      <header class="header">
        <div class="title-stack">
          <h1 class="title">Test Analysis Report</h1>
          <div class="meta-line">
            <span id="projName" class="meta-item">—</span>
            <span class="dot">•</span>
            <span id="runDate" class="meta-item">—</span>
          </div>
        </div>
        <div class="actions">
          <button class="btn" onclick="window.print()">Print / PDF</button>
        </div>
      </header>

      <section class="card card--kpis">
        <div class="kpis">
          <div class="kpi">
            <h4>Total</h4>
            <div class="v" id="kTotal">0</div>
          </div>
          <div class="kpi ok">
            <h4>Passed</h4>
            <div class="v" id="kPassed">0</div>
          </div>
          <div class="kpi err">
            <h4>Failed</h4>
            <div class="v" id="kFailed">0</div>
          </div>
          <div class="kpi warn">
            <h4>Skipped</h4>
            <div class="v" id="kSkipped">0</div>
          </div>
        </div>
      </section>

      <section class="grid">
        <div class="card card-flex">
          <div class="section-title"><h3>Tests Status</h3></div>
          <div class="chart-area">
            <canvas id="testsOverviewChart"></canvas>
          </div>
        </div>
        <div class="card card-flex">
          <div class="section-title"><h3>Failure Types</h3></div>
          <div class="chart-area stick-bottom">
            <canvas id="failureTypesChart"></canvas>
          </div>
        </div>
      </section>

      <section class="grid grid--equal" style="margin-top: 16px">
        <div class="card card-flex">
          <div class="section-title"><h3>Insights</h3></div>
          <p class="section-hint">
            Concise, high-signal observations derived from the LLM analysis.
          </p>
          <div class="table-wrap table-wrap--scroll">
            <table class="table table-compact" id="insightsTable">
              <thead>
                <tr>
                  <th style="width: 30%">Insight</th>
                  <th>Detail</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <div class="card card-flex card--risk">
          <div class="section-title"><h3>Risk Matrix</h3></div>
          <div class="chart-area">
            <canvas id="riskBubblesChart"></canvas>
          </div>
        </div>
      </section>

      <section class="card" style="margin-top: 16px">
        <div class="section-title"><h3>Failed Items</h3></div>
        <div class="table-wrap table-wrap--fail-scroll" id="failWrap">
          <table class="table table-fail" id="failTable">
            <thead>
              <tr>
                <th style="min-width: 220px">Test</th>
                <th style="min-width: 320px">Root Cause</th>
                <th style="min-width: 240px">Location</th>
                <th style="min-width: 280px">Error</th>
                <th style="min-width: 260px">Suggested Fixes</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>
    </div>

    <script>
      const REPORT = {
        schemaVersion: "1.0.0",
        project: { name: "pytest-samples", date: "2025-08-13" },
        metrics: {
          total: 29,
          passed: 19,
          failed: 4,
          skipped: 1,
          durationSec: 0.0,
        },
        insights: [
          {
            title: "test_will_fail",
            detail: [
              "Incorrect logic in core functions can propagate errors across dependent modules.",
              "Medium risk to release stability due to failure in basic functionality.",
              "Potential increase in debugging and lead time if similar issues persist.",
            ],
          },
          {
            title: "test_delayed_response_with_error",
            detail: [
              "Improper mocking setups can lead to unreliable test results.",
              "Medium risk to integration tests relying on consistent mock behavior.",
              "Potential tech debt accumulation if mocking issues are not standardized.",
            ],
          },
          {
            title: "test_mock_patching",
            detail: [
              "Improper mocking practices can reduce test reliability.",
              "Low risk to release but increases debugging overhead.",
              "Standardizing mock usage can prevent similar issues in future tests.",
            ],
          },
          {
            title: "test_mock_side_effect",
            detail: [
              "Improper mocking practices can reduce test reliability.",
              "Low risk to release but increases debugging overhead.",
              "Standardizing mock usage can prevent similar issues in future tests.",
            ],
          },
        ],
        risks: [],
        failures: [
          {
            id: "tests/smoke/test_basic.py::test_will_fail",
            title: "tests/smoke/test_basic.py::test_will_fail",
            type: "unit",
            message:
              "AssertionError: Function should return double of the value",
            root_cause:
              "The function in SystemUnderTest does not correctly return double the input value as expected.",
            severity: "medium",
            file: "source/sut.py",
            location: "source/sut.py>11",
            location_layers: {
              heuristic: ["source/sut.py>11"],
              graph_ranked: ["source/sut.py>11"],
              llm: ["source>sut.py>11"],
            },
            functions: ["source/sut.py::SystemUnderTest::function"],
            suggested_fixes: [
              "Update the implementation of SystemUnderTest::function to correctly return double the input value.",
              "Add unit tests to validate the behavior of SystemUnderTest::function for various inputs.",
            ],
          },
          {
            id: "tests/unit/test_delayed_assert.py::test_delayed_response_with_error",
            title:
              "tests/unit/test_delayed_assert.py::test_delayed_response_with_error",
            type: "unit",
            message: "AssertionError: Failed Expectations : 1",
            root_cause:
              "The mocked response JSON does not match the expected empty dictionary, causing a failed expectation.",
            severity: "medium",
            file: "",
            location:
              "tests>unit>test_delayed_assert.py>13, tests>unit>test_delayed_assert.py>12, .venv>Lib>site-packages>delayed_assert>delayed_assert.py>74",
            location_layers: {
              heuristic: [
                "tests>unit>test_delayed_assert.py>13",
                "tests>unit>test_delayed_assert.py>12",
                ".venv>Lib>site-packages>delayed_assert>delayed_assert.py>74",
              ],
              graph_ranked: [
                "tests>unit>test_delayed_assert.py>13",
                "tests>unit>test_delayed_assert.py>12",
                ".venv>Lib>site-packages>delayed_assert>delayed_assert.py>74",
              ],
              llm: [],
            },
            functions: [],
            suggested_fixes: [
              "Update the test to correctly mock the expected response JSON as {}.",
              "Ensure the test setup aligns with the expected behavior of the mocked response.",
            ],
          },
          {
            id: "tests/unit/test_mocks.py::test_mock_patching",
            title: "tests/unit/test_mocks.py::test_mock_patching",
            type: "unit",
            message: "AttributeError: 'called_once' is not a valid assertion.",
            root_cause:
              "The 'called_once' attribute is not valid for the mocked object; it requires a spec to define valid attributes.",
            severity: "low",
            file: "",
            location:
              "tests>unit>test_mocks.py>24, ..>..>..>AppData>Local>Programs>Python>Python312>Lib>unittest>mock.py>663",
            location_layers: {
              heuristic: [
                "tests>unit>test_mocks.py>24",
                "..>..>..>AppData>Local>Programs>Python>Python312>Lib>unittest>mock.py>663",
              ],
              graph_ranked: [
                "tests>unit>test_mocks.py>24",
                "..>..>..>AppData>Local>Programs>Python>Python312>Lib>unittest>mock.py>663",
              ],
              llm: [],
            },
            functions: [],
            suggested_fixes: [
              "Add a spec to the mock object to define valid attributes.",
              "Replace 'called_once' with a valid assertion method like 'assert_called_once'.",
            ],
          },
          {
            id: "tests/unit/test_mocks.py::test_mock_side_effect",
            title: "tests/unit/test_mocks.py::test_mock_side_effect",
            type: "unit",
            message: "AttributeError: 'called_once' is not a valid assertion.",
            root_cause:
              "The 'called_once' attribute is not valid for the mocked object; it requires a spec to define valid attributes.",
            severity: "low",
            file: "",
            location:
              "tests>unit>test_mocks.py>34, ..>..>..>AppData>Local>Programs>Python>Python312>Lib>unittest>mock.py>663",
            location_layers: {
              heuristic: [
                "tests>unit>test_mocks.py>34",
                "..>..>..>AppData>Local>Programs>Python>Python312>Lib>unittest>mock.py>663",
              ],
              graph_ranked: [
                "tests>unit>test_mocks.py>34",
                "..>..>..>AppData>Local>Programs>Python>Python312>Lib>unittest>mock.py>663",
              ],
              llm: [],
            },
            functions: [],
            suggested_fixes: [
              "Add a spec to the mock object to define valid attributes.",
              "Replace 'called_once' with a valid assertion method like 'assert_called_once'.",
            ],
          },
        ],
        charts: {
          testsOverview: { passed: 19, failed: 4, skipped: 1 },
          failureTypes: [
            { type: "AssertionError", count: 2 },
            { type: "AttributeError", count: 2 },
          ],
          riskBubbles: [
            {
              probability: 60.8,
              impact: 65.0,
              r: 12,
              risk: "medium",
              test_name: "tests/smoke/test_basic.py::test_will_fail",
            },
            {
              probability: 60.82,
              impact: 65.0,
              r: 12,
              risk: "medium",
              test_name:
                "tests/unit/test_delayed_assert.py::test_delayed_response_with_error",
            },
            {
              probability: 56.74,
              impact: 30.0,
              r: 12,
              risk: "low",
              test_name: "tests/unit/test_mocks.py::test_mock_patching",
            },
            {
              probability: 56.76,
              impact: 30.0,
              r: 12,
              risk: "low",
              test_name: "tests/unit/test_mocks.py::test_mock_side_effect",
            },
          ],
        },
      };
    </script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="app.js"></script>
  </body>
</html>
