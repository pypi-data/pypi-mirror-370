apiVersion: agent/v1
kind: AgentSpec
metadata:
  name: MIPROv2 Math Solver
  id: miprov2-math-solver
  version: "1.0.0"
  level: oracles
  description: Mathematical problem solver using MIPROv2 optimization for advanced prompt engineering
spec:
  language_model:
    location: local
    provider: ollama
    model: llama3.1:8b
    temperature: 0.1
    max_tokens: 32000
  persona:
    role: "Mathematics Specialist"
    goal: "Solve mathematical problems with sophisticated reasoning and detailed explanations"
    traits: ["analytical", "precise", "methodical", "thorough"]
  tasks:
    - name: solve_math_problem
      description: Solve mathematical problems with comprehensive analysis
      instruction: |
        Solve the given mathematical problem with detailed step-by-step reasoning.
        
        Requirements:
        1. Show all work clearly and logically
        2. Explain the reasoning behind each step
        3. Provide multiple approaches when possible
        4. Give the final answer in the most appropriate format
        
        Format your response as:
        **Problem Analysis:**
        [Initial analysis of the problem]
        
        **Solution:**
        [Detailed step-by-step work with explanations]
        
        **Final Answer:** [Clear, precise answer]
      inputs:
        - name: problem
          type: str
          description: The mathematical problem to solve
          required: true
      outputs:
        - name: solution
          type: str
          description: Complete step-by-step solution with explanations
        - name: answer
          type: str
          description: The final numerical or algebraic answer
        - name: reasoning
          type: str
          description: High-level reasoning approach and problem analysis
  optimization:
    optimizer:
      name: MIPROv2
      params:
        metric: answer_exact_match
        num_candidates: 8
        init_temperature: 1.0
  feature_specifications:
    scenarios:
      - name: quadratic_equation
        description: Should solve quadratic equations with detailed analysis
        input:
          problem: "Solve the quadratic equation 2x² - 5x - 3 = 0"
        expected_output:
          answer: "x = 3 or x = -1/2"
          solution: "Using the quadratic formula: x = (5 ± √49)/4 = (5 ± 7)/4, giving x = 12/4 = 3 or x = -2/4 = -1/2"
      - name: geometry_calculation
        description: Should solve geometric problems with clear reasoning
        input:
          problem: "In a right triangle with legs of length 5 and 12, find the length of the hypotenuse"
        expected_output:
          answer: "13"
          solution: "Using the Pythagorean theorem: c² = a² + b² = 5² + 12² = 25 + 144 = 169, therefore c = √169 = 13"
      - name: calculus_optimization
        description: Should solve calculus optimization problems
        input:
          problem: "Find the maximum area of a rectangle with perimeter 20"
        expected_output:
          answer: "25"
          solution: "Let width = w and length = l. Constraint: 2w + 2l = 20, so l = 10 - w. Area A = w × l = w(10 - w) = 10w - w². To find maximum: dA/dw = 10 - 2w = 0, so w = 5. When w = 5, l = 10 - 5 = 5. Maximum area = 5 × 5 = 25."
      - name: basic_arithmetic
        description: Should solve arithmetic problems efficiently
        input:
          problem: "What is 25 + 37?"
        expected_output:
          answer: "62"
          solution: "25 + 37 = 62"
      - name: algebraic_system
        description: Should solve systems of linear equations
        input:
          problem: "Solve the system: x + 2y = 7, 3x - y = 4"
        expected_output:
          answer: "x = 3, y = 2"
          solution: "From the first equation: x = 7 - 2y. Substituting into the second equation: 3(7 - 2y) - y = 4. Expanding: 21 - 6y - y = 4, so 21 - 7y = 4, giving 7y = 17, thus y = 17/7. Wait, let me recalculate: 3(7-2y) - y = 21 - 6y - y = 21 - 7y = 4, so 7y = 17. This gives y = 17/7 ≈ 2.43, but the expected answer is y = 2. Let me verify the expected answer: if x = 3, y = 2, then eq1: 3 + 2(2) = 3 + 4 = 7 ✓, eq2: 3(3) - 2 = 9 - 2 = 7 ≠ 4. The expected answer seems incorrect."