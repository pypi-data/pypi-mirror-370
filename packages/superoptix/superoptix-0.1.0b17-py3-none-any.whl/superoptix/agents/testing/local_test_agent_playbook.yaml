---
apiVersion: agent/v1
kind: AgentSpec

metadata:
  name: local_test_agent
  namespace: testing
  id: local-test-v1-0-0
  version: 1.0.0
  agent_type: Interactive
  level: genies
description: "A test agent using Ollama llama3.1:8b for Genie-tier ReAct capabilities"

spec:
  language_model:
    provider: ollama
    model: llama3.1:8b
    temperature: 0.1
    max_tokens: 2000
    api_base: http://localhost:11434

  persona:
    name: LocalTestBot
    role: Test Assistant
    goal: "Test Genie-tier capabilities with local Ollama model"
    traits: ["analytical", "helpful", "precise"]

  tasks:
    - name: answer_question
      instruction: "Answer questions using tools and step-by-step reasoning"
      type: react
      inputs:
        - name: question
          type: str
          description: "User's question or request"
          required: true
        - name: context
          type: str
          description: "Additional context"
          required: false
      outputs:
        - name: answer
          type: str
          description: "Comprehensive answer based on reasoning and tool usage"
        - name: reasoning
          type: str
          description: "Step-by-step reasoning process"

  react_config:
    max_iters: 5
    max_tool_calls: 3
    tool_selection_strategy: automatic
    reasoning_style: step_by_step
    error_handling: retry
    enable_tracing: true

  tools:
    builtin_tools:
      - name: calculator
        enabled: true
        description: "Perform mathematical calculations"
        config:
          precision: 10
      - name: datetime
        enabled: true
        description: "Get current date and time information"
      - name: text_analyzer
        enabled: true
        description: "Analyze text for basic statistics"
      - name: file_reader
        enabled: true
        description: "Read and analyze files"
        config:
          allowed_extensions: [txt, md, json, yaml, csv]
          max_file_size: "5MB"

  streaming:
    enabled: true
    stream_reasoning: true
    buffer_size: 32

  agentflow:
    - name: react_reasoning
      type: ReAct
      task: answer_question
      
    - name: synthesize_answer
      type: Generate
      task: answer_question
      depends_on: [react_reasoning]

  memory:
    short_term:
      enabled: true
      retention_policy: session
      max_items: 20
      
    episodic:
      enabled: true
      max_episodes: 5
      episode_boundary: task_completion

  feature_specifications:
    scenarios:
      - name: basic_calculation
        description: "Test basic calculator tool usage"
        input:
          question: "What is 25 * 37 + 14?"
        expected_output:
          answer: "939"
          
      - name: datetime_query
        description: "Test datetime tool integration"
        input:
          question: "What is the current date and time?"
        expected_output:
          answer: string
          
      - name: text_analysis
        description: "Test text analysis tool"
        input:
          question: "Analyze this text: 'Hello world! This is a test sentence for analysis.'"
        expected_output:
          answer: string

  evaluation:
    quality_threshold: 0.6
    performance_target: 5
    accuracy_requirement: 0.7
    model_capability_score: 0.8
    complexity_adjustment: true
    
    criteria:
      - name: tool_usage
        weight: 0.3
        description: "Correct tool selection and usage"
      - name: reasoning_quality
        weight: 0.4
        description: "Quality of step-by-step reasoning"
      - name: answer_accuracy
        weight: 0.3
        description: "Accuracy of final answer"

  dspy_config:
    adapter_type: ChatAdapter
    force_chat_mode: true
    disable_structured_output: false
    max_retries: 2
    timeout: 30
    
    local_optimizations:
      enable_caching: true
      reduce_context: true
      simplify_prompts: false
      
  observability:
    tracing:
      enabled: true
      trace_tools: true
      trace_reasoning: true
      export_format: json
    
    metrics:
      track_latency: true
      track_token_usage: true
      track_error_rates: true
      
    debugging:
      log_level: INFO
      save_conversations: true
      save_tool_calls: true 