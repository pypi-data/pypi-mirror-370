var Ee=Object.defineProperty;var Me=(s,e,a)=>e in s?Ee(s,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[e]=a;var C=(s,e,a)=>Me(s,typeof e!="symbol"?e+"":e,a);import{j as t,u as B,a as De,Q as Oe,b as Pe}from"./query-C6o_FDNk.js";import{a as Fe,r as o,b as We}from"./vendor-Gm9i_4Ku.js";import{u as Ae,L as se,a as Le,R as $e,b as z,B as Re}from"./router-jua2Vyaz.js";import{u as Ie,f as ae,g as He,a as Ye}from"./table-iqIhI9LJ.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function a(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=a(r);fetch(r.href,i)}})();var K={},ne=Fe;K.createRoot=ne.createRoot,K.hydrateRoot=ne.hydrateRoot;function qe({title:s,titleId:e,...a},n){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"}))}const _e=o.forwardRef(qe);function Be({title:s,titleId:e,...a},n){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const Ve=o.forwardRef(Be);function Qe({title:s,titleId:e,...a},n){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m19.5 8.25-7.5 7.5-7.5-7.5"}))}const Ue=o.forwardRef(Qe);function Xe({title:s,titleId:e,...a},n){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 15.75 7.5-7.5 7.5 7.5"}))}const Je=o.forwardRef(Xe);function ze({title:s,titleId:e,...a},n){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"}))}const he=o.forwardRef(ze);function Ge({title:s,titleId:e,...a},n){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25"}))}const Ze=o.forwardRef(Ge);function Ke({title:s,titleId:e,...a},n){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 17.25v-.228a4.5 4.5 0 0 0-.12-1.03l-2.268-9.64a3.375 3.375 0 0 0-3.285-2.602H7.923a3.375 3.375 0 0 0-3.285 2.602l-2.268 9.64a4.5 4.5 0 0 0-.12 1.03v.228m19.5 0a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3m19.5 0a3 3 0 0 0-3-3H5.25a3 3 0 0 0-3 3m16.5 0h.008v.008h-.008v-.008Zm-3 0h.008v.008h-.008v-.008Z"}))}const fe=o.forwardRef(Ke);function et({title:s,titleId:e,...a},n){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.288 15.038a5.25 5.25 0 0 1 7.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0M12.53 18.22l-.53.53-.53-.53a.75.75 0 0 1 1.06 0Z"}))}const xe=o.forwardRef(et);function tt({title:s,titleId:e,...a},n){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const Y=o.forwardRef(tt);function st({title:s,titleId:e,...a},n){return o.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:n,"aria-labelledby":e},a),s?o.createElement("title",{id:e},s):null,o.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"}))}const at=o.forwardRef(st),re=[{name:"Dashboard",href:"/",icon:Ze},{name:"Skalds",href:"/skalds",icon:fe},{name:"Tasks",href:"/tasks",icon:he}];function nt({children:s}){const[e,a]=o.useState(!1),n=Ae();return t.jsxs("div",{className:"min-h-screen bg-gray-50",children:[t.jsxs("div",{className:`fixed inset-0 z-40 lg:hidden ${e?"":"hidden"}`,children:[t.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-75",onClick:()=>a(!1)}),t.jsxs("div",{className:"relative flex w-full max-w-xs flex-1 flex-col bg-white",children:[t.jsx("div",{className:"absolute top-0 right-0 -mr-12 pt-2",children:t.jsx("button",{type:"button",className:"ml-1 flex h-10 w-10 items-center justify-center rounded-full focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:()=>a(!1),children:t.jsx(at,{className:"h-6 w-6 text-white"})})}),t.jsxs("div",{className:"h-0 flex-1 overflow-y-auto pt-5 pb-4",children:[t.jsx("div",{className:"flex flex-shrink-0 items-center px-4",children:t.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Skalds Dashboard"})}),t.jsx("nav",{className:"mt-5 space-y-1 px-2",children:re.map(r=>{const i=n.pathname===r.href;return t.jsxs(se,{to:r.href,className:`group flex items-center px-2 py-2 text-base font-medium rounded-md ${i?"bg-primary-100 text-primary-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}`,onClick:()=>a(!1),children:[t.jsx(r.icon,{className:`mr-4 h-6 w-6 flex-shrink-0 ${i?"text-primary-500":"text-gray-400 group-hover:text-gray-500"}`}),r.name]},r.name)})})]})]})]}),t.jsx("div",{className:"hidden lg:fixed lg:inset-y-0 lg:flex lg:w-64 lg:flex-col",children:t.jsx("div",{className:"flex min-h-0 flex-1 flex-col bg-white border-r border-gray-200",children:t.jsxs("div",{className:"flex flex-1 flex-col overflow-y-auto pt-5 pb-4",children:[t.jsx("div",{className:"flex flex-shrink-0 items-center px-4",children:t.jsx("h1",{className:"text-xl font-bold text-gray-900",children:"Skalds Dashboard"})}),t.jsx("nav",{className:"mt-5 flex-1 space-y-1 px-2",children:re.map(r=>{const i=n.pathname===r.href;return t.jsxs(se,{to:r.href,className:`group flex items-center px-2 py-2 text-sm font-medium rounded-md ${i?"bg-primary-100 text-primary-900":"text-gray-600 hover:bg-gray-50 hover:text-gray-900"}`,children:[t.jsx(r.icon,{className:`mr-3 h-6 w-6 flex-shrink-0 ${i?"text-primary-500":"text-gray-400 group-hover:text-gray-500"}`}),r.name]},r.name)})})]})})}),t.jsxs("div",{className:"lg:pl-64",children:[t.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 lg:hidden",children:t.jsxs("div",{className:"flex h-16 items-center justify-between px-4",children:[t.jsx("button",{type:"button",className:"border-r border-gray-200 px-4 text-gray-500 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary-500 lg:hidden",onClick:()=>a(!0),children:t.jsx(_e,{className:"h-6 w-6"})}),t.jsx("h1",{className:"text-lg font-semibold text-gray-900",children:"Skalds Dashboard"}),t.jsx("div",{className:"w-10"})," "]})}),t.jsx("main",{className:"flex-1",children:t.jsx("div",{className:"py-6",children:t.jsx("div",{className:"w-full px-4 sm:px-6 lg:px-8",children:s})})})]})]})}const _=[{id:"skalds-node-001",type:"node",status:"online",lastHeartbeat:new Date().toISOString(),supportedTasks:["data_processing","ml_training","file_conversion"],currentTasks:["task-001","task-003"]},{id:"skalds-node-002",type:"node",status:"online",lastHeartbeat:new Date(Date.now()-3e4).toISOString(),supportedTasks:["data_processing","image_processing"],currentTasks:["task-002"]},{id:"skalds-edge-001",type:"edge",status:"offline",lastHeartbeat:new Date(Date.now()-3e5).toISOString(),supportedTasks:["sensor_data","edge_computing"],currentTasks:[]}],W=[{id:"task-001",mode:"Active",className:"data_processing",lifecycleStatus:"Running",executor:"skalds-node-001",createDateTime:new Date(Date.now()-36e5).toISOString(),updateDateTime:new Date(Date.now()-18e5).toISOString(),attachments:{inputFile:"data.csv",outputPath:"/tmp/processed"},heartbeat:150,error:void 0,exception:void 0},{id:"task-002",mode:"Active",className:"ml_training",lifecycleStatus:"Running",executor:"skalds-node-002",createDateTime:new Date(Date.now()-72e5).toISOString(),updateDateTime:new Date(Date.now()-9e5).toISOString(),attachments:{model:"neural_network",dataset:"training_data.json"},heartbeat:75,error:void 0,exception:void 0},{id:"task-003",mode:"Active",className:"file_conversion",lifecycleStatus:"Finished",executor:"skalds-node-001",createDateTime:new Date(Date.now()-18e5).toISOString(),updateDateTime:new Date(Date.now()-3e5).toISOString(),attachments:{sourceFile:"document.pdf",targetFormat:"docx"},heartbeat:200,error:void 0,exception:void 0},{id:"task-004",mode:"Active",className:"data_processing",lifecycleStatus:"Failed",executor:"skalds-node-002",createDateTime:new Date(Date.now()-54e5).toISOString(),updateDateTime:new Date(Date.now()-36e5).toISOString(),attachments:{inputFile:"corrupted_data.csv"},heartbeat:-1,error:"File format not supported",exception:"ValueError: Invalid data format"},{id:"task-005",mode:"Active",className:"image_processing",lifecycleStatus:"Created",executor:void 0,createDateTime:new Date(Date.now()-6e5).toISOString(),updateDateTime:new Date(Date.now()-6e5).toISOString(),attachments:{images:["img1.jpg","img2.jpg"],filter:"blur"},heartbeat:0,error:void 0,exception:void 0}];class rt{constructor(){C(this,"baseUrl");C(this,"useMockData",!1);this.baseUrl=window.location.origin,this.useMockData=!1,console.log(`API Client initialized - Base URL: ${this.baseUrl}, Mock Data: ${this.useMockData}`)}async fetchApi(e,a){const n=`${this.baseUrl}${e}`;console.log(`Making API call to: ${n}`);try{const r=await fetch(n,{headers:{"Content-Type":"application/json",...a==null?void 0:a.headers},...a});if(!r.ok)throw console.error(`API call failed: ${r.status} ${r.statusText}`),new Error(`HTTP error! status: ${r.status} - ${r.statusText}`);const i=await r.json();return console.log(`API call successful for ${e}:`,i),i}catch(r){throw console.error(`API call failed for ${e}:`,r),r}}getMockData(e){if(e.includes("/api/skalds"))return{items:_,total:_.length};if(e.includes("/api/tasks"))return{items:W,total:W.length,page:1,pageSize:20};if(e.includes("/api/system/dashboard/summary"))return{totalSkalds:_.length,onlineSkalds:_.filter(a=>a.status==="online").length,totalTasks:W.length,runningTasks:W.filter(a=>a.lifecycleStatus==="Running").length,finishedTasks:W.filter(a=>a.lifecycleStatus==="Finished").length,failedTasks:W.filter(a=>a.lifecycleStatus==="Failed").length};throw new Error(`No mock data available for ${e}`)}async getSkalds(){return this.fetchApi("/api/skalds/")}async getSkald(e){return this.fetchApi(`/api/skalds/${e}`)}async getTasks(e){const a=new URLSearchParams({page:e.page.toString(),pageSize:e.pageSize.toString()});return e.lifecycleStatus&&a.append("lifecycleStatus",e.lifecycleStatus),e.className&&a.append("className",e.className),e.executor&&a.append("executor",e.executor),e.id&&a.append("id",e.id),this.fetchApi(`/api/tasks/?${a.toString()}`)}async getTaskClassNames(){return this.fetchApi("/api/tasks/classnames")}async getTask(e){return this.fetchApi(`/api/tasks/${e}`)}async updateTaskStatus(e,a){return this.fetchApi(`/api/tasks/${e}/status`,{method:"PUT",body:JSON.stringify(a)})}async updateTaskAttachments(e,a){return this.fetchApi(`/api/tasks/${e}/attachments`,{method:"PUT",body:JSON.stringify(a)})}async getDashboardSummary(){return this.fetchApi("/api/system/dashboard/summary")}}const $=new rt;function ge(s){var e,a,n="";if(typeof s=="string"||typeof s=="number")n+=s;else if(typeof s=="object")if(Array.isArray(s)){var r=s.length;for(e=0;e<r;e++)s[e]&&(a=ge(s[e]))&&(n&&(n+=" "),n+=a)}else for(a in s)s[a]&&(n&&(n+=" "),n+=a);return n}function G(){for(var s,e,a=0,n="",r=arguments.length;a<r;a++)(s=arguments[a])&&(e=ge(s))&&(n&&(n+=" "),n+=e);return n}const it={online:{color:"status-online",label:"Online",dotColor:"bg-success-500"},offline:{color:"status-offline",label:"Offline",dotColor:"bg-gray-500"},Created:{color:"status-created",label:"Created",dotColor:"bg-warning-500"},Assigning:{color:"status-assigning",label:"Assigning",dotColor:"bg-warning-500"},Running:{color:"status-running",label:"Running",dotColor:"bg-primary-500"},Paused:{color:"status-paused",label:"Paused",dotColor:"bg-warning-500"},Finished:{color:"status-finished",label:"Finished",dotColor:"bg-success-500"},Failed:{color:"status-failed",label:"Failed",dotColor:"bg-danger-500"},Cancelled:{color:"status-cancelled",label:"Cancelled",dotColor:"bg-gray-500"}},ot={sm:{badge:"px-2 py-1 text-xs",dot:"w-2 h-2"},md:{badge:"px-2.5 py-1.5 text-sm",dot:"w-3 h-3"},lg:{badge:"px-3 py-2 text-base",dot:"w-4 h-4"}};function L({status:s,size:e="md",showLabel:a=!0,animated:n=!1}){const r=it[s],i=ot[e];return r?a?t.jsxs("span",{className:G("inline-flex items-center gap-1.5 rounded-full border font-medium",r.color,i.badge),children:[t.jsx("div",{className:G("rounded-full",i.dot,r.dotColor,n&&(s==="online"||s==="Running")&&"animate-heartbeat")}),r.label]}):t.jsx("div",{className:"flex items-center",children:t.jsx("div",{className:G("rounded-full",i.dot,r.dotColor,n&&(s==="online"||s==="Running")&&"animate-pulse")})}):null}function ct(){const s=Le(),{data:e,isLoading:a,error:n}=B({queryKey:["dashboard-summary"],queryFn:()=>$.getDashboardSummary(),retry:2,retryDelay:1e3});if(o.useEffect(()=>{console.log("Dashboard component mounted - API call status:",{isLoading:a,error:n,summary:e})},[a,n,e]),n)return console.error("Dashboard API error:",n),t.jsx("div",{className:"space-y-6",children:t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(Y,{className:"h-5 w-5 text-red-400"})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"API Connection Error"}),t.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[t.jsx("p",{children:"Failed to load dashboard data. Please check:"}),t.jsxs("ul",{className:"list-disc list-inside mt-1",children:[t.jsx("li",{children:"SystemController backend is running"}),t.jsx("li",{children:"API endpoints are accessible"}),t.jsx("li",{children:"Network connectivity"})]}),t.jsxs("p",{className:"mt-2 font-mono text-xs bg-red-100 p-2 rounded",children:["Error: ",n instanceof Error?n.message:"Unknown error"]})]}),t.jsx("div",{className:"mt-4",children:t.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-sm btn-primary",children:"Retry"})})]})]})})});if(a)return t.jsx("div",{className:"space-y-6",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4 mb-6"}),t.jsx("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:[...Array(4)].map((i,u)=>t.jsx("div",{className:"card",children:t.jsxs("div",{className:"card-content",children:[t.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),t.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/2"})]})},u))})]})});const r=[{name:"Total Skalds",value:(e==null?void 0:e.totalSkalds)||0,subValue:`${(e==null?void 0:e.onlineSkalds)||0} online`,icon:fe,color:"text-primary-600",bgColor:"bg-primary-100"},{name:"Total Tasks",value:(e==null?void 0:e.totalTasks)||0,subValue:`${(e==null?void 0:e.runningTasks)||0} running`,icon:he,color:"text-blue-600",bgColor:"bg-blue-100"},{name:"Finished Tasks",value:(e==null?void 0:e.finishedTasks)||0,subValue:"Successfully finished",icon:Ve,color:"text-success-600",bgColor:"bg-success-100"},{name:"Failed Tasks",value:(e==null?void 0:e.failedTasks)||0,subValue:"Need attention",icon:Y,color:"text-danger-600",bgColor:"bg-danger-100"}];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Dashboard"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Overview of your Skalds system status and performance"})]}),t.jsx("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:r.map(i=>t.jsx("div",{className:"card",children:t.jsx("div",{className:"card-content",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx("div",{className:`p-3 rounded-lg ${i.bgColor}`,children:t.jsx(i.icon,{className:`h-6 w-6 ${i.color}`})})}),t.jsxs("div",{className:"ml-4 flex-1",children:[t.jsx("div",{className:"text-sm font-medium text-gray-500",children:i.name}),t.jsx("div",{className:"text-2xl font-bold text-gray-900",children:i.value}),t.jsx("div",{className:"text-xs text-gray-400",children:i.subValue})]})]})})},i.name))}),t.jsxs("div",{className:"grid grid-cols-1 gap-6 lg:grid-cols-2",children:[t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header",children:t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"System Status"})}),t.jsxs("div",{className:"card-content space-y-4",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Skalds Connectivity"}),t.jsxs("span",{className:"text-xs text-gray-500",children:[(e==null?void 0:e.onlineSkalds)||0," of ",(e==null?void 0:e.totalSkalds)||0," skalds online"]})]}),t.jsx("div",{className:"flex items-center space-x-2",children:(()=>{const i=e!=null&&e.totalSkalds?e.onlineSkalds/e.totalSkalds:0;return i===1?t.jsx("div",{title:"Status: Online - All Skalds nodes are connected and operational",children:t.jsx(L,{status:"online",animated:!0})}):i>=.7?t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1.5 text-sm bg-warning-100 text-warning-800 border-warning-200 cursor-help",title:`Status: Partial - ${Math.round(i*100)}% of skalds online (≥70% threshold met, but not all nodes available)`,children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-warning-500 animate-pulse"}),"Partial"]}):i>0?t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1.5 text-sm bg-danger-100 text-danger-800 border-danger-200 cursor-help",title:`Status: Degraded - Only ${Math.round(i*100)}% of skalds online (<70% threshold, system performance may be impacted)`,children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-danger-500 animate-pulse"}),"Degraded"]}):t.jsx("div",{title:"Status: Offline - No Skalds nodes are currently connected",children:t.jsx(L,{status:"offline",animated:!0})})})()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-sm font-medium text-gray-900",children:"Task Processing"}),t.jsx("span",{className:"text-xs text-gray-500",children:(()=>{const i=(e==null?void 0:e.runningTasks)||0,u=(e==null?void 0:e.finishedTasks)||0,h=(e==null?void 0:e.failedTasks)||0;return i===0&&u===0&&h>0?"0 running, 0 finished, all failed":`${i} running, ${u} finished`})()})]}),t.jsx("div",{className:"flex items-center space-x-2",children:(()=>{const i=(e==null?void 0:e.runningTasks)||0,u=(e==null?void 0:e.failedTasks)||0;return i>0?t.jsx("div",{title:`Status: Running - ${i} task(s) currently being processed`,children:t.jsx(L,{status:"Running",animated:!0})}):u===0?t.jsx("div",{title:"Status: Finished - No active tasks, all previous tasks finished successfully",children:t.jsx(L,{status:"Finished"})}):t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1.5 text-sm bg-warning-100 text-warning-800 border-warning-200 cursor-help",title:`Status: Idle - No tasks running, but ${u} failed task(s) require attention`,children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-warning-500"}),"Idle"]})})()})]}),t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("span",{className:"text-sm font-medium text-gray-900",children:"System Health"}),t.jsxs("span",{className:"text-xs text-gray-500",children:[(e==null?void 0:e.failedTasks)||0," failed tasks detected"]})]}),t.jsx("div",{className:"flex items-center space-x-2",children:(()=>{const i=(e==null?void 0:e.failedTasks)||0,u=(e==null?void 0:e.totalTasks)||0,h=u>0?i/u:0;return i===0?t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1.5 text-sm bg-success-100 text-success-800 border-success-200 cursor-help",title:"Status: Healthy - No failed tasks detected, system operating normally",children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-success-500"}),"Healthy"]}):h<.1?t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1.5 text-sm bg-warning-100 text-warning-800 border-warning-200 cursor-help",title:`Status: Warning - ${i} failed task(s), failure rate ${Math.round(h*100)}% (<10% threshold, monitor closely)`,children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-warning-500 animate-pulse"}),"Warning"]}):t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1.5 text-sm bg-danger-100 text-danger-800 border-danger-200 cursor-help",title:`Status: Critical - ${i} failed task(s), failure rate ${Math.round(h*100)}% (≥10% threshold, immediate attention required)`,children:[t.jsx("div",{className:"w-3 h-3 rounded-full bg-danger-500 animate-pulse"}),"Critical"]})})()})]})]})]}),t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"card-header",children:t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Quick Actions"})}),t.jsxs("div",{className:"card-content space-y-3",children:[t.jsx("button",{className:"btn btn-primary btn-md w-full",onClick:()=>s("/tasks"),children:"View All Tasks"}),t.jsx("button",{className:"btn btn-primary btn-md w-full",onClick:()=>s("/skalds"),children:"Monitor Skalds"}),t.jsx("button",{className:"btn btn-primary btn-md w-full",onClick:()=>alert("System Logs feature coming soon!"),children:"System Logs"})]})]})]}),t.jsxs("div",{className:"card",children:[t.jsxs("div",{className:"card-header",children:[t.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Status Legend"}),t.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Understanding system status indicators and their logic"})]}),t.jsx("div",{className:"card-content",children:t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full text-sm",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"border-b border-gray-200",children:[t.jsx("th",{className:"text-left py-3 font-medium text-gray-900",children:"Category"}),t.jsx("th",{className:"text-left py-3 font-medium text-gray-900",children:"Status"}),t.jsx("th",{className:"text-left py-3 font-medium text-gray-900",children:"Logic & Conditions"})]})}),t.jsxs("tbody",{className:"divide-y divide-gray-100",children:[t.jsxs("tr",{children:[t.jsx("td",{rowSpan:4,className:"py-3 font-medium text-gray-900 align-top border-r border-gray-100",children:"Skalds Connectivity"}),t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-success-100 text-success-800 border-success-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-success-500"}),"Online"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"All Skalds nodes are connected and operational (100% online)"})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-warning-100 text-warning-800 border-warning-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-warning-500"}),"Partial"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"≥70% of skalds online, but not all nodes are available"})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-danger-100 text-danger-800 border-danger-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-danger-500"}),"Degraded"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"<70% of skalds online, system performance may be impacted"})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-gray-100 text-gray-800 border-gray-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-gray-500"}),"Offline"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"No Skalds nodes are currently connected (0% online)"})]}),t.jsxs("tr",{children:[t.jsx("td",{rowSpan:3,className:"py-3 font-medium text-gray-900 align-top border-r border-gray-100",children:"Task Processing"}),t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-primary-100 text-primary-800 border-primary-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-primary-500"}),"Running"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"One or more tasks are currently being processed"})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-success-100 text-success-800 border-success-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-success-500"}),"Finished"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"No active tasks, all previous tasks finished successfully"})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-warning-100 text-warning-800 border-warning-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-warning-500"}),"Idle"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"No tasks currently running, but failed tasks exist and require attention"})]}),t.jsxs("tr",{children:[t.jsx("td",{rowSpan:3,className:"py-3 font-medium text-gray-900 align-top border-r border-gray-100",children:"System Health"}),t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-success-100 text-success-800 border-success-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-success-500"}),"Healthy"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"No failed tasks detected, system operating normally (0% failure rate)"})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-warning-100 text-warning-800 border-warning-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-warning-500"}),"Warning"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"Task failure rate <10%, system should be monitored closely"})]}),t.jsxs("tr",{children:[t.jsx("td",{className:"py-3",children:t.jsxs("span",{className:"inline-flex items-center gap-1.5 rounded-full border px-2.5 py-1 text-xs bg-danger-100 text-danger-800 border-danger-200",children:[t.jsx("div",{className:"w-2 h-2 rounded-full bg-danger-500"}),"Critical"]})}),t.jsx("td",{className:"py-3 text-gray-600",children:"Task failure rate ≥10%, immediate attention and intervention required"})]})]})]})})})]})]})}function pe({data:s,columns:e,loading:a=!1,pagination:n,onRowClick:r}){const[i,u]=o.useState([]),h=e.map(l=>({accessorKey:l.key,header:l.header,enableSorting:l.sortable??!0,cell:({getValue:d,row:w})=>{const N=d();return l.render?l.render(N,w.original):String(N)}})),p=Ie({data:s,columns:h,state:{sorting:i},onSortingChange:u,getCoreRowModel:Ye(),getSortedRowModel:He()});return a?t.jsx("div",{className:"card",children:t.jsxs("div",{className:"animate-pulse",children:[t.jsx("div",{className:"card-header",children:t.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/4"})}),t.jsx("div",{className:"card-content space-y-3",children:[...Array(5)].map((l,d)=>t.jsx("div",{className:"h-4 bg-gray-200 rounded"},d))})]})}):t.jsxs("div",{className:"card",children:[t.jsx("div",{className:"overflow-x-auto",children:t.jsxs("table",{className:"w-full",children:[t.jsx("thead",{children:p.getHeaderGroups().map(l=>t.jsx("tr",{className:"border-b border-gray-200",children:l.headers.map(d=>t.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:d.isPlaceholder?null:t.jsxs("div",{className:`flex items-center gap-2 ${d.column.getCanSort()?"cursor-pointer select-none":""}`,onClick:d.column.getToggleSortingHandler(),children:[ae(d.column.columnDef.header,d.getContext()),d.column.getCanSort()&&t.jsxs("span",{className:"flex flex-col",children:[t.jsx(Je,{className:`w-3 h-3 ${d.column.getIsSorted()==="asc"?"text-primary-600":"text-gray-400"}`}),t.jsx(Ue,{className:`w-3 h-3 -mt-1 ${d.column.getIsSorted()==="desc"?"text-primary-600":"text-gray-400"}`})]})]})},d.id))},l.id))}),t.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:p.getRowModel().rows.map(l=>t.jsx("tr",{className:`hover:bg-gray-50 ${r?"cursor-pointer":""}`,onClick:()=>r==null?void 0:r(l.original),children:l.getVisibleCells().map(d=>t.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ae(d.column.columnDef.cell,d.getContext())},d.id))},l.id))})]})}),n&&t.jsxs("div",{className:"card-footer flex items-center justify-between",children:[t.jsxs("div",{className:"text-sm text-gray-700",children:["Showing ",(n.page-1)*n.pageSize+1," to"," ",Math.min(n.page*n.pageSize,n.total)," of"," ",n.total," results"]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>n.onPageChange(n.page-1),disabled:n.page<=1,children:"Previous"}),t.jsxs("span",{className:"text-sm text-gray-700",children:["Page ",n.page," of ",Math.ceil(n.total/n.pageSize)]}),t.jsx("button",{className:"btn btn-secondary btn-sm",onClick:()=>n.onPageChange(n.page+1),disabled:n.page>=Math.ceil(n.total/n.pageSize),children:"Next"})]})]})]})}class lt{constructor(e="/api/events"){C(this,"skaldEventSource",null);C(this,"taskEventSource",null);C(this,"skaldCallbacks",new Map);C(this,"taskCallbacks",new Map);C(this,"connectionCallbacks",[]);C(this,"reconnectAttempts",0);C(this,"maxReconnectAttempts",5);C(this,"reconnectDelay",1e3);C(this,"connected",!1);C(this,"lastError",null);this.baseUrl=e}connect(){this.connectSkaldEvents(),this.connectTaskEvents()}disconnect(){this.disconnectSkaldEvents(),this.disconnectTaskEvents(),this.connected=!1,this.notifyConnectionState(!1)}reconnect(){if(this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached");return}this.reconnectAttempts++;const e=this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1);console.log(`Attempting to reconnect in ${e}ms (attempt ${this.reconnectAttempts})`),setTimeout(()=>{this.disconnect(),this.connect()},e)}connectSkaldEvents(){try{this.skaldEventSource=new EventSource(`${this.baseUrl}/skalds`),this.skaldEventSource.onopen=()=>{console.log("Skalds SSE connection opened"),this.reconnectAttempts=0,this.connected=!0,this.lastError=null,this.notifyConnectionState(!0)},this.skaldEventSource.onmessage=e=>{try{const a=JSON.parse(e.data);this.handleSkaldEvent(a)}catch(a){console.error("Error parsing Skalds event:",a)}},this.skaldEventSource.onerror=e=>{var a;console.error("Skalds SSE error:",e),this.lastError=new Error("Skalds SSE connection error"),this.connected=!1,this.notifyConnectionState(!1),((a=this.skaldEventSource)==null?void 0:a.readyState)===EventSource.CLOSED&&this.reconnect()}}catch(e){console.error("Failed to connect to Skalds events:",e),this.lastError=e}}disconnectSkaldEvents(){this.skaldEventSource&&(this.skaldEventSource.close(),this.skaldEventSource=null)}connectTaskEvents(){try{this.taskEventSource=new EventSource(`${this.baseUrl}/tasks`),this.taskEventSource.onopen=()=>{console.log("Task SSE connection opened")},this.taskEventSource.onmessage=e=>{try{const a=JSON.parse(e.data);this.handleTaskEvent(a)}catch(a){console.error("Error parsing Task event:",a)}},this.taskEventSource.onerror=e=>{var a;console.error("Task SSE error:",e),this.lastError=new Error("Task SSE connection error"),((a=this.taskEventSource)==null?void 0:a.readyState)===EventSource.CLOSED&&this.reconnect()}}catch(e){console.error("Failed to connect to Task events:",e),this.lastError=e}}disconnectTaskEvents(){this.taskEventSource&&(this.taskEventSource.close(),this.taskEventSource=null)}subscribeToSkald(e,a){return this.skaldCallbacks.has(e)||this.skaldCallbacks.set(e,[]),this.skaldCallbacks.get(e).push(a),()=>{const n=this.skaldCallbacks.get(e);if(n){const r=n.indexOf(a);r>-1&&n.splice(r,1),n.length===0&&this.skaldCallbacks.delete(e)}}}subscribeToTask(e,a){return this.taskCallbacks.has(e)||this.taskCallbacks.set(e,[]),this.taskCallbacks.get(e).push(a),()=>{const n=this.taskCallbacks.get(e);if(n){const r=n.indexOf(a);r>-1&&n.splice(r,1),n.length===0&&this.taskCallbacks.delete(e)}}}subscribeToConnection(e){return this.connectionCallbacks.push(e),()=>{const a=this.connectionCallbacks.indexOf(e);a>-1&&this.connectionCallbacks.splice(a,1)}}handleSkaldEvent(e){const a=this.skaldCallbacks.get(e.skaldId);a&&a.forEach(n=>{try{n(e)}catch(r){console.error("Error in Skalds event callback:",r)}})}handleTaskEvent(e){const a=this.taskCallbacks.get(e.taskId);a&&a.forEach(n=>{try{n(e)}catch(r){console.error("Error in Task event callback:",r)}})}notifyConnectionState(e){this.connectionCallbacks.forEach(a=>{try{a(e)}catch(n){console.error("Error in connection state callback:",n)}})}isConnected(){return this.connected}getLastError(){return this.lastError}startMockEvents(){}startMockSkaldEvents(){const e=["skalds-node-001","skalds-node-002","skalds-edge-001"];setInterval(()=>{const n={type:"skald_heartbeat",skaldId:e[Math.floor(Math.random()*e.length)],data:{heartbeat:Math.floor(Math.random()*100)}};this.handleSkaldEvent(n)},5e3)}startMockTaskEvents(){const e=["task-001","task-002","task-003","task-004","task-005"];setInterval(()=>{const n={type:"task_heartbeat",taskId:e[Math.floor(Math.random()*e.length)],data:{heartbeat:Math.floor(Math.random()*200)}};this.handleTaskEvent(n)},3e3)}}const dt=window.location.origin+"/api/events",S=new lt(dt),be=o.createContext(void 0);function ut({children:s}){const[e,a]=o.useState(!1),[n,r]=o.useState(null),[i,u]=o.useState(new Map),[h,p]=o.useState(new Map),l=o.useCallback((m,g)=>{u(E=>{const f=new Map(E),j=f.get(m);return j?f.set(m,{...j,...g}):f.set(m,{id:m,type:"node",status:"offline",lastHeartbeat:new Date().toISOString(),supportedTasks:[],currentTasks:[],...g}),f})},[]),d=o.useCallback((m,g)=>{p(E=>{const f=new Map(E),j=f.get(m);return j?f.set(m,{...j,...g}):f.set(m,{id:m,className:"Unknown",lifecycleStatus:"Created",createDateTime:new Date().toISOString(),updateDateTime:new Date().toISOString(),attachments:{},heartbeat:0,...g}),f})},[]),w=o.useCallback(m=>{const g={};switch(m.type){case"skald_status":m.data.status&&(g.status=m.data.status),m.data.tasks&&(g.currentTasks=m.data.tasks);break;case"skald_heartbeat":m.data.heartbeat!==void 0&&(g.lastHeartbeat=new Date().toISOString(),g.status="online"),m.data.tasks&&(g.currentTasks=m.data.tasks);break}Object.keys(g).length>0&&l(m.skaldId,g)},[l]),N=o.useCallback(m=>{const g={updateDateTime:new Date().toISOString()};switch(m.type){case"task_heartbeat":m.data.heartbeat!==void 0&&(g.heartbeat=m.data.heartbeat),m.data.lifecycleStatus!==void 0&&(g.lifecycleStatus=m.data.lifecycleStatus);break;case"task_error":m.data.error&&(g.error=m.data.error),m.data.lifecycleStatus!==void 0&&(g.lifecycleStatus=m.data.lifecycleStatus);break;case"task_exception":m.data.exception&&(g.exception=m.data.exception),m.data.lifecycleStatus!==void 0&&(g.lifecycleStatus=m.data.lifecycleStatus);break}d(m.taskId,g)},[d]),T=o.useCallback((m,g)=>S.subscribeToSkald(m,g),[]),k=o.useCallback((m,g)=>S.subscribeToTask(m,g),[]),v=o.useCallback(()=>{S.connect()},[]),y=o.useCallback(()=>{S.disconnect()},[]);o.useEffect(()=>{const m=S.subscribeToConnection(f=>{a(f),r(f?null:S.getLastError())}),g=S.handleSkaldEvent.bind(S),E=S.handleTaskEvent.bind(S);return S.handleSkaldEvent=f=>{g(f),w(f)},S.handleTaskEvent=f=>{E(f),N(f)},S.connect(),()=>{S.handleSkaldEvent=g,S.handleTaskEvent=E,m(),S.disconnect()}},[w,N]),o.useEffect(()=>{const m=setInterval(()=>{a(S.isConnected()),r(S.getLastError())},1e3);return()=>clearInterval(m)},[]);const R={isConnected:e,lastError:n,skalds:i,updateSkald:l,tasks:h,updateTask:d,subscribeToSkald:T,subscribeToTask:k,connect:v,disconnect:y};return t.jsx(be.Provider,{value:R,children:s})}function ye(){const s=o.useContext(be);if(s===void 0)throw new Error("useSSE must be used within an SSEProvider");return s}function mt(){const{data:s,isLoading:e,error:a}=B({queryKey:["skalds"],queryFn:()=>$.getSkalds(),retry:2,retryDelay:1e3}),{skalds:n,isConnected:r,lastError:i,updateSkald:u}=ye(),h=o.useMemo(()=>s!=null&&s.items?s.items.map(l=>{const d=n.get(l.id);return d?{...l,...d,supportedTasks:l.supportedTasks,type:l.type}:l}):[],[s==null?void 0:s.items,n]);if(o.useEffect(()=>{if(!(s!=null&&s.items))return;const l=[];return s.items.forEach(d=>{n.has(d.id)||u(d.id,d)}),()=>{l.forEach(d=>d())}},[s==null?void 0:s.items,n,u]),o.useEffect(()=>{var l;console.log("SkaldsPage status:",{isLoading:e,error:a,skalds:((l=s==null?void 0:s.items)==null?void 0:l.length)||0,sseConnected:r,sseError:i,sseSkalds:n.size})},[e,a,s,r,i,n]),a)return console.error("Skalds API error:",a),t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Skalds"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Monitor and manage your Skalds workers"})]}),t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(Y,{className:"h-5 w-5 text-red-400"})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Failed to Load Skalds"}),t.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[t.jsx("p",{children:"Unable to fetch Skalds data from the API."}),t.jsxs("p",{className:"mt-2 font-mono text-xs bg-red-100 p-2 rounded",children:["Error: ",a instanceof Error?a.message:"Unknown error"]})]}),t.jsx("div",{className:"mt-4",children:t.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-sm btn-primary",children:"Retry"})})]})]})})]});const p=[{key:"id",header:"Skalds ID",sortable:!0},{key:"type",header:"Type",sortable:!0,render:l=>t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${l==="node"?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"}`,children:l})},{key:"status",header:"Status",sortable:!0,render:l=>t.jsx(L,{status:l,animated:!0})},{key:"supportedTasks",header:"Supported Tasks",sortable:!1,render:l=>t.jsxs("div",{className:"flex flex-wrap gap-1",children:[l.slice(0,3).map((d,w)=>t.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800",children:d},w)),l.length>3&&t.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-md text-xs font-medium bg-gray-100 text-gray-800",children:["+",l.length-3," more"]})]})},{key:"currentTasks",header:"Current Tasks",sortable:!0,render:l=>t.jsx("span",{className:"text-sm text-gray-900",children:l.length})}];return t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Skalds"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Monitor and manage your Skalds workers"})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(xe,{className:`h-5 w-5 ${r?"text-green-500":"text-red-500"}`}),t.jsx("span",{className:`text-sm font-medium ${r?"text-green-700":"text-red-700"}`,children:r?"Live Updates":"Disconnected"}),i&&t.jsx("span",{className:"text-xs text-red-500",title:i.message,children:"(Error)"})]})]}),t.jsx(pe,{data:h,columns:p,loading:e})]})}function M(s){const e=Object.prototype.toString.call(s);return s instanceof Date||typeof s=="object"&&e==="[object Date]"?new s.constructor(+s):typeof s=="number"||e==="[object Number]"||typeof s=="string"||e==="[object String]"?new Date(s):new Date(NaN)}function F(s,e){return s instanceof Date?new s.constructor(e):new Date(e)}const we=6048e5,ht=864e5;let ft={};function Q(){return ft}function q(s,e){var h,p,l,d;const a=Q(),n=(e==null?void 0:e.weekStartsOn)??((p=(h=e==null?void 0:e.locale)==null?void 0:h.options)==null?void 0:p.weekStartsOn)??a.weekStartsOn??((d=(l=a.locale)==null?void 0:l.options)==null?void 0:d.weekStartsOn)??0,r=M(s),i=r.getDay(),u=(i<n?7:0)+i-n;return r.setDate(r.getDate()-u),r.setHours(0,0,0,0),r}function V(s){return q(s,{weekStartsOn:1})}function ke(s){const e=M(s),a=e.getFullYear(),n=F(s,0);n.setFullYear(a+1,0,4),n.setHours(0,0,0,0);const r=V(n),i=F(s,0);i.setFullYear(a,0,4),i.setHours(0,0,0,0);const u=V(i);return e.getTime()>=r.getTime()?a+1:e.getTime()>=u.getTime()?a:a-1}function ie(s){const e=M(s);return e.setHours(0,0,0,0),e}function oe(s){const e=M(s),a=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return a.setUTCFullYear(e.getFullYear()),+s-+a}function xt(s,e){const a=ie(s),n=ie(e),r=+a-oe(a),i=+n-oe(n);return Math.round((r-i)/ht)}function gt(s){const e=ke(s),a=F(s,0);return a.setFullYear(e,0,4),a.setHours(0,0,0,0),V(a)}function pt(s){return s instanceof Date||typeof s=="object"&&Object.prototype.toString.call(s)==="[object Date]"}function bt(s){if(!pt(s)&&typeof s!="number")return!1;const e=M(s);return!isNaN(Number(e))}function yt(s){const e=M(s),a=F(s,0);return a.setFullYear(e.getFullYear(),0,1),a.setHours(0,0,0,0),a}const wt={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},kt=(s,e,a)=>{let n;const r=wt[s];return typeof r=="string"?n=r:e===1?n=r.one:n=r.other.replace("{{count}}",e.toString()),a!=null&&a.addSuffix?a.comparison&&a.comparison>0?"in "+n:n+" ago":n};function Z(s){return(e={})=>{const a=e.width?String(e.width):s.defaultWidth;return s.formats[a]||s.formats[s.defaultWidth]}}const vt={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},jt={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Nt={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},St={date:Z({formats:vt,defaultWidth:"full"}),time:Z({formats:jt,defaultWidth:"full"}),dateTime:Z({formats:Nt,defaultWidth:"full"})},Ct={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Tt=(s,e,a,n)=>Ct[s];function I(s){return(e,a)=>{const n=a!=null&&a.context?String(a.context):"standalone";let r;if(n==="formatting"&&s.formattingValues){const u=s.defaultFormattingWidth||s.defaultWidth,h=a!=null&&a.width?String(a.width):u;r=s.formattingValues[h]||s.formattingValues[u]}else{const u=s.defaultWidth,h=a!=null&&a.width?String(a.width):s.defaultWidth;r=s.values[h]||s.values[u]}const i=s.argumentCallback?s.argumentCallback(e):e;return r[i]}}const Et={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Mt={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Dt={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Ot={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Pt={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Ft={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Wt=(s,e)=>{const a=Number(s),n=a%100;if(n>20||n<10)switch(n%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},At={ordinalNumber:Wt,era:I({values:Et,defaultWidth:"wide"}),quarter:I({values:Mt,defaultWidth:"wide",argumentCallback:s=>s-1}),month:I({values:Dt,defaultWidth:"wide"}),day:I({values:Ot,defaultWidth:"wide"}),dayPeriod:I({values:Pt,defaultWidth:"wide",formattingValues:Ft,defaultFormattingWidth:"wide"})};function H(s){return(e,a={})=>{const n=a.width,r=n&&s.matchPatterns[n]||s.matchPatterns[s.defaultMatchWidth],i=e.match(r);if(!i)return null;const u=i[0],h=n&&s.parsePatterns[n]||s.parsePatterns[s.defaultParseWidth],p=Array.isArray(h)?$t(h,w=>w.test(u)):Lt(h,w=>w.test(u));let l;l=s.valueCallback?s.valueCallback(p):p,l=a.valueCallback?a.valueCallback(l):l;const d=e.slice(u.length);return{value:l,rest:d}}}function Lt(s,e){for(const a in s)if(Object.prototype.hasOwnProperty.call(s,a)&&e(s[a]))return a}function $t(s,e){for(let a=0;a<s.length;a++)if(e(s[a]))return a}function Rt(s){return(e,a={})=>{const n=e.match(s.matchPattern);if(!n)return null;const r=n[0],i=e.match(s.parsePattern);if(!i)return null;let u=s.valueCallback?s.valueCallback(i[0]):i[0];u=a.valueCallback?a.valueCallback(u):u;const h=e.slice(r.length);return{value:u,rest:h}}}const It=/^(\d+)(th|st|nd|rd)?/i,Ht=/\d+/i,Yt={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},qt={any:[/^b/i,/^(a|c)/i]},_t={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Bt={any:[/1/i,/2/i,/3/i,/4/i]},Vt={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Qt={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},Ut={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Xt={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Jt={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},zt={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Gt={ordinalNumber:Rt({matchPattern:It,parsePattern:Ht,valueCallback:s=>parseInt(s,10)}),era:H({matchPatterns:Yt,defaultMatchWidth:"wide",parsePatterns:qt,defaultParseWidth:"any"}),quarter:H({matchPatterns:_t,defaultMatchWidth:"wide",parsePatterns:Bt,defaultParseWidth:"any",valueCallback:s=>s+1}),month:H({matchPatterns:Vt,defaultMatchWidth:"wide",parsePatterns:Qt,defaultParseWidth:"any"}),day:H({matchPatterns:Ut,defaultMatchWidth:"wide",parsePatterns:Xt,defaultParseWidth:"any"}),dayPeriod:H({matchPatterns:Jt,defaultMatchWidth:"any",parsePatterns:zt,defaultParseWidth:"any"})},Zt={code:"en-US",formatDistance:kt,formatLong:St,formatRelative:Tt,localize:At,match:Gt,options:{weekStartsOn:0,firstWeekContainsDate:1}};function Kt(s){const e=M(s);return xt(e,yt(e))+1}function es(s){const e=M(s),a=+V(e)-+gt(e);return Math.round(a/we)+1}function ve(s,e){var d,w,N,T;const a=M(s),n=a.getFullYear(),r=Q(),i=(e==null?void 0:e.firstWeekContainsDate)??((w=(d=e==null?void 0:e.locale)==null?void 0:d.options)==null?void 0:w.firstWeekContainsDate)??r.firstWeekContainsDate??((T=(N=r.locale)==null?void 0:N.options)==null?void 0:T.firstWeekContainsDate)??1,u=F(s,0);u.setFullYear(n+1,0,i),u.setHours(0,0,0,0);const h=q(u,e),p=F(s,0);p.setFullYear(n,0,i),p.setHours(0,0,0,0);const l=q(p,e);return a.getTime()>=h.getTime()?n+1:a.getTime()>=l.getTime()?n:n-1}function ts(s,e){var h,p,l,d;const a=Q(),n=(e==null?void 0:e.firstWeekContainsDate)??((p=(h=e==null?void 0:e.locale)==null?void 0:h.options)==null?void 0:p.firstWeekContainsDate)??a.firstWeekContainsDate??((d=(l=a.locale)==null?void 0:l.options)==null?void 0:d.firstWeekContainsDate)??1,r=ve(s,e),i=F(s,0);return i.setFullYear(r,0,n),i.setHours(0,0,0,0),q(i,e)}function ss(s,e){const a=M(s),n=+q(a,e)-+ts(a,e);return Math.round(n/we)+1}function b(s,e){const a=s<0?"-":"",n=Math.abs(s).toString().padStart(e,"0");return a+n}const O={y(s,e){const a=s.getFullYear(),n=a>0?a:1-a;return b(e==="yy"?n%100:n,e.length)},M(s,e){const a=s.getMonth();return e==="M"?String(a+1):b(a+1,2)},d(s,e){return b(s.getDate(),e.length)},a(s,e){const a=s.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(s,e){return b(s.getHours()%12||12,e.length)},H(s,e){return b(s.getHours(),e.length)},m(s,e){return b(s.getMinutes(),e.length)},s(s,e){return b(s.getSeconds(),e.length)},S(s,e){const a=e.length,n=s.getMilliseconds(),r=Math.trunc(n*Math.pow(10,a-3));return b(r,e.length)}},A={midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},ce={G:function(s,e,a){const n=s.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return a.era(n,{width:"abbreviated"});case"GGGGG":return a.era(n,{width:"narrow"});case"GGGG":default:return a.era(n,{width:"wide"})}},y:function(s,e,a){if(e==="yo"){const n=s.getFullYear(),r=n>0?n:1-n;return a.ordinalNumber(r,{unit:"year"})}return O.y(s,e)},Y:function(s,e,a,n){const r=ve(s,n),i=r>0?r:1-r;if(e==="YY"){const u=i%100;return b(u,2)}return e==="Yo"?a.ordinalNumber(i,{unit:"year"}):b(i,e.length)},R:function(s,e){const a=ke(s);return b(a,e.length)},u:function(s,e){const a=s.getFullYear();return b(a,e.length)},Q:function(s,e,a){const n=Math.ceil((s.getMonth()+1)/3);switch(e){case"Q":return String(n);case"QQ":return b(n,2);case"Qo":return a.ordinalNumber(n,{unit:"quarter"});case"QQQ":return a.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(n,{width:"wide",context:"formatting"})}},q:function(s,e,a){const n=Math.ceil((s.getMonth()+1)/3);switch(e){case"q":return String(n);case"qq":return b(n,2);case"qo":return a.ordinalNumber(n,{unit:"quarter"});case"qqq":return a.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(n,{width:"wide",context:"standalone"})}},M:function(s,e,a){const n=s.getMonth();switch(e){case"M":case"MM":return O.M(s,e);case"Mo":return a.ordinalNumber(n+1,{unit:"month"});case"MMM":return a.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(n,{width:"wide",context:"formatting"})}},L:function(s,e,a){const n=s.getMonth();switch(e){case"L":return String(n+1);case"LL":return b(n+1,2);case"Lo":return a.ordinalNumber(n+1,{unit:"month"});case"LLL":return a.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(n,{width:"wide",context:"standalone"})}},w:function(s,e,a,n){const r=ss(s,n);return e==="wo"?a.ordinalNumber(r,{unit:"week"}):b(r,e.length)},I:function(s,e,a){const n=es(s);return e==="Io"?a.ordinalNumber(n,{unit:"week"}):b(n,e.length)},d:function(s,e,a){return e==="do"?a.ordinalNumber(s.getDate(),{unit:"date"}):O.d(s,e)},D:function(s,e,a){const n=Kt(s);return e==="Do"?a.ordinalNumber(n,{unit:"dayOfYear"}):b(n,e.length)},E:function(s,e,a){const n=s.getDay();switch(e){case"E":case"EE":case"EEE":return a.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(n,{width:"short",context:"formatting"});case"EEEE":default:return a.day(n,{width:"wide",context:"formatting"})}},e:function(s,e,a,n){const r=s.getDay(),i=(r-n.weekStartsOn+8)%7||7;switch(e){case"e":return String(i);case"ee":return b(i,2);case"eo":return a.ordinalNumber(i,{unit:"day"});case"eee":return a.day(r,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(r,{width:"short",context:"formatting"});case"eeee":default:return a.day(r,{width:"wide",context:"formatting"})}},c:function(s,e,a,n){const r=s.getDay(),i=(r-n.weekStartsOn+8)%7||7;switch(e){case"c":return String(i);case"cc":return b(i,e.length);case"co":return a.ordinalNumber(i,{unit:"day"});case"ccc":return a.day(r,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(r,{width:"narrow",context:"standalone"});case"cccccc":return a.day(r,{width:"short",context:"standalone"});case"cccc":default:return a.day(r,{width:"wide",context:"standalone"})}},i:function(s,e,a){const n=s.getDay(),r=n===0?7:n;switch(e){case"i":return String(r);case"ii":return b(r,e.length);case"io":return a.ordinalNumber(r,{unit:"day"});case"iii":return a.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(n,{width:"short",context:"formatting"});case"iiii":default:return a.day(n,{width:"wide",context:"formatting"})}},a:function(s,e,a){const r=s.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(r,{width:"wide",context:"formatting"})}},b:function(s,e,a){const n=s.getHours();let r;switch(n===12?r=A.noon:n===0?r=A.midnight:r=n/12>=1?"pm":"am",e){case"b":case"bb":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(r,{width:"wide",context:"formatting"})}},B:function(s,e,a){const n=s.getHours();let r;switch(n>=17?r=A.evening:n>=12?r=A.afternoon:n>=4?r=A.morning:r=A.night,e){case"B":case"BB":case"BBB":return a.dayPeriod(r,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(r,{width:"wide",context:"formatting"})}},h:function(s,e,a){if(e==="ho"){let n=s.getHours()%12;return n===0&&(n=12),a.ordinalNumber(n,{unit:"hour"})}return O.h(s,e)},H:function(s,e,a){return e==="Ho"?a.ordinalNumber(s.getHours(),{unit:"hour"}):O.H(s,e)},K:function(s,e,a){const n=s.getHours()%12;return e==="Ko"?a.ordinalNumber(n,{unit:"hour"}):b(n,e.length)},k:function(s,e,a){let n=s.getHours();return n===0&&(n=24),e==="ko"?a.ordinalNumber(n,{unit:"hour"}):b(n,e.length)},m:function(s,e,a){return e==="mo"?a.ordinalNumber(s.getMinutes(),{unit:"minute"}):O.m(s,e)},s:function(s,e,a){return e==="so"?a.ordinalNumber(s.getSeconds(),{unit:"second"}):O.s(s,e)},S:function(s,e){return O.S(s,e)},X:function(s,e,a){const n=s.getTimezoneOffset();if(n===0)return"Z";switch(e){case"X":return de(n);case"XXXX":case"XX":return P(n);case"XXXXX":case"XXX":default:return P(n,":")}},x:function(s,e,a){const n=s.getTimezoneOffset();switch(e){case"x":return de(n);case"xxxx":case"xx":return P(n);case"xxxxx":case"xxx":default:return P(n,":")}},O:function(s,e,a){const n=s.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+le(n,":");case"OOOO":default:return"GMT"+P(n,":")}},z:function(s,e,a){const n=s.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+le(n,":");case"zzzz":default:return"GMT"+P(n,":")}},t:function(s,e,a){const n=Math.trunc(s.getTime()/1e3);return b(n,e.length)},T:function(s,e,a){const n=s.getTime();return b(n,e.length)}};function le(s,e=""){const a=s>0?"-":"+",n=Math.abs(s),r=Math.trunc(n/60),i=n%60;return i===0?a+String(r):a+String(r)+e+b(i,2)}function de(s,e){return s%60===0?(s>0?"-":"+")+b(Math.abs(s)/60,2):P(s,e)}function P(s,e=""){const a=s>0?"-":"+",n=Math.abs(s),r=b(Math.trunc(n/60),2),i=b(n%60,2);return a+r+e+i}const ue=(s,e)=>{switch(s){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},je=(s,e)=>{switch(s){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},as=(s,e)=>{const a=s.match(/(P+)(p+)?/)||[],n=a[1],r=a[2];if(!r)return ue(s,e);let i;switch(n){case"P":i=e.dateTime({width:"short"});break;case"PP":i=e.dateTime({width:"medium"});break;case"PPP":i=e.dateTime({width:"long"});break;case"PPPP":default:i=e.dateTime({width:"full"});break}return i.replace("{{date}}",ue(n,e)).replace("{{time}}",je(r,e))},ns={p:je,P:as},rs=/^D+$/,is=/^Y+$/,os=["D","DD","YY","YYYY"];function cs(s){return rs.test(s)}function ls(s){return is.test(s)}function ds(s,e,a){const n=us(s,e,a);if(console.warn(n),os.includes(s))throw new RangeError(n)}function us(s,e,a){const n=s[0]==="Y"?"years":"days of the month";return`Use \`${s.toLowerCase()}\` instead of \`${s}\` (in \`${e}\`) for formatting ${n} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const ms=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,hs=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,fs=/^'([^]*?)'?$/,xs=/''/g,gs=/[a-zA-Z]/;function me(s,e,a){var d,w,N,T;const n=Q(),r=n.locale??Zt,i=n.firstWeekContainsDate??((w=(d=n.locale)==null?void 0:d.options)==null?void 0:w.firstWeekContainsDate)??1,u=n.weekStartsOn??((T=(N=n.locale)==null?void 0:N.options)==null?void 0:T.weekStartsOn)??0,h=M(s);if(!bt(h))throw new RangeError("Invalid time value");let p=e.match(hs).map(k=>{const v=k[0];if(v==="p"||v==="P"){const y=ns[v];return y(k,r.formatLong)}return k}).join("").match(ms).map(k=>{if(k==="''")return{isToken:!1,value:"'"};const v=k[0];if(v==="'")return{isToken:!1,value:ps(k)};if(ce[v])return{isToken:!0,value:k};if(v.match(gs))throw new RangeError("Format string contains an unescaped latin alphabet character `"+v+"`");return{isToken:!1,value:k}});r.localize.preprocessor&&(p=r.localize.preprocessor(h,p));const l={firstWeekContainsDate:i,weekStartsOn:u,locale:r};return p.map(k=>{if(!k.isToken)return k.value;const v=k.value;(ls(v)||cs(v))&&ds(v,e,String(s));const y=ce[v[0]];return y(h,v,r.localize,l)}).join("")}function ps(s){const e=s.match(fs);return e?e[1].replace(xs,"'"):s}function bs({task:s,onClose:e,onUpdated:a}){const[n,r]=o.useState({...s.attachments}),[i,u]=o.useState(s.lifecycleStatus),[h,p]=o.useState(!1),[l,d]=o.useState(null),[w,N]=o.useState(null),[T,k]=o.useState(()=>JSON.stringify(n,null,2)),[v,y]=o.useState(null),R=o.useCallback(f=>{k(f);try{const j=JSON.parse(f);r(j),y(null)}catch{y("Invalid JSON format")}},[]),m=o.useCallback(f=>{r(f),k(JSON.stringify(f,null,2)),y(null)},[]),g=async()=>{p(!0),d(null),N(null);try{const f=await $.updateTaskAttachments(s.id,{attachments:n});f.attachments=n;const j={...s,attachments:f.attachments};N("Attachments updated successfully"),a&&a(j)}catch(f){d(f.message||"Failed to update attachments")}finally{p(!1)}},E=async f=>{p(!0),d(null),N(null);try{const j=await $.updateTaskStatus(s.id,{lifecycleStatus:f}),U={...s,id:j.data.taskId,lifecycleStatus:j.data.status,updateDateTime:new Date().toISOString()};u(j.data.status),N(j.message||`Status changed to ${j.data.status}`),a&&a(U)}catch(j){d(j.message||"Failed to update status")}finally{p(!1)}};return t.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-40",children:t.jsxs("div",{className:"bg-white rounded-xl shadow-2xl p-0 w-full max-w-2xl relative flex flex-col",style:{maxHeight:"90vh"},children:[t.jsx("button",{className:"absolute top-3 right-3 text-gray-400 hover:text-gray-700 text-2xl",onClick:e,style:{lineHeight:1},children:"×"}),t.jsxs("div",{className:"px-8 pt-7 pb-2 border-b border-gray-100",children:[t.jsx("h2",{className:"text-2xl font-bold mb-1 text-gray-900",children:"Task Details"}),t.jsxs("div",{className:"flex flex-wrap gap-x-8 gap-y-1 text-xs text-gray-500 mb-1",children:[t.jsxs("div",{children:["Task ID: ",t.jsx("span",{className:"font-mono",children:s.id})]}),t.jsxs("div",{children:["Type: ",s.className]}),t.jsxs("div",{children:["Executor: ",s.executor||"Unassigned"]}),t.jsxs("div",{children:["Status: ",t.jsx("span",{className:"font-mono",children:i})]})]})]}),t.jsxs("div",{className:"overflow-y-auto px-8 py-4 flex-1",style:{minHeight:200},children:[t.jsxs("div",{className:"mb-6",children:[t.jsx("h3",{className:"font-semibold text-sm mb-2",children:"Attachments"}),t.jsxs("div",{className:"space-y-2",children:[t.jsx("textarea",{className:"w-full h-48 p-3 border rounded-md font-mono text-xs resize-y",value:T,onChange:f=>R(f.target.value),placeholder:"Enter JSON data for attachments...",spellCheck:!1}),v&&t.jsx("div",{className:"text-xs text-red-600 bg-red-50 p-2 rounded",children:v}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsx("button",{className:"px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded border",onClick:()=>{try{const f=JSON.stringify(JSON.parse(T),null,2);k(f)}catch{}},type:"button",children:"Format JSON"}),t.jsx("button",{className:"px-3 py-1 text-xs bg-gray-100 hover:bg-gray-200 rounded border",onClick:()=>m({}),type:"button",children:"Clear"})]})]}),t.jsx("button",{className:"mt-3 px-4 py-1.5 rounded bg-primary-500 text-white text-sm font-medium shadow hover:bg-primary-600 transition",onClick:g,disabled:h||!!v,type:"button",children:h?"Updating...":"Update Attachments"})]}),s.mode==="Passive"&&t.jsxs("div",{className:"mb-4",children:[t.jsx("h3",{className:"font-semibold text-sm mb-2",children:"Change Status"}),t.jsxs("div",{className:"flex space-x-2",children:[t.jsxs("button",{className:`flex items-center gap-2 px-5 py-2 rounded-lg text-base font-semibold shadow transition
                    ${i==="Cancelled"?"bg-yellow-200 text-yellow-600 cursor-not-allowed opacity-60":"bg-yellow-400 text-white hover:bg-yellow-500 scale-105 border-2 border-yellow-500"}
                  `,onClick:()=>E("Cancelled"),disabled:h||i==="Cancelled",type:"button",title:i==="Cancelled"?"Already Cancelled":"Set status to Cancelled",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}),"Set Cancelled"]}),t.jsxs("button",{className:`flex items-center gap-2 px-5 py-2 rounded-lg text-base font-semibold shadow transition
                    ${i==="Created"?"bg-green-200 text-green-600 cursor-not-allowed opacity-60":"bg-green-500 text-white hover:bg-green-600 scale-105 border-2 border-green-600"}
                  `,onClick:()=>E("Created"),disabled:h||i==="Created",type:"button",title:i==="Created"?"Already Created":"Set status to Created",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),"Set Created"]})]})]}),l&&t.jsx("div",{className:"text-xs text-red-600 mb-2",children:l}),w&&t.jsx("div",{className:"text-xs text-green-600 mb-2",children:w})]}),t.jsx("div",{className:"px-8 pb-6 pt-2 border-t border-gray-100 flex justify-end",children:t.jsx("button",{className:"px-4 py-1.5 rounded bg-gray-200 text-gray-700 text-sm font-medium shadow hover:bg-gray-300 transition",onClick:e,type:"button",children:"Close"})})]})})}function ys(){const s=De(),[e,a]=o.useState(1),[n,r]=o.useState(),[i,u]=o.useState(),[h,p]=o.useState(""),[l,d]=o.useState(""),[w,N]=o.useState({}),T=10;o.useEffect(()=>{const c=setTimeout(()=>{d(h)},400);return()=>clearTimeout(c)},[h]);const{data:k=[]}=B({queryKey:["task-classnames"],queryFn:()=>$.getTaskClassNames(),staleTime:5*60*1e3}),v=Array.isArray(k)?k:[],{data:y,isLoading:R,error:m}=B({queryKey:["tasks",e,n,i,l],queryFn:async()=>$.getTasks({page:e,pageSize:T,lifecycleStatus:n,className:i,id:l.trim()||void 0}),retry:2,retryDelay:1e3}),{tasks:g,isConnected:E,lastError:f,updateTask:j,subscribeToTask:U}=ye(),Ne=o.useMemo(()=>Array.from(g.entries()).map(([c,x])=>`${c}:${x.heartbeat}:${x.lifecycleStatus}:${x.updateDateTime}`).join("|"),[g]),Se=o.useMemo(()=>y!=null&&y.items?y.items.map(c=>{const x=w[c.id];if(x)return{...c,...x};const D=g.get(c.id);return D?{...c,...D,className:c.className,createDateTime:c.createDateTime,attachments:c.attachments}:c}):[],[y==null?void 0:y.items,Ne,w]);if(o.useEffect(()=>{if(!(y!=null&&y.items))return;const c=[];return y.items.forEach(x=>{g.has(x.id)||j(x.id,x)}),()=>{c.forEach(x=>x())}},[y==null?void 0:y.items,g,j,U]),m)return console.error("Tasks API error:",m),t.jsxs("div",{className:"space-y-6",children:[t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Tasks"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Monitor and manage task execution"})]})}),t.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:t.jsxs("div",{className:"flex",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(Y,{className:"h-5 w-5 text-red-400"})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Failed to Load Tasks"}),t.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[t.jsx("p",{children:"Unable to fetch task data from the API."}),t.jsxs("p",{className:"mt-2 font-mono text-xs bg-red-100 p-2 rounded",children:["Error: ",m instanceof Error?m.message:"Unknown error"]})]}),t.jsx("div",{className:"mt-4",children:t.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-sm btn-primary",children:"Retry"})})]})]})})]});const ee=[{key:"id",header:"Task ID",sortable:!0,render:c=>t.jsx("span",{className:"font-mono text-sm",children:c})},{key:"className",header:"Type",sortable:!0,render:c=>t.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:c})},{key:"mode",header:"Mode",sortable:!0,render:c=>t.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${c==="Active"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"}`,children:c})},{key:"lifecycleStatus",header:"Status",sortable:!0,render:c=>t.jsx(L,{status:c,animated:!0})},{key:"executor",header:"Executor",sortable:!0,render:c=>t.jsx("span",{className:"text-sm text-gray-900",children:c||"Unassigned"})},{key:"heartbeat",header:"Heartbeat",sortable:!0,render:(c,x)=>{const D=g.get(x.id);let J=(D==null?void 0:D.heartbeat)??c??0;return x.lifecycleStatus==="Finished"&&(J=200),t.jsx("span",{className:`text-sm font-mono ${J>0?"text-green-600":"text-gray-400"}`,children:J})}},{key:"createDateTime",header:"Created",sortable:!0,render:c=>{try{const x=new Date(c);return isNaN(x.getTime())?t.jsx("span",{className:"text-sm text-gray-400",children:"Invalid date"}):t.jsx("span",{className:"text-sm text-gray-500",children:me(x,"MMM dd, HH:mm")})}catch(x){return console.warn("Invalid date value:",c,x),t.jsx("span",{className:"text-sm text-gray-400",children:"Invalid date"})}}},{key:"updateDateTime",header:"Updated",sortable:!0,render:c=>{try{const x=new Date(c);return isNaN(x.getTime())?t.jsx("span",{className:"text-sm text-gray-400",children:"Invalid date"}):t.jsx("span",{className:"text-sm text-gray-500",children:me(x,"MMM dd, HH:mm")})}catch(x){return console.warn("Invalid date value:",c,x),t.jsx("span",{className:"text-sm text-gray-400",children:"Invalid date"})}}}],[te,X]=o.useState(null);function Ce(c){return c&&typeof c=="object"&&typeof c.id=="string"&&typeof c.className=="string"}const Te=[void 0,"Created","Assigning","Running","Paused","Finished","Failed","Cancelled"];return ee.push({key:"actions",header:"Actions",sortable:!1,render:(c,x)=>Ce(x)?t.jsxs("button",{className:"inline-flex items-center px-3 py-1 rounded bg-primary-500 text-white text-xs font-medium shadow hover:bg-primary-600 transition",style:{minWidth:70,minHeight:28},onClick:()=>{console.log("Details button clicked, row:",x),X(x)},children:[t.jsx("svg",{className:"w-4 h-4 mr-1",fill:"none",stroke:"currentColor",strokeWidth:"2",viewBox:"0 0 24 24",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 12H9m12 0A9 9 0 11 3 12a9 9 0 0118 0z"})}),"Details"]}):t.jsx("span",{className:"text-xs text-gray-400",children:"N/A"})}),t.jsxs("div",{className:"space-y-6 w-full",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Tasks"}),t.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Monitor and manage task execution"})]}),t.jsxs("div",{className:"flex items-center space-x-4 flex-nowrap",children:[t.jsxs("div",{className:"flex items-center space-x-2 flex-shrink-0 min-w-max",children:[t.jsx(xe,{className:`h-5 w-5 ${E?"text-green-500":"text-red-500"}`}),t.jsx("span",{className:`text-sm font-medium ${E?"text-green-700":"text-red-700"}`,children:E?"Live Updates":"Disconnected"}),f&&t.jsx("span",{className:"text-xs text-red-500",title:f.message,children:"(Error)"})]}),t.jsxs("div",{className:"flex flex-1 items-center space-x-2",children:[t.jsx("input",{type:"text",value:h,onChange:c=>p(c.target.value),placeholder:"Filter by Task ID",className:"block rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm px-3 py-2 w-full",style:{paddingLeft:"0.75rem",paddingRight:"0.75rem",paddingTop:"0.5rem",paddingBottom:"0.5rem"}}),t.jsxs("select",{value:i||"",onChange:c=>u(c.target.value||void 0),className:"block rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm w-full",children:[t.jsx("option",{value:"",children:"All Types"}),v.map(c=>t.jsx("option",{value:c,children:c},c))]}),t.jsx("select",{value:n||"",onChange:c=>r(c.target.value||void 0),className:"block rounded-md border-gray-300 shadow-sm focus:border-primary-500 focus:ring-primary-500 sm:text-sm w-full",children:Te.map(c=>t.jsx("option",{value:c||"",children:c||"All Status"},c||"all"))})]})]})]}),t.jsx(pe,{data:Se,columns:ee,loading:R,pagination:{page:e,pageSize:T,total:(y==null?void 0:y.total)||0,onPageChange:a}}),te&&t.jsx(bs,{task:te,onClose:()=>X(null),onUpdated:c=>{console.log("Task updated:",c),c&&c.id&&(N(x=>({...x,[c.id]:{...x[c.id],...c,lifecycleStatus:c.lifecycleStatus,updateDateTime:c.updateDateTime,attachments:c.attachments}})),s.setQueryData(["tasks",e,n,i,l],x=>x!=null&&x.items?{...x,items:x.items.map(D=>D.id===c.id?{...D,...c}:D)}:x),j(c.id,c)),X(null)}})]})}function ws(){return t.jsx(ut,{children:t.jsx(nt,{children:t.jsxs($e,{children:[t.jsx(z,{path:"/",element:t.jsx(ct,{})}),t.jsx(z,{path:"/skalds",element:t.jsx(mt,{})}),t.jsx(z,{path:"/tasks",element:t.jsx(ys,{})})]})})})}class ks extends o.Component{constructor(){super(...arguments);C(this,"state",{hasError:!1})}static getDerivedStateFromError(a){return{hasError:!0,error:a}}componentDidCatch(a,n){console.error("ErrorBoundary caught an error:",a,n)}render(){return this.state.hasError?this.props.fallback?this.props.fallback:t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:t.jsx("div",{className:"max-w-md w-full bg-white shadow-lg rounded-lg p-6",children:t.jsxs("div",{className:"flex items-center",children:[t.jsx("div",{className:"flex-shrink-0",children:t.jsx(Y,{className:"h-8 w-8 text-red-400"})}),t.jsxs("div",{className:"ml-3",children:[t.jsx("h3",{className:"text-lg font-medium text-red-800",children:"Something went wrong"}),t.jsxs("div",{className:"mt-2 text-sm text-red-700",children:[t.jsx("p",{children:"An unexpected error occurred while rendering this page."}),this.state.error&&t.jsx("p",{className:"mt-2 font-mono text-xs bg-red-100 p-2 rounded",children:this.state.error.message})]}),t.jsx("div",{className:"mt-4",children:t.jsx("button",{onClick:()=>window.location.reload(),className:"btn btn-sm btn-primary",children:"Reload Page"})})]})]})})}):this.props.children}}const vs=new Oe({defaultOptions:{queries:{staleTime:1e3*60*5,retry:1}}});K.createRoot(document.getElementById("root")).render(t.jsx(We.StrictMode,{children:t.jsx(ks,{children:t.jsx(Pe,{client:vs,children:t.jsx(Re,{basename:"/dashboard",children:t.jsx(ws,{})})})})}));
//# sourceMappingURL=index-B7U4dIS2.js.map
