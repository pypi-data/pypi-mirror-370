image: debian:latest

before_script:
  - apt update
  - apt --assume-yes install libsuitesparse-dev
  - apt --assume-yes install pkg-config
  - apt update
  - apt --assume-yes install libhdf5-dev
  - apt --assume-yes install python3
  - apt --assume-yes install python3-pip python3-venv
  - apt --assume-yes install git


stages:
  - unit
  - tox
  - build

test:
  stage: unit
  script:
    - python3 -m venv gp-api
    - source gp-api/bin/activate; python3 -m pip install tox pytest pytest-cov build numpy
    - source gp-api/bin/activate; make tests
  artifacts:
    paths:
      - test_*.png
    when: always
    expire_in: 4 week

#tox:
#  stage: tox
#  script:
#    - tox
#  only:
#    - master
#    - staging
#  artifacts:
#    paths:
#    - .tox
#    when: always
#    expire_in: 4 week
#
#wheel:
#  stage: build
#  script:
#    - pip3 install --upgrade build
#    - make install
#  only:
#    - master
#  artifacts:
#    paths:
#      - dist
#    when: always
#    expire_in: 4 week
#
after_script:
  - echo "All CI tasks run"
