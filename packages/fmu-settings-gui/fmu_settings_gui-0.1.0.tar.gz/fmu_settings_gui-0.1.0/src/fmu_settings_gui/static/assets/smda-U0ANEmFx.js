import{D as h,r as d,E as m,F as j,C as p,G as y,H as f,j as e,P as S,a as o,J as k,q as A,L as M,K as q,v as F,x as P,M as b,N as u,O as C,B as l,y as O}from"./index-V2L5n8jS.js";import{u as x,L as D}from"./common-qVALfEsR.js";import{D as E}from"./DotProgress-wMMTdDTj.js";import"./useBaseQuery-D8_kRa3T.js";/*! @azure/msal-react v3.0.15 2025-07-08 */function R(s,t){return s.length>0}function T(s){const{accounts:t,inProgress:n}=h();return d.useMemo(()=>n===m.Startup?!1:R(t),[t,n,s])}function _(){return x(j({queryFn:async({queryKey:s,signal:t})=>{var i;let n,r="";try{const a=await y({...s[0],signal:t,throwOnError:!0});n=!0,r=a.data.status??""}catch(a){n=!1,f(a)&&((i=a.response)!=null&&i.data)&&"detail"in a.response.data&&(r=String(a.response.data.detail))}return{status:n,text:r}},queryKey:p(),retry:!1}))}function K(){const{data:s}=x(A()),t="smda_subscription"in s.user_api_keys&&s.user_api_keys.smda_subscription!=="";return e.jsx(o,{children:t?e.jsxs(e.Fragment,{children:["✅ SMDA ",e.jsx("strong",{children:"subscription key"})," is present"]}):e.jsxs(e.Fragment,{children:["⛔ An SMDA ",e.jsx("strong",{children:"subscription key"})," is not present, please"," ",e.jsx(M,{to:"/user/keys",hash:"smda_subscription",children:"add this key"})]})})}function L(s){try{s.loginRedirect({scopes:u})}catch(t){console.error("Error when logging in to SSO: ",t),O.error(String(t))}}function H(s,t){t({body:{id:"smda_api",key:s}})}function v(){const{queryClient:s,accessToken:t}=q.useRouteContext(),{instance:n}=h(),r=T(),{mutate:i,isPending:a}=F({...b(),onSuccess:()=>{s.invalidateQueries({queryKey:p()})},retry:(c,g)=>P(c,g),meta:{errorPrefix:"Error adding access token to session"}});return d.useEffect(()=>{r&&n.acquireTokenSilent({scopes:u}).catch(c=>{if(c instanceof C)return n.acquireTokenRedirect({scopes:u})})},[r,n]),e.jsx(e.Fragment,{children:e.jsx(o,{children:r?e.jsxs(e.Fragment,{children:["✅ You are logged in with SSO and an ",e.jsx("strong",{children:"access token"})," ","is present. Try adding it to the session:"," ",e.jsx(l,{onClick:()=>{H(t,i)},children:a?e.jsx(E,{}):"Add to session"})]}):e.jsxs(e.Fragment,{children:["⛔ An SSO ",e.jsx("strong",{children:"access token"})," is not present, please log in:"," ",e.jsx(l,{onClick:()=>{L(n)},children:"Log in"})]})})})}function w({text:s}){return e.jsxs(e.Fragment,{children:[e.jsx(o,{children:"Required data for accessing SMDA is not present:"}),e.jsx(k,{children:s}),e.jsx(K,{}),e.jsx(v,{})]})}function G(){return e.jsx(e.Fragment,{children:e.jsx(o,{children:"SMDA can be accessed."})})}function I(){const{data:s}=_();return e.jsx(e.Fragment,{children:s.status?e.jsx(G,{}):e.jsx(w,{text:s.text})})}const J=function(){return e.jsxs(e.Fragment,{children:[e.jsx(S,{children:"SMDA"}),e.jsx(d.Suspense,{fallback:e.jsx(D,{}),children:e.jsx(I,{})})]})};export{J as component};
