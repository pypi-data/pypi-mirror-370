# <!-- Powered by JTECH™ Core -->
template:
  id: brownfield-architecture-template-v2
  name: Arquitetura de Melhoria Brownfield
  version: 2.0
  output:
    format: markdown
    filename: docs/architecture.md
    title: "Arquitetura de Melhoria Brownfield {{project_name}}"

workflow:
  mode: interactive
  elicitation: advanced-elicitation

sections:
  - id: introduction
    title: Introdução
    instruction: |
      IMPORTANTE - ESCOPO E AVALIAÇÃO NECESSÁRIOS:

      Este documento de arquitetura é para melhorias SIGNIFICATIVAS de projetos existentes que requerem planejamento arquitetônico abrangente. Antes de prosseguir:

      1. **Verificar Complexidade**: Confirme que esta melhoria requer planejamento arquitetônico. Para adições simples, recomende: "Para mudanças mais simples que não requerem planejamento arquitetônico, considere usar a tarefa brownfield-create-epic ou brownfield-create-story com o Product Owner."

      2. **ENTRADAS OBRIGATÓRIAS**:
         - brownfield-prd.md completo
         - Documentação técnica do projeto existente (da pasta docs ou fornecida pelo usuário)
         - Acesso à estrutura do projeto existente (IDE ou arquivos carregados)

      3. **MANDATO DE ANÁLISE PROFUNDA**: Você DEVE conduzir análise completa do codebase existente, padrões arquiteturais e restrições técnicas antes de fazer QUALQUER recomendação arquitetônica. Toda sugestão deve ser baseada em análise real do projeto, não suposições.

      4. **VALIDAÇÃO CONTÍNUA**: Durante todo este processo, valide explicitamente seu entendimento com o usuário. Para cada decisão arquitetônica, confirme: "Baseado na minha análise do seu sistema existente, recomendo [decisão] porque [evidência do projeto real]. Isso está alinhado com a realidade do seu sistema?"

      Se alguma entrada obrigatória estiver faltando, solicite-a antes de prosseguir.
    elicit: true
    sections:
      - id: intro-content
        content: |
          Este documento delineia a abordagem arquitetônica para melhorar {{project_name}} com {{enhancement_description}}. Seu objetivo principal é servir como o blueprint arquitetônico orientador para desenvolvimento orientado por IA de novas funcionalidades, garantindo integração perfeita com o sistema existente.

          **Escopo da Melhoria:**
          {{enhancement_scope}}

          **Relacionamento com Arquitetura Existente:**
          Este documento trabalha em conjunto com a arquitetura existente do sistema, documentando apenas as mudanças, adições e considerações específicas para a melhoria proposta.

      - id: existing-system-analysis
        title: Análise do Sistema Existente
        instruction: |
          MANDATÓRIO: Análise completa do sistema atual antes de propor qualquer mudança. Use evidência específica do código e configurações reais.
        elicit: true
        sections:
          - id: current-architecture
            title: Arquitetura Atual
            instruction: |
              Analise e documente a arquitetura atual baseada na inspeção real do código e documentação. NÃO faça suposições.
            template: |
              **Stack Tecnológica Atual:**
              {{current_tech_stack}}

              **Padrões Arquiteturais em Uso:**
              {{current_architectural_patterns}}

              **Estrutura de Pastas Existente:**
              ```
              {{current_folder_structure}}
              ```

              **Componentes Principais:**
              {{current_main_components}}

              **Fluxos de Dados Existentes:**
              {{current_data_flows}}

          - id: integration-points
            title: Pontos de Integração
            template: |
              **APIs e Interfaces Existentes:**
              {{existing_apis}}

              **Banco de Dados e Esquemas:**
              {{existing_database_schemas}}

              **Serviços Externos e Dependências:**
              {{external_dependencies}}

              **Padrões de Autenticação/Autorização:**
              {{existing_auth_patterns}}

          - id: constraints-limitations
            title: Restrições e Limitações
            template: |
              **Restrições Técnicas:**
              {{technical_constraints}}

              **Limitações de Arquitetura:**
              {{architectural_limitations}}

              **Dependências Legadas:**
              {{legacy_dependencies}}

              **Considerações de Performance:**
              {{performance_considerations}}

  - id: enhancement-architecture
    title: Arquitetura da Melhoria
    instruction: |
      Projete a arquitetura específica para a melhoria, garantindo compatibilidade total com o sistema existente.
    sections:
      - id: enhancement-overview
        title: Visão Geral da Melhoria
        template: |
          **Objetivos Arquiteturais:**
          {{architectural_objectives}}

          **Novos Componentes:**
          {{new_components}}

          **Componentes Modificados:**
          {{modified_components}}

          **Pontos de Integração:**
          {{integration_strategy}}

      - id: detailed-implementation
        title: Implementação Detalhada
        sections:
          - id: new-modules
            title: Novos Módulos/Serviços
            template: |
              **Módulos a Serem Criados:**
              {{new_modules}}

              **Estrutura de Pastas para Novos Componentes:**
              ```
              {{new_folder_structure}}
              ```

          - id: data-layer-changes
            title: Mudanças na Camada de Dados
            template: |
              **Novas Tabelas/Entidades:**
              {{new_data_entities}}

              **Modificações de Esquema:**
              {{schema_modifications}}

              **Estratégia de Migração:**
              {{migration_strategy}}

          - id: api-changes
            title: Mudanças de API
            template: |
              **Novos Endpoints:**
              {{new_endpoints}}

              **Modificações de Endpoints Existentes:**
              {{modified_endpoints}}

              **Versionamento de API:**
              {{api_versioning_strategy}}

  - id: integration-strategy
    title: Estratégia de Integração
    template: |
      **Abordagem de Integração:**
      {{integration_approach}}

      **Pontos de Acoplamento:**
      {{coupling_points}}

      **Compatibilidade com Versões Anteriores:**
      {{backward_compatibility}}

      **Estratégia de Deploy:**
      {{deployment_strategy}}

  - id: testing-validation
    title: Testes e Validação
    template: |
      **Estratégia de Testes para Melhorias:**
      {{enhancement_testing_strategy}}

      **Testes de Regressão:**
      {{regression_testing}}

      **Testes de Integração:**
      {{integration_testing}}

      **Critérios de Validação:**
      {{validation_criteria}}

  - id: rollout-plan
    title: Plano de Rollout
    template: |
      **Fases de Implementação:**
      {{implementation_phases}}

      **Estratégia de Feature Flags:**
      {{feature_flag_strategy}}

      **Plano de Rollback:**
      {{rollback_plan}}

      **Monitoramento de Deploy:**
      {{deployment_monitoring}}

  - id: risk-mitigation
    title: Riscos e Mitigação
    template: |
      **Riscos Específicos da Integração:**
      {{integration_risks}}

      **Riscos de Compatibilidade:**
      {{compatibility_risks}}

      **Estratégias de Mitigação:**
      {{mitigation_strategies}}

      **Planos de Contingência:**
      {{contingency_plans}}

  - id: future-evolution
    title: Evolução Futura
    template: |
      **Preparação para Melhorias Futuras:**
      {{future_enhancement_preparation}}

      **Pontos de Extensão:**
      {{extension_points}}

      **Refatoração Recomendada:**
      {{recommended_refactoring}}

validation:
  required_sections:
    - existing-system-analysis
    - enhancement-architecture
    - integration-strategy
    - testing-validation
  
  review_prompts:
    - "A análise do sistema existente é baseada em evidência real do código?"
    - "A integração proposta preserva a funcionalidade existente?"
    - "Os riscos de compatibilidade foram adequadamente identificados?"
    - "A estratégia de testes cobre cenários de regressão?"
    - "O plano de rollout é incremental e seguro?"
