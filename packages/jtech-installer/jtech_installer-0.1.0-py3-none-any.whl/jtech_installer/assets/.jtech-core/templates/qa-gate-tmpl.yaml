# <!-- Powered by JTECH™ Core -->
template:
  id: qa-gate-template-v1
  name: Decisão de Gate de Qualidade
  version: 1.0
  output:
    format: yaml
    filename: qa.qaLocation/gates/{{epic_num}}.{{story_num}}-{{story_slug}}.yml
    title: "Gate de Qualidade: {{epic_num}}.{{story_num}}"

# Campos obrigatórios (mantenha-os primeiro)
schema: 1
story: "{{epic_num}}.{{story_num}}"
story_title: "{{story_title}}"
gate: "{{gate_status}}" # PASS|CONCERNS|FAIL|WAIVED
status_reason: "{{status_reason}}" # Resumo de 1-2 frases do motivo desta decisão de gate
reviewer: "Quinn (Arquiteto de Testes)"
updated: "{{iso_timestamp}}"

# Sempre presente mas apenas ativo quando WAIVED
waiver: { active: false }

# Issues (se houver) - Use severidade fixa: low | medium | high
top_issues: []

# Resumo de riscos (da tarefa risk-profile se executada)
risk_summary:
  totals: { critical: 0, high: 0, medium: 0, low: 0 }
  recommendations:
    must_fix: []
    monitor: []

# Seção de exemplos usando escalares de bloco para clareza
examples:
  with_issues: |
    top_issues:
      - id: "SEC-001"
        severity: high  # APENAS: low|medium|high
        finding: "Sem limitação de taxa no endpoint de login"
        suggested_action: "Adicionar middleware de limitação de taxa antes da produção"
      - id: "PERF-001"
        severity: medium
        finding: "Consulta de banco de dados não otimizada na busca de usuários"
        suggested_action: "Adicionar índice na coluna email da tabela users"
      - id: "CODE-001"
        severity: low
        finding: "Faltam comentários de documentação em funções públicas"
        suggested_action: "Adicionar JSDoc para todas as funções exportadas"

  with_waiver: |
    gate: WAIVED
    status_reason: "Gate passou com ressalvas menores aceitas pelo PO"
    waiver:
      active: true
      reason: "Problemas de formatação de código serão corrigidos no próximo sprint"
      approver: "João Silva (Product Owner)"
      expires: "2024-03-15"
      conditions: ["Não impacta funcionalidade", "Será corrigido antes do release"]

  risk_summary_example: |
    risk_summary:
      totals: { critical: 0, high: 1, medium: 2, low: 3 }
      recommendations:
        must_fix: 
          - "Implementar autenticação de dois fatores antes do release"
          - "Corrigir vulnerabilidade de SQL injection no módulo de relatórios"
        monitor:
          - "Monitorar performance da consulta de busca em produção"
          - "Acompanhar taxa de erro na integração com API externa"

  comprehensive_example: |
    schema: 1
    story: "1.3"
    story_title: "Sistema de autenticação de usuário"
    gate: CONCERNS
    status_reason: "Funcionalidade implementada mas com questões de segurança que precisam ser endereçadas"
    reviewer: "Quinn (Arquiteto de Testes)"
    updated: "2024-02-15T14:30:00Z"
    
    waiver: { active: false }
    
    top_issues:
      - id: "SEC-002"
        severity: high
        finding: "Senhas não estão sendo hasheadas adequadamente"
        suggested_action: "Implementar bcrypt com salt rounds >= 12"
      - id: "SEC-003"
        severity: medium
        finding: "Falta validação de força de senha"
        suggested_action: "Adicionar validação de complexidade de senha no frontend e backend"
      - id: "TEST-001"
        severity: medium
        finding: "Cobertura de testes insuficiente para cenários de erro"
        suggested_action: "Adicionar testes para casos de falha de autenticação"
    
    risk_summary:
      totals: { critical: 0, high: 1, medium: 2, low: 0 }
      recommendations:
        must_fix: 
          - "Corrigir hashing de senhas antes do deploy"
        monitor:
          - "Acompanhar tentativas de login falhadas"
          - "Monitorar performance do sistema de autenticação"

validation:
  required_fields:
    - schema
    - story
    - story_title
    - gate
    - status_reason
    - reviewer
    - updated
  
  gate_values:
    - PASS
    - CONCERNS  
    - FAIL
    - WAIVED
  
  severity_levels:
    - low
    - medium
    - high
  
  review_prompts:
    - "O status do gate reflete adequadamente a qualidade da implementação?"
    - "Os issues identificados estão classificados com severidade apropriada?"
    - "As ações sugeridas são específicas e acionáveis?"
    - "O resumo de riscos está alinhado com os issues encontrados?"
