import{d as ne,c as G,e as H,f as d,J as Me,V as ue,v as pe,a as de,r,aH as te,h as t,F as me,j as e,H as x,w as o,n as _e,t as z,i as Se,k as fe,B as ve,m as j,a1 as Ie,a2 as ze,x as oe,Q as Ve,Z as Ce,p as $e,aJ as ke,aW as se,aX as le,$ as ie,aY as Le,aZ as Ue,a_ as Re,y as Ae,a$ as De,N as Fe,I as ae,b0 as re,b1 as Ne,A as Pe,E as qe}from"./index-DOdIYOkR.js";import{d as He}from"./exp-BL6mWztX.js";import{u as je}from"./groupDetail-DGDhYZP2.js";import{g as Be,a as Ke,s as Oe,b as Te,i as Ee,_ as Ge,c as Je,A as Ze,d as Qe,F as We}from"./FileSaver.min-DxebSpbo.js";import{_ as Xe}from"./DynamicForm.vue_vue_type_script_setup_true_lang-r8iZL3AR.js";import{i as Ye}from"./json-editor-vue-BF_1KIfc.js";import{_ as ea,a as aa}from"./FormItem-BXNzH03D.js";import{a as ge,b as he}from"./Tabs-dCRhCvDT.js";import{A as ta}from"./Add-C39WCOkR.js";import"./index-CJcxqf5R.js";import"./Copy16Filled-B0aEZLoO.js";import"./HandRight24Filled-h8AfnU-s.js";import"./Popconfirm-D4ZFjBKK.js";import"./InputNumber-jEPipemT.js";import"./Add-Cl6tY5vX.js";import"./Alert-CGrj_oNe.js";import"./debounce-HnRb9GPW.js";const sa={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},na=ne({name:"FormNew24Regular",render:function(A,m){return H(),G("svg",sa,m[0]||(m[0]=[d("g",{fill:"none"},[d("path",{d:"M5.75 3A2.75 2.75 0 0 0 3 5.75v12.5A2.75 2.75 0 0 0 5.75 21h6.272a6.471 6.471 0 0 1-.709-1.5H5.75c-.69 0-1.25-.56-1.25-1.25V5.75c0-.69.56-1.25 1.25-1.25h12.5c.69 0 1.25.56 1.25 1.25v5.563a6.471 6.471 0 0 1 1.5.709V5.75A2.75 2.75 0 0 0 18.25 3H5.75zm12.207 8.016a.749.749 0 0 0-.703-1.014H12.25a.75.75 0 0 0 0 1.5h2.742a6.48 6.48 0 0 1 2.965-.486zM8.25 8.502a2.25 2.25 0 1 0 0 4.5a2.25 2.25 0 0 0 0-4.5zm-.75 2.25a.75.75 0 1 1 1.5 0a.75.75 0 0 1-1.5 0zM6 16.25a2.25 2.25 0 1 1 4.5 0a2.25 2.25 0 0 1-4.5 0zm2.25-.75a.75.75 0 1 0 0 1.5a.75.75 0 0 0 0-1.5zm9.004-8h-10.5a.75.75 0 1 1 0-1.5h10.5a.75.75 0 0 1 0 1.5zM23 17.5a5.5 5.5 0 1 0-11 0a5.5 5.5 0 0 0 11 0zm-4.999 3.003a.5.5 0 1 1-1 0V18h-2.505a.5.5 0 1 1 0-1H17v-2.5a.5.5 0 1 1 1 0V17h2.503a.5.5 0 1 1 0 1h-2.502v2.503z",fill:"currentColor"})],-1)]))}}),oa={class:"text-xl text-center"},la={class:"flex justify-end mt-5"},ia={class:"text-xl text-center pb-2"},ra={class:"flex justify-end pt-3 pr-5"},ca={class:"flex justify-end mt-5"},ua=ne({__name:"SpaceModal",props:{spaceId:{}},emits:["success"],setup(J,{expose:A,emit:m}){const B=Me({}),D=J,K=ue(),F=pe(),{t:l}=de(),N=m,h=r(),_=r({space_name:void 0,description:void 0}),Z=r({space_name:{required:!0,message:l("common.required")},description:{required:!0,message:l("common.required")}}),V=r(!1),C=r(!1),$=r(!1),w=r(),k=r(),b=r(),y=r(),M=r(!1),I=r(!1),L=r(!1),E=()=>{L.value=!1,_.value={space_name:void 0,description:void 0}},s=()=>{I.value=!1,M.value=!1,b.value=void 0,k.value=void 0},n=i=>{i||E()},c=i=>{i||s()},f=i=>{i||(M.value=!1,b.value=void 0)},U=async()=>{const[i,a]=await Be();!i&&(a==null?void 0:a.status)===0&&(w.value=a.data,y.value=Object.keys(a.data||{})[0],se(()=>{S(y.value)}))},S=async i=>{const[a,u]=await Ke({initializer_name:i});!a&&(u==null?void 0:u.status)===0&&(k.value=u.data)},O=i=>{S(i)},P=async i=>{var R;if(V.value)return;V.value=!0;const a=await((R=B[i])==null?void 0:R.submit()),u=le(a);if(ie(u)){V.value=!1;return}M.value=!0;const[v,p]=await Oe({device_group_name:F.query.device_group_name,space_id:D.spaceId,initializer_name:y.value,setting:u});V.value=!1,!v&&(p==null?void 0:p.status)===0&&(b.value=p.data)},Q=async i=>{var R;if(C.value)return;C.value=!0;const a=await((R=B[i])==null?void 0:R.submit()),u=le(a);if(ie(u)){C.value=!1;return}const[v,p]=await Te({device_group_name:F.query.device_group_name,space_id:D.spaceId,initializer_name:y.value,setting:u});C.value=!1,!v&&(p==null?void 0:p.status)===0&&s()},W=async()=>{var i;$.value||($.value=!0,(i=h.value)==null||i.validate(async a=>{var p;if(a){$.value=!1;return}const[u,v]=await Ee({device_group_name:F.query.device_group_name,..._.value});$.value=!1,!u&&(v==null?void 0:v.status)===0&&(E(),N("success",(p=v.data)==null?void 0:p.space_id))}))};return te(I,i=>{i&&U()},{immediate:!0}),A({openInitialLizerModal:()=>I.value=!0,openAddModal:()=>L.value=!0}),(i,a)=>{const u=Se,v=fe,p=aa,R=ea,X=ve,Y=_e,ee=me,we=Ce,ye=Ve,xe=he,be=ge;return H(),G("div",null,[t(ee,{show:e(L),"onUpdate:show":a[2]||(a[2]=g=>x(L)?L.value=g:null),onUpdateShow:n},{default:o(()=>[t(Y,{style:{width:"700px",height:"320px","padding-top":"0"}},{default:o(()=>[d("div",oa,z(e(l)("groupDetail.parameterManager.createSpace")),1),t(u,{class:"!my-3"}),t(R,{ref_key:"addFormRef",ref:h,model:e(_),rules:e(Z)},{default:o(()=>[t(p,{label:e(l)("groupDetail.parameterManager.spaceName"),path:"space_name"},{default:o(()=>[t(v,{value:e(_).space_name,"onUpdate:value":a[0]||(a[0]=g=>e(_).space_name=g)},null,8,["value"])]),_:1},8,["label"]),t(p,{label:e(l)("groupDetail.parameterManager.description"),path:"description"},{default:o(()=>[t(v,{value:e(_).description,"onUpdate:value":a[1]||(a[1]=g=>e(_).description=g)},null,8,["value"])]),_:1},8,["label"])]),_:1},8,["model","rules"]),d("div",la,[t(X,{type:"primary",loading:e($),onClick:W},{default:o(()=>[j(z(e(l)("common.OK")),1)]),_:1},8,["loading"])])]),_:1})]),_:1},8,["show"]),t(ee,{show:e(I),"onUpdate:show":a[6]||(a[6]=g=>x(I)?I.value=g:null),"onOnUpdate:show":c},{default:o(()=>[t(Y,{style:{width:"800px","min-height":"600px",height:"80vh","padding-top":"0"}},{default:o(()=>[d("div",ia,z(e(l)("groupDetail.parameterManager.paramsTpl")),1),t(be,{type:"card",placement:"left",value:e(y),"onUpdate:value":a[5]||(a[5]=g=>x(y)?y.value=g:null),onUpdateValue:O},{default:o(()=>[(H(!0),G(Ie,null,ze(e(w),(g,q)=>(H(),oe(xe,{key:q,tab:g.title,name:q},{default:o(()=>[t(ye,{class:"pt-3 pl-4 pb-4"},{default:o(()=>[t(we,{style:{"max-height":"calc(80vh - 140px)","padding-right":"20px"}},{default:o(()=>[e(k)?(H(),oe(Xe,{ref_for:!0,ref:T=>e(B)[q]=T,cfgs:e(k),key:q},null,8,["cfgs"])):$e("",!0)]),_:2},1024),d("div",ra,[t(X,{type:"primary",loading:e(V),onClick:()=>P(q)},{default:o(()=>[j(z(e(l)("common.OK")),1)]),_:2},1032,["loading","onClick"])]),t(ee,{show:e(M),"onUpdate:show":a[4]||(a[4]=T=>x(M)?M.value=T:null),"onOnUpdate:show":f},{default:o(()=>[t(Y,{style:{width:"700px"}},{default:o(()=>[a[7]||(a[7]=d("div",{class:"mb-5 text-xl text-center"},"Preview",-1)),t(e(Ye),{class:ke(["w-full overflow-auto",[e(K).baseColor==="#000"?"jse-theme-dark":""]]),style:{height:"calc(80vh - 100px)"},disabled:"",modelValue:e(b),"onUpdate:modelValue":a[3]||(a[3]=T=>x(b)?b.value=T:null),mode:"text"},null,8,["class","modelValue"]),d("div",ca,[t(X,{type:"primary",loading:e(C),onClick:()=>Q(q)},{default:o(()=>[j(z(e(l)("common.submit")),1)]),_:2},1032,["loading","onClick"])])]),_:2},1024)]),_:2},1032,["show"])]),_:2},1024)]),_:2},1032,["tab","name"]))),128))]),_:1},8,["value"])]),_:1})]),_:1},8,["show"])])}}}),pa={class:"flex flex-1 items-center justify-between gap-2"},da={class:"flex gap-2 items-center"},ma={class:"relative"},_a={class:"flex items-center gap-2"},ce="spid",fa=ne({__name:"ParamManager",setup(J){const A=pe(),{t:m}=de(),B=ue(),D=je(),K=r(),F=r(!1),l=r(),N=r(!1),h=r(!1);te(()=>D.spaceList,s=>{if(!s||h.value)return;const n=(S,O)=>s==null?void 0:s.find(P=>P[O]==S),c=Le(ce),{space_name:f,space_id:U}=A.query;if(F.value&&n(c,"space_id"))l.value=c,h.value=!0;else if(U&&n(U,"space_id"))l.value=+U,h.value=!0;else if(f&&n(f,"space_name")){const S=n(f,"space_name");l.value=S?+S.space_id:void 0,h.value=!0}else c&&n(c,"space_id")?(l.value=+c,h.value=!0):s[0]&&(l.value=+s[0].space_id,h.value=!0)},{immediate:!0});const _=r(),Z=()=>{},V=s=>ae("div",{class:"flex gap-3 items-baseline"},[ae("div",{class:"text-base"},`${s.space_name||""}`),ae("div",{class:"text-xs opacity-50"},s.create_time?`[${new Date(s.create_time).toLocaleString()}] ${s.description||""}`:"")]),C=()=>{var s;(s=K.value)==null||s.openAddModal()},$=()=>{var s;(s=K.value)==null||s.openInitialLizerModal()},w=r(),k=()=>{var s;(s=w.value)!=null&&s.trim()&&(N.value=!0)},b=r(),y=r(),M=()=>{var s,n;(s=b.value)==null||s.refresh(),(n=y.value)==null||n.refresh()},I=async()=>{var c;const[s,n]=await He({group_name:A.query.device_group_name,space_id:l.value});!s&&(n==null?void 0:n.status)===0&&We.saveAs(`${re(location.origin)}/${re((c=n==null?void 0:n.data)==null?void 0:c.filename)}`,Ne(n.data.filename))},L=async()=>{const[s,n]=await Pe({device_group_name:A.query.device_group_name});if(!s&&(n==null?void 0:n.status)===0){const{space_list:c}=n.data;h.value=!1,D.spaceList=c.map(f=>({...f,label:f.space_name,value:f.space_id})),se(()=>{M()})}},E=s=>{l.value=s,se(()=>{F.value=!0,L()})};return te(l,s=>{s&&localStorage.setItem(ce,s)}),(s,n)=>{const c=ve,f=Ue,U=fe,S=Ae,O=Fe,P=he,Q=ge,W=_e,i=me;return H(),G("div",null,[t(Q,{type:"card",animated:"",onUpdateValue:Z,value:e(_),"onUpdate:value":n[2]||(n[2]=a=>x(_)?_.value=a:null),class:"!h-full"},{suffix:o(()=>[d("div",pa,[d("div",da,[t(f,{trigger:"hover"},{trigger:o(()=>[t(c,{type:"primary",class:"!ml-1",onClick:I},{icon:o(()=>[t(e(Ze))]),_:1})]),default:o(()=>[j(" "+z(e(m)("expInfo.downloadSpaceParams")),1)]),_:1}),d("div",ma,[t(U,{style:{width:"310px","padding-right":"20px"},value:e(w),"onUpdate:value":n[0]||(n[0]=a=>x(w)?w.value=a:null),valueModifiers:{trim:!0},onKeyup:Re(k,["enter"]),placeholder:e(m)("groupDetail.parameterManager.searchPlaceholder")},null,8,["value","placeholder"]),d("div",{class:"absolute -right-4 top-1/2 -translate-1/2 h-full w-8 flex items-center justify-center cursor-pointer",onClick:k},[t(S,{color:e(B).primaryColor,component:e(De)},null,8,["color","component"])])])]),d("div",_a,[t(O,{options:e(D).spaceList,"render-label":V,value:e(l),"onUpdate:value":n[1]||(n[1]=a=>x(l)?l.value=a:null)},null,8,["options","value"]),t(c,{size:"small",type:"primary",class:"!h-[34px]",onClick:$},{icon:o(()=>[t(e(na))]),default:o(()=>[j(" "+z(e(m)("groupDetail.parameterManager.initSpaceParams")),1)]),_:1}),t(c,{size:"small",type:"primary",class:"!h-[34px]",onClick:C},{icon:o(()=>[t(e(ta))]),default:o(()=>[j(" "+z(e(m)("groupDetail.parameterManager.createSpace")),1)]),_:1})])])]),default:o(()=>[t(P,{name:"globalLatest","tab-type":"latest",tab:e(m)("groupDetail.parameterManager.globalLatest")},{default:o(()=>[t(Ge,{"space-id":e(l),ref_key:"paramsLatestRef",ref:b},null,8,["space-id"])]),_:1},8,["tab"]),t(P,{name:"globalHistory",tab:e(m)("groupDetail.parameterManager.globalHistory")},{default:o(()=>[t(Je,{"space-id":e(l),ref_key:"paramsHistoryRef",ref:y},null,8,["space-id"])]),_:1},8,["tab"])]),_:1},8,["value"]),t(ua,{ref_key:"spaceModalRef",ref:K,"space-id":e(l),onSuccess:E},null,8,["space-id"]),t(i,{show:e(N),"onUpdate:show":n[4]||(n[4]=a=>x(N)?N.value=a:null),size:"huge"},{default:o(()=>[t(W,{style:{"min-height":"400px",overflow:"auto",width:"1300px","max-width":"95vw","min-width":"500px"}},{default:o(()=>[t(Qe,{search:"","space-id":e(l),"hide-history-option":"",modelValue:e(w),"onUpdate:modelValue":n[3]||(n[3]=a=>x(w)?w.value=a:null),onRefresh:M},null,8,["space-id","modelValue"])]),_:1})]),_:1},8,["show"])])}}}),Ra=qe(fa,[["__scopeId","data-v-4193f8f8"]]);export{Ra as default};
