import{d as ne,c as q,e as m,f as w,r as V,v as Oe,b as Pe,W as qe,V as Me,a as $e,C as ye,aa as ve,I as U,N as ze,k as Ae,a6 as Fe,B as F,aI as je,y as Le,o as Be,$ as ae,bI as Ke,h as N,w as b,a1 as se,a2 as le,j as t,x as P,Q as De,H as be,t as E,a7 as Je,p as G,Z as He,m as B,Y as Ge,aN as We,i as Ye,S as Qe,b4 as Xe,M as Ze,n as Se,aJ as et,F as tt,aW as Q,aX as at}from"./index-DOdIYOkR.js";import{r as st,g as lt,t as nt,u as ot,v as ut,w as it,x as ct}from"./exp-BL6mWztX.js";import{_ as rt}from"./DynamicForm.vue_vue_type_script_setup_true_lang-r8iZL3AR.js";import{i as dt}from"./json-editor-vue-BF_1KIfc.js";import{u as _t}from"./exp-DwbafzoG.js";import{c as ft}from"./index-CJcxqf5R.js";import{N as mt}from"./InputNumber-jEPipemT.js";import{b as pt,a as yt}from"./Tabs-dCRhCvDT.js";import{_ as vt}from"./Popconfirm-D4ZFjBKK.js";import"./FormItem-BXNzH03D.js";import"./Alert-CGrj_oNe.js";import"./debounce-HnRb9GPW.js";import"./Add-Cl6tY5vX.js";const bt={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 24 24"},gt=ne({name:"ArrowReset24Regular",render:function(z,v){return m(),q("svg",bt,v[0]||(v[0]=[w("g",{fill:"none"},[w("path",{d:"M6.78 2.72a.75.75 0 0 1 0 1.06L4.56 6h8.69a7.75 7.75 0 1 1-7.75 7.75a.75.75 0 0 1 1.5 0a6.25 6.25 0 1 0 6.25-6.25H4.56l2.22 2.22a.75.75 0 1 1-1.06 1.06l-3.5-3.5a.75.75 0 0 1 0-1.06l3.5-3.5a.75.75 0 0 1 1.06 0z",fill:"currentColor"})],-1)]))}}),ht={xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",viewBox:"0 0 32 32"},wt=ne({name:"Edit",render:function(z,v){return m(),q("svg",ht,v[0]||(v[0]=[w("path",{d:"M2 26h28v2H2z",fill:"currentColor"},null,-1),w("path",{d:"M25.4 9c.8-.8.8-2 0-2.8l-3.6-3.6c-.8-.8-2-.8-2.8 0l-15 15V24h6.4l15-15zm-5-5L24 7.6l-3 3L17.4 7l3-3zM6 22v-3.6l10-10l3.6 3.6l-10 10H6z",fill:"currentColor"},null,-1)]))}}),kt={class:"flex gap-3"},xt={class:"w-64 pl-2"},Ct={class:"mb-5"},It={class:"text-xl"},Rt={class:"text-sm opacity-80"},Vt={key:0,class:"text-right mt-2"},Nt={class:"flex justify-between items-center mb-2"},Et={class:"flex-1"},Ut={key:0},Tt={class:"text-xl"},Ot={class:"opacity-75 italic pl-2"},Pt={key:1,class:"text-xl"},qt={key:0,class:"flex gap-2"},Mt={class:"mt-4 mb-2 text-xl"},$t={class:"flex justify-end mt-5 gap-2"},f="__SPACE_PARAMETER_UPDATING__",zt="__SELECTED_SPACE_PARAMETER_UPDATING__",Xt=ne({__name:"ExpRunResult",setup(oe){const z=V(!1),v=Oe(),ge=Pe(),he=qe(),ue=Me(),e=_t(),{t:I}=$e(),X=V(),A=V({show:!1}),j=V(!1),W=V(!1),K=V(!1),D=V(!1),we=[{label:"str",value:"str"},{label:"int",value:"int"},{label:"float",value:"float"},{label:"bool",value:"bool"},{label:"list",value:"list"},{label:"tuple",value:"tuple"},{label:"dict",value:"dict"},{label:"complex",value:"complex"},{label:"ndarray",value:"ndarray"}],L=V(),ie=V(),ce=V(),ke=async()=>{var u,a;const[o,s]=await st();if(!o&&(s==null?void 0:s.status)===0){ce.value=s.data;const[d]=(a=(u=e==null?void 0:e.expInfo)==null?void 0:u.exp)!=null&&a.template?e.expInfo.exp.template.split("/"):"";d&&s.data[d]?(L.value=d,Q(()=>{S(d,!0)})):(L.value=Object.keys(s.data)[0],Q(()=>{S(Object.keys(s.data)[0])}))}},re=async()=>{var u,a,d;if(!v.query.exp_id)return;const[o,s]=await lt({exp_id:v.query.exp_id,device_group_name:v.query.device_group_name,space_id:v.query.space_id});if(!o&&(s==null?void 0:s.status)===0){if((u=s.data)!=null&&u.data){s.data.data=JSON.parse(s.data.data);const i=(a=s.data.data)!=null&&a.tables?(d=s.data.data)==null?void 0:d.tables[f]:null;i&&(i.crows=i.rows)}e.result=s.data}},de=ye(()=>{var s,u;const o=[];return(s=e.result)!=null&&s.data&&ve((u=e.result.data)==null?void 0:u.tables,a=>{const d=a.rows.map(c=>{var r;const l={};return(r=a.columns)==null||r.forEach((n,_)=>{l[n.name]=typeof c[_]!==void 0?`${c[_]}`:c[_]}),l}),i=a.columns.map((c,l)=>{const r={...c,title:c.name,key:c.name};return c.name==="key"?{...r,minWidth:200}:c.name==="type"&&a.name===f?{...r,width:200,render(n,_){if(z.value){const k=a.crows?a.crows[_][l]:null;return U(ze,{class:k!=n.type?"!outline !outline-red-500 w-32":"w-32",options:we,value:n.type,onUpdateValue:x=>{var $,C,M,g,h,p,y,R;(C=($=e==null?void 0:e.result)==null?void 0:$.data)!=null&&C.tables&&((g=(M=e==null?void 0:e.result)==null?void 0:M.data)!=null&&g.tables[f])&&(((p=(h=e==null?void 0:e.result)==null?void 0:h.data)==null?void 0:p.tables[f]).rows[_][l]=x,x==="bool"&&(((R=(y=e==null?void 0:e.result)==null?void 0:y.data)==null?void 0:R.tables[f]).rows[_][l+1]=!1))}})}return n.type}}:c.name==="value"&&a.name===f?{...r,render:(n,_)=>{const k=a.crows?a.crows[_][l]:null;if(z.value){const x=U(mt,{value:+n.value,class:k!=n.value?"outline outline-red-500 w-full":"w-full",onUpdateValue(g){var h,p,y,R,T,O;(p=(h=e==null?void 0:e.result)==null?void 0:h.data)!=null&&p.tables&&((R=(y=e==null?void 0:e.result)==null?void 0:y.data)!=null&&R.tables[f])&&(((O=(T=e==null?void 0:e.result)==null?void 0:T.data)==null?void 0:O.tables[f]).rows[_][l]=g)}}),$=U(Ae,{value:String(n.value),class:k!==n.value?"!outline !outline-red-500":"",onUpdateValue(g){var h,p,y,R,T,O;(p=(h=e==null?void 0:e.result)==null?void 0:h.data)!=null&&p.tables&&((R=(y=e==null?void 0:e.result)==null?void 0:y.data)!=null&&R.tables[f])&&(((O=(T=e==null?void 0:e.result)==null?void 0:T.data)==null?void 0:O.tables[f]).rows[_][l]=g)}}),C=U("div",{class:"flex gap-2 h-[34px] leading-[34px]"},[U("div",{class:k!=n.value?"outline outline-red-500":""},U(Fe,{lineClamp:1},{default:()=>n.value})),U(F,{type:"info",size:"tiny",class:"!h-[34px] !w-[34px]",onClick:()=>{A.value={show:!0,info:{rowIdx:_,cidx:l,value:n.value}}}},{icon:()=>U(wt)})]),M=U(je,{class:k!=n.value?"!outline !outline-red-500 w-32":"w-32",checkedValue:"true",uncheckedValue:"false",onUpdateValue:g=>{var h,p,y,R,T,O;(p=(h=e==null?void 0:e.result)==null?void 0:h.data)!=null&&p.tables&&((R=(y=e==null?void 0:e.result)==null?void 0:y.data)!=null&&R.tables[f])&&(((O=(T=e==null?void 0:e.result)==null?void 0:T.data)==null?void 0:O.tables[f]).rows[_][l]=g)}});return U("div",{class:"flex items-center"},ft([["float","int"].includes(n.type)?x:null,["str","complex"].includes(n.type)?$:null,["dict","list","tuple","ndarray"].includes(n.type)?C:null,["bool"].includes(n.type)?M:null]))}return n.value}}:r});z.value&&a.name===f&&i.push({title:I("expInfo.tableOptions"),key:"options",width:100,align:"rigth",render(c,l){const r=a.columns.findIndex(x=>x.name==="type"),n=a.crows?a.crows[l][r]:null,_=a.columns.findIndex(x=>x.name==="value"),k=a.crows?a.crows[l][_]:null;return U(F,{type:"info",size:"small",class:"!h-[34px]",onClick:()=>{var x,$,C,M,g,h,p,y;($=(x=e==null?void 0:e.result)==null?void 0:x.data)!=null&&$.tables&&((M=(C=e==null?void 0:e.result)==null?void 0:C.data)!=null&&M.tables[f])&&(((h=(g=e==null?void 0:e.result)==null?void 0:g.data)==null?void 0:h.tables[f]).rows[l][_]=k,((y=(p=e==null?void 0:e.result)==null?void 0:p.data)==null?void 0:y.tables[f]).rows[l][r]=n)}},{default:()=>I("expInfo.reset"),icon:()=>U(Le,{component:gt})})}}),a.name===f&&z.value&&i.unshift({type:"selection",key:"selection"}),o.push({oname:a.name,name:a.name===f?I("expInfo.needUpdateParams"):a.name===zt?I("expInfo.updatedParams"):a.name,columns:i,rows:d})}),o}),J=V(),Z=V(),S=async(o,s)=>{var d,i,c;const[u,a]=await nt({fitter_group_name:o});if(!u&&(a==null?void 0:a.status)===0){ie.value=a.data;const l=(c=(i=(d=e==null?void 0:e.expInfo)==null?void 0:d.exp)==null?void 0:i.template)==null?void 0:c.split("/")[1];l&&a.data[l]&&s?(J.value=l,Q(()=>{ee(l)})):(J.value=Object.keys(a.data)[0],Q(()=>{ee(Object.keys(a.data)[0])}))}},ee=async o=>{if(j.value)return;j.value=!0;const[s,u]=await ot({fitter_group_name:L.value,fitter_name:o,group_name:v.query.device_group_name,space_id:v.query.space_id});j.value=!1,!s&&(u==null?void 0:u.status)===0&&(u.data.exp_id&&(u.data.exp_id.default=v.query.exp_id?Number(v.query.exp_id):null),Z.value=u.data)},xe=o=>{S(o)},Ce=o=>{ee(o)},Ie=async()=>{var c;if(!X.value||W.value)return;W.value=!0;const o=await((c=X.value[0])==null?void 0:c.submit()),s=at(o);if(ae(s))return;const{device_group_name:u,space_id:a}=v.query,[d,i]=await ut({setting:s,group_name:u,space_id:a,fitter_group:L.value,fitter_name:J.value});if(W.value=!1,!d&&(i==null?void 0:i.status)===0){e.result={...i.data,big_picture_url:"/"+i.data.plot_file_in_static};const[l,r]=await it("/"+i.data.table_file_in_static);l||(z.value=!0,ve(r==null?void 0:r.tables,(n,_)=>{_===f&&(n.crows=JSON.parse(JSON.stringify(n.rows)),Y.value=n.crows.map(k=>k[0]))}),e.result={...e.result||{},data:r})}},te=async(o=!1)=>{var d,i,c,l,r;if(o){if(D.value)return;D.value=!0}else{if(K.value)return;K.value=!0}const s={group_name:v.query.device_group_name,space_id:v.query.space_id,exp_id:v.query.exp_id,task_id:((d=e.expInfo)==null?void 0:d.task_id)||"",img_file:((i=e.result)==null?void 0:i.plot_file)||"",table_file:((c=e.result)==null?void 0:c.table_file)||"",update_space_parameters:o};if(o){const n=(l=de.value)==null?void 0:l.find(_=>_.oname===f);s.space_parameters=(r=Y.value)==null?void 0:r.map(_=>{var k;return(k=n.rows)==null?void 0:k.find(x=>x.key===_)})}const[u,a]=await ct(s);!u&&(a==null?void 0:a.status)===0&&(he.success("Submit Successfully"),await re(),z.value=!1),o?D.value=!1:K.value=!1},Y=V(),Re=o=>{Y.value=o};Be(()=>{if(!v.query.exp_id){ge.back();return}ke(),re()});const Ve=()=>{te()},Ne=ye(()=>{var s,u,a,d,i,c;const o=(u=(s=e.result)==null?void 0:s.data)!=null&&u.tables?(d=(a=e.result)==null?void 0:a.data)==null?void 0:d.tables[f]:null;if(!ae(o)){const l=(i=o.columns)==null?void 0:i.findIndex(r=>r.name==="value");return l<0?!1:(c=o.crows)==null?void 0:c.some((r,n)=>r[l]!==o.rows[n][l])}return!1}),_e=()=>{A.value={show:!1,info:void 0}},Ee=()=>{var a,d,i,c,l,r;const{rowIdx:o,cidx:s,value:u}=A.value.info;(d=(a=e==null?void 0:e.result)==null?void 0:a.data)!=null&&d.tables&&((c=(i=e==null?void 0:e.result)==null?void 0:i.data)!=null&&c.tables[f])&&(((r=(l=e==null?void 0:e.result)==null?void 0:l.data)==null?void 0:r.tables[f]).rows[o][s]=u),_e()};return Ke(()=>{e.result=void 0}),(o,s)=>{const u=He,a=Je,d=We,i=vt,c=Ye,l=Qe,r=Ze,n=pt,_=yt,k=De,x=Se,$=tt;return m(),q("div",null,[N(_,{type:"card",placement:"top",animated:"",onUpdateValue:xe,value:t(L),"onUpdate:value":s[3]||(s[3]=C=>be(L)?L.value=C:null),class:"!h-full"},{default:b(()=>[(m(!0),q(se,null,le(t(ce),(C,M)=>(m(),P(n,{key:M,name:M,tab:C.title,disabled:t(j)},{default:b(()=>[N(k,{class:"p-3 min-h-[260px]"},{default:b(()=>[N(_,{type:"line",placement:"left",value:t(J),"onUpdate:value":s[2]||(s[2]=g=>be(J)?J.value=g:null),size:"small",onUpdateValue:Ce,style:{height:"calc(100vh - 330px)"}},{default:b(()=>[(m(!0),q(se,null,le(t(ie),(g,h)=>(m(),P(n,{key:h,name:h,tab:g.title,disabled:t(j)},{default:b(()=>[w("div",kt,[w("div",xt,[w("div",Ct,[w("div",It,E(g.title),1),w("div",Rt,E(g.desc),1)]),N(a,{show:t(j)},{default:b(()=>{var p,y;return[N(u,{style:{"max-height":"calc(100vh - 330px)"}},{default:b(()=>[t(Z)&&!t(j)?(m(),P(rt,{key:0,cfgs:t(Z),ref_for:!0,ref_key:"dynamicFormRef",ref:X},null,8,["cfgs"])):G("",!0)]),_:1}),(y=(p=t(e))==null?void 0:p.expInfo)!=null&&y.exp_id?(m(),q("div",Vt,[N(t(F),{type:"primary",onClick:Ie,loading:t(W)},{default:b(()=>[B(E(t(I)("expInfo.ffitting")),1)]),_:1},8,["loading"])])):G("",!0)]}),_:1},8,["show"])]),w("div",{class:"flex-1 pl-3",style:Ge({borderLeft:`1px solid ${t(ue).dividerColor}`})},[t(ae)(t(e).result)?(m(),P(d,{key:0,description:t(I)("expInfo.nores"),class:"mt-20"},null,8,["description"])):(m(),P(u,{key:1,style:{"max-height":"calc(100vh - 330px)"}},{default:b(()=>{var p,y,R,T,O,fe,me,pe;return[w("div",Nt,[w("div",Et,[!((p=t(e).result)!=null&&p.plot_file)&&!((y=t(e).result)!=null&&y.table_file)&&((R=t(e).result)!=null&&R.create_time)?(m(),q("div",Ut,[w("span",Tt,E(t(I)("expInfo.resUploaded")),1),w("span",Ot,E((T=t(e).result)==null?void 0:T.create_time),1)])):(m(),q("div",Pt,E(t(I)("expInfo.result")),1))]),(O=t(e).result)!=null&&O.plot_file||(fe=t(e).result)!=null&&fe.table_file?(m(),q("div",qt,[t(Ne)?(m(),P(i,{key:0,onPositiveClick:Ve},{trigger:b(()=>[N(t(F),{loading:t(K),type:"primary",disabled:t(D)},{default:b(()=>[B(E(t(I)("expInfo.uploadOnly")),1)]),_:1},8,["loading","disabled"])]),default:b(()=>[B(" "+E(t(I)("expInfo.updateOnlyTips")),1)]),_:1})):(m(),P(t(F),{key:1,loading:t(K),type:"primary",onClick:s[0]||(s[0]=()=>te()),disabled:t(D)},{default:b(()=>[B(E(t(I)("expInfo.uploadOnly")),1)]),_:1},8,["loading","disabled"])),N(t(F),{loading:t(D),type:"primary",onClick:s[1]||(s[1]=()=>te(!0)),disabled:t(K)},{default:b(()=>[B(E(t(I)("expInfo.uploadAndModifyParams")),1)]),_:1},8,["loading","disabled"])])):G("",!0)]),N(c,{class:"!my-2"}),(me=t(e).result)!=null&&me.big_picture_url?(m(),P(l,{key:0,src:t(Xe)((pe=t(e).result)==null?void 0:pe.big_picture_url,"t",String(+new Date)),alt:"",class:"max-w-full"},null,8,["src"])):G("",!0),(m(!0),q(se,null,le(t(de),(H,Ue)=>(m(),q("div",{key:Ue},[w("div",Mt,E(H.name),1),H.oname===f?(m(),P(r,{key:0,columns:H.columns,data:H.rows,"checked-row-keys":t(Y),"row-key":Te=>Te.key,"onUpdate:checkedRowKeys":Re},null,8,["columns","data","checked-row-keys","row-key"])):(m(),P(r,{key:1,columns:H.columns,data:H.rows},null,8,["columns","data"]))]))),128))]}),_:2},1024))],4)])]),_:2},1032,["name","tab","disabled"]))),128))]),_:2},1032,["value"])]),_:2},1024)]),_:2},1032,["name","tab","disabled"]))),128))]),_:1},8,["value"]),N($,{show:t(A).show,"onUpdate:show":s[5]||(s[5]=C=>t(A).show=C),"mask-closable":!1},{default:b(()=>[N(x,{style:{width:"1000px","min-height":"500px"},size:"huge",bordered:!1},{default:b(()=>[t(A).info?(m(),P(t(dt),{key:0,class:et(["w-full h-[70vh] overflow-auto",[t(ue).baseColor==="#000"?"jse-theme-dark":""]]),modelValue:t(A).info.value,"onUpdate:modelValue":s[4]||(s[4]=C=>t(A).info.value=C),mode:"text"},null,8,["class","modelValue"])):G("",!0),w("div",$t,[N(t(F),{onClick:_e},{default:b(()=>[B(E(t(I)("common.cancel")),1)]),_:1}),N(t(F),{type:"primary",onClick:Ee},{default:b(()=>[B(E(t(I)("common.OK")),1)]),_:1})])]),_:1})]),_:1},8,["show"])])}}});export{Xt as default};
